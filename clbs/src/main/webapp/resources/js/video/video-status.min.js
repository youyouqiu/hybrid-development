!function(v){var e=function(t,e){var n=v.extend({channelHeight:30,channelTitleWidth:null,hourWidth:null,minuteWidth:null,secondWidth:null,halfHourWidth:null,containerWidth:null,thumbContainerWidth:null,channelNum:0,sectionTmpl:'<div class="section">$index<div class="section-half"></div></div>',channelTitleTmpl:'<div class="channel-title">$name</div>',channelTmpl:'<div class="channel"></div>',greenTmpl:'<div class="green"></div>',defaultDate:null,onScale:null,onDragStart:null,onDrag:null,onDragEnd:null,onClick:null,onStart:null,onStop:null,onPause:null,onContinue:null,onPlaying:null,onStatusClick:null},e);return n.channelTitleWidth=parseInt(t.find(".left").css("width")),n.containerWidth=parseInt(t.css("width")),n.thumbContainerWidth=n.containerWidth-n.channelTitleWidth,n.hourWidth=n.thumbContainerWidth/24,n.secondWidth=n.minuteWidth=n.thumbContainerWidth/60,n.thumbWidth=parseInt(t.find(".thumb").css("width")),n.channelNum=n.channels.length,this.$this=t,this.options=n,this.state={intervalHour:0,intervalMinute:0,currentHour:0,currentMinute:0,currentSecond:0,currentChannels:n.channels,timeLevel:"hour",isThumbMoving:!1,timerId:null,speed:1,direction:"forward"},this.initHtml(),this.renderHour(),this.initBind(),this.render(),this};e.prototype.initHtml=function(){var t=this.$this,e=this.options,n=t.find(".channel-title-container"),i=t.find(".channel-container");n.empty();for(var r=0;r<e.channels.length;r++){var o=e.channels[r];n.append(v(e.channelTitleTmpl.replace("$name","通道"+o)).attr("id","channelTitle_"+o))}for(i.empty(),r=0;r<e.channels.length;r++){var a=e.channels[r];i.append(v(e.channelTmpl).attr("id","channel_"+a))}t.find(".line").css("height",e.channelHeight*(r+1)+"px");var s=null,h=e.channelData;if(h&&0<Object.keys(h).length){var u=h[Object.keys(h)[0]];s=0<u.length?new Date(u[0].StartTime.replace(/-/g,"/")):e.defaultDate?e.defaultDate:new Date}else s=e.defaultDate?e.defaultDate:new Date;var l=s.getFullYear()+"-"+(s.getMonth()+1)+"-"+s.getDate();t.find(".day").html(l)},e.prototype.initBind=function(){var h=this,r=this.$this,u=this.options,l=this.state;v(r.find(".ruler")).off("mousewheel DOMMouseScroll").on("mousewheel DOMMouseScroll",function(t){t.preventDefault();var e=t.originalEvent.wheelDelta&&(0<t.originalEvent.wheelDelta?1:-1)||t.originalEvent.detail&&(0<t.originalEvent.detail?-1:1);0<e&&"second"===l.timeLevel||e<0&&"hour"===l.timeLevel||(0<e?("hour"===l.timeLevel?(l.timeLevel="minute",h.renderMinuteSecond()):"minute"===l.timeLevel&&(l.timeLevel="second",h.renderMinuteSecond()),h.updateInterval(t.pageX)):"second"===l.timeLevel?(h.renderMinuteSecond(),l.timeLevel="minute"):"minute"===l.timeLevel&&(h.renderHour(),l.timeLevel="hour"),h.updateIntervalText(),h.onScale())});r.find(".thumb").off("mousedown").on("mousedown",function(t){var i=parseInt(v(this).css("left")),r=t.pageX,o=v(this),a=-u.thumbWidth/2,s=u.thumbContainerWidth-u.thumbWidth-a;l.isThumbMoving=!0,h.onDragStart(),v(document).on("mousemove",function(t){if(l.isThumbMoving){t.preventDefault();var e=t.pageX-r,n=i+e;n<a?o.css("left",a+"px"):s<n?o.css("left",s+"px"):o.css("left",n+"px"),h.updateThumbTime(),h.onDrag()}})}),v(document).off("mouseup").on("mouseup",function(t){l.isThumbMoving&&(v(document).off("mousemove"),l.isThumbMoving=!1,h.onDragEnd())});r.find(".channel-container").off("click").on("click",function(t){var e=r.find(".thumb"),n=r.offset().left,i=t.pageX-(u.channelTitleWidth+n)-u.thumbWidth/2;e.css({left:i+"px",visibility:"visible"}),h.updateThumbTime(),h.onStatusClick()})},e.prototype.renderHour=function(){var t=this.$this.find(".ruler");t.empty();for(var e=this.options,n=0;n<24;n++){var i=v(e.sectionTmpl.replace("$index",n));i.css("width",e.hourWidth+"px").css("left",e.thumbContainerWidth*n/24+"px"),i.attr("id","hourSection_"+n),t.append(i)}return this},e.prototype.renderMinuteSecond=function(){var t=this.$this.find(".ruler");t.empty();for(var e=this.options,n=0;n<60;n++){var i=v(e.sectionTmpl.replace("$index",n));i.css("width",e.minuteWidth+"px").css("left",e.thumbContainerWidth*n/60+"px"),i.attr("id","hourSection_"+n),t.append(i)}return this},e.prototype.updateThumbText=function(){var t=this.$this,e=this.state,n=t.find(".thumb .h"),i=t.find(".thumb .m"),r=t.find(".thumb .s");n.html(this.util.padZero(e.currentHour)+":"),i.html(this.util.padZero(e.currentMinute)+":"),r.html(this.util.padZero(e.currentSecond))},e.prototype.updateThumbTime=function(){var t=this.$this,e=this.options,n=this.state,i=t.find(".thumb"),r=parseInt(i.css("left"))+e.thumbWidth/2,o=0;"hour"===n.timeLevel?(o=86400*r/e.thumbContainerWidth,n.currentHour=parseInt(o/3600),o-=3600*n.currentHour,n.currentMinute=parseInt(o/60),o-=60*n.currentMinute):"minute"===n.timeLevel?(n.currentHour=n.intervalHour,o=3600*r/e.thumbContainerWidth,n.currentMinute=parseInt(o/60),o-=60*n.currentMinute):(n.currentHour=n.intervalHour,n.currentMinute=n.intervalMinute,o=60*r/e.thumbContainerWidth),n.currentSecond=parseInt(o),24===n.currentHour&&(n.currentHour=23,n.currentMinute=59,n.currentSecond=59),this.updateThumbText()},e.prototype.updateIntervalText=function(){var t=this.$this,e=this.state;"hour"===e.timeLevel?t.find(".title").html("小时"):"minute"===e.timeLevel?t.find(".title").html("分钟("+e.intervalHour+"-"+(e.intervalHour+1)+"时)"):t.find(".title").html("秒("+e.intervalHour+":"+e.intervalMinute+"-"+e.intervalHour+":"+(e.intervalMinute+1)+"分)")},e.prototype.updateInterval=function(t){var e=this.$this,n=this.options,i=this.state,r=e.offset().left,o=t-(n.channelTitleWidth+r),a=0;"minute"===i.timeLevel?(a=86400*o/n.thumbContainerWidth,i.intervalHour=parseInt(a/3600)):"second"===i.timeLevel&&(a=3600*o/n.thumbContainerWidth,i.intervalMinute=parseInt(a/60)),24===i.intervalHour&&(i.intervalHour=23,i.intervalMinute=59)},e.prototype.setCurrentTime=function(t,e){var n=null;if("object"==typeof t)n=t;else{if("string"!=typeof t)return!1;if(e)n=new Date(t);else{var i=new Date,r=i.getFullYear()+"/"+(i.getMonth()+1)+"/"+i.getDate()+" "+t;n=new Date(r)}}var o=n.getHours(),a=n.getMinutes(),s=n.getSeconds();this.setCurrentTimeByHms(o,a,s)},e.prototype.setCurrentTimeByHms=function(t,e,n){var i=this.state;i.currentHour=t,i.currentMinute=e,i.currentSecond=n,this.renderRed(),this.updateThumbText()},e.prototype.setSpeed=function(t){var e=this.state;e.speed=t;var n=parseInt(1e3/e.speed);e.timerId&&clearInterval(e.timerId),e.timerId=setInterval(this.go.bind(this),n)},e.prototype.setDirection=function(t){var e="forward"===t?"forward":"backward";this.state.direction=e},e.prototype.setChannels=function(t){var e=this.$this,n=this.options,i=this.state,r=null;if("object"==typeof t)r=t;else{if("string"!=typeof t)return!1;r=t.split(",")}i.currentChannels=r;for(var o=0;o<n.channels.length;o++){var a=n.channels[o].toString();r.indexOf(a)<0?(e.find("#channelTitle_"+a).hide(),e.find("#channel_"+a).hide()):(e.find("#channelTitle_"+a).show(),e.find("#channel_"+a).show())}e.find(".line").css("height",n.channelHeight*(Math.min(r.length,n.channels.length)+1)+"px")},e.prototype.go=function(){var t=this.state,e="forward"===t.direction?1:-1,n=this.util.hms2Second(t.currentHour,t.currentMinute,t.currentSecond);n+=e;var i=this.util.second2Hms(n);this.setCurrentTimeByHms(i.hour,i.minute,i.second),this.onPlaying()},e.prototype.play=function(){var t=this.state,e=this.options,n=parseInt(1e3/t.speed);t.timerId&&clearInterval(t.timerId);var i=null,r=null,o=e.channelData,a=Object.keys(o);a=a.filter(function(e){return 0<t.currentChannels.filter(function(t){return e.toString()===t.toString()}).length});for(var s=0;s<a.length;s++)for(var h=o[a[s]],u=0;u<h.length;u++){var l=h[u];i?i>(r=new Date(l.StartTime.replace(/-/g,"/")))&&(i=r):i=new Date(l.StartTime.replace(/-/g,"/"))}i&&(t.timerId=setInterval(this.go.bind(this),n),this.setCurrentTime(i),this.onStart())},e.prototype.stop=function(){var t=this.state;t.timerId&&clearInterval(t.timerId),this.setCurrentTimeByHms(0,0,0),this.onStop()},e.prototype.pause=function(){var t=this.state;t.timerId&&clearInterval(t.timerId),this.onPause()},e.prototype.continue=function(){var t=this.state,e=parseInt(1e3/t.speed);t.timerId&&clearInterval(t.timerId),t.timerId=setInterval(this.go.bind(this),e),this.onContinue()},e.prototype.destory=function(){var t=this.$this,e=this.state,n=this.options;e.timerId&&clearInterval(e.timerId);var i=t.find(".channel-title-container"),r=t.find(".channel-container");i.empty(),r.empty(),t.find(".line").css("height",n.channelHeight+"px"),t.find(".title").html("小时")},e.prototype.render=function(){this.renderGreen(),this.renderRed()},e.prototype.renderRed=function(){var t=this.$this,e=this.options,n=this.state,i=this.util.hms2Second(n.currentHour,n.currentMinute,n.currentSecond),r=0;r="hour"===n.timeLevel?e.thumbContainerWidth*i/86400:"minute"===n.timeLevel?e.thumbContainerWidth*(i-3600*n.intervalHour)/3600:e.thumbContainerWidth*(i-(3600*n.intervalHour+60*n.intervalMinute))/60,r-=e.thumbWidth/2,t.find(".thumb").css("left",r+"px"),r<-e.thumbWidth/2||r>e.thumbContainerWidth+e.thumbWidth/2?t.find(".thumb").css("visibility","hidden"):t.find(".thumb").css("visibility","visible")},e.prototype.renderGreen=function(){for(var t=this.$this,e=this.options,n=this.state,i=e.channelData,r=Object.keys(i),o=0;o<r.length;o++){var a=r[o],s=i[a],h=t.find("#channel_"+a);h.empty();for(var u=0;u<s.length;u++){var l=s[u],c=v(e.greenTmpl),d=this.util.parseDate2HMS(l.StartTime.replace(/-/g,"/")),p=this.util.parseDate2HMS(l.EndTime.replace(/-/g,"/")).totalSecond-d.totalSecond,m=0,f=0;"hour"===n.timeLevel?(m=e.thumbContainerWidth*p/86400,f=e.thumbContainerWidth*d.totalSecond/86400):"minute"===n.timeLevel?(m=e.thumbContainerWidth*p/3600,f=e.thumbContainerWidth*(d.totalSecond-3600*n.intervalHour)/3600):(m=e.thumbContainerWidth*p/60,f=e.thumbContainerWidth*(d.totalSecond-(3600*n.intervalHour+60*n.intervalMinute))/60),c.css({width:m+"px",left:f+"px"}),h.append(c)}}},e.prototype.util={padZero:function(t){return t<10?"0"+t.toString():t.toString()},parseDate2HMS:function(t){t=t.replace(/-/g,"/");var e=new Date(t),n=e.getHours(),i=e.getMinutes(),r=e.getSeconds();return{hour:n,minute:i,second:r,totalSecond:3600*n+60*i+r}},hms2Second:function(t,e,n){return 3600*t+60*e+n},hmsStr2Second:function(t){var e=t.split(":");return 3600*parseInt(e[0])+60*parseInt(e[1])+parseInt(e[2])},second2Hms:function(t){var e,n,i=t;return i-=3600*(e=parseInt(i/3600)),{hour:e,minute:n=parseInt(i/60),second:i-=60*n}}},e.prototype.onScale=function(){var t=this.$this,e=this.options,n=this.state;this.render(),e.onScale&&"function"==typeof e.onScale&&e.onScale.call(this,t,n)},e.prototype.onDrag=function(){var t=this.$this,e=this.options,n=this.state;e.onDrag&&"function"==typeof e.onDrag&&e.onDrag.call(this,t,n)},e.prototype.onDragStart=function(){var t=this.$this,e=this.options,n=this.state;e.onDragStart&&"function"==typeof e.onDragStart&&e.onDragStart.call(this,t,n)},e.prototype.onDragEnd=function(){var t=this.$this,e=this.options,n=this.state;e.onDragEnd&&"function"==typeof e.onDragEnd&&e.onDragEnd.call(this,t,n)},e.prototype.onStatusClick=function(){var t=this.$this,e=this.options,n=this.state;e.onStatusClick&&"function"==typeof e.onStatusClick&&e.onStatusClick.call(this,t,n)},e.prototype.onPlaying=function(){var t=this.$this,e=this.options,n=this.state;e.onPlaying&&"function"==typeof e.onPlaying&&e.onPlaying.call(this,t,n)},e.prototype.onStart=function(){var t=this.$this,e=this.options,n=this.state;e.onStart&&"function"==typeof e.onStart&&e.onStart.call(this,t,n)},e.prototype.onStop=function(){var t=this.$this,e=this.options,n=this.state;e.onStop&&"function"==typeof e.onStop&&e.onStop.call(this,t,n)},e.prototype.onPause=function(){var t=this.$this,e=this.options,n=this.state;e.onPause&&"function"==typeof e.onPause&&e.onPause.call(this,t,n)},e.prototype.onContinue=function(){var t=this.$this,e=this.options,n=this.state;e.onContinue&&"function"==typeof e.onContinue&&e.onContinue.call(this,t,n)},e.prototype.test=function(){},v.fn.videoStatus=function(t){return new e(this,t)}}(jQuery);