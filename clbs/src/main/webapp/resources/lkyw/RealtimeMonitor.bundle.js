(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{175:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a(177);function i(e){var t=e;return n.inflate(t,{to:"string"})}},178:function(e,t,a){},180:function(e,t){var a=function(e,t){this.options=t,this.$origin=$(e),this.isDragging=!1,this.downY=0,this.downX=0,this.downTop=0,this.moveHandler=null,this.$indicator=null,this.delta=0,this.$origin.on("mousedown",a.prototype.mousedownHandler.bind(this)),$("body").on("mouseup",a.prototype.mouseupHandler.bind(this))};a.prototype.mousedownHandler=function(e){e.preventDefault(),this.isDragging=!0,this.downX=e.clientX,this.downY=e.clientY,this.$indicator=$('<div class="indicator"></div>'),this.$origin.append(this.$indicator);var t=parseFloat(this.$indicator.css("top"));this.downTop=isNaN(t)?0:t,this.moveHandler=a.prototype.mousemoveHandler.bind(this),this.$indicator.css("position","absolute"),$("body").on("mousemove",this.moveHandler)},a.prototype.mousemoveHandler=function(e){if(e.preventDefault(),this.isDragging){var t=e.clientY-this.downY,a=this.delta+t;if(this.options&&void 0!==this.options.min&&a<this.options.min)return;if(this.options&&void 0!==this.options.max&&a>this.options.max)return;this.$indicator.css("top",this.downTop+t+"px")}},a.prototype.mouseupHandler=function(e){if(this.isDragging){var t=e.clientY-this.downY;this.delta+=t,this.options&&void 0!==this.options.min&&this.delta<this.options.min&&(this.delta=this.options.min),this.options&&void 0!==this.options.max&&this.delta>this.options.max&&(this.delta=this.options.max),this.isDragging=!1,this.$origin.empty(),$("body").off("mousemove",this.moveHandler),this.options&&this.options.onDragEnd&&this.options.onDragEnd(this.delta)}},a.prototype.setDelta=function(e){this.options&&void 0!==this.options.min&&e>=this.options.min&&this.options&&void 0!==this.options.max&&e<=this.options.max&&(this.delta=e,this.options&&this.options.onDragEnd&&this.options.onDragEnd(this.delta))},window.DragBar=a},186:function(e,t){e.exports='<div id="lkywRealtimeMonitor" class="full-height">\r\n    <div class="row full-height">\r\n        <div class="col-md-12 full-height clearfix">\r\n            \x3c!--监控对象组织树--\x3e\r\n            <div class="lkyw-realtime-bar">\r\n                <ul class="nav nav-tabs">\r\n                    <li class="active"><a href="#lkywRealtimeMonitors" data-toggle="tab">监控对象</a></li>\r\n                    <li><a href="#lkywRealtimeFence" data-toggle="tab">电子围栏</a></li>\r\n                </ul>\r\n\r\n                <div class="tab-content">\r\n                    \x3c!--组织树--\x3e\r\n                    <div class="tab-pane full-height clearfix active" id="lkywRealtimeMonitors"></div>\r\n\r\n                    \x3c!--围栏--\x3e\r\n                    <div class="tab-pane full-height" id="lkywRealtimeFence"></div>\r\n                </div>\r\n            </div>\r\n\r\n            \x3c!--右边内容--\x3e\r\n            <div class="lkyw-realtime-content">\r\n                \x3c!--地图--\x3e\r\n                <div id="lkywRealtimeTop" class="lkyw-realtime-top">\r\n\r\n                </div>\r\n                \x3c!--右键视频--\x3e\r\n                <div class="activeSafety" id="btn-videoRealTime-show">\r\n                    实时视频\r\n                </div>\r\n                <div class="videoDrawer-container"></div>\r\n\r\n                <div id="lkywMonitorTableWrap">\r\n                    \x3c!--数据列表--\x3e\r\n                    <div id="lkywRealtimeBottom" class="lkyw-realtime-bottom">\r\n                        <div class="drag-bar" id="tableMapDrag"></div>\r\n                        <div id="lkywRealtimeTables" class="lkyw-realtime-tables"></div>\r\n                    </div>\r\n\r\n                    \x3c!--底部筛选--\x3e\r\n                    <div id="lkywRealtimeFilter" class="lkyw-realtime-filter"></div>\r\n                </div>\r\n\r\n                \x3c!-- 围栏绑定列表 --\x3e\r\n                <div class="row" id="fenceBindTable" style="width:100%;">\r\n\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n\x3c!-- 文本信息下发 --\x3e\r\n<div class="modal fade" id="textInfoSend" style="z-index: 9999;" aria-hidden="true" data-backdrop="static" role="dialog"\r\n    aria-labelledby="myModalLabel">\r\n    <div class="modal-dialog" role="document">\r\n        <div class="modal-content">\r\n            <form action="/clbs/adas/v/monitoring/sendTTS" role="form" id="txtSend" method="post"\r\n                class="form-horizontal">\r\n                <div class="modal-header">\r\n                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"></button>\r\n                    <h4 class="modal-title" id="textInfoSendBrand"></h4>\r\n                    <input class="hidden" id="vid5" name="vehicleId" value="">\r\n                </div>\r\n                <div class="modal-body">\r\n                    <div class="row">\r\n                        <div class="form-group">\r\n                            <label class="col-md-3 control-label">文本内容：</label>\r\n                            <div class=" col-md-7">\r\n                                <textarea class="form-control" maxlength="512" name="sendTextContent"\r\n                                    rows="4"></textarea>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class="modal-footer">\r\n                    <button type="button" id="goTxtSend" class="btn btn-primary">下发</button>\r\n                    <button type="button" class="btn btn-default btn-off" data-dismiss="modal">关闭</button>\r\n                </div>\r\n            </form>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n\x3c!--预览图片弹框--\x3e\r\n<div class="modal fade in" id="lkywRealtimePreview" role="dialog" aria-labelledby="eventMediaModalLabel"\r\n    aria-hidden="false">\r\n    <div class="modal-dialog" role="document">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span\r\n                        aria-hidden="true">×</span></button>\r\n                <h4 class="modal-title">图片预览</h4>\r\n            </div>\r\n            <div class="modal-body" style="height: 500px; max-height: 750px;">\r\n                <div id="mapPic">\r\n                    <img src="" id="picImg" />\r\n                </div>\r\n\r\n            </div>\r\n            <div class="modal-footer">\r\n                <button type="button" class="btn btn-primary" id="print">打印</button>\r\n                <button type="button" class="btn btn-primary" id="downloadPic">下载</button>\r\n                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n\x3c!-- 区域查车弹框 --\x3e\r\n<div class="modal fade" id="realtimeAreaSearchCar" role="dialog" style="overflow-y:hidden" data-backdrop="static"\r\n    data-keyboard="false" aria-labelledby="alarmSettingInfo" aria-hidden="true">\r\n    <div class="modal-dialog">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <h4 class="modal-title">区域查询</h4>\r\n            </div>\r\n            <div id="realtimeAreaSearchCarBody" class="modal-body modal-body-overflow">\r\n                <div>\r\n                    该区域监控对象总数：\r\n                    <span id="sumRegionalQuery"></span>\r\n                </div>\r\n                <div class="row form-horizontal" id="areaSearchCarTable">\r\n\r\n                </div>\r\n            </div>\r\n            <div class="modal-footer">\r\n                <button id="searchCarClose" type="button" class="btn btn-default" data-dismiss="modal">关闭</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n\r\n\x3c!-- 需要根据电脑屏幕定位的弹层 start --\x3e\r\n\x3c!-- table表鼠标右键 --\x3e\r\n<div id="tableRightMenu" class="table-right-menu">\r\n    <a class="item" href="#" data-key="track-playback">历史轨迹</li>\r\n        <a class="item" href="#" data-key="realtime-video">实时视频</a>\r\n        <a class="item" href="#" data-key="video-playback">视频回放</a>\r\n        <a class="item" href="#" data-key="group-message">发送消息</a>\r\n        <a class="item" href="#" data-key="history-capture">抓拍图片</a>\r\n</div>\r\n\r\n\x3c!-- 查询原始数据 --\x3e\r\n<div id="rMenu" class="lkyw-realtime-origion">\r\n    <div class="col-md-12" style="padding:0px">\r\n        <a class="rmenu-last-a" href="#">查询原始数据</a>\r\n    </div>\r\n</div>\r\n\r\n\x3c!-- 主动安全事件弹窗 --\x3e\r\n<div id="securityEventModule">\r\n\r\n</div>\r\n\x3c!-- 需要根据电脑屏幕定位的弹层 end --\x3e'},187:function(e,t,a){},188:function(e,t){e.exports='<div class="lkyw-type clearfix">\r\n  <div id="allVihecle" data-type=\'0\' class="col-md-4 col-sm-5 col-xs-5 item">\r\n    <span>全部</span>\r\n    (<span class="allSize">...</span>)\r\n  </div>\r\n  <div id="onlineVihecle" data-type=\'1\' class="col-md-4 col-sm-5 col-xs-5 item active">\r\n    <span>在线</span>\r\n    (<span class="onlineSize">...</span>)\r\n  </div>\r\n  <div id="missVihecle" data-type=\'7\' class="col-md-4 col-sm-5 col-xs-5 item">\r\n    <span>不在线</span>\r\n    (<span class="missSize">...</span>)\r\n  </div>\r\n</div>\r\n\r\n<div class="lkyw-filter clearfix">\r\n  <div class="col-md-5 no-padding">\r\n    <select id="searchType" placeholder="请选择搜索类别" class="form-control">\r\n      <option selected="selected" value="name">监控对象</option>\r\n      <option value="deviceNumber">终端号</option>\r\n      <option value="simcardNumber">终端手机号</option>\r\n      <option value="group">企业</option>\r\n      <option value="assignName">分组</option>\r\n      <option value="professional">从业人员</option>\r\n    </select>\r\n  </div>\r\n  <div class="col-md-5 no-padding">\r\n    <input id="searchCondition" name="search" autocomplete="off" type="text" class="form-control" placeholder="关键字" />\r\n  </div>\r\n  <div class="col-md-2 no-padding">\r\n    <button id="realSetBtn" class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown"\r\n      aria-haspopup="true" aria-expanded="true">\r\n      <span class="fa fa-cog"></span>\r\n    </button>\r\n    <ul id="realSetMenu" class="dropdown-menu" aria-labelledby="dropdownMenu1">\r\n      <li>\r\n        <a href="javascript:void(0);" id="refresh" name="refresh" title="刷新" data-stoppropagation="true">\r\n          <i class="glyphicon glyphicon-refresh"></i>刷新\r\n        </a>\r\n      </li>\r\n      <li>\r\n        <a href="javascript:void(0);" id="showAliases" data-stoppropagation="true">\r\n          <label for="showName"><input type="checkbox" id="showName">显示别名</label>\r\n        </a>\r\n      </li>\r\n      <li id="showMonitorCountLi" style="display: none">\r\n        <a href="javascript:void(0);" id="showMonitorCount" data-stoppropagation="true">\r\n          <label for="monitorCountInput">\r\n            <input type="checkbox" id="monitorCountInput" class="showInput">显示车辆数\r\n          </label>\r\n        </a>\r\n      </li>\r\n    </ul>\r\n    </ul>\r\n  </div>\r\n</div>\r\n\r\n<div class="lkyw-thetree">\r\n  <div id="treeLoad" style="width: 140px; margin: 20px auto 0 65px">\r\n    <i class="fa fa-spinner loading-state"></i>\r\n    <span>加载中，请稍候</span>\r\n  </div>\r\n  <ul id="lkywRealtimeTree" class="ztree"></ul>\r\n</div>'},189:function(e,t,a){},198:function(module,exports){module.exports=function anonymous(locals,filters,escape,rethrow){escape=escape||function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;")};var __stack={lineno:1,input:'<div><span><%- tit -%></span><span class="code"><%- con -%></span><a class="analysis" data-con="<%- con -%>">解析</a>\r\n</div>',filename:"."};function rethrow(e,t,a,n){var i=t.split("\n"),r=Math.max(n-3,0),s=Math.min(i.length,n+3),o=i.slice(r,s).map((function(e,t){var a=t+r+1;return(a==n?" >> ":"    ")+a+"| "+e})).join("\n");throw e.path=a,e.message=(a||"ejs")+":"+n+"\n"+o+"\n\n"+e.message,e}try{var buf=[];with(locals||{})buf.push("<div><span>",(__stack.lineno=1,tit),'</span><span class="code">',(__stack.lineno=1,con),'</span><a class="analysis" data-con="',(__stack.lineno=1,con),'">解析</a></div>');return buf.join("")}catch(err){rethrow(err,__stack.input,__stack.filename,__stack.lineno)}}},200:function(e,t){e.exports='\x3c!-- 地图容器 --\x3e\r\n<div id="realtimeMapContainer" style="width:100%;height:100%;"></div>\r\n\r\n\x3c!--收起组织树--\x3e\r\n<div class="toggle-left-part" id="toggleLeftPart">\r\n    <i class="fa fa-chevron-left"></i>\r\n</div>\r\n<div id="goShow">\r\n    <i class="fa fa-chevron-right"></i>\r\n</div>\r\n\r\n\x3c!-- 围栏 --\x3e\r\n<div id="fenceTool" class="btn-group fenceTool">\r\n    <button id="fenceToolBtn" style="padding:7px !important;" type="button" class="btn btn-white dropdown-toggle"\r\n        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\r\n        <img src="/clbs/resources/img/FenceIco.svg" style="width:18px;height:15.3px;" /><span class="caret"></span>\r\n    </button>\r\n    <div class="dropdown-menu">\r\n        <div id="vFenceMsg" class="col-md-12 text-center">请双击选择监控对象！</div>\r\n        <div id="vSearchContent" class="hidden">\r\n            <input type="text" autocomplete="off" class="form-control" name="search" id="vFenceSearch" placeholder="请输入关键字" />\r\n        </div>\r\n        <ul id="vFenceTree" class="ztree hidden"></ul>\r\n    </div>\r\n</div>\r\n\r\n\x3c!-- 工具条 --\x3e\r\n<div class="toolClickArea">\r\n    <div id="toolClick" class="toolClick">\r\n        <img alt="" src="/clbs/resources/img/tool.svg">\r\n    </div>\r\n\r\n    <div id="toolOperateClick" class="toolOperateClick tool-phoneCall">\r\n        <a class="item fenceA" id="previewImage">\r\n            <i class="print-sett"></i>\r\n            <span>预览图片</span>\r\n        </a>\r\n        <a class="item fenceA" id="mapDropSetting">\r\n            <i class="map-drop-sett"></i>\r\n            <span>地图设置</span>\r\n        </a>\r\n        <a class="mapOpra fenceA" id="queryClick">\r\n            <i class="map-query"></i>\r\n            <span class="change">区域查询</span>\r\n        </a>\r\n        <a class="mapOpra fenceA" id="magnifyClick">\r\n            <i class="map-magnify"></i>\r\n            <span class="change">拉框放大</span>\r\n        </a>\r\n        <a class="mapOpra fenceA" id="shrinkClick">\r\n            <i class="map-shrink"></i>\r\n            <span class="change">拉框缩小</span>\r\n        </a>\r\n        <a class="item fenceA" id="countClick">\r\n            <i class="map-count"></i>\r\n            <span>量算</span>\r\n        </a>\r\n        \x3c!-- <a class="item fenceA" id="displayClick">\r\n            <i class="map-displaySetting"></i>\r\n            <span>显示设置</span>\r\n        </a> --\x3e\r\n    </div>\r\n</div>\r\n\r\n\x3c!-- 地图设置下拉 --\x3e\r\n<div class="dropDown mapDropSettingMenu" id="mapDropSettingMenu" style="right:438px;">\r\n    <p class="m-line">\r\n        <label for="realTimeRCInput" id="realTimeRC">\r\n            <input type="checkbox" id="realTimeRCInput" class="monitoringSelect" />\r\n            <span>路况</span>\r\n        </label>\r\n    </p>\r\n    <hr>\r\n    <p>\r\n        <label for="defaultMapInput" id="defaultMap">\r\n            <input type="checkbox" id="defaultMapInput" class="monitoringSelect" />\r\n            <span>卫星地图</span>\r\n        </label>\r\n    </p>\r\n    <hr>\r\n    <p>\r\n        <label for="googleMapInput" id="googleMap">\r\n            <input type="checkbox" id="googleMapInput" class="monitoringSelect" />\r\n            <span>谷歌地图</span>\r\n        </label>\r\n    </p>\r\n</div>\r\n\r\n\x3c!--量算下拉--\x3e\r\n<div class="dropDown measurementMenu" id="measurementMenu" style="right:53px">\r\n    <p id="distanceMeasuremenLab" class="item m-line">\r\n        <span class="monitoringSelect">距离量算</span>\r\n    </p>\r\n    <div id="areaMeasurementLab" class="item">\r\n        <i class="draw-left"></i>\r\n        <span class="monitoringSelect">面积量算</span>\r\n\r\n        <div class="areaMeasurementList" id="drawGraphics">\r\n            <p data-type="circle">圆形</p>\r\n            <p data-type="rectangle">矩形</p>\r\n        </div>\r\n    </div>\r\n\r\n</div>\r\n\r\n\x3c!-- 显示设置下拉 --\x3e\r\n<div class="dropDown disSetMenu" id="disSetMenu">\r\n    <p>\r\n        <label for="logoDisplay" class="monitoringSelect">\r\n            <input type="checkbox" checked="checked" id="logoDisplay" class="monitoringSelect" />\r\n            <span>标识显示</span>\r\n        </label>\r\n    </p>\r\n    <hr>\r\n    <p>\r\n        <label for="icoUp" class="monitoringSelect">\r\n            <input type="checkbox" id="icoUp" class="monitoringSelect" />\r\n            <span>图标向上</span>\r\n        </label>\r\n    </p>\r\n</div>\r\n\r\n\x3c!-- 查询原始数据 --\x3e\r\n<div spellcheck="false" id="originalDataModal" class="realtime-origion-modal">\r\n    <div style="height: 38px; line-height: 38px;">\r\n        <ul class="original-title-list">\r\n            <li style="display: inline-block;">监控对象：<span id="searchForName"></span></li>\r\n            <li style="display: inline-block;">终端号：<span id="searchDviceNumber"></span></li>\r\n            <li style="display: inline-block;">终端手机号：<span id="searchSimNumber"></span></li>\r\n            <li class="float-right"><i id="originalDataModalClose" class="glyphicon glyphicon-remove"></i></li>\r\n\r\n            <li class="float-right">\r\n                <button id="controlGetData" type="button" class="btn btn-default btn-xs original-handle">暂停</button>\r\n            </li>\r\n            <li class="float-right">\r\n                <button id="clearOriginalData" type="button" class="btn btn-default btn-xs original-handle">清空</button>\r\n            </li>\r\n            <li class="float-right">\r\n                <button id="copyOriginalData" type="button" class="btn btn-default btn-xs original-handle">复制</button>\r\n            </li>\r\n        </ul>\r\n    </div>\r\n    <pre id="originalDataList" class="original-content"></pre>\r\n</div>'},201:function(e,t,a){},203:function(module,exports){module.exports=function anonymous(locals,filters,escape,rethrow){escape=escape||function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;")};var __stack={lineno:1,input:'<table id="dataTable" class="table table-striped table-bordered table-hover" cellspacing="0" width="100%">\r\n    <thead>\r\n        <tr>\r\n            <th>监控对象</th>\r\n            <th>分组</th>\r\n        </tr>\r\n    </thead>\r\n    <tbody>\r\n        <% data.forEach(function(item){ %>\r\n        <tr>\r\n            <td><%= item.carName %></td>\r\n            <td><%= item.carGroup %></td>\r\n        </tr>\r\n        <% }) %>\r\n    </tbody>\r\n</table>',filename:"."};function rethrow(e,t,a,n){var i=t.split("\n"),r=Math.max(n-3,0),s=Math.min(i.length,n+3),o=i.slice(r,s).map((function(e,t){var a=t+r+1;return(a==n?" >> ":"    ")+a+"| "+e})).join("\n");throw e.path=a,e.message=(a||"ejs")+":"+n+"\n"+o+"\n\n"+e.message,e}try{var buf=[];with(locals||{})buf.push('<table id="dataTable" class="table table-striped table-bordered table-hover" cellspacing="0" width="100%">\n    <thead>\n        <tr>\n            <th>监控对象</th>\n            <th>分组</th>\n        </tr>\n    </thead>\n    <tbody>\n        '),__stack.lineno=9,data.forEach((function(e){buf.push("\n        <tr>\n            <td>",escape((__stack.lineno=11,e.carName)),"</td>\n            <td>",escape((__stack.lineno=12,e.carGroup)),"</td>\n        </tr>\n        "),__stack.lineno=14})),buf.push("\n    </tbody>\n</table>");return buf.join("")}catch(err){rethrow(err,__stack.input,__stack.filename,__stack.lineno)}}},204:function(module,__webpack_exports__,__webpack_require__){"use strict";var _framework_utils_ajax__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(7),_index_html__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(205),_index_html__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_index_html__WEBPACK_IMPORTED_MODULE_1__),_style_less__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(206),_style_less__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_style_less__WEBPACK_IMPORTED_MODULE_2__),_assets_js_tg_util__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(55),_assets_js_tg_util__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_assets_js_tg_util__WEBPACK_IMPORTED_MODULE_3__),_framework_utils_websocket__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(22),_framework_utils_unzip__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(175),__awaiter=function(e,t,a,n){return new(a||(a=Promise))((function(i,r){function s(e){try{l(n.next(e))}catch(e){r(e)}}function o(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(s,o)}l((n=n.apply(e,t||[])).next())}))},__generator=function(e,t){var a,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function o(r){return function(o){return function(r){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],n=0}finally{a=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,o])}}},fencing=function(){function fencing(e,t){this.dependency=t,this.setOption(e)}return fencing.prototype.setOption=function(e){this.option=e,this.state={$origin:null,$dom:{$markerLng:null,$addBtn:null,$tableList:null,$removeBtn:null},data:{map:null,isAddDragRoute:null,isAddFlag:null,isAreaSearchFlag:null,isDistanceCount:null,clickRectangleFlag:null,mapVehicle:new mapVehicle,isDragRouteFlag:null,content:null,lineSpotMap:new mapVehicle,sectionPointMarkerMap:new mapVehicle,isEdit:null,sectionMarkerPointArray:new mapVehicle,fenceSectionPointMap:new mapVehicle,bindFenceSetChar:null,trid:[],changeArray:null,crrentSubV:null,crrentSubName:null,cheakdiyuealls:null,cancelList:[],isAreaSearch:null,saveFenceName:null,saveFenceType:null,fenceIdArray:[],fenceOpenArray:[],moveMarkerFenceId:null,moveMarkerBackData:null,rectangle:null,detailsFenceDescribe:null,amendLine:null,amendCircle:null,fenceSize:null,vehicelTree:null,vehicleNode:null,vehicleFenceList:null,queryFenceId:[],fanceID:null,district:null,clickStateChar:void 0,charFlag:null,fenceCheckLength:null,fenceLayerSelect:null,wms:null,amapLayer:null,notExpandNodeInit:null,checkFlag:null,fenceZTreeIdJson:{},myTable:null,addItemFlag:!0,mapHeight:null,fenceInputChange:void 0,drawFence:null,waybillAndPractitionersInfo:new mapVehicle}},this.state.$origin=$(e.selector),this.initHtml(),this.bindEvent()},fencing.prototype.initHtml=function(){var e=$(_index_html__WEBPACK_IMPORTED_MODULE_1___default.a);this.state.$origin.empty(),this.state.$origin.append(e),this.state.$dom.$markerLng=e.find("#markerLng"),this.state.$dom.$addBtn=e.find("#addBtn"),this.state.$dom.$tableList=e.find("#tableList"),this.state.$dom.$removeBtn=e.find("#removeBtn"),this.zTreeInit(),this.MapInit(),this.tableInit()},fencing.prototype.bindEvent=function(){var e=this;$(".lngLat_show").on("click",this.lngLatTextShow),$("#annotatedSave").on("click",this.annotatedSave.bind(this)),$("#markFenceClose").bind("click",this.markFenceClose.bind(this)),this.state.$dom.$addBtn.on("click",this.addBtnClick.bind(this)),this.state.$dom.$tableList.on("click",".checkList",this.checkboxis.bind(this)),this.state.$dom.$tableList.on("click",".startDatePlugin",this.selectDate.bind(this)),this.state.$dom.$tableList.on("click",".endDatePlugin",this.selectDate.bind(this)),this.state.$dom.$tableList.on("click",".startTimeHMS",this.selectTime.bind(this)),this.state.$dom.$tableList.on("click",".endTimeHMS",this.selectTime.bind(this)),this.state.$dom.$removeBtn.on("click",this.removeBtnClick.bind(this)),$("#checkAll").on("click",this.checkAllClick.bind(this)),$("#setAll").on("click",this.setAllClick.bind(this)),$("#fenceSaveBtn").on("click",this.fenceSaveBtnClick.bind(this)),$("#threadSave").on("click",this.threadSave.bind(this)),$("#lineEditClose").on("click",this.lineEditClose.bind(this)),$("#rectangleSave").on("click",this.rectangleSave.bind(this)),$("#roundSave").on("click",this.roundSave.bind(this)),$("#circleFenceClose").on("click",this.circleFenceClose.bind(this)),$("#polygonSave").on("click",this.polygonSave.bind(this)),$("#polygonFenceClose").on("click",this.polygonFenceClose.bind(this)),$("#province, #city, #district, #street").on("change",this.administrativeAreaSelect.bind(this)),$("#administrativeSave").on("click",this.administrativeSave.bind(this)),$("#administrativeClose").on("click",this.administrativeClose.bind(this)),$("#lineDragRouteSave").on("click",this.lineDragRouteSave.bind(this)),$("#lineDragRouteClose").on("click",this.lineDragRouteClose.bind(this)),$("#searchFence").bind("input oninput",this.searchFenceCarSearch),$("#refreshFence").on("click",this.FenceSearch.bind(this)),$("#search_button").bind("click",this.searchBindTable.bind(this)),$("#refreshTable").on("click",(function(){$("#simpleQueryParam").val(""),e.searchBindTable.bind(e)()})),$("#tableCheckAll").bind("click",this.tableCheckAll.bind(this)),$("#send_model").on("click",this.sendModelClick.bind(this)),$("#del_model").on("click",this.delModelClick.bind(this)),$("#bingListClick").on("click",this.bingListClick),$("#rectangleEditClose").on("click",this.rectangleEditClose.bind(this)),$("#searchVehicle").on("input oninput",this.searchVehicleSearch.bind(this)),$("#save").on("click",this.doSubmits1.bind(this)),$("#realtimeMapContainer").on("click","#jump",this.deleteKeyPoint.bind(this)),$("#monitoringTagClose").bind("click",this.monitorClose),$("#saveSection").on("click",this.doSubmitsMonitor.bind(this)),$("#sectionRateLimitingClose").on("click",this.sectionRateLimitingClose.bind(this))},fencing.prototype.destory=function(){this.state.$origin.empty()},fencing.prototype.MapInit=function(){var e=this.dependency.get("realtimeAMap").state.data.map,t=new AMap.TileLayer.WMTS({url:"https://services.arcgisonline.com/arcgis/rest/services/Demographics/USA_Population_Density/MapServer/WMTS/",blend:!1,tileSize:256,params:{Layer:"0",Version:"1.0.0",Format:"image/png"},visible:!1});t.setMap(e),this.state.data.wms=t;var a=new AMap.ImageLayer({url:"http://amappc.cn-hangzhou.oss-pub.aliyun-inc.com/lbs/static/img/dongwuyuan.jpg",bounds:new AMap.Bounds([116.327911,39.939229],[116.342659,39.946275]),zooms:[2,18],visible:!1,map:e});this.state.data.amapLayer=a},fencing.prototype.zTreeInit=function(){var e;"Microsoft Internet Explorer"===navigator.appName&&"MSIE9.0"===navigator.appVersion.split(";")[1].replace(/[ ]/g,"")&&$("#searchFence").bind("focus",(function(){e=setInterval((function(){search_ztree("fenceDemo","searchFence","fence",null)}),500)})).bind("blur",(function(){clearInterval(e)}));$("input").inputClear().on("onClearEvent",(function(e,t){var a=t.id;"searchFence"==a&&search_ztree("fenceDemo",a,"fence",null)}));var t={async:{url:"/clbs/m/functionconfig/fence/bindfence/fenceTree",type:"post",enable:!0,autoParam:["id"],dataType:"json",otherParam:{type:"multiple"},dataFilter:this.FenceAjaxDataFilter},check:{enable:!0,chkStyle:"checkbox",chkboxType:{Y:"s",N:"s"},radioType:"all"},view:{addHoverDom:this.addHoverDom.bind(this),removeHoverDom:this.removeHoverDom.bind(this),dblClickExpand:!1,nameIsHTML:!0,fontCss:setFontCss_ztree},data:{simpleData:{enable:!0}},callback:{onClick:this.onClickFenceChar.bind(this),onCheck:this.onCheckFenceChar.bind(this)}};$.fn.zTree.init($("#fenceDemo"),t,null)},fencing.prototype.FenceAjaxDataFilter=function(e,t,a){if(a){for(var n=0;n<a.length;n++){var i=a[n];i.open=!1,i.name=html2Escape(i.name,""),1===i.markIcon&&(i.iconSkin="zw_m_marker_circle_skin")}a.push({name:"图层",pId:"0",id:"zw_m_travel_layer",type:"fenceParent",open:!1}),a.push({iconSkin:"zw_m_rectangle_skin",name:"图层1",pId:"zw_m_travel_layer",type:"fence",open:!1}),a.push({iconSkin:"zw_m_rectangle_skin",name:"图层2",pId:"zw_m_travel_layer",type:"fence",open:!1})}return a},fencing.prototype.addHoverDom=function(e,t){var a=this.dependency.get("realtimeAMap"),n=this;if("zw_m_travel_layer"===t.id||"zw_m_travel_layer"===t.pId)return!1;var i=t.type;if(null!=i&&void 0!==i&&""!==i&&"fenceParent"===i){var r=$("#"+t.tId+"_span"),s=$("#"+t.tId+"_span");if(t.editNameFlag||$("#addBtn_"+t.tId).length>0)return;var o,l=t.id,d="<span class='button add' id='addBtn_"+t.tId+"' title='新增'></span>";("zw_m_line"===l||"zw_m_polygon"===l)&&(o="<a class='button import' id='import_"+t.tId+"' href='/clbs/v/monitoring/import?pid="+l+"' data-toggle='modal' data-target='#commonSmWin' title='导入'></a>"),s.after(o),r.after(d);var c=$("#addBtn_"+t.tId);c&&c.bind("click",(function(){if(a.mouseToolClose(),$("label.error").remove(),n.state.data.isAddDragRoute=!1,$("#drivenRoute").hide(),$(".lngLat_show").children("span").attr("class","fa fa-chevron-up"),$(".pointList").hide(),$(".fenceA i").removeClass("active"),$(".fenceA span").css("color","#5c5e62"),n.state.data.isAddFlag=!0,n.state.data.isAreaSearchFlag=!1,"标注"===t.name)layer.msg("请在地图上点出标注点",{time:1e3}),n.clearMapMarker(),a.mouseToolMarker(-9,-23),a.state.data.mouseTool.on("draw",n.createSuccess.bind(n));else if("路线"===t.name)layer.msg("请在地图上画出路线",{time:1e3}),n.state.data.isDistanceCount=!1,n.clearLine(),a.mouseToolPolyline(),a.state.data.mouseTool.on("draw",n.createSuccess.bind(n));else if("矩形"===t.name)layer.msg("请在地图上画出矩形",{time:1e3}),n.clearRectangle(),a.mouseToolRectangle(),n.state.data.clickRectangleFlag=!0,a.state.data.mouseTool1.on("draw",n.createSuccess.bind(n));else if("圆形"===t.name)layer.msg("请在地图上画出圆形",{time:1e3}),n.clearCircle(),a.mouseToolCircle(),a.state.data.mouseTool1.on("draw",n.createSuccess.bind(n));else if("多边形"===t.name)layer.msg("请在地图上画出多边形",{time:1e3}),n.clearPolygon(),a.mouseToolPolygon(),n.state.data.clickRectangleFlag=!1,a.state.data.mouseTool1.on("draw",n.createSuccess.bind(n));else if("导航路线"===t.name)$("#drivenRoute").show(),n.addItem();else if("行政区划"===t.name){$("#administrationName").val(""),$("#administrationDistrict").val(""),$("#province").val("--请选择--"),document.getElementById("city").innerHTML="",document.getElementById("district").innerHTML="",$("#administrativeArea").modal("show");var e=new AMap.DistrictSearch({subdistrict:1,level:"city",showbiz:!1});e.search("中国",(function(e,t){"complete"==e&&n.getData(t.districtList[0])})),n.state.data.district=e,a.state.data.mouseTool.on("draw",n.createSuccess.bind(n))}return!1}))}else if(null!=i&&void 0!==i&&""!==i&&"fence"===i){var p=$("#"+t.tId+"_span"),u=$("#"+t.tId+"_span"),h=$("#"+t.tId+"_span"),m=$("#"+t.tId+"_span");if(t.editNameFlag||$("#editBtn_"+t.tId).length>0)return;var v="<span class='button binds' id='detailsBtn_"+t.tId+"' title='详情'></span>",g="<span class='button details' id='bindBtn_"+t.tId+"' title='绑定'></span>",f="";f="zw_m_administration"!==t.pId?"<span class='button edit' id='editBtn_"+t.tId+"' title='修改' ></span>":"<span id='editBtn_"+t.tId+"' title='修改' ></span>";var b="<span class='button remove' id='deleteBtn_"+t.tId+"' title='删除' ></span>";h.after(b),u.after(v),p.after(f),m.after(g);var y=$.fn.zTree.getZTreeObj("fenceDemo"),k=$("#editBtn_"+t.tId);k&&k.bind("click",(function(){$("label.error").remove(),n.closeFenceEdit(),n.state.data.isAddDragRoute=!1,$("#drivenRoute").hide(),$(".lngLat_show").children("span").attr("class","fa fa-chevron-up"),$(".pointList").hide(),a.mouseToolClose(),n.state.data.isEdit=!1,n.state.data.isAddFlag=!1,n.state.data.isAreaSearchFlag=!1;var e=t.id+"#"+t.pId;return y.checkNode(t,!0,!0),t.checkedOld=!0,n.updateFence(e,null),!1}));var T=$("#bindBtn_"+t.tId);T&&T.bind("click",(function(){return n.state.data.isAddDragRoute=!1,$("#drivenRoute").hide(),n.state.data.trid=[],n.fenceBind(t.pId,t.name,t.fenceInfoId,t.id),!1}));var w=$("#deleteBtn_"+t.tId);w&&w.bind("click",(function(){return n.state.data.isAddDragRoute=!1,$("#drivenRoute").hide(),a.state.data.infoWindow.close(),n.deleteFence(t),!1}));var S=$("#detailsBtn_"+t.tId);S&&S.bind("click",(function(){n.state.data.isAddDragRoute=!1,$("#drivenRoute").hide(),$("#detailsFenceName").text(t.name);var e=t.id+"#"+t.pId+"#"+!0;return n.updateFence(e,null),$("#detailsModel").modal("show"),!1}))}},fencing.prototype.clearMapMarker=function(){$("#addOrUpdateMarkerFlag").val("0"),$("#markerId").val(""),$("#markerName").val(""),$("#markerDescription").val(""),$("#mark-lng").attr("value",""),$("#mark-lat").attr("value","")},fencing.prototype.clearLine=function(){$("#addOrUpdateLineFlag").val("0"),$("#lineId").val(""),$("#lineName1").val(""),$("#lineWidth1").val(""),$("#lineDescription1").val(""),$("#pointSeqs").val(""),$("#longitudes").val(""),$("#latitudes").val("")},fencing.prototype.clearRectangle=function(){$("#addOrUpdateRectangleFlag").val("0"),$("#rectangleId").val(""),$("#rectangleName").val(""),$("#rectangleDescription").val(""),$("#pointSeqsRectangles").val(""),$("#longitudesRectangles").val(""),$("#latitudesRectangles").val("")},fencing.prototype.clearPolygon=function(){$("#addOrUpdatePolygonFlag").val("0"),$("#polygonId").val(""),$("#polygonName").val(""),$("#polygonDescription").val(""),$("#pointSeqsPolygons").val(""),$("#longitudesPolygons").val(""),$("#latitudesPolygons").val("")},fencing.prototype.clearCircle=function(){$("#addOrUpdateCircleFlag").val("0"),$("#circleId").val(""),$("#circleName").val(""),$("#circleDescription").val(""),$("#circle-lng").attr("value",""),$("#circle-lat").attr("value",""),$("#circle-radius").attr("value","")},fencing.prototype.addItem=function(){var e=this.dependency.get("realtimeAMap");$("#addOrUpdateTravelFlag").val("0"),this.state.data.isAddDragRoute=!0;var t,a=this;this.state.data.addItemFlag&&(e.state.data.contextMenu.addItem("<i class='menu-icon menu-icon-from'></i>&ensp;&ensp;&ensp;<span>起点</span>",(function(){a.itemCallBack(t,0,e.state.data.map)}),0),e.state.data.contextMenu.addItem("<i class='menu-icon menu-icon-via'></i>&ensp;&ensp;&ensp;<span>途经点</span>",(function(){a.itemCallBack(t,1,e.state.data.map)}),1),e.state.data.contextMenu.addItem("<i class='menu-icon menu-icon-to'></i>&ensp;&ensp;&ensp;<span>终点</span>",(function(){a.itemCallBack(t,2,e.state.data.map)}),2),e.state.data.contextMenu.addItem("<i class='icon-clearmap'></i>&ensp;&ensp;&ensp;<span>清除路线</span>",(function(){a.itemCallBack(t,3,e.state.data.map)}),3));e.state.data.map.on("rightclick",(function(n){a.state.data.isAddDragRoute&&(t=[n.lnglat.lng,n.lnglat.lat],e.state.data.contextMenu.open(e.state.data.map,n.lnglat))}))},fencing.prototype.itemCallBack=function(e,t,a){this.state.data.addItemFlag=!1;var n=this.dependency.get("realtimeAMap");if(3!==t){var i;0===t?i="/clbs/resources/img/start_point.png":1===t?i="/clbs/resources/img/mid_point.png":2===t&&(i="/clbs/resources/img/end_point.png");var r=new AMap.Marker({map:a,position:e,icon:new AMap.Icon({size:new AMap.Size(40,40),image:i})});if(0===t){if(this.state.data.mapVehicle.containsKey(t)){var s=this.state.data.mapVehicle.get(t);a.remove(s),this.state.data.mapVehicle.remove(t)}this.state.data.mapVehicle.put(t,r)}else if(2===t){if(this.state.data.mapVehicle.containsKey(t)){s=this.state.data.mapVehicle.get(t);a.remove(s),this.state.data.mapVehicle.remove(t)}this.state.data.mapVehicle.put(t,r)}else if(1===t){var o=[];this.state.data.mapVehicle.containsKey(t)&&(o=this.state.data.mapVehicle.get(t),this.state.data.mapVehicle.remove(t)),o.push(r),this.state.data.mapVehicle.put(t,o)}this.getAddressOneInfo(e,t)}else this.state.data.isDragRouteFlag=!1,this.clearLineDragRoute(),this.addItem(),void 0!==n.state.data.lineRoute&&n.state.data.lineRoute.destroy(),$("#drivenRoute").show()},fencing.prototype.getAddressOneInfo=function(e,t){var a=this,n=e[0]+";"+e[1],i=new AMap.Geocoder({city:"全国",radius:500});i.getAddress(e,null),i.on("complete",(function(e){if("complete"===e.type){var i=e.regeocode.addressComponent.township,r=e.regeocode.formattedAddress;0===t&&$("#startPoint").val(r).attr("data-address",r).attr("data-lnglat",n),2===t&&$("#endPoint").val(r).attr("data-address",r).attr("data-lnglat",n),1===t&&a.addWayToPoint([r,i,n]),a.dragRoute("drag")}}))},fencing.prototype.addWayToPoint=function(e){var t="wayPoint"+($("#wayPointArea").children("div").length+1);$('<div class="form-group"><div class="col-md-10"><input type="text" id="'+t+'" placeholder="请输入途经点" class="form-control wayPoint" name="wayPoint" /></div><button type="button" class="btn btn-danger padBottom deleteWayPoint"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span></button></div>').appendTo($("#wayPointArea")),$("#"+t).inputClear().on("onClearEvent",this.wayPointInputClear),Array.isArray(e)&&$("#"+t).val(e[0]).attr("data-address",e[0]).attr("data-lnglat",e[2]),new AMap.Autocomplete({input:t}).on("select",this.dragRoute),$(".deleteWayPoint").off("click").on("click",this.deleteWayPoint.bind(this))},fencing.prototype.dragRoute=function(e){var t=this.dependency.get("realtimeAMap"),a=[];if(null!=e&&"drag"!==e){var n=$(this).attr("id");$("#"+n).attr("data-address",e.poi.district+e.poi.name).removeAttr("data-lnglat")}var i=$("#startPoint").attr("data-address"),r=$("#startPoint").attr("data-lnglat"),s=$("#endPoint").attr("data-address"),o=$("#endPoint").attr("data-lnglat");if(""!==i&&""!==s&&void 0!==i&&void 0!==s){void 0!==t.state.data.lineRoute&&t.state.data.lineRoute.destroy(),void 0!==r?a.push(r):a.push(i),$("#wayPointArea input").each((function(){if(""!==$(this).val()){var e=$(this).attr("data-address"),t=$(this).attr("data-lnglat");void 0!==t?a.push(t):a.push(e)}else $(this).parent("div").parent("div").remove()})),void 0!==o?a.push(o):a.push(s);this.getAddressLngLat(a,0,[])}},fencing.prototype.wayPointInputClear=function(e,t){var a=t.id;$("#"+a).attr("data-address","").removeAttr("data-lnglat")},fencing.prototype.getAddressLngLat=function(e,t,a){var n=this,i=e[t];if(this.isChineseChar(i)){var r=new AMap.Geocoder({city:"全国",radius:500});r.getLocation(i,null),r.on("complete",(function(i){if("complete"===i.type){var r=i.geocodes[0].location.lng,s=i.geocodes[0].location.lat;a.push([r,s]),++t===e.length?n.madeDragRoute(a):n.getAddressLngLat(e,t,a)}}))}else t++,a.push(i.split(";")),t===e.length?n.madeDragRoute(a):n.getAddressLngLat(e,t,a)},fencing.prototype.madeDragRoute=function(e){var t=this,a=this.dependency.get("realtimeAMap"),n=a.state.data.lineRoute;this.state.data.isDragRouteFlag=!1,a.state.data.map.plugin("AMap.DragRoute",(function(){(n=new AMap.DragRoute(a.state.data.map,e,AMap.DrivingPolicy.REAL_TRAFFIC,null)).search(),a.state.data.lineRoute=n,n.on("complete",t.dragRouteComplete.bind(t))}))},fencing.prototype.dragRouteComplete=function(e){var t=this.dependency.get("realtimeAMap");this.state.data.isDragRouteFlag=!0,this.clearPointMarker();var a=[],n=[e.data.start.location.lng,e.data.start.location.lat],i=e.data.waypoints,r=[e.data.end.location.lng,e.data.end.location.lat];a.push(n);for(var s=0,o=i.length;s<o;s++)a.push([i[s].location.lng,i[s].location.lat]);a.push(r),this.getAddressValue(a,0,[]);var l="",d="",c="",p="",u=0;for(o=a.length;u<o;u++)0===u||u===o-1?(l+=a[u][0]+";",d+=a[u][1]+";"):(c+=a[u][0]+";",p+=a[u][1]+";");$("#startToEndLng").val(l),$("#startToEndLat").val(d),$("#wayPointLng").val(c),$("#wayPointLat").val(p);var h=t.state.data.lineRoute.getRoute(),m="",v="";for(u=0,o=h.length;u<o;u++)m+=h[u].lng+";",v+=h[u].lat+";";$("#allPointLng").val(m),$("#allPointLat").val(v)},fencing.prototype.clearPointMarker=function(){var e=this.dependency.get("realtimeAMap");if(void 0!==this.state.data.mapVehicle){if(this.state.data.mapVehicle.containsKey("0")){var t=this.state.data.mapVehicle.get("0");e.state.data.map.remove([t])}if(this.state.data.mapVehicle.containsKey("2")){t=this.state.data.mapVehicle.get("2");e.state.data.map.remove([t])}if(this.state.data.mapVehicle.containsKey("1")){var a=this.state.data.mapVehicle.get("1");e.state.data.map.remove(a)}this.state.data.mapVehicle.clear()}},fencing.prototype.getAddressValue=function(e,t,a){var n=this,i=e[t],r=new AMap.Geocoder({radius:1e3,extensions:"all"});r.getAddress(i,null),r.on("complete",(function(i){if("complete"===i.type){var r=i.regeocode.addressComponent.township,s=i.regeocode.formattedAddress;if(a.push([s,r]),++t===e.length){for(var o="",l=1,d=a.length-1;l<d;l++)o+='<div class="form-group"><div class="col-md-10"><input type="text" id="wayPoint'+l+'" placeholder="请输入途经点" class="form-control wayPoint" name="wayPoint" /></div><button type="button" class="btn btn-danger padBottom deleteWayPoint"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span></button></div>';$("#wayPointArea").html(o),$("#startPoint").val(a[0][0]).attr("data-address",a[0][0]),$("#endPoint").val(a[a.length-1][0]).attr("data-address",a[a.length-1][0]);var c=1;for(d=a.length-1;c<d;c++){var p="wayPoint"+c;$("#"+p).val(a[c][0]).attr("data-address",a[c][0]).attr("data-lnglat",e[c][0]+";"+e[c][1]),new AMap.Autocomplete({input:p}).on("select",n.dragRoute),$("#"+p).inputClear().on("onClearEvent",n.wayPointInputClear)}$(".deleteWayPoint").off("click").on("click",n.deleteWayPoint.bind(n))}else n.getAddressValue(e,t,a)}}))},fencing.prototype.deleteWayPoint=function(e){$(e.currentTarget).parent("div.form-group").remove(),this.dragRoute(null)},fencing.prototype.isChineseChar=function(e){return/[\u4E00-\u9FA5\uF900-\uFA2D]/.test(e)},fencing.prototype.clearLineDragRoute=function(){var e=this.dependency.get("realtimeAMap");$("#drivenRoute").hide(),$("#drivenRoute input").each((function(){$(this).val("").attr("data-address","").removeAttr("data-lnglat")})),$("#wayPointArea").html(""),$("#dragRouteDescription").val("");var t=this.state.data.mapVehicle.get("0"),a=this.state.data.mapVehicle.get("2"),n=this.state.data.mapVehicle.get("1");void 0!==t&&e.state.data.map.remove([t]),void 0!==a&&e.state.data.map.remove([a]),void 0!==n&&e.state.data.map.remove([n]),this.state.data.mapVehicle.clear()},fencing.prototype.closeFenceEdit=function(){var e=this.dependency.get("realtimeAMap");this.lineDragRouteClose(),e.state.data.polyFence&&"AMap.Marker"===e.state.data.polyFence.CLASS_NAME&&(e.state.data.polyFence.setDraggable(!1),e.state.data.polyFence.off("mouseup",this.moveMarker),e.state.data.polyFence=void 0),e.mouseToolClose();var t=e.state.data.PolyEditorMap.values();if(Array.isArray(t))for(var a=0,n=t.length;a<n;a++)if(Array.isArray(t[a]))for(var i=0,r=t[a].length;i<r;i++)t[a][i].close();else t[a].close();else t.close();e.state.data.PolyEditorMap.clear()},fencing.prototype.lineDragRouteClose=function(){var e=this.dependency.get("realtimeAMap"),t=$("#travelLineId").val(),a=$.fn.zTree.getZTreeObj("fenceDemo").getNodeByParam("id",t,null);this.getFenceDetail([a],e.state.data.map),this.closeDragRoute(),void 0!==e.state.data.lineRoute&&e.state.data.lineRoute.destroy(),this.clearLineDragRoute(),this.state.data.isDragRouteFlag=!1,this.state.data.addItemFlag=!1},fencing.prototype.moveMarker=function(e){var t=this.dependency.get("realtimeAMap");$("#addOrUpdateMarkerFlag").val("1"),$("#markerId").val(this.state.data.moveMarkerFenceId),$("#markerName").val(this.state.data.moveMarkerBackData.name),$("#markerType").val(this.state.data.moveMarkerBackData.type),$("#markerDescription").val(this.state.data.moveMarkerBackData.description),$("#mark-lng").attr("value",e.lnglat.lng),$("#mark-lat").attr("value",e.lnglat.lat),$("#markerLng").val(e.lnglat.lng),$("#markerLat").val(e.lnglat.lat),$("#mark").modal("show"),t.state.data.polyFence.off("mouseup",this.moveMarker)},fencing.prototype.getFenceDetail=function(e,t){var a=this.dependency.get("realtimeAMap"),n=this;layer.load(2),$.ajax({type:"POST",url:"/clbs/m/functionconfig/fence/bindfence/getFenceDetails",data:{fenceNodes:JSON.stringify(e)},dataType:"json",success:function(e){if(layer.closeAll("loading"),e.success){var i=e.obj;if(null!=i&&i.length>0){"zw_m_line"===i[0].fenceType&&(n.state.data.fanceID=i[0].fenceData[0].lineId);for(var r=0;r<i.length;r++){var s,o,l=i[r].fenceType;"zw_m_travel_line"===l?(s=i[r].allPoints,o=i[r].passPointData):s=i[r].fenceData;var d=void 0===i[r].lineSpot?[]:i[r].lineSpot,c=void 0===i[r].lineSegment?[]:i[r].lineSegment;if("zw_m_marker"===l)a.drawMark(s,t);else if("zw_m_line"===l)n.drawLine(s,d,c,t);else if("zw_m_rectangle"===l)a.drawRectangle(s,t);else if("zw_m_polygon"===l)a.drawPolygon(s,t);else if("zw_m_circle"===l)a.drawCircle(s,t);else if("zw_m_administration"===l){var p=i[0].aId;a.drawAdministration(s,p,t)}else"zw_m_travel_line"===l&&a.drawTravelLine(s,t,i[r].travelLine,o)}}}}})},fencing.prototype.drawLine=function(e,t,a,n){for(var i=this,r=this.dependency.get("realtimeAMap"),s=[],o=0,l=e.length;o<l;o++)s.push([e[o].longitude,e[o].latitude]);s=s.unique3();e[0].longitude,e[0].latitude,e[e.length-1].longitude,e[e.length-1].latitude;var d=e[0].lineId;if($("#lineId").val(d),r.state.data.fenceIDMap.containsKey(d)){var c=r.state.data.fenceIDMap.get(d);if(Array.isArray(c))for(o=0;o<c.length;o++)c[o].hide();else c.hide();r.state.data.fenceIDMap.remove(d)}if(r.state.data.PolyEditorMap.containsKey(d)){var p=r.state.data.PolyEditorMap.get(d);if(Array.isArray(p))for(o=0;o<p.length;o++)p[o].close();else p.close()}var u=[];if(e.length>0){$.each(e,(function(e,t){"0"===t.type&&(u[e]=[t.longitude,t.latitude])}));var h=[];for(o=0;o<t.length;o++){var m=[];this.state.data.content=[],this.state.data.content.push("名称："+t[o].name),this.state.data.content.push("经度："+t[o].longitude),this.state.data.content.push("维度："+t[o].latitude),this.state.data.content.push("达到时间："+t[o].arriveTime),this.state.data.content.push("离开时间："+t[o].leaveTime),this.state.data.content.push("描述："+t[o].description),this.state.data.content.push('<a id="jump" data-id = "'+t[o].id+'" >删除</a>'),m.push(t[o].longitude),m.push(t[o].latitude),this.state.data.drawFence=new AMap.Marker({position:m}),this.state.data.drawFence.content=this.state.data.content.join("<br/>"),this.state.data.drawFence.setMap(n),n.setFitView(this.state.data.drawFence),h.push(this.state.data.drawFence),this.state.data.drawFence.on("click",this.markerClick.bind(this))}if(this.state.data.lineSpotMap.containsKey(d)){var v=this.state.data.lineSpotMap.get(d);r.state.data.map.remove(v),this.state.data.lineSpotMap.remove(d)}this.state.data.lineSpotMap.put(d,h),$.each(u,(function(e,t){void 0===t&&u.splice(e,1)}))}var g=[];if(0!==a.length){var f=[];for(o=0;o<a.length;o++){var b=[],y=a[o].longitude.split(","),k=a[o].latitude.split(",");for(I=0;I<y.length;I++)b[I]=[Number(y[I]),Number(k[I])];f.push(b)}if(this.state.data.sectionPointMarkerMap.containsKey(d)){for(var T=this.state.data.sectionPointMarkerMap.get(d),w=0;w<T.length;w++)T[w].hide();this.state.data.sectionPointMarkerMap.remove(d)}var S=[];for(o=0;o<f.length;o++)if(f[o].length>1){var x=f[o][f[o].length-1],M='<p class="sectionPointIcon">'+(o+1)+"</p>",C=new AMap.Marker({icon:"../../resources/img/sectionPoint.png",position:x,content:M,offset:new AMap.Pixel(-10,-25)});if(C.setMap(r.state.data.map),S.push(C),a[o].maximumSpeed>=0&&a[o].maximumSpeed<=40){var _=new AMap.Polyline({path:f[o],strokeColor:"#66CD00",strokeOpacity:1,strokeWeight:5,strokeStyle:"dashed",strokeDasharray:[10,5]});_.setMap(n),n.setFitView(_),g.push(_)}a[o].maximumSpeed>40&&a[o].maximumSpeed<=80&&((_=new AMap.Polyline({path:f[o],strokeColor:"#EEEE00",strokeOpacity:1,strokeWeight:5,strokeStyle:"dashed",strokeDasharray:[10,5]})).setMap(n),n.setFitView(_),g.push(_)),a[o].maximumSpeed>80&&a[o].maximumSpeed<=100&&((_=new AMap.Polyline({path:f[o],strokeColor:"#EE7600",strokeOpacity:1,strokeWeight:5,strokeStyle:"dashed",strokeDasharray:[10,5]})).setMap(n),n.setFitView(_),g.push(_)),a[o].maximumSpeed>100&&((_=new AMap.Polyline({path:f[o],strokeColor:"#EE0000",strokeOpacity:1,strokeWeight:5,strokeStyle:"dashed",strokeDasharray:[10,5]})).setMap(n),n.setFitView(_),g.push(_))}this.state.data.sectionPointMarkerMap.put(d,S),r.state.data.fenceIDMap.put(d,g)}else _=new AMap.Polyline({path:u,strokeColor:"#3366FF",strokeOpacity:1,strokeWeight:5,strokeStyle:"solid",strokeDasharray:[10,5],zIndex:51}),g.push(_),r.state.data.fenceIDMap.put(d,_),_.setMap(n),n.setFitView(_);if(r.state.data.polyFence=g,this.state.data.isEdit){i=this;for(var I=0;I<r.state.data.polyFence.length;I++){var A=r.state.data.polyFence[I],L=s.slice();A.on("click",(function(e){if(r.state.data.map.getZoom()>=16){var t=e.lnglat.getLng(),o=e.lnglat.getLat(),c=[t,o];if(i.state.data.sectionMarkerPointArray.containsKey(d)){for(var p=i.state.data.sectionMarkerPointArray.get(d),u=p[0],h=[],m=0;m<u.length;m++)if(!1===p[1]){var v=s.indexOf(u[m]);s.splice(v,1)}else h.push(u[m]);h.push(c),i.state.data.sectionMarkerPointArray.remove(d),i.state.data.sectionMarkerPointArray.put(d,[h,!0])}else i.state.data.sectionMarkerPointArray.put(d,[[c],!0]);layer.confirm("请选择需要进行的操作",{btn:["关键点","分段","取消"],closeBtn:0,btn3:function(){0===a.length&&i.sectionRateLimitingClose(d)},id:"lineClickOperation",success:function(e){e.find(".layui-layer-btn").children(".layui-layer-btn1").css({"border-color":"#4898d5","background-color":"#2e8ded",color:"#ffffff"})}},(function(){layer.closeAll(),0===a.length&&i.sectionRateLimitingClose(d),$("#marking-lng").val(t),$("#marking-lat").val(o),$("#lineIDs").val(d),$("#addMonitoringTag").modal("show")}),(function(){if(0!==a.length){$("#lineId").val(d);if(json_ajax("POST","/clbs/m/functionconfig/fence/managefence/resetSegment","json",!1,{lineId:d},i.resetSegment.bind(i)),layer.closeAll(),i.state.data.sectionPointMarkerMap.containsKey(d)){for(var e=i.state.data.sectionPointMarkerMap.get(d),t=0;t<e.length;t++)e[t].hide();i.state.data.sectionPointMarkerMap.remove(d)}i.state.data.fenceSectionPointMap.containsKey(d)&&i.state.data.fenceSectionPointMap.remove(d)}else if(0===a.length){if(i.state.data.fenceSectionPointMap.containsKey(d)){var n=[],o=i.state.data.fenceSectionPointMap.get(d);n.push(c);for(var p=0;p<o.length;p++)n.push(o[p][o[p].length-1]);for(F=0,l=L.length;F<l-1;F++){var u=AMap.GeometryUtil.isPointOnSegment(c,L[F],L[F+1]);if(u&&(L[F][0]!==c[0]||L[F][1]!==c[1])){L.splice(F+1,0,c);break}}i.state.data.fenceSectionPointMap.remove(d);for(var h=[],m=0;m<n.length;m++){l=L.length;for(var v=0;v<l;v++)L[v][0]===n[m][0]&&L[v][1]===n[m][1]&&h.push(v)}var g=0,f=[];if(i.state.data.sectionPointMarkerMap.containsKey(d)){for(e=i.state.data.sectionPointMarkerMap.get(d),t=0;t<e.length;t++)e[t].hide();i.state.data.sectionPointMarkerMap.remove(d)}x=[];for(var b=h.sort(i.sortNumber),y=0;y<b.length;y++){var k=Number(b[y]),T=L.slice(g,k+1);g=k,f.push(T),_=L[b[y]],C='<p class="sectionPointIcon">'+(y+1)+"</p>",(I=new AMap.Marker({icon:"../../resources/img/sectionPoint.png",position:_,content:C,offset:new AMap.Pixel(-10,-25)})).setMap(r.state.data.map),x.push(I)}i.state.data.sectionPointMarkerMap.put(d,x),i.state.data.fenceSectionPointMap.put(d,f)}else{for(F=0,l=L.length-1;F<l;F++)if(u=AMap.GeometryUtil.isPointOnSegment(c,L[F],L[F+1])){if(L[F][0]!==c[0]||L[F][1]!==c[1]){L.splice(F+1,0,c);var w=L.slice(0,F+2),S=L.slice(F+1,L.length);i.state.data.fenceSectionPointMap.put(d,[w,S]);break}w=L.slice(0,F+1),S=L.slice(F,L.length),i.state.data.fenceSectionPointMap.put(d,[w,S])}for(var x=[],M=0;M<2;M++){var C='<p class="sectionPointIcon">'+(M+1)+"</p>",_=[];_=0===M?c:s[s.length-1];var I=new AMap.Marker({icon:"../../resources/img/sectionPoint.png",position:_,content:C,offset:new AMap.Pixel(-10,-25)});I.setMap(r.state.data.map),x.push(I)}i.state.data.sectionPointMarkerMap.put(d,x)}for(var A=[],D=i.state.data.fenceSectionPointMap.get(d),F=0;F<D.length;F++){var P=[];for(M=0;M<D[F].length;M++)P.push(D[F][M][0]+";"+D[F][M][1]);A.push(P)}layer.confirm("是否继续增加分段",{btn:["完成","继续分段"],closeBtn:0},(function(){return __awaiter(this,void 0,void 0,(function(){var e,t,a,n,r,o,c,p,u,h,m,v,g,f,b;return __generator(this,(function(y){switch(y.label){case 0:return $("#lineId").val(d),e=d+"#zw_m_line",[4,i.updateFence(e,!0)];case 1:for(t=y.sent(),a="",n="",layer.closeAll(),f=0;f<A.length;f++)if(r="#route"+(f+1),o="route"+(f+1),b="section-lng"+(f+1),c="section-lat"+(f+1),0===f){for(a+='<li class="active" id="TabFenceBox"><a href="#route1" data-toggle="tab">路段1</a></li>',n+='<div class="tab-pane active" id="route1">',n+='<div class="form-group hidden">',n+='<input id="lineIDms1" name="lineId" value=""/>',n+='<input id="sumn" name="sumn" value=""/>',n+='<div class="col-md-3">',n+='<input  id="section-lng1"   name="longitude" value=""/>',n+="</div>",n+='<div class="col-md-3" >',n+='<input id="section-lat1"   name="latitude" value=""/>',n+="</div>",n+="</div>",n+='<div class="form-group">',n+='<label class="col-md-5 control-label"><label class="text-danger">*</label> 偏移量(m)：</label>',n+='<div class=" col-md-5">',n+='<input type="text" placeholder="请输入偏移量" value="'+t+'" onkeyup="value=value.replace(/[^0-9]/g,\'\') " class="form-control" id="sectionOffset'+f+'" name="offset"/>',n+="</div>",n+="</div>",n+='<div class="form-group">',n+='<label class="col-md-5 control-label">路段行驶过长阈值(s)：</label>',n+='<div class=" col-md-5">',n+='<input type="text" placeholder="请输入路段行驶过长阈值" value="0" class="form-control" id="sectionLongThreshold'+f+'" name="overlengthThreshold"/>',n+="</div>",n+="</div>",n+='<div class="form-group">',n+='<label class="col-md-5 control-label">路段行驶不足阈值(s)：</label>',n+='<div class=" col-md-5">',n+='<input type="text" placeholder="请输入路段行驶不足阈值" value="0" class="form-control" id="sectionInsufficientThreshold'+f+'" name="shortageThreshold"/>',n+="</div>",n+="</div>",n+='<div class="form-group">',n+='<label class="col-md-5 control-label">路段最高速度（km/h）：</label>',n+='<div class=" col-md-5">',n+='<input type="text" placeholder="请输入路段最高速度" value="0" class="form-control" id="maxSpeed'+f+'" name="maximumSpeed"/>',n+="</div>",n+="</div>",n+='<div class="form-group">',n+='<label class="col-md-5 control-label">夜间最高速度(km/h)：</label>',n+='<div class=" col-md-5">',n+='<input type="text" placeholder="请选择夜间限速时间段" value="0" class="form-control" id="nightMaxSpeed'+f+'" name="nightMaxSpeed"/>',n+="</div>",n+="</div>",n+='<div class="form-group">',n+='<label class="col-md-5 control-label">夜间限速时间段：</label>',n+='<div class=" col-md-5">',n+='<input style="cursor: pointer;  background-color: #fafafa;" class="dateTime2 form-control layer-date laydate-icon valid" id="nightLimitTime'+f+'" name="nightLimitTime" readonly>',n+="</div>",n+="</div>",n+='<div class="form-group">',n+='<label class="col-md-5 control-label">超速持续时间（s）：</label>',n+='<div class=" col-md-5">',n+='<input type="text" placeholder="请输入超速持续时间" value="0" class="form-control" id="durationSpeeding'+f+'" name="overspeedTime"/>',n+="</div>",n+="</div>",n+='<div class="isQueryShow"><label>拐点数据 <span class="fa fa-chevron-up" aria-hidden="true"></span></label></div>',n+='<div class="pointList">',p=0;p<A[f].length-1;p++)u=A[f][p].split(";"),n+='<div class="form-group sectionLngLat">',n+='<label class="col-md-2 control-label">经度：</label>',n+='<div class="col-md-3 sectionLng">',n+='<input type="text" id="piecewiseLng'+(h=f+""+p)+'" name="lng" placeholder="请输入经度值" value="'+u[0]+'" class="form-control" />',n+="</div>",n+='<label class="col-md-2 control-label">纬度：</label>',n+='<div class="col-md-3 sectionLat">',n+='<input type="text" id="piecewiseLat'+h+'" name="lat" placeholder="请输入纬度值" value="'+u[1]+'" class="form-control" />',n+="</div>",0===p?(n+='<button type="button" class="btn btn-primary addLngLat">',n+='<span class="glyphicon glyphicon-plus" aria-hidden="true"></span>',n+="</button>"):(n+='<button type="button" class="btn btn-danger removeLngLat">',n+='<span class="glyphicon glyphicon-trash" aria-hidden="true"></span>',n+="</button>"),n+="</div>";n+="</div>",n+="</div>"}else{if(a+='<li id="TabFenceBox"><a href="'+r+'" data-toggle="tab">路段'+(f+1)+"</a></li>",n+='<div class="tab-pane" id="'+o+'">',n+='<div class="form-group hidden">',n+='<div class="col-md-3">',n+='<input  id="'+b+'"    name="longitude" value=""/>',n+="</div>",n+='<div class="col-md-3" >',n+='<input id="'+c+'"   name="latitude" value=""/>',n+="</div>",n+="</div>",n+='<div class="form-group">',n+='<label class="col-md-5 control-label"><label class="text-danger">*</label> 偏移量(m)：</label>',n+='<div class=" col-md-5">',n+='<input type="text" placeholder="请输入偏移量" value="'+t+'" onkeyup="value=value.replace(/[^0-9]/g,\'\') " class="form-control" id="sectionOffset'+f+'" name="offset"/>',n+="</div>",n+="</div>",n+='<div class="form-group">',n+='<label class="col-md-5 control-label">  路段行驶过长阈值(s)：</label>',n+='<div class=" col-md-5">',n+='<input type="text" placeholder="请输入路段行驶过长阈值" value="0" class="form-control" id="sectionLongThreshold'+f+'" name="overlengthThreshold"/>',n+="</div>",n+="</div>",n+='<div class="form-group">',n+='<label class="col-md-5 control-label">路段行驶不足阈值(s)：</label>',n+='<div class=" col-md-5">',n+='<input type="text" placeholder="请输入路段行驶不足阈值" value="0" class="form-control" id="sectionInsufficientThreshold'+f+'" name="shortageThreshold"/>',n+="</div>",n+="</div>",n+='<div class="form-group">',n+='<label class="col-md-5 control-label">路段最高速度（km/h）：</label>',n+='<div class=" col-md-5">',n+='<input type="text" placeholder="请输入路段最高速度" value="0" class="form-control" id="maxSpeed'+f+'" name="maximumSpeed"/>',n+="</div>",n+="</div>",n+='<div class="form-group">',n+='<label class="col-md-5 control-label">夜间最高速度(km/h)：</label>',n+='<div class=" col-md-5">',n+='<input type="text" placeholder="请选择夜间限速时间段" value="0" class="form-control" id="nightMaxSpeed'+f+'" name="nightMaxSpeed"/>',n+="</div>",n+="</div>",n+='<div class="form-group">',n+='<label class="col-md-5 control-label">夜间限速时间段：</label>',n+='<div class=" col-md-5">',n+='<input style="cursor: pointer;  background-color: #fafafa;" class="dateTime2 form-control layer-date laydate-icon valid" id="nightLimitTime'+f+'" name="nightLimitTime" readonly>',n+="</div>",n+="</div>",n+='<div class="form-group">',n+='<label class="col-md-5 control-label">超速持续时间（s）：</label>',n+='<div class=" col-md-5">',n+='<input type="text" placeholder="请输入超速持续时间" value="0" class="form-control" id="durationSpeeding'+f+'" name="overspeedTime"/>',n+="</div>",n+="</div>",n+='<div class="isQueryShow"><label>拐点数据 <span class="fa fa-chevron-up" aria-hidden="true"></span></label></div>',n+='<div class="pointList">',f===A.length-1)for(p=1;p<A[f].length;p++)u=A[f][p].split(";"),n+='<div class="form-group sectionLngLat">',n+='<label class="col-md-2 control-label">经度：</label>',n+='<div class="col-md-3 sectionLng">',n+='<input type="text" id="piecewiseLng'+(h=f+""+p)+'" name="lng" placeholder="请输入经度值" value="'+u[0]+'" class="form-control" />',n+="</div>",n+='<label class="col-md-2 control-label">纬度：</label>',n+='<div class="col-md-3 sectionLat">',n+='<input type="text" id="piecewiseLat'+h+'" name="lat" placeholder="请输入纬度值" value="'+u[1]+'" class="form-control" />',n+="</div>",1===p?(n+='<button type="button" class="btn btn-primary addLngLat">',n+='<span class="glyphicon glyphicon-plus" aria-hidden="true"></span>',n+="</button>"):(n+='<button type="button" class="btn btn-danger removeLngLat">',n+='<span class="glyphicon glyphicon-trash" aria-hidden="true"></span>',n+="</button>"),n+="</div>";else for(p=1;p<A[f].length-1;p++)u=A[f][p].split(";"),n+='<div class="form-group sectionLngLat">',n+='<label class="col-md-2 control-label">经度：</label>',n+='<div class="col-md-3 sectionLng">',n+='<input type="number" type="number" min="73.66" max="135.05" name="lng" placeholder="请输入经度值" value="'+u[0]+'" class="form-control" />',n+="</div>",n+='<label class="col-md-2 control-label">纬度：</label>',n+='<div class="col-md-3 sectionLat">',n+='<input type="number" min="3.86" max="53.55" name="lat" placeholder="请输入纬度值" value="'+u[1]+'" class="form-control" />',n+="</div>",1===p?(n+='<button type="button" class="btn btn-primary addLngLat">',n+='<span class="glyphicon glyphicon-plus" aria-hidden="true"></span>',n+="</button>"):(n+='<button type="button" class="btn btn-danger removeLngLat">',n+='<span class="glyphicon glyphicon-trash" aria-hidden="true"></span>',n+="</button>"),n+="</div>";n+="</div>",n+="</div>"}for(m=[],v=[],g=[],f=0,l=s.length;f<l;f++)m.push(f),v.push(s[f][0]),g.push(s[f][1]);for($("#pointSeqs").val(m.join(",")),$("#longitudes").val(v.join(",")),$("#latitudes").val(g.join(",")),$("#tenples").html(a),$("#pagecontent").html(n),$(".addLngLat").unbind("click").bind("click",i.addLngLat.bind(i)),$(".removeLngLat").unbind("click").bind("click",i.removeLngLat.bind(this)),$(".isQueryShow").unbind("click").bind("click",i.isQueryShow),$("#lineIDms1").attr("value",d),$("#sumn").attr("value",A.length),f=0;f<A.length;f++)b="section-lng"+(f+1),$("#"+b).attr("value",A[f]+"]"),laydate.render({elem:"#nightLimitTime"+f,type:"time",range:"--",format:"HH:mm",noSecond:!0,trigger:"click"});return $("#addMonitoringSection").modal("show"),[2]}}))}))}),(function(){}))}}))}else n.setZoomAndCenter(16,[e.lnglat.getLng(),e.lnglat.getLat()])}))}}},fencing.prototype.sectionRateLimitingClose=function(e){var t,a=this.dependency.get("realtimeAMap");(this.clearErrorMsg(),t="object"==typeof e?$("#lineIDms1").attr("value"):e,this.state.data.sectionMarkerPointArray.containsKey(t))&&(this.state.data.sectionMarkerPointArray.get(t)[1]=!1,this.state.data.sectionMarkerPointArray.remove(t));if(this.state.data.fenceSectionPointMap.containsKey(t)&&this.state.data.fenceSectionPointMap.remove(t),this.state.data.sectionPointMarkerMap.containsKey(t)){var n=this.state.data.sectionPointMarkerMap.get(t);a.state.data.map.remove(n),this.state.data.sectionPointMarkerMap.remove(t),$("#tenples").html(""),$("#pagecontent").html("")}},fencing.prototype.updateFence=function(e,t){return __awaiter(this,void 0,void 0,(function(){var a,n,i,r,s,o,l,d,c,p,u,h,m,v,g,f,b,y,k,T,w,S,x,M,C,_,I,A,L,D,F,P,N,O,R,z;return __generator(this,(function(E){switch(E.label){case 0:return c=this.dependency.get("realtimeAMap"),a=this,i=e.split("#"),r=i[0],i[1],s=3===i.length?i[0]+"#"+i[1]:e,(o=new FormData).set("fenceIdShape",s),[4,_framework_utils_ajax__WEBPACK_IMPORTED_MODULE_0__.a.post("/clbs/m/functionconfig/fence/managefence/previewFence",o)];case 1:if(l=E.sent(),(d=l.data).success)if(c=this.dependency.get("realtimeAMap"),p=c.state.data.map,u=d.obj,t)n=u[0].line.width;else if(2===i.length){if(null!=u&&u.length>0)for($("#myPageTop").hide(),$("#result").hide(),$(".fenceA").removeClass("fenceA-active"),c.mouseToolClose(),c.state.data.mouseTool1.close(!0),k=0;k<u.length;k++)if("zw_m_travel_line"===(h=u[k].fenceType)?(v=u[k].travelLine,g=u[k].passPointData):m=u[k].fenceData,f=u[k].line,void 0===u[k].lineSegment?[]:u[k].lineSegment,[],b=u[k].polygon,"zw_m_marker"===h)layer.msg("请鼠标拖动标注进行修改"),p.off("rightclick",this.state.data.amendLine),p.off("rightclick",c.state.data.amendPolygon),p.off("rightclick",this.state.data.amendCircle),c.drawMark(m,p),c.state.data.polyFence.setDraggable(!0),this.state.data.moveMarkerFenceId=r,this.state.data.moveMarkerBackData=m,c.state.data.polyFence.on("mouseup",this.moveMarker.bind(this));else if("zw_m_line"===h){for($("#lineId").val(r),"/clbs/m/functionconfig/fence/managefence/resetSegment",json_ajax("POST","/clbs/m/functionconfig/fence/managefence/resetSegment","json",!1,{lineId:r},this.resetSegment.bind(this)),layer.closeAll(),this.state.data.fenceSectionPointMap.containsKey(r)&&this.state.data.fenceSectionPointMap.remove(r),c.state.data.PolyEditorMap.containsKey(r)&&c.state.data.PolyEditorMap.remove(r),y=[],k=0;k<c.state.data.polyFence.length;k++)(T=new AMap.PolyEditor(p,c.state.data.polyFence[k])).open(),y.push(T);if(c.state.data.PolyEditorMap.put(r,y),this.state.data.sectionPointMarkerMap.containsKey(r)){for(w=this.state.data.sectionPointMarkerMap.get(r),S=0;S<w.length;S++)w[S].hide();this.state.data.sectionPointMarkerMap.remove(r)}if(this.state.data.lineSpotMap.containsKey(r))for(x=this.state.data.lineSpotMap.get(r),k=0;k<x.length;k++)x[k].hide();p.off("rightclick",this.state.data.amendCircle),p.off("rightclick",c.state.data.amendPolygon),this.state.data.amendLine=function(){a.rightClickHandler(h,f,r)},p.on("rightclick",this.state.data.amendLine)}else if("zw_m_rectangle"===h)layer.msg("请重新在地图上选择区域"),c.drawRectangle(m,p),c.mouseToolRectangle(),this.state.data.rectangle=!0,c.state.data.mouseTool1.on("draw",(function(e){if(!a.state.data.isAddFlag&&!a.state.data.isAreaSearchFlag){var t=e.obj.getPath(),n="",i="",s="",o=new Array;if(t){for(var l=[t[0].P],d=0;d<t.length;d++)0!=d&&t[d].P==l[0]&&l.push(t[d].P),o.push([t[d].lng,t[d].lat]);for(t.length!=l.length&&($("#LUPointLngLat").val(o[0][0]+","+o[0][1]),o.length>2&&$("#RDPointLngLat").val(o[2][0]+","+o[2][1])),d=0;d<o.length;d++)$("#table-lng-lat tbody tr:nth-child("+d+"1)").children("td:nth-child(2)").text(o[d][0]),$("#table-lng-lat tbody tr:nth-child("+d+"1)").children("td:nth-child(3)").text(o[d][1]),n+=d+",",i+=o[d][0]+",",s+=o[d][1]+","}n.length>0&&(n=n.substr(0,n.length-1)),i.length>0&&(i=i.substr(0,i.length-1)),s.length>0&&(s=s.substr(0,s.length-1)),$("#addOrUpdateRectangleFlag").val("1"),$("#rectangleId").val(r),$("#rectangleName").val(m.name),$("#rectangleType").val(m.type),$("#rectangleDescription").val(m.description),$("#pointSeqsRectangles").val(n),$("#longitudesRectangles").val(i),$("#latitudesRectangles").val(s),setTimeout((function(){$("#rectangle-form").modal("show")}),200)}})),p.off("rightclick",this.state.data.amendLine),p.off("rightclick",c.state.data.amendPolygon),p.off("rightclick",this.state.data.amendCircle);else if("zw_m_polygon"===h)c.drawPolygon(m,p),c.state.data.PolyEditorMap.containsKey(r)&&c.state.data.PolyEditorMap.remove(r),(M=new AMap.PolyEditor(p,c.state.data.polyFence)).open(),c.state.data.PolyEditorMap.put(r,M),p.off("rightclick",this.state.data.amendCircle),p.off("rightclick",this.state.data.amendLine),c.state.data.amendPolygon=function(){a.rightClickHandler(h,b,r)},p.on("rightclick",c.state.data.amendPolygon);else if("zw_m_circle"===h)c.drawCircle(m,p),c.state.data.PolyEditorMap.containsKey(r)&&c.state.data.PolyEditorMap.remove(r),(C=new AMap.CircleEditor(p,c.state.data.polyFence)).open(),c.state.data.PolyEditorMap.put(r,C),p.off("rightclick",this.state.data.amendLine),p.off("rightclick",c.state.data.amendPolygon),this.state.data.amendCircle=function(){$("#addOrUpdateCircleFlag").val("1"),$("#circleId").val(r),$("#circleName").val(m.name),$("#circleType").val(m.type),$("#circleDescription").val(m.description);var e=c.state.data.polyFence.getCenter(),t=c.state.data.polyFence.getRadius();$("#circle-lng").attr("value",e.lng),$("#circle-lat").attr("value",e.lat),$("#circle-radius").attr("value",t),$("#editCircleLng").val(e.lng),$("#editCircleLat").val(e.lat),$("#editCircleRadius").val(t),setTimeout((function(){$("#circleArea").modal("show")}),200)},p.on("rightclick",this.state.data.amendCircle);else if("zw_m_administration"===h);else if("zw_m_travel_line"===h){if(this.state.data.isAddDragRoute=!0,$("#addOrUpdateTravelFlag").val("1"),_=v.id,$("#travelLineId").val(_),c.state.data.travelLineMap.containsKey(_)&&(I=c.state.data.travelLineMap.get(_),p.remove([I]),c.state.data.travelLineMap.remove(_)),A=v.lineOffset,L=v.lineType,D=v.name,F=v.description,$("#dragRouteLineName").val(D),$("#dragRouteType").val(L),$("#excursion").val(A),$("#dragRouteDescription").val(F),P=[v.startLongitude,v.startLatitude],N=[v.endLongitude,v.endLatitude],(O=[]).push(P),void 0!==g)for(R=0,z=g.length;R<z;R++)O.push([g[R].longitude,g[R].latitude]);O.push(N),this.getAddressValue(O,0,[]),$("#drivenRoute").show(),this.madeDragRoute(O)}}else this.fenceDetails(u);else layer.msg(d.msg);return[2,n]}}))}))},fencing.prototype.sortNumber=function(e,t){return e-t},fencing.prototype.markerClick=function(e){var t=this,a=this.dependency.get("realtimeAMap"),n=this.dependency.get("data"),i=Object(_framework_utils_websocket__WEBPACK_IMPORTED_MODULE_4__.a)({access_token:n.get("access_token")}),r={access_token:n.get("access_token")};i.subscribe(r,"/topic/deviceReportLog",(function(e){var a=JSON.parse(e.body),n=a.desc.msgID,i=a.desc.monitorId,r=$("#infowindowShowVid").val(),s={waybill:"",practitioners:null};t.state.data.waybillAndPractitionersInfo.containsKey(i)&&(s=t.state.data.waybillAndPractitionersInfo.get(i)),1793==n?(s.waybill=a.data.msgBody.data,i==r&&$("#bombBox7").text("电子运单："+(s.waybill?s.waybill:""))):1794==n&&(s.practitioners=a.data.msgBody,i==r&&($("#bombBox8").text("从业人员："+(s.practitioners.driverName?s.practitioners.driverName:"")),$("#cardIDBox").text("身份证号："+(s.practitioners.driverIdentity?s.practitioners.driverIdentity:"")),$("#bombBox9").text("从业资格证号："+(s.practitioners.certificationID?s.practitioners.certificationID:"")),$("#cANameBox").text("发证机构："+(s.practitioners.cAName?s.practitioners.cAName:"")))),t.state.data.waybillAndPractitionersInfo.put(i,s)}),null,null);var s=e.target.getPosition();a.state.data.infoWindow.setContent(e.target.content),a.state.data.infoWindow.open(a.state.data.map,s)},fencing.prototype.resetSegment=function(e){e.success?this.resetFance():e.msg.toString().indexOf("系统错误")>-1&&layer.msg(e.msg,{move:!1})},fencing.prototype.resetFance=function(){var e=this,t=this.dependency.get("realtimeAMap"),a=t.state.data.map,n=$.fn.zTree.getZTreeObj("fenceDemo"),i=$("#lineId").val(),r=n.getNodesByParam("id",i,null);layer.load(2),$.ajax({type:"POST",url:"/clbs/m/functionconfig/fence/bindfence/getFenceDetails",async:!1,data:{fenceNodes:JSON.stringify(r)},dataType:"json",success:function(n){if(layer.closeAll("loading"),n.success){var i=n.obj;if(null!=i&&i.length>0){"zw_m_line"===i[0].fenceType&&(e.state.data.fanceID=i[0].fenceData[0].lineId);for(var r=0;r<i.length;r++){var s=i[r].fenceType,o=i[r].fenceData,l=i[r].lineSpot,d=void 0===i[r].lineSegment?[]:i[r].lineSegment;"zw_m_marker"===s?t.drawMark(o,a):"zw_m_line"===s?e.drawLine(o,l,d,a):"zw_m_rectangle"===s?t.drawRectangle(o,a):"zw_m_polygon"===s?t.drawPolygon(o,a):"zw_m_circle"===s&&t.drawCircle(o,a)}}}}})},fencing.prototype.addLngLat=function(e){var t=$(e.currentTarget).parent(".sectionLngLat").parent("div").parents("div").attr("id"),a=$(e.currentTarget).parent("div.sectionLngLat").clone(!0),n=$(e.currentTarget).parent(".sectionLngLat").parent("div").children(".sectionLngLat:last-child"),i=n.children(".sectionLng").children("input").attr("id")+1,r=n.children(".sectionLat").children("input").attr("id")+1;a.children("div.sectionLng").children("input").attr("value","").val("").attr("id",i).siblings("label.error").remove(),a.children("div.sectionLat").children("input").attr("value","").val("").attr("id",r).siblings("label.error").remove(),a.children("button").attr("class","btn btn-danger removeLngLat").children("span").attr("class","glyphicon glyphicon-trash"),$("#"+t).children("div.pointList").append(a),$(".removeLngLat").unbind("click").bind("click",this.removeLngLat.bind(this))},fencing.prototype.removeLngLat=function(e){$(e.currentTarget).parent(".sectionLngLat").remove()},fencing.prototype.isQueryShow=function(){$(this).next("div.pointList").is(":hidden")?($(this).children("label").children("span").attr("class","fa fa-chevron-down"),$(this).next("div.pointList").slideDown()):($(this).children("label").children("span").attr("class","fa fa-chevron-up"),$(this).next("div.pointList").slideUp())},fencing.prototype.closeDragRout=function(){var e=this.dependency.get("realtimeAMap");this.state.data.isAddDragRoute=!1,void 0!==e.state.data.contextMenu&&e.state.data.contextMenu.close(),$("#drivenRoute").hide()},fencing.prototype.fenceBind=function(e,t,a,n){return this.clearFenceBind(),$("#fenceID").val(e),$("#fenceName").val(t),$("#fenceInfoId").val(a),"zw_m_line"==e||"zw_m_rectangle"==e||"zw_m_circle"==e||"zw_m_polygon"==e?$(".addFenceTh").show():$(".addFenceTh").hide(),$("#fenceBind").modal("show"),this.initBindFenceTree(),!1},fencing.prototype.clearFenceBind=function(){$("#searchVehicle").val(""),$("#tableList tbody").html("")},fencing.prototype.initBindFenceTree=function(){this.state.data.bindFenceSetChar={async:{url:this.getFenceTreeUrl,type:"post",enable:!0,autoParam:["id"],dataType:"json",otherParam:{type:"multiple"},dataFilter:this.ajaxDataFilter.bind(this)},check:{enable:!0,chkStyle:"checkbox",chkboxType:{Y:"s",N:"s"},radioType:"all"},view:{dblClickExpand:!1,nameIsHTML:!0,fontCss:setFontCss_ztree},data:{simpleData:{enable:!0}},callback:{beforeClick:this.beforeClickFenceVehicle.bind(this),onAsyncSuccess:this.zTreeVFenceOnAsyncSuccess.bind(this),beforeCheck:this.zTreeBeforeCheck.bind(this),onCheck:this.onCheckFenceVehicle.bind(this),onExpand:this.zTreeOnExpand.bind(this),onNodeCreated:this.zTreeOnNodeCreated.bind(this)}},$.fn.zTree.init($("#treeDemoFence"),this.state.data.bindFenceSetChar,null)},fencing.prototype.getFenceTreeUrl=function(e,t){return null==t?"/clbs/m/functionconfig/fence/bindfence/alarmSearchTree":"assignment"===t.type?"/clbs/m/functionconfig/fence/bindfence/putMonitorByAssign?assignmentId="+t.id+"&isChecked="+t.checked+"&monitorType=monitor":void 0},fencing.prototype.ajaxDataFilter=function(e,t,a){$.fn.zTree.getZTreeObj("treeDemoFence");if(a.msg){var n,i=JSON.parse(Object(_framework_utils_unzip__WEBPACK_IMPORTED_MODULE_5__.a)(a.msg));null!=i.tree&&void 0!==i.tree?(n=i.tree,this.state.data.fenceSize=i.size):n=i;for(var r=0;r<n.length;r++)"group"===n[r].type&&(n[r].open=!0)}return n},fencing.prototype.createSuccess=function(e){if($("#queryClick i").hasClass("active")){this.state.data.changeArray=e.obj.getBounds();ajax_submit("POST","/clbs/v/monitoring/regionalQuery","json",!0,null,!0,this.regionalQuery)}if("AMap.Marker"===e.obj.CLASS_NAME){$("#addOrUpdateMarkerFlag").val("0");var t=e.obj.getPosition();$("#mark-lng").attr("value",t.lng),$("#markerLng").val(t.lng),$("#mark-lat").attr("value",t.lat),$("#markerLat").val(t.lat),$("#mark").modal("show")}if("AMap.Circle"===e.obj.CLASS_NAME){$("#addOrUpdateCircleFlag").val("0");var a=e.obj.getCenter(),n=e.obj.getRadius();$("#circle-lng").attr("value",a.lng),$("#circle-lat").attr("value",a.lat),$("#circle-radius").attr("value",n),$("#editCircleLng").val(a.lng),$("#editCircleLat").val(a.lat),$("#editCircleRadius").val(n),$("#circleArea").modal("show")}if("AMap.Polyline"===e.obj.CLASS_NAME||"AMap.Polygon"===e.obj.CLASS_NAME){for(var i="",r="",s="",o=new Array,l=e.obj.getPath(),d=0;d<l.length;d++)o.push([l[d].lng,l[d].lat]);o=this.removeAdjoinRepeatPoint(o);var c="";for(d=0;d<o.length;d++)c+="<tr>",c+="<td>"+d+"</td>",c+="<td>aa</td>",c+="<td>bb</td>",c+="</tr>";$("#tal").html(c);var p='<div class="isQueryShow" style="padding: 0 30px"><label>拐点数据 <span class="fa fa-chevron-up" aria-hidden="true"></span></label></div>';for(p+='<div class="pointList" style="padding-right: 30px">',d=0;d<o.length;d++){$("#table-lng-lat tbody tr:nth-child("+Number(d+1)+")").children("td:nth-child(2)").text(o[d][0]),$("#table-lng-lat tbody tr:nth-child("+Number(d+1)+")").children("td:nth-child(3)").text(o[d][1]),i+=d+",",r+=o[d][0]+",",s+=o[d][1]+",";var u=d;p+='<div class="form-group sectionLngLat">',p+='<label class="col-md-2 control-label">经度：</label>',p+='<div class="col-md-3 sectionLng">',p+='<input type="text" id="piecewiseLng'+u+'" name="lng" placeholder="请输入经度值" value="'+o[d][0]+'" class="form-control" />',p+="</div>",p+='<label class="col-md-2 control-label">纬度：</label>',p+='<div class="col-md-3 sectionLat">',p+='<input type="text" id="piecewiseLat'+u+'" name="lat" placeholder="请输入纬度值" value="'+o[d][1]+'" class="form-control" />',p+="</div>",p+='<button type="button" class="btn btn-primary addLngLat">',p+='<span class="glyphicon glyphicon-plus" aria-hidden="true"></span>',p+="</button>&ensp;",p+='<button type="button" class="btn btn-danger removeLngLat">',p+='<span class="glyphicon glyphicon-trash" aria-hidden="true"></span>',p+="</button>",p+="</div>"}if($("#inflectionPointBox").html(p),$(".addLngLat").unbind("click").bind("click",this.newAddLngLat),$(".removeLngLat").unbind("click").bind("click",this.newRemoveLngLat),$(".isQueryShow").unbind("click").bind("click",this.isQueryShow),i.length>0&&(i=i.substr(0,i.length-1)),r.length>0&&(r=r.substr(0,r.length-1)),s.length>0&&(s=s.substr(0,s.length-1)),$("#pointSeqs").val(i),$("#longitudes").val(r),$("#latitudes").val(s),$("#pointSeqsRectangles").val(i),$("#longitudesRectangles").val(r),$("#latitudesRectangles").val(s),$("#pointSeqsPolygons").val(i),$("#longitudesPolygons").val(r),$("#latitudesPolygons").val(s),"AMap.Polyline"!==e.obj.CLASS_NAME||this.state.data.isDistanceCount||($("#addOrUpdateLineFlag").val("0"),$("#addLine").modal("show")),"AMap.Polygon"===e.obj.CLASS_NAME&&this.state.data.clickRectangleFlag&&this.state.data.isAddFlag&&!this.state.data.isAreaSearchFlag){if(o.length<4)return!1;$("#LUPointLngLat").val(o[0][0]+","+o[0][1]),$("#RDPointLngLat").val(o[2][0]+","+o[2][1]),$("#addOrUpdateRectangleFlag").val("0"),$("#rectangle-form").modal("show")}if("AMap.Polygon"===e.obj.CLASS_NAME&&!this.state.data.clickRectangleFlag&&this.state.data.isAddFlag&&!$("#queryClick i").hasClass("active")){var h="";for(d=0;d<o.length;d++)h+='<div class="form-group"><label class="col-md-3 control-label">顶点'+(d+1)+'经纬度：</label><div class=" col-md-8"><input type="text" placeholder="请输入顶点经纬度" value="'+o[d][0]+","+o[d][1]+'" class="form-control rectangleAllPointLngLat"/></div></div>';$("#rectangleAllPointShow").html(h),$("#addOrUpdatePolygonFlag").val("0"),$("#myModal").modal("show")}}},fencing.prototype.regionalQuery=function(e){var t=this.dependency.get("realtimeAMap");$("#dataTable tbody").html("");for(var a=e.obj,n=!1,i=$.fn.zTree.getZTreeObj("treeDemo"),r="",s=[],o=[],l=0,d=0;d<a.length;d++){var c=a[d][2],p=a[d][1];if(!0===this.state.data.changeArray.contains([c,p])){n=!0;var u=a[d][0];if(-1===o.toString().indexOf(u)){l++;var h=a[d][4],m=a[d][3],v=i.getNodesByParam("id",u,null);this.state.data.crrentSubV.push(a[d][0]),this.state.data.crrentSubName.push(a[d][4]);for(var g=0;g<v.length;g++)i.checkNode(v[g],!0,!0),v[g].checkedOld=!0,i.updateNode(v[g]);this.state.data.cheakdiyuealls.push(u),r+="<tr><td>"+h+"</td><td>"+m+"</td></tr>";var f=new Object;f.vehicleID=u,s.push(f),o.push(u)}}}if($("#sumRegionalQuery").text("共计"+l+"监控对象！"),$("#dataTable tbody").html(r),n){$("#areaSearchCar").modal("show");$("#userName").text();this.state.data.cancelList=[],this.state.data.isAreaSearch=!0}else layer.msg("该区域没有任何监控对象"),t.mouseToolClose(),$("#queryClick i").removeClass("active"),$("#queryClick span").css("color","#5c5e62")},fencing.prototype.removeAdjoinRepeatPoint=function(e){var t=new Array;if(null!=e&&e.length>1){t.push([e[0][0],e[0][1]]);for(var a=1;a<e.length;a++){var n=e[a][0],i=e[a][1];n===e[a-1][0]&&i===e[a-1][1]||t.push([n,i])}e=t}return e},fencing.prototype.newAddLngLat=function(){var e=$(this).closest(".pointList"),t=$(this).parent("div.sectionLngLat"),a=t.clone(!0),n=e.find("div.sectionLngLat").length;a.find("input").val(""),a.find("input").eq(0).attr("id","piecewiseLng"+n),a.find("input").eq(1).attr("id","piecewiseLat"+n),t.after(a),$(".addLngLat").unbind("click").bind("click",this.newAddLngLat),$(".removeLngLat").unbind("click").bind("click",this.newRemoveLngLat),n>1&&e.find("button.removeLngLat").removeAttr("disabled")},fencing.prototype.newRemoveLngLat=function(){$(this).parent(".sectionLngLat").remove(),$(".pointList").find("div.sectionLngLat").length<3&&$(".pointList").find("button.removeLngLat").prop("disabled",!0)},fencing.prototype.lngLatTextShow=function(){var e=$(this).parent("div").next("div.pointList");e.is(":hidden")?($(this).children("span").attr("class","fa fa-chevron-down"),e.slideDown()):($(this).children("span").attr("class","fa fa-chevron-up"),e.slideUp())},fencing.prototype.annotatedSave=function(thisBtn){var amap=this.dependency.get("realtimeAMap"),_this=this;if(this.validate_marker()){thisBtn.disabled=!0;var markerLng=$("#markerLng").val(),markerLat=$("#markerLat").val();$("#mark-lng").val(markerLng),$("#mark-lat").val(markerLat),$("#marker").ajaxSubmit((function(data){var datas=eval("("+data+")");if(!0===datas.success){_this.state.data.saveFenceName=$("#markerName").val(),_this.state.data.saveFenceType="zw_m_marker",$("#mark").modal("hide"),amap.mouseToolClose();var markFenceID=$("#markerId").val();_this.addNodes();var markFence=amap.state.data.fenceIDMap.get(markFenceID);void 0!==markFence&&markFence.setDraggable(!1);var zTree=$.fn.zTree.getZTreeObj("fenceDemo"),nodes=zTree.getNodesByParam("id",markFenceID,null);_this.getFenceDetail(nodes,amap.state.data.map)}else null==datas.msg?layer.msg("该标注围栏名称已存在，请重新输入"):null!=datas.msg&&layer.msg(data.msg,{move:!1})}))}},fencing.prototype.validate_marker=function(){return $("#marker").validate({rules:{name:{required:!0,maxlength:10},description:{maxlength:255},groupName:{required:!0},markerLngName:{required:!0,range:[1,200]},markerLatName:{required:!0,range:[1,200]}},messages:{name:{required:"您忘记输入标注名称啦",maxlength:"长度不超过10位"},description:{maxlength:"长度不超过255位"},groupName:{required:"请选择所属企业"},markerLngName:{required:"经纬度不能为空",range:"输入的数字必须在1-200之间"},markerLatName:{required:"经纬度不能为空",range:"输入的数字必须在1-200之间"}}}).form()},fencing.prototype.addNodes=function(){this.state.data.fenceIdArray=[],this.state.data.fenceOpenArray=[];for(var e=$.fn.zTree.getZTreeObj("fenceDemo"),t=e.getNodes(),a=0,n=t.length;a<n;a++)!0===t[a].open&&this.state.data.fenceOpenArray.push(t[a].id);var i=e.getCheckedNodes(!0);for(a=0,n=i.length;a<n;a++)this.state.data.fenceIdArray.push(i[a].id);var r={async:{url:"/clbs/m/functionconfig/fence/bindfence/fenceTree",type:"post",enable:!0,autoParam:["id"],dataType:"json",dataFilter:this.ajaxFenceDataFilter.bind(this),otherParam:{type:"multiple"}},check:{enable:!0,chkStyle:"checkbox",chkboxType:{Y:"s",N:"s"},radioType:"all"},view:{addHoverDom:this.addHoverDom.bind(this),removeHoverDom:this.removeHoverDom.bind(this),dblClickExpand:!1,nameIsHTML:!0,fontCss:setFontCss_ztree},data:{simpleData:{enable:!0}},callback:{onClick:this.onClickFenceChar.bind(this),onCheck:this.onCheckFenceChar.bind(this),onAsyncSuccess:this.zTreeOnAsyncFenceSuccess.bind(this)}};$.fn.zTree.init($("#fenceDemo"),r,null)},fencing.prototype.ajaxFenceDataFilter=function(e,t,a){if(a){for(var n=0;n<a.length;n++)a[n].open=!1,a[n].name=html2Escape(a[n].name,null),"fence"===a[n].type&&-1!==this.state.data.fenceIdArray.indexOf(a[n].id)&&(a[n].checked=!0),"fenceParent"===a[n].type&&-1!==this.state.data.fenceOpenArray.indexOf(a[n].id)&&(a[n].open=!0),"fenceParent"===a[n].type&&a[n].id===this.state.data.saveFenceType&&(a[n].open=!0),1===a[n].markIcon&&(a[n].iconSkin="zw_m_marker_circle_skin");a.push({name:"图层",pId:"0",id:"zw_m_travel_layer",type:"fenceParent",open:!1}),a.push({iconSkin:"zw_m_rectangle_skin",name:"图层1",pId:"zw_m_travel_layer",type:"fence",open:!1}),a.push({iconSkin:"zw_m_rectangle_skin",name:"图层2",pId:"zw_m_travel_layer",type:"fence",open:!1})}return a},fencing.prototype.markFenceClose=function(){var e=this.dependency.get("realtimeAMap");e.mouseToolClose();var t=$("#markerId").val(),a=$.fn.zTree.getZTreeObj("fenceDemo").getNodesByParam("id",t,null);this.getFenceDetail(a,e.state.data.map)},fencing.prototype.rightClickHandler=function(e,t,a){var n,i=this.dependency.get("realtimeAMap").state.data.polyFence;if(Array.isArray(i)){for(var r=[],s=0;s<i.length;s++){var o=i[s].getPath();r=r.concat(o)}n=r}else n=i.getPath();for(var l="",d="",c="",p=[],u=0;u<n.length;u++)p.push([n[u].lng,n[u].lat]);var h='<div class="isQueryShow" style="padding: 0 30px"><label>拐点数据 <span class="fa fa-chevron-up" aria-hidden="true"></span></label></div>';for(h+='<div class="pointList" style="padding-right: 30px">',u=0;u<p.length;u++){$("#table-lng-lat tbody tr:nth-child("+Number(u+1)+")").children("td:nth-child(2)").text(p[u][0]),$("#table-lng-lat tbody tr:nth-child("+Number(u+1)+")").children("td:nth-child(3)").text(p[u][1]),l+=u+",",d+=p[u][0]+",",c+=p[u][1]+",";var m=u;h+='<div class="form-group sectionLngLat">',h+='<label class="col-md-2 control-label">经度：</label>',h+='<div class="col-md-3 sectionLng">',h+='<input type="text" id="piecewiseLng'+m+'" name="lng" placeholder="请输入经度值" value="'+p[u][0]+'" class="form-control" />',h+="</div>",h+='<label class="col-md-2 control-label">纬度：</label>',h+='<div class="col-md-3 sectionLat">',h+='<input type="text" id="piecewiseLat'+m+'" name="lat" placeholder="请输入纬度值" value="'+p[u][1]+'" class="form-control" />',h+="</div>",h+='<button type="button" class="btn btn-primary addLngLat">',h+='<span class="glyphicon glyphicon-plus" aria-hidden="true"></span>',h+="</button>&ensp;",h+='<button type="button" class="btn btn-danger removeLngLat">',h+='<span class="glyphicon glyphicon-trash" aria-hidden="true"></span>',h+="</button>",h+="</div>"}if(l.length>0&&(l=l.substr(0,l.length-1)),d.length>0&&(d=d.substr(0,d.length-1)),c.length>0&&(c=c.substr(0,c.length-1)),"zw_m_line"===e)$("#addOrUpdateLineFlag").val("1"),$("#lineId").val(a),$("#lineName1").val(t.name),$("#lineType1").val(t.type),$("#lineWidth1").val(t.width),$("#lineDescription1").val(t.description),$("#pointSeqs").val(l),$("#longitudes").val(d),$("#latitudes").val(c),$("#inflectionPointBox").html(h),$(".addLngLat").unbind("click").bind("click",this.newAddLngLat),$(".removeLngLat").unbind("click").bind("click",this.newRemoveLngLat),$(".isQueryShow").unbind("click").bind("click",this.isQueryShow),setTimeout((function(){$("#addLine").modal("show")}),200);else if("zw_m_rectangle"===e)$("#addOrUpdateRectangleFlag").val("1"),$("#rectangleId").val(a),$("#rectangleName").val(t.name),$("#rectangleType").val(t.type),$("#rectangleDescription").val(t.description),$("#pointSeqsRectangles").val(l),$("#longitudesRectangles").val(d),$("#latitudesRectangles").val(c),setTimeout((function(){$("#rectangle-form").modal("show")}),200);else if("zw_m_polygon"===e){var v="";for(u=0;u<p.length;u++)v+='<div class="form-group"><label class="col-md-3 control-label">顶点'+(u+1)+'经纬度：</label><div class=" col-md-8"><input type="text" name="polygonPointLngLat" placeholder="请输入顶点经纬度" value="'+p[u][0]+","+p[u][1]+'" class="form-control rectangleAllPointLngLat"/></div></div>';$("#rectangleAllPointShow").html(v),$("#addOrUpdatePolygonFlag").val("1"),$("#polygonId").val(a),$("#polygonName").val(t.name),$("#polygonType").val(t.type),$("#polygonDescription").val(t.description),$("#pointSeqsPolygons").val(l),$("#longitudesPolygons").val(d),$("#latitudesPolygons").val(c),setTimeout((function(){$("#myModal").modal("show")}),200)}},fencing.prototype.fenceDetails=function(e){var t,a,n,i=e[0].fenceData,r=e[0].fenceType,s=this.fencetypepid(r),o=this.state.data.detailsFenceDescribe;"zw_m_line"===r?(t=e[0].line.type,""!==(o=e[0].line.description)&&null!=o||(o="无任何描述"),a=e[0].line.createDataUsername,n=e[0].line.createDataTime):"zw_m_polygon"===r?(t=e[0].polygon.type,""!==(o=e[0].polygon.description)&&null!=o||(o="无任何描述"),a=e[0].polygon.createDataUsername,n=e[0].polygon.createDataTime):"zw_m_administration"===r?(t="行政区域",o=""===e[0].administration.description?"无任何描述":e[0].administration.description,a=e[0].administration.createDataUsername,n=e[0].administration.createDataTime):"zw_m_travel_line"===r?(s="导航路线",t=e[0].travelLine.lineType,a=e[0].travelLine.createDataUsername,n=e[0].travelLine.createDataTime,o=e[0].travelLine.description):(t=i.type,a=i.createDataUsername,n=i.createDataTime,o=""===i.description?"无任何描述":i.description),$("#detailsFenceShape").text(s),$("#detailsFenceType").text(t),$("#detailsFenceCreateName").text(a),$("#detailsFenceCreateTime").text(n),$("#detailsFenceDescribe").text(o)},fencing.prototype.fencetypepid=function(e){return"zw_m_marker"===e?"标注":"zw_m_line"===e?"路线":"zw_m_rectangle"===e?"矩形":"zw_m_circle"===e?"圆形":"zw_m_polygon"===e?"多边形":"zw_m_administration"===e?"行政区划":"zw_m_travel_line"===e?"导航路线":void 0},fencing.prototype.deleteFence=function(e){var t=this.dependency.get("realtimeAMap"),a=this,n="/clbs/m/functionconfig/fence/managefence/delete_"+e.id+".gsp";layer.confirm("你确定要删除此围栏吗",{btn:["确定","取消"],icon:3,move:!1,title:"操作确认"},(function(i){json_ajax("POST",n,"json",!0,null,(function(n){if(n.success){if(a.fenceHidden(e.id),t.state.data.fenceIDMap.remove(e.id),a.sectionPointState(e.id,!1),a.state.data.lineSpotMap.containsKey(e.id)){var i=a.state.data.lineSpotMap.get(e.id);t.state.data.map.remove(i),a.state.data.lineSpotMap.remove(e.id)}$.fn.zTree.getZTreeObj("fenceDemo").removeNode(e),a.addNodes()}else layer.msg(n.msg)})),layer.close(i)}),(function(e){layer.close(e)}))},fencing.prototype.fenceHidden=function(e){var t=this.dependency.get("realtimeAMap"),a=this.state.data.lineSpotMap,n=t.state.data.fenceIDMap,i=t.state.data.PolyEditorMap;if(a.containsKey(e))for(var r=a.get(e),s=0;s<r.length;s++)r[s].hide();if(n.containsKey(e)){var o=n.get(e);if(void 0!==i){var l=i.get(e);if(void 0!==l)if(Array.isArray(l))for(var d=0;d<l.length;d++)l[d].close();else l.close()}if(Array.isArray(o))for(s=0;s<o.length;s++)o[s].hide();else o.hide()}this.hideFence(e)},fencing.prototype.hideFence=function(e){var t,a=(t=this.dependency.get("realtimeAMap")).state.data.administrationMap,n=(t=this.dependency.get("realtimeAMap")).state.data.map,i=t.state.data.travelLineMap;if(a.containsKey(e)){var r=a.get(e);n.remove(r),a.remove(e)}if(i.containsKey(e)){r=i.get(e);n.remove(r),i.remove(e)}},fencing.prototype.sectionPointState=function(e,t){var a=this.state.data.sectionPointMarkerMap;if(a.containsKey(e))for(var n=a.get(e),i=0;i<n.length;i++)t?n[i].show():n[i].hide()},fencing.prototype.addBtnClick=function(){this.state.data.trid=[];var e=$.fn.zTree.getZTreeObj("treeDemoFence"),t=e.getCheckedNodes();if(this.state.data.vehicelTree=e,this.state.data.vehicleNode=t,null==t||0===t.length)layer.msg("至少选择一个监控对象",{move:!1});else{var a=$("#fenceName").val(),n=$("#fenceInfoId").val();$("#tableList tbody").html(""),t=t.unique2();for(var i=0,r=0;r<t.length;r++)if("vehicle"===t[r].type||"people"===t[r].type||"thing"===t[r].type){var s,o="Inradio"+ ++i,l="Outradio"+i,d="InDriver"+i,c="OutDriver"+i,p="sendFenceType"+i,u="alarmSourceName"+i,h="openDoor"+i,m="communicationFlag"+i,v="gnssFlag"+i,g=$("#fenceID").val(),f=$("input#fenceID").val(),b="<tr id='list"+i+"'><td><input class='checkList' id='checkList"+i+"' type='checkbox' name='thead'/></td><td>"+a+"</td><td>"+t[r].name+"</td><td><label name = 'fenceType' style='margin-bottom:0px;'>"+this.fencetypepid(g)+"</label></td>"+this.sendFenceTypeTd(g,p)+this.alarmSourceCheck(g,u)+"<td id = 'startTime'><input id='startDatePlugin"+i+"' style='width:120px;cursor:default;' class='form-control layer-date laydate-icon selectTime startDatePlugin' name='startTime' readonly /></td><td id = 'endTime'><input id='endDatePlugin"+i+"' style='width:120px;cursor:default;'  class='form-control layer-date laydate-icon selectTime endDatePlugin' name='endTime' readonly /></td><td id = 'alarmStartDateTD'><input id='startTimeHMS"+i+"'style='width:120px;cursor:default;'  class='form-control layer-date laydate-icon startTimeHMS'  name='alarmStartDateTD'  readonly /></td><td id = 'alarmEndDateTD'><input id='endTimeHMS"+i+"' style='width:120px;cursor:default;'  class='form-control layer-date laydate-icon endTimeHMS' name='alarmEndDateTD'  readonly /></td><td id = 'alarmIn'><input type='radio' value = 1 checked name='"+o+"' id='"+o+"'><label style='margin-bottom:0px;cursor:pointer' for='"+o+"'>是</label><input type='radio' value = 0 name='"+o+"' id='"+o+"s'><label style='margin-bottom:0px;cursor:pointer' for='"+o+"s'>否</label></td><td id = 'alarmOut'><input type='radio'  value = 1 checked name='"+l+"' id='"+l+"'><label style='margin-bottom:0px;cursor:pointer' for='"+l+"'>是</label><input type='radio'  value = 0 name='"+l+"' id='"+l+"s'><label style='margin-bottom:0px;cursor:pointer' for='"+l+"s'>否</label></td><td id = 'alarmInDriver'><input type='radio' value = 1 checked name='"+d+"' id='"+d+"'><label style='margin-bottom:0px;cursor:pointer' for='"+d+"'>是</label><input type='radio' value = 0 name='"+d+"' id='"+d+"s'><label style='margin-bottom:0px;cursor:pointer' for='"+d+"s'>否</label></td><td id = 'alarmOutDriver'><input type='radio'  value = 1 checked name='"+c+"' id='"+c+"'><label style='margin-bottom:0px;cursor:pointer' for='"+c+"'>是</label><input type='radio'  value = 0 name='"+c+"' id='"+c+"s'><label style='margin-bottom:0px;cursor:pointer' for='"+c+"s'>否</label></td><td id='speed'><input type= 'text' name = 'speed' class='form-control' onkeyup=\"value=value.replace(/[^\\d]/g,'')\" /></td>";"zw_m_line"!=f&&"zw_m_rectangle"!=f&&"zw_m_circle"!=f&&"zw_m_polygon"!=f||(b+="<td id='nightMaxSpeed'><input type= 'text' name = 'nightMaxSpeed' class='form-control' onkeyup=\"value=value.replace(/[^\\d]/g,'')\" /></td><td id='nightLimitTime'><input style='width:135px;cursor: pointer;background-color: #fafafa;' class='dateTime2 form-control layer-date laydate-icon valid' id='nightLimitTime"+r+"' name='nightLimitTime' readonly></td>"),b+="<td id='overSpeedLastTime'><input type= 'text' name = 'overSpeedLastTime' class='form-control' onkeyup=\"value=value.replace(/[^\\d]/g,'')\" /></td>"+this.travelLongAndSmallTime(g)+this.otherInfo(g,h,m,v)+"<td class='hidden' id='fenceId'>"+n+"</td><td class='hidden' id = 'vehicleId'>"+t[r].id+"</td><td id = 'monitorType' class='hidden'>"+t[r].type+"</td></tr>",$("#tableList tbody").append(b),laydate.render({elem:"#nightLimitTime"+r,type:"time",range:"--",format:"HH:mm",noSecond:!0,trigger:"click"}),s="zw_m_administration"===g||"zw_m_travel_line"===g?$("input[name="+u+"]")[1]:$("input[name="+u+"]")[0],1==$(s).val()&&$("#tableList tbody tr").find("#sendFenceType,#alarmInDriver,#alarmOutDriver,#overSpeedLastTime,#travelLongTime,#travelSmallTime,#openDoor,#communicationFlag,#gnssFlag").css("opacity","0")}this.accordingToFenceTypeSHTable(g),$("input[name*='alarmSourceName']").change((function(){var e=$(this).val(),t=$(this).parent().parent();"1"===e?(t.children("td#sendFenceType").css("opacity","0"),t.children("td#alarmInDriver").css("opacity","0"),t.children("td#alarmOutDriver").css("opacity","0"),t.children("td#overSpeedLastTime").css("opacity","0"),t.children("td#travelLongTime").css("opacity","0"),t.children("td#travelSmallTime").css("opacity","0"),t.children("td#openDoor").css("opacity","0"),t.children("td#communicationFlag").css("opacity","0"),t.children("td#gnssFlag").css("opacity","0")):(t.children("td#sendFenceType").css("opacity","1"),t.children("td#alarmInDriver").css("opacity","1"),t.children("td#alarmOutDriver").css("opacity","1"),t.children("td#overSpeedLastTime").css("opacity","1"),t.children("td#travelLongTime").css("opacity","1"),t.children("td#travelSmallTime").css("opacity","1"),t.children("td#openDoor").css("opacity","1"),t.children("td#communicationFlag").css("opacity","1"),t.children("td#gnssFlag").css("opacity","1"))}))}},fencing.prototype.sendFenceTypeTd=function(e,t){return"zw_m_line"!==e&&"zw_m_polygon"!==e&&"zw_m_travel_line"!==e&&"zw_m_administration"!==e?"<td id = 'sendFenceType'><input type='radio' value = 0 checked name='"+t+"' id='"+t+"'><label style='margin-bottom:0px;cursor:pointer' for='"+t+"'>更新</label><input type='radio' value = 1 name='"+t+"' id='"+t+"s'><label style='margin-bottom:0px;cursor:pointer' for='"+t+"s'>追加</label><input type='radio' value = 2 name='"+t+"' id='"+t+"ss'><label style='margin-bottom:0px;cursor:pointer' for='"+t+"ss'>修改</label></td>":"<td id = 'sendFenceType'><input type='radio' disabled value = 0 checked name='"+t+"'>更新</td>"},fencing.prototype.alarmSourceCheck=function(e,t){return"zw_m_administration"===e||"zw_m_travel_line"===e?"<td id = 'alarmSource'><label style='margin-bottom:0px;cursor:pointer'><input type='radio' value='2' name='"+t+"'>平台与终端 </label><input type='radio' disabled value='0' name='"+t+"' id='"+t+"'><label style='margin-bottom:0px;cursor:pointer' for='"+t+"'>终端报警 </label><input type='radio' value='1' checked='checked' name='"+t+"' id='"+t+"s'><label style='margin-bottom:0px;cursor:pointer' for='"+t+"s'>平台报警 </label></td>":"<td id = 'alarmSource'><label style='margin-bottom:0px;cursor:pointer'><input type='radio' value='2' name='"+t+"'>平台与终端</label><input type='radio' value='0' checked='checked' name='"+t+"' id='"+t+"'><label style='margin-bottom:0px;cursor:pointer' for='"+t+"'>终端报警</label><input type='radio' value='1' name='"+t+"' id='"+t+"s'><label style='margin-bottom:0px;cursor:pointer' for='"+t+"s'>平台报警</label></td>"},fencing.prototype.travelLongAndSmallTime=function(e){return"zw_m_line"===e||"zw_m_travel_line"===e?"<td id='travelLongTime'><input type= 'text' name = 'travelLongTime' class='form-control' onkeyup=\"value=value.replace(/[^\\d]/g,'')\" /></td><td id='travelSmallTime'><input type= 'text' name = 'travelSmallTime' class='form-control' onkeyup=\"value=value.replace(/[^\\d]/g,'')\" /></td>":"<td id='travelLongTime'></td><td id='travelSmallTime'></td>"},fencing.prototype.otherInfo=function(e,t,a,n){return"zw_m_line"!=e&&"zw_m_travel_line"!=e?"<td id = 'openDoor'><input type='radio' value = 0 checked name='"+t+"' id='"+t+"'><label style='margin-bottom:0px;cursor:pointer' for='"+t+"'>是</label><input type='radio' value =1 name='"+t+"' id='"+t+"s'><label style='margin-bottom:0px;cursor:pointer' for='"+t+"s'>否</lebal></td><td id = 'communicationFlag'><input type='radio'  value = 0 checked name='"+a+"' id='"+a+"'><label style='margin-bottom:0px;cursor:pointer' for='"+a+"'>是</label><input type='radio'  value = 1 name='"+a+"' id='"+a+"s'><label style='margin-bottom:0px;cursor:pointer' for='"+a+"s'>否</lebal></td><td id = 'gnssFlag'><input type='radio' value = 0 checked name='"+n+"' id='"+n+"'><label style='margin-bottom:0px;cursor:pointer' for='"+n+"'>是</label><input type='radio' value = 1 name='"+n+"' id='"+n+"s'><label style='margin-bottom:0px;cursor:pointer' for='"+n+"s'>否</lebal></td>":"<td id = 'openDoor'></td><td id = 'communicationFlag'></td><td id = 'gnssFlag'></td>"},fencing.prototype.accordingToFenceTypeSHTable=function(e){"zw_m_rectangle"==e||"zw_m_circle"==e||"zw_m_polygon"==e||"zw_m_administration"==e?($("#openDoor,#communicationFlag,#gnssFlag").removeClass("hidden"),$("#tableList thead tr th:nth-child(21)").removeClass("hidden"),$("#tableList thead tr th:nth-child(22)").removeClass("hidden"),$("#tableList thead tr th:nth-child(23)").removeClass("hidden"),$("#travelLongTime,#travelSmallTime").addClass("hidden"),$("#tableList thead tr th:nth-child(19)").addClass("hidden"),$("#tableList thead tr th:nth-child(20)").addClass("hidden")):"zw_m_line"===e||"zw_m_travel_line"===e?($("#travelLongTime,#travelSmallTime").removeClass("hidden"),$("#tableList thead tr th:nth-child(19)").removeClass("hidden"),$("#tableList thead tr th:nth-child(20)").removeClass("hidden"),$("#openDoor,#communicationFlag,#gnssFlag").addClass("hidden"),$("#tableList thead tr th:nth-child(21)").addClass("hidden"),$("#tableList thead tr th:nth-child(22)").addClass("hidden"),$("#tableList thead tr th:nth-child(23)").addClass("hidden")):($("#travelLongTime,#travelSmallTime,#openDoor,#communicationFlag,#gnssFlag").removeClass("hidden"),$("#tableList thead tr th:nth-child(19)").removeClass("hidden"),$("#tableList thead tr th:nth-child(20)").removeClass("hidden"),$("#tableList thead tr th:nth-child(21)").removeClass("hidden"),$("#tableList thead tr th:nth-child(22)").removeClass("hidden"),$("#tableList thead tr th:nth-child(23)").removeClass("hidden"))},fencing.prototype.checkboxis=function(e){e=e.currentTarget;var t=this.state.data.trid;if($("#checkAll").prop("checked",!1),!e.checked)return t=$.grep(t,(function(t,a){return t!==$("#"+e.id).parents("tr").attr("id")}));t.push($("#"+e.id).parents("tr").attr("id"))},fencing.prototype.selectDate=function(e){var t="#"+$(e.target).attr("id");laydate.render({elem:t,theme:"#6dcff6",show:!0})},fencing.prototype.selectTime=function(e){var t="#"+$(e.target).attr("id");laydate.render({elem:t,theme:"#6dcff6",type:"time",show:!0})},fencing.prototype.removeBtnClick=function(){var e=this.state.data.trid;if($("#checkAll").is(":checked")){for(var t=0;t<=this.state.data.vehicleNode.length;t++)e.push($("#list"+t)),$("#list"+t).remove();$("#checkAll").prop("checked",!1)}else{0===e.length&&layer.msg("请至少勾选一项",{move:!1});for(var a=0;a<e.length;a++)$("#"+e[a]).remove()}e=[]},fencing.prototype.checkAllClick=function(){var e;if(!0===$("#checkAll").prop("checked")){$("#checkAll").prop("checked",!0),$("#tableList input[type='checkbox']").prop("checked",$("#checkAll").prop("checked")),$("#tableList tbody tr").addClass("selected"),e=[];for(var t=1;t<$("#tableList tr").length;t++)e.push("list"+t);this.state.data.trid=e}else $("#checkAll").prop("checked",!1),$("#tableList input[type='checkbox']").prop("checked",!1),$("#tableList tbody tr").removeClass("selected"),e=[]},fencing.prototype.setAllClick=function(){var e=0,t="",a="",n="",i="",r="",s="",o="",l="",d="",c="",p="",u="",h="",m="",v="",g="",f="",b="",y="",k="",T="",w="",S="",x="",M="",C="",_="",I="",A=this.state.data.trid,L=$("#"+A[0]).children("td").eq(3).find("label").text();if(A.length<1)layer.msg("请选择一项！");else if(A.length>1)layer.msg("只能选择一项！");else for("sendFenceType"==$("#"+A[0]).children("td").eq(4).attr("id")&&(u=$("#"+A[0]).children("td").eq(4).find("input").attr("name"),t=$('input[name="'+u+'"]:checked').val()),"alarmSource"==$("#"+A[0]).children("td").eq(5).attr("id")&&(h=$("#"+A[0]).children("td").eq(5).find("input").attr("name"),a=$('input[name="'+h+'"]:checked').val()),null!=$("#"+A[0]).children("td").eq(6).find("input").val()&&(c=$("#"+A[0]).children("td").eq(6).find("input").val()),null!=$("#"+A[0]).children("td").eq(7).find("input").val()&&(p=$("#"+A[0]).children("td").eq(7).find("input").val()),null!=$("#"+A[0]).children("td").eq(8).find("input").val()&&(T=$("#"+A[0]).children("td").eq(8).find("input").val()),null!=$("#"+A[0]).children("td").eq(9).find("input").val()&&(w=$("#"+A[0]).children("td").eq(9).find("input").val()),"alarmIn"==$("#"+A[0]).children("td").eq(10).attr("id")&&(m=$("#"+A[0]).children("td").eq(10).find("input").attr("name"),n=$('input[name="'+m+'"]:checked').val()),"alarmOut"==$("#"+A[0]).children("td").eq(11).attr("id")&&(v=$("#"+A[0]).children("td").eq(11).find("input").attr("name"),i=$('input[name="'+v+'"]:checked').val()),"alarmInDriver"==$("#"+A[0]).children("td").eq(12).attr("id")&&(g=$("#"+A[0]).children("td").eq(12).find("input").attr("name"),r=$('input[name="'+g+'"]:checked').val()),"alarmOutDriver"==$("#"+A[0]).children("td").eq(13).attr("id")&&(f=$("#"+A[0]).children("td").eq(13).find("input").attr("name"),s=$('input[name="'+f+'"]:checked').val()),null!=$("#"+A[0]).children("td").eq(14).find("input").val()&&(S=$("#"+A[0]).children("td").eq(14).find("input").val()),null!=$("#"+A[0]).children("td").eq(15).find("input").val()&&(x=$("#"+A[0]).children("td").eq(15).find("input").val()),null!=$("#"+A[0]).children("td").eq(16).find("input").val()&&(M=$("#"+A[0]).children("td").eq(16).find("input").val()),null!=$("#"+A[0]).children("td").eq(17).find("input").val()&&(C=$("#"+A[0]).children("td").eq(17).find("input").val()),null!=$("#"+A[0]).children("td").eq(18).find("input").val()&&(_=$("#"+A[0]).children("td").eq(18).find("input").val()),null!=$("#"+A[0]).children("td").eq(19).find("input").val()&&(I=$("#"+A[0]).children("td").eq(19).find("input").val()),"openDoor"==$("#"+A[0]).children("td").eq(20).attr("id")&&(b=$("#"+A[0]).children("td").eq(20).find("input").attr("name"),o=$('input[name="'+b+'"]:checked').val()),"communicationFlag"==$("#"+A[0]).children("td").eq(21).attr("id")&&(y=$("#"+A[0]).children("td").eq(21).find("input").attr("name"),l=$('input[name="'+y+'"]:checked').val()),"gnssFlag"==$("#"+A[0]).children("td").eq(22).attr("id")&&(k=$("#"+A[0]).children("td").eq(22).find("input").attr("name"),d=$('input[name="'+k+'"]:checked').val()),e=0;e<=$("#tableList tbody tr").length;e++){var D=$("#tableList tbody tr")[e];$(D).each((function(){var u=this,h=e+1;if("路线"!==L&&"多边形"!==L&&("0"===t?($(u).find('input[name="sendFenceType'+h+'"][type="radio"]').eq(0).prop("checked",!0),$(u).find('input[name="sendFenceType'+h+'"][type="radio"]').eq(1).prop("checked",!1),$(u).find('input[name="sendFenceType'+h+'"][type="radio"]').eq(2).prop("checked",!1)):"1"===t?($(u).find('input[name="sendFenceType'+h+'"][type="radio"]').eq(0).prop("checked",!1),$(u).find('input[name="sendFenceType'+h+'"][type="radio"]').eq(1).prop("checked",!0),$(u).find('input[name="sendFenceType'+e+'"][type="radio"]').eq(2).prop("checked",!1)):"2"===t&&($(u).find('input[name="sendFenceType'+h+'"][type="radio"]').eq(0).prop("checked",!1),$(u).find('input[name="sendFenceType'+h+'"][type="radio"]').eq(1).prop("checked",!1),$(u).find('input[name="sendFenceType'+h+'"][type="radio"]').eq(2).prop("checked",!0))),"1"===n?($(u).find('input[name="Inradio'+h+'"][type="radio"]').eq(0).prop("checked",!0),$(u).find('input[name="Inradio'+h+'"][type="radio"]').eq(1).prop("checked",!1)):"0"===n&&($(u).find('input[name="Inradio'+h+'"][type="radio"]').eq(1).prop("checked",!0),$(u).find('input[name="Inradio'+h+'"][type="radio"]').eq(0).prop("checked",!1)),"1"===i?($(u).find('input[name="Outradio'+h+'"][type="radio"]').eq(0).prop("checked",!0),$(u).find('input[name="Outradio'+h+'"][type="radio"]').eq(1).prop("checked",!1)):"0"===i&&($(u).find('input[name="Outradio'+h+'"][type="radio"]').eq(1).prop("checked",!0),$(u).find('input[name="Outradio'+h+'"][type="radio"]').eq(0).prop("checked",!1)),"1"===r?($(u).find('input[name="InDriver'+h+'"][type="radio"]').eq(0).prop("checked",!0),$(u).find('input[name="InDriver'+e+'"][type="radio"]').eq(1).prop("checked",!1)):"0"===r&&($(u).find('input[name="InDriver'+h+'"][type="radio"]').eq(1).prop("checked",!0),$(u).find('input[name="InDriver'+h+'"][type="radio"]').eq(0).prop("checked",!1)),"1"===s?($(u).find('input[name="OutDriver'+h+'"][type="radio"]').eq(0).prop("checked",!0),$(u).find('input[name="OutDriver'+h+'"][type="radio"]').eq(1).prop("checked",!1)):"0"===s&&($(u).find('input[name="OutDriver'+h+'"][type="radio"]').eq(1).prop("checked",!0),$(u).find('input[name="OutDriver'+h+'"][type="radio"]').eq(0).prop("checked",!1)),null!=c&&$(u).find('input[name="startTime"]').val(c),null!=p&&$(u).find('input[name="endTime"]').val(p),null!=T&&$(u).find('input[name="alarmStartDateTD"]').val(T),null!=w&&$(u).find('input[name="alarmEndDateTD"]').val(w),null!=S&&$(u).find('input[name="speed"]').val(S),null!=x&&$(u).find('input[name="nightMaxSpeed"]').val(x),null!=M&&$(u).find('input[name="nightLimitTime"]').val(M),null!=C&&$(u).find('input[name="overSpeedLastTime"]').val(C),"路线"===L&&(null!=_&&$(u).find('input[name="travelLongTime"]').val(_),null!=I&&$(u).find('input[name="travelSmallTime"]').val(I)),"路线"!==L&&("0"===o?($(u).find('input[name="openDoor'+h+'"][type="radio"]').eq(0).prop("checked",!0),$(u).find('input[name="openDoor'+h+'"][type="radio"]').eq(1).prop("checked",!1)):"1"===o&&($(u).find('input[name="openDoor'+h+'"][type="radio"]').eq(1).prop("checked",!0),$(u).find('input[name="openDoor'+h+'"][type="radio"]').eq(0).prop("checked",!1)),"0"===l?($(u).find('input[name="communicationFlag'+h+'"][type="radio"]').eq(0).prop("checked",!0),$(u).find('input[name="communicationFlag'+h+'"][type="radio"]').eq(1).prop("checked",!1)):"1"===l&&($(u).find('input[name="communicationFlag'+h+'"][type="radio"]').eq(1).prop("checked",!0),$(u).find('input[name="communicationFlag'+h+'"][type="radio"]').eq(0).prop("checked",!1)),"0"===d?($(u).find('input[name="gnssFlag'+h+'"][type="radio"]').eq(0).prop("checked",!0),$(u).find('input[name="gnssFlag'+h+'"][type="radio"]').eq(1).prop("checked",!1)):"1"===d&&($(u).find('input[name="gnssFlag'+h+'"][type="radio"]').eq(1).prop("checked",!0),$(u).find('input[name="gnssFlag'+h+'"][type="radio"]').eq(0).prop("checked",!1))),"0"===a||"2"===a)$(u).find('input[name="alarmSourceName'+h+'"][type="radio"]').eq(0).prop("checked",!0),$(u).find('input[name="alarmSourceName'+h+'"][type="radio"]').eq(1).prop("checked",!1),(m=$(u).parent()).find("td#sendFenceType").css("opacity","1"),m.find("td#alarmInDriver").css("opacity","1"),m.find("td#alarmOutDriver").css("opacity","1"),m.find("td#overSpeedLastTime").css("opacity","1"),m.find("td#travelLongTime").css("opacity","1"),m.find("td#travelSmallTime").css("opacity","1"),m.find("td#openDoor").css("opacity","1"),m.find("td#communicationFlag").css("opacity","1"),m.find("td#gnssFlag").css("opacity","1");else if("1"===a){var m;$(u).find('input[name="alarmSourceName'+h+'"][type="radio"]').eq(1).prop("checked",!0),$(u).find('input[name="alarmSourceName'+h+'"][type="radio"]').eq(0).prop("checked",!1),(m=$(u).parent()).find("td#sendFenceType").css("opacity","0"),m.find("td#alarmInDriver").css("opacity","0"),m.find("td#alarmOutDriver").css("opacity","0"),m.find("td#overSpeedLastTime").css("opacity","0"),m.find("td#travelLongTime").css("opacity","0"),m.find("td#travelSmallTime").css("opacity","0"),m.find("td#openDoor").css("opacity","0"),m.find("td#communicationFlag").css("opacity","0"),m.find("td#gnssFlag").css("opacity","0")}else $(u).find('input[name="alarmSourceName'+h+'"][type="radio"]').eq(0).prop("checked",!1)}))}},fencing.prototype.fenceSaveBtnClick=function(){var e=[],t=1,a="",n=0,i=this;if($("#tableList tr").each((function(){var r={};$(this).children("td").each((function(){var e=this;if("fenceId"===e.id)r.fenceId=$(e).html();else if("vehicleId"===e.id)r.vehicleId=$(e).html();else if("monitorType"===e.id)r.monitorType=$(e).html();else if("sendFenceType"===e.id)r.sendFenceType=$(e).find("input[type='radio']:checked ").attr("value");else if("alarmSource"===e.id)r.alarmSource=$(e).find("input[type='radio']:checked ").attr("value");else if("alarmIn"===e.id)r.alarmInPlatform=$(e).find("input[type='radio']:checked ").attr("value");else if("alarmOut"===e.id)r.alarmOutPlatform=$(e).find("input[type='radio']:checked ").attr("value");else if("alarmInDriver"===e.id)r.alarmInDriver=$(e).find("input[type='radio']:checked ").attr("value");else if("alarmOutDriver"===e.id)r.alarmOutDriver=$(e).find("input[type='radio']:checked ").attr("value");else if("startTime"===e.id)r.alarmStartTime=$(e).find("input").val();else if("endTime"===e.id)r.alarmEndTime=$(e).find("input").val();else if("alarmStartDateTD"===e.id){var t=$(e).find("input").val();r.alarmStartDate=null!=t&&""!==t?"2016-01-01 "+t:""}else if("alarmEndDateTD"===e.id){t=$(e).find("input").val();r.alarmEndDate=null!=t&&""!==t?"2016-01-01 "+t:""}else if("speed"===e.id)r.speed=$(e).find("input").val();else if("nightMaxSpeed"===e.id)r.nightMaxSpeed=$(e).find("input").val();else if("nightLimitTime"===e.id)r.nightLimitTime=$(e).find("input").val();else if("overSpeedLastTime"===e.id)r.overSpeedLastTime=$(e).find("input").val();else if("travelLongTime"===e.id){var a=$(e).find("input").val();r.travelLongTime=void 0!==a&&null!=a?a:""}else if("travelSmallTime"===e.id){var i=$(e).find("input").val();r.travelSmallTime=void 0!==i&&null!=i?i:""}else if("openDoor"===e.id){var s=$(e).find("input[name='openDoor"+n+"']:checked ").attr("value");r.openDoor=void 0!==s&&null!=s&&""!==s?s:2}else if("communicationFlag"===e.id){var o=$(e).find("input[type='radio']:checked ").attr("value");r.communicationFlag=void 0!==o&&null!=o&&""!==o?o:2}else if("gnssFlag"==e.id){var l=$(e).find("input[type='radio']:checked ").attr("value");r.gnssFlag=null!=l&&null!=l&&""!=l?l:2}}));var s=n;""!==r.alarmStartTime&&""===r.alarmEndTime?(t=0,a+="第"+s+"条数据请选择结束日期！<br/>"):""===r.alarmStartTime&&""!==r.alarmEndTime?(t=0,a+="第"+s+"条数据请选择开始日期！<br/>"):""!==r.alarmStartTime&&""!==r.alarmEndTime&&i.compareDate(r.alarmStartTime,r.alarmEndTime)&&(t=0,a+="第"+s+"条数据结束日期必须大于开始日期！<br/>"),""!==r.alarmStartDate&&""===r.alarmEndDate?(t=0,a+="第"+s+"条数据请选择结束时间！<br/>"):""===r.alarmStartDate&&""!==r.alarmEndDate?(t=0,a+="第"+s+"条数据请选择开始时间！<br/>"):""!==r.alarmStartDate&&""!==r.alarmEndDate&&i.compareDate(r.alarmStartDate,r.alarmEndDate)&&(t=0,a+="第"+s+"条数据结束时间必须大于开始时间！<br/>"),(r.speed<0||r.speed>65535)&&(t=0,a+="第"+s+"条数限速的最小值为0，最大值为65535！<br/>"),(r.nightMaxSpeed<0||r.nightMaxSpeed>65535)&&(t=0,a+="第"+s+"条数限速的最小值为0，最大值为65535！<br/>"),(r.overSpeedLastTime<0||r.overSpeedLastTime>65535)&&(t=0,a+="第"+s+"条数超速持续时长的最小值为0，最大值为65535！<br/>"),""!==r.travelLongTime&&""===r.travelSmallTime?(t=0,a+="第"+s+"条数据请输入行驶不足阈值！<br/>"):""===r.travelLongTime&&""!==r.travelSmallTime&&(t=0,a+="第"+s+"条数据请输入行驶过长阈值！<br/>"),jQuery.isEmptyObject(r)||e.push(r),n++})),null==e||0===e.length)layer.msg("请绑定围栏",{move:!1});else if(0===t)layer.msg(a);else{var r={data:JSON.stringify(e)};json_ajax("POST","/clbs/m/functionconfig/fence/bindfence/saveBindFence","json",!0,r,i.saveBindCallback.bind(i))}i.state.data.vehicleFenceList=""},fencing.prototype.compareDate=function(e,t){var a=new Date(e),n=new Date(t);return!isNaN(a)&&!isNaN(n)&&a>n},fencing.prototype.saveBindCallback=function(e){if(null!=e)if(e.success)if(1===e.obj.flag){$("#fenceBind").modal("hide");var t=$.fn.zTree.getZTreeObj("fenceDemo");if(this.getcheckFenceNode(t),this.state.data.myTable.filter(),this.state.data.myTable.requestData(),layer.msg("围栏绑定成功",{closeBtn:0},(function(){layer.close()})),$(".panel-body.fixed-table-body").is(":hidden")){var a=$("#realtimeMapContainer").css("height");$(".panel-body.fixed-table-body").slideDown(),$("#bingListClick").children("i").removeClass("fa-chevron-up").addClass("fa-chevron-down");Number("224px");$("#realtimeMapContainer").animate({height:"647px"})}}else 2===e.obj.flag&&layer.alert(e.obj.errMsg,{id:"promptMessage"});else layer.msg(e.msg,{move:!1})},fencing.prototype.getcheckFenceNode=function(e){var t=e.getCheckedNodes(!0),a=[];if(null!=t&&t.length>0)for(var n=0;n<t.length;n++)!1===t[n].isParent&&a.push(t[n].id);this.state.data.queryFenceId=a},fencing.prototype.threadSave=function(thisBtn){var _this=this,amap=this.dependency.get("realtimeAMap"),map=amap.state.data.map,pointList=$("#addLineForm .pointList");if(pointList.find("label.error").length>0&&(pointList.show(),pointList.siblings(".isQueryShow").find("span").attr("class","fa fa-chevron-down")),this.validate_line()){layer.load(2),thisBtn.disabled=!0;for(var longitudes=[],latitudes=[],numStr=[],sectionLngLat=$("#addLineForm").find(".sectionLngLat"),i=0,len=sectionLngLat.length;i<len;i++){var long=$(sectionLngLat[i]).find("input").eq(0).val(),lat=$(sectionLngLat[i]).find("input").eq(1).val();longitudes.push(long),latitudes.push(lat),numStr.push(i)}$("#pointSeqs").val(numStr.join(",")),$("#longitudes").val(longitudes.join(",")),$("#latitudes").val(latitudes.join(",")),$("#pointSeqsRectangles").val(numStr.join(",")),$("#longitudesRectangles").val(longitudes.join(",")),$("#latitudesRectangles").val(latitudes.join(",")),$("#pointSeqsPolygons").val(numStr.join(",")),$("#longitudesPolygons").val(longitudes.join(",")),$("#latitudesPolygons").val(latitudes.join(",")),$("#addLineForm").ajaxSubmit((function(data){var datas=eval("("+data+")");if(!0===datas.success){_this.state.data.isEdit=!0,$("#addLine").modal("hide"),_this.state.data.saveFenceName=$("#lineName1").val(),_this.state.data.saveFenceType="zw_m_line",amap.mouseToolClose();var lineId=$("#lineId").val(),zTree=$.fn.zTree.getZTreeObj("fenceDemo"),node=zTree.getNodesByParam("id",lineId,null);if(_this.getFenceDetail(node,map),_this.addNodes(),map.off("rightclick",_this.state.data.amendLine),amap.state.data.PolyEditorMap.containsKey(lineId)){var mapEditFence=amap.state.data.PolyEditorMap.get(lineId);if(Array.isArray(mapEditFence))for(var i=0;i<mapEditFence.length;i++)mapEditFence[i].close();else mapEditFence.close()}}else null==datas.msg?(layer.msg("该路线围栏名称已存在，请重新输入"),layer.closeAll("loading")):null!=datas.msg&&layer.msg(data.msg,{move:!1})}))}},fencing.prototype.validate_line=function(){return $("#addLineForm").validate({ignore:"",rules:{name:{required:!0,maxlength:20},width:{required:!0,range:[0,255]},description:{maxlength:100},groupName:{required:!0},lng:{required:!0,number:!0,range:[73.66,135.05]},lat:{required:!0,number:!0,range:[3.86,53.55]}},messages:{lng:{required:"请输入经度值",number:"请输入73.66-135.05之间的数字",range:"请输入73.66-135.05之间的数字"},lat:{required:"请输入纬度值",number:"请输入3.86-53.55之间的数字",range:"请输入3.86-53.55之间的数字"},name:{required:"此线是你画，此路是你开，要想从此过，留个线路名",maxlength:"长度不超过20位"},width:{required:"请输入偏移量",maxlength:"输入值必须介于0和255之间"},description:{maxlength:"public.size100.length"},groupName:{required:"请选择所属企业"}}}).form()},fencing.prototype.lineEditClose=function(){var e=this.dependency.get("realtimeAMap"),t=e.state.data.map;e.mouseToolClose(),t.off("rightclick",this.state.data.amendLine);var a=$("#lineId").val(),n=$.fn.zTree.getZTreeObj("fenceDemo").getNodesByParam("id",a,null);this.getFenceDetail(n,t)},fencing.prototype.rectangleSave=function(thisBtn){var _this=this,amap=this.dependency.get("realtimeAMap"),nowLU=$("#LUPointLngLat").val(),nowLULnglat=nowLU.split(","),nowRD=$("#RDPointLngLat").val(),nowRDLngLat=nowRD.split(",");$("#longitudesRectangles").attr("value",nowLULnglat[0]+","+nowRDLngLat[0]+","+nowRDLngLat[0]+","+nowLULnglat[0]),$("#latitudesRectangles").attr("value",nowLULnglat[1]+","+nowRDLngLat[1]+","+nowRDLngLat[1]+","+nowLULnglat[1]),this.validate_rectangle()&&(thisBtn.disabled=!0,$("#rectangles").ajaxSubmit((function(data){var datas=eval("("+data+")");if(!0===datas.success){$("#rectangle-form").modal("hide"),_this.state.data.saveFenceName=$("#rectangleName").val(),_this.state.data.saveFenceType="zw_m_rectangle",amap.mouseToolClose();var rectang_fenceId=$("#rectangleId").val();if(""!==rectang_fenceId){var thisFence=amap.state.data.fenceIDMap.get(rectang_fenceId);amap.state.data.fenceIDMap.remove(rectang_fenceId),thisFence.hide()}_this.addNodes()}else null==datas.msg?layer.msg("该矩形围栏名称已存在，请重新输入"):null!=datas.msg&&layer.msg(data.msg,{move:!1})})))},fencing.prototype.validate_rectangle=function(){return $("#rectangles").validate({rules:{name:{required:!0,maxlength:20},type:{required:!1,maxlength:20},description:{maxlength:100},lnglatQuery_LU:{required:!0,isLngLat:[[135.05,53.55],[73.66,3.86]]},lnglatQuery_RD:{required:!0,isLngLat:[[135.05,53.55],[73.66,3.86]]},groupName:{required:!0}},messages:{name:{required:"您忘记输入区域名称啦",maxlength:"长度不超过20位"},type:{required:"请输入偏移量，长度1~10",maxlength:""},description:{maxlength:"长度不超过20位"},lnglatQuery_LU:{required:"经纬度不能为空",isLngLat:"请正确填写经纬度"},lnglatQuery_RD:{required:"经纬度不能为空",isLngLat:"请正确填写经纬度"},groupName:{required:"请选择所属企业"}}}).form()},fencing.prototype.rectangleEditClose=function(){var e=this.dependency.get("realtimeAMap");e.state.data.mouseTool1.close(!0),e.mouseToolClose()},fencing.prototype.roundSave=function(thisBtn){var circleLng=$("#editCircleLng").val(),circleLat=$("#editCircleLat").val(),circleRadius=$("#editCircleRadius").val();if(""!==circleLng&&$("#circle-lng").prop("value",circleLng),""!==circleLat&&$("#circle-lat").prop("value",circleLat),""!==circleRadius&&$("#circle-radius").prop("value",circleRadius),this.validate_circle()){thisBtn.disabled=!0;var _this=this,amap=this.dependency.get("realtimeAMap");$("#circles").ajaxSubmit((function(data){var datas=eval("("+data+")");if(!0===datas.success){$("#circleArea").modal("hide"),_this.state.data.saveFenceName=$("#circleName").val(),_this.state.data.saveFenceType="zw_m_circle",amap.mouseToolClose(),amap.state.data.mouseTool1.close(!0);var circleId=$("#circleId").val();if(amap.state.data.PolyEditorMap.containsKey(circleId)){var mapEditFence=amap.state.data.PolyEditorMap.get(circleId);mapEditFence.close()}amap.state.data.map.off("rightclick",_this.state.data.amendCircle),_this.addNodes()}else null==datas.msg?layer.msg("该圆形围栏名称已存在，请重新输入"):null!=datas.msg&&layer.msg(data.msg,{move:!1})}))}},fencing.prototype.validate_circle=function(){return $("#circles").validate({rules:{name:{required:!0,maxlength:20},type:{maxlength:20},description:{maxlength:100},centerPointLng:{required:!0,isLng:[135.05,53.55]},centerPointLat:{required:!0,isLat:[73.66,3.86]},centerRadius:{required:!0,number:!0},groupName:{required:!0}},messages:{name:{required:"您忘记输入区域名称啦",maxlength:"长度不超过20位"},type:{maxlength:"长度不超过20位"},description:{maxlength:"长度不超过20位"},centerPointLng:{required:"请输入经度",isLng:"请正确填写经度"},centerPointLat:{required:"请输入纬度",isLat:"请正确填写纬度"},centerRadius:{required:"请输入半径",number:"请输入数字"},groupName:{required:"请选择所属企业"}}}).form()},fencing.prototype.circleFenceClose=function(){var e=this.dependency.get("realtimeAMap");e.mouseToolClose(),e.state.data.mouseTool1.close(!0);var t=$("#circleId").val(),a=$.fn.zTree.getZTreeObj("fenceDemo").getNodesByParam("id",t,null);this.getFenceDetail(a,e.state.data.map)},fencing.prototype.polygonSave=function(thisBtn){var _this=this,map=this.dependency.get("realtimeAMap"),polygonId=$("#polygonId").val(),rectanglePointMag=[],allPointArray=[];$(".rectangleAllPointLngLat").each((function(){var e=$(this).val().split(","),t=[];t.polygonId=polygonId,t.longitude=e[0],t.latitude=e[1],rectanglePointMag.push(t),allPointArray.push(e)}));for(var lngValue="",latValue="",i=0,len=allPointArray.length;i<len;i++)i!==len-1?(lngValue+=allPointArray[i][0]+",",latValue+=allPointArray[i][1]+","):(lngValue+=allPointArray[i][0],latValue+=allPointArray[i][1]);$("#longitudesPolygons").attr("value",lngValue),$("#latitudesPolygons").attr("value",latValue);var polygonId=$("#polygonId").val(),rectanglePointMag=[],allPointArray=[];$(".rectangleAllPointLngLat").each((function(){var e=$(this).val().split(","),t=[];t.polygonId=polygonId,t.longitude=e[0],t.latitude=e[1],rectanglePointMag.push(t),allPointArray.push(e)}));for(var lngValue="",latValue="",i=0,len=allPointArray.length;i<len;i++)i!==len-1?(lngValue+=allPointArray[i][0]+",",latValue+=allPointArray[i][1]+","):(lngValue+=allPointArray[i][0],latValue+=allPointArray[i][1]);$("#longitudesPolygons").attr("value",lngValue),$("#latitudesPolygons").attr("value",latValue),this.validate_polygon()&&(thisBtn.disabled=!0,$("#polygons").ajaxSubmit((function(data){var datas=eval("("+data+")");if(!0===datas.success){$("#myModal").modal("hide"),_this.state.data.saveFenceName=$("#polygonName").val(),_this.state.data.saveFenceType="zw_m_polygon",$(".fenceA").removeClass("fenceA-active"),map.mouseToolClose(),map.state.data.mouseTool1.close(!0),map.state.data.map.off("rightclick",map.state.data.amendPolygon);var polygonId=$("#polygonId").val();if(map.state.data.PolyEditorMap.containsKey(polygonId)){var mapEditFence=map.state.data.PolyEditorMap.get(polygonId);mapEditFence.close()}_this.addNodes()}else null==datas.msg?layer.msg("该多边形围栏名称已存在，请重新输入"):layer.msg(datas.msg,{move:!1})})))},fencing.prototype.validate_polygon=function(){return $("#polygons").validate({rules:{name:{required:!0,maxlength:20},type:{maxlength:20},description:{maxlength:100},groupName:{required:!0}},messages:{name:{required:"您忘记输入区域名称啦",maxlength:"长度不超过20位"},type:{maxlength:"长度不超过20位"},description:{maxlength:"长度不超过100位"},groupName:{required:"请选择所属企业"}}}).form()},fencing.prototype.polygonFenceClose=function(){var e=this.dependency.get("realtimeAMap");e.mouseToolClose(),e.state.data.mouseTool1.close(!0);var t=$("#polygonId").val(),a=$.fn.zTree.getZTreeObj("fenceDemo").getNodesByParam("id",t,null);this.getFenceDetail(a,e.state.data.map)},fencing.prototype.administrativeAreaSelect=function(e){var t=e.target,a=this.dependency.get("realtimeAMap").state.data.administrativeAreaFence,n=this,i=$("#province").val();"province"===i?$("#provinceError").css("display","none"):"--请选择--"===i&&$("#provinceError").css("display","block");for(var r=0,s=a.length;r<s;r++)a[r].setMap(null);var o=t[t.options.selectedIndex],l=(o.text,o.adcode),d=new AMap.DistrictSearch;d.setLevel(o.value),d.setExtensions("all"),d.search(l,(function(e,t){"complete"===e&&n.getData(t.districtList[0])}))},fencing.prototype.getData=function(e){var t=this.dependency.get("realtimeAMap"),a=t.state.data.map,n=e.boundaries;if(n){$("#administrativeLngLat").val(n.join("-"));for(var i=0,r=n.length;i<r;i++){var s=new AMap.Polygon({map:a,strokeWeight:1,strokeColor:"#CC66CC",fillColor:"#CCF3FF",fillOpacity:.5,path:n[i]});t.state.data.administrativeAreaFence.push(s),a.setFitView(s)}}var o=e.districtList,l=e.level;if("province"===l?(document.getElementById("city").innerHTML="",document.getElementById("district").innerHTML=""):"city"===l&&(document.getElementById("district").innerHTML=""),o){var d=new Option("--请选择--");for(i=0,r=o.length;i<r;i++){var c=o[i].name,p=o[i].level;if("street"===p)return!1;o[i].citycode;0===i&&document.querySelector("#"+p).append(d),(d=new Option(c)).setAttribute("value",p),d.center=o[i].center,d.adcode=o[i].adcode,document.querySelector("#"+p).append(d)}}},fencing.prototype.administrativeSave=function(){var _this=this,map=this.dependency.get("realtimeAMap"),province=$("#province").find("option:selected").text();$("#provinceVal").val(province);var city=$("#city").find("option:selected").text();$("#cityVal").val(city);var district=$("#district").find("option:selected").text();$("#districtVal").val(district);var provin=$("#province").val();if("--请选择--"===provin)return $("#provinceError").css("display","block"),!1;this.validate_administration()&&($("#administrativeSave").attr("disabled","disabled"),$("#administrativeSave").text("保存中"),layer.load(2),$("#administration").ajaxSubmit((function(data){var datas=eval("("+data+")");!0===datas.success?(layer.closeAll("loading"),$("#administrativeArea").modal("hide"),_this.state.data.saveFenceName=$("#administrationName").val(),_this.state.data.saveFenceType="zw_m_administration",$(".fenceA").removeClass("fenceA-active"),map.mouseToolClose(),map.state.data.mouseTool1.close(!0),_this.addNodes(),$("#administrationName").val(""),$("#administrationDistrict").val(""),$("#administrativeSave").text("保存"),$("#administrativeSave").removeAttr("disabled"),_this.administrativeClose()):null==datas.msg?($("#administrativeSave").text("保存"),$("#administrativeSave").removeAttr("disabled"),layer.msg("该行政区划围栏名称已存在，请重新输入")):layer.msg(datas.msg,{move:!1})})))},fencing.prototype.validate_administration=function(){return $("#administration").validate({rules:{province:{required:!0},name:{required:!0,maxlength:20},description:{maxlength:50},groupName:{required:!0}},messages:{name:{required:"您忘记输入区域名称啦",maxlength:"长度不超过20位"},description:{maxlength:"长度不超过50位"},groupName:{required:"请选择所属企业"}}}).form()},fencing.prototype.administrativeClose=function(){for(var e=this.dependency.get("realtimeAMap").state.data.administrativeAreaFence,t=0,a=e.length;t<a;t++)e[t].setMap(null);$("#provinceError").hide()},fencing.prototype.lineDragRouteSave=function(){var _this=this,amap=this.dependency.get("realtimeAMap"),map=amap.state.data.map;this.state.data.isDragRouteFlag?this.validate_dragRoute()&&$("#dragRouteLine").ajaxSubmit((function(data){var datas=eval("("+data+")");if(!0===datas.success){var dragRouteId=$("#travelLineId").val();_this.state.data.saveFenceName=$("#dragRouteLineName").val(),_this.state.data.saveFenceType="zw_m_travel_line";var zTree=$.fn.zTree.getZTreeObj("fenceDemo"),node=zTree.getNodeByParam("id",dragRouteId,null);_this.getFenceDetail([node],map),_this.closeDragRoute(),_this.addNodes(),_this.clearLineDragRoute(),void 0!==amap.state.data.lineRoute&&amap.state.data.lineRoute.destroy()}else null==datas.msg?layer.msg("该导航路线名称已存在，请重新输入"):layer.msg(datas.msg,{move:!1})})):layer.msg("请进行正确的路线规划")},fencing.prototype.validate_dragRoute=function(){return $("#dragRouteLine").validate({rules:{name:{required:!0,maxlength:20},startPoint:{required:!0},endPoint:{required:!0},excursion:{required:!0,maxlength:10},description:{maxlength:100},groupName:{required:!0}},messages:{name:{required:"此线是你画，此路是你开，要想从此过，留个线路名",maxlength:"长度不超过20位"},startPoint:{required:"请输入起点"},endPoint:{required:"请输入终点"},excursion:{required:"请输入偏移量",maxlength:"长度不超过10位"},description:{maxlength:"长度不超过100位"},groupName:{required:"请选择所属企业"}}}).form()},fencing.prototype.closeDragRoute=function(){this.state.data.isAddDragRoute=!1;var e=this.dependency.get("realtimeAMap").state.data.contextMenu;void 0!==e&&e.close(),$("#drivenRoute").hide()},fencing.prototype.removeHoverDom=function(e,t){var a=t.type;null!=a&&void 0!==a&&""!==a&&"fenceParent"===a?($("#addBtn_"+t.tId).unbind().remove(),$("#import_"+t.tId).unbind().remove()):null!=a&&void 0!==a&&""!==a&&"fence"===a&&($("#editBtn_"+t.tId).unbind().remove(),$("#detailsBtn_"+t.tId).unbind().remove(),$("#bindBtn_"+t.tId).unbind().remove(),$("#deleteBtn_"+t.tId).unbind().remove())},fencing.prototype.onClickFenceChar=function(e,t,a){var n=$.fn.zTree.getZTreeObj("fenceDemo"),i=this.state.data.clickStateChar,r=this.dependency.get("realtimeAMap").state.data.map,s=this.state.data.charFlag,o=this.state.data.fenceLayerSelect;if("zw_m_travel_layer"!==a.pId){this.state.data.isAddDragRoute=!1,this.state.data.isEdit=!0;var l=n.getSelectedNodes(!0);if("fenceParent"===a.type)return n.cancelSelectedNode(l[0]),!1;$("#charMap").attr("class","fa fa-chevron-down mapBind"),$("#charMapArea").css("display","block");var d=a.id;if(void 0===i)i=d,n.checkNode(l[0],!0,!0),l[0].checkedOld=!0,this.fenceHidden(d),this.getFenceDetail(l,r);else if(d===i)if(s){n.checkNode(l[0],!1,!0),l[0].checkedOld=!1,n.cancelSelectedNode(l[0]);var c=n.getCheckedNodes(!0);this.state.data.fenceCheckLength=c.length,this.fenceHidden(d),this.sectionPointState(d,!1),s=!1}else s=!0,i=d,n.checkNode(l[0],!0,!0),l[0].checkedOld=!0,this.fenceHidden(d),this.getFenceDetail(l,r),this.sectionPointState(d,!0);else s=!0,i=d,n.checkNode(l[0],!0,!0),l[0].checkedOld=!0,this.fenceHidden(d),this.getFenceDetail(l,r),this.sectionPointState(d,!0);this.getcheckFenceNode(n),this.state.data.myTable.filter(),this.state.data.myTable.requestData();$("#dataTableBind tbody tr").length;$(".panel-body.fixed-table-body").is(":hidden")&&($(".panel-body.fixed-table-body").slideDown(),$("#bingListClick").children("i").removeClass("fa-chevron-up").addClass("fa-chevron-down"))}else a.checked?a.name===o?(n.checkNode(a,!1,!0),n.cancelSelectedNode(a),this.amapFenceFun(a,!1),o=null):(n.cancelSelectedNode(),n.selectNode(a),n.checkNode(a,!0,!0),this.amapFenceFun(a,!0),o=a.name):(n.selectNode(a),n.checkNode(a,!0,!0),this.amapFenceFun(a,!0),o=a.name)},fencing.prototype.amapFenceFun=function(e,t){"zw_m_travel_layer"==e.id&&(t?(this.layerTwoShow(),this.layerOneShow()):(this.layerTwoHide(),this.layerOneHide())),"zw_m_travel_layer"==e.pId&&("图层1"==e.name?t?this.layerOneShow():this.layerOneHide():"图层2"==e.name&&(t?this.layerTwoShow():this.layerTwoHide()))},fencing.prototype.layerTwoShow=function(){var e=this.dependency.get("realtimeAMap").state.data.map;this.state.data.wms.show(),e.setCenter([-99.241291,39.51401]),e.setZoom(4)},fencing.prototype.layerOneShow=function(){var e=this.dependency.get("realtimeAMap").state.data.map;this.state.data.amapLayer.show(),e.setCenter([116.33719,39.942384]),e.setZoom(15)},fencing.prototype.layerTwoHide=function(){this.state.data.wms.hide()},fencing.prototype.layerOneHide=function(){this.state.data.amapLayer.hide()},fencing.prototype.onCheckFenceChar=function(e,t,a){if("zw_m_travel_layer"===a.pId||"zw_m_travel_layer"===a.id)return a.checked?this.amapFenceFun(a,!0):this.amapFenceFun(a,!1),!1;this.state.data.isAddDragRoute=!1,this.state.data.isEdit=!0;var n=$.fn.zTree.getZTreeObj("fenceDemo"),i=n.getCheckedNodes(!0).length;if(this.getcheckFenceNode(n),this.state.data.myTable.requestData(),i>this.state.data.fenceCheckLength){this.state.data.fenceCheckLength=i;for(var r=n.getChangeCheckedNodes(),s=0,o=r.length;s<o;s++)r[s].checkedOld=!0;for(var l=0;l<r.length;l++){var d=r[l].id;this.fenceShow(d,r[l]),this.sectionPointState(d,!0)}}else{this.state.data.fenceCheckLength=i;for(s=0,o=(r=n.getChangeCheckedNodes()).length;s<o;s++)r[s].checkedOld=!1,n.cancelSelectedNode(r[s]),d=r[s].id,this.hideFence(d),this.fenceHidden(d),this.sectionPointState(d,!1)}$("#dataTableBind tbody tr").length;$(".panel-body.fixed-table-body").is(":hidden")&&($(".panel-body.fixed-table-body").slideDown(),$("#bingListClick").children("i").removeClass("fa-chevron-up").addClass("fa-chevron-down"))},fencing.prototype.fenceShow=function(e,t){var a=this.dependency.get("realtimeAMap"),n=a.state.data.map;if(a.state.data.fenceIDMap.containsKey(e)){var i=a.state.data.fenceIDMap.get(e);if(void 0!==i)if(Array.isArray(i))for(var r=0;r<i.length;r++)i[r].show(),n.setFitView(i[r]);else i.show(),n.setFitView(i)}else this.getFenceDetail([t],n);if(this.state.data.lineSpotMap.containsKey(e))for(var s=this.state.data.lineSpotMap.get(e),o=0;o<s.length;o++)s[o].show()},fencing.prototype.zTreeOnAsyncFenceSuccess=function(e,t,a,n){var i=this.dependency.get("realtimeAMap").state.data.map,r=$("#rectangleId").val(),s=$.fn.zTree.getZTreeObj("fenceDemo"),o=s.getNodesByParam("id",r,null);0!==o.length&&this.getFenceDetail(o,i),$("#rectangleId").val("");var l=s.getNodesByParam("id",this.state.data.saveFenceType,null);if(void 0!==l&&null!=l&&l.length>0){var d=l[0].children;if(void 0!==d)for(var c=0,p=d.length;c<p;c++)this.state.data.saveFenceName===d[c].name&&(s.checkNode(d[c],!0,!0),s.selectNode(d[c]),this.state.data.fenceCheckLength=s.getCheckedNodes(!0).length,d[c].checkedOld=!0,this.getFenceDetail([d[c]],i))}},fencing.prototype.searchFenceCarSearch=function(){search_ztree("fenceDemo","searchFence","fence",null)},fencing.prototype.FenceSearch=function(){$("#searchFence").val(""),this.searchFenceCarSearch()},fencing.prototype.beforeClickFenceVehicle=function(e,t){return $.fn.zTree.getZTreeObj("treeDemoFence").checkNode(t,!t.checked,null,!0),!1},fencing.prototype.zTreeVFenceOnAsyncSuccess=function(e,t,a,n){var i=$.fn.zTree.getZTreeObj(t);i.updateNodeCount(a);var r=0,s=i.getNodesByFilter(assignmentNotExpandFilter);this.state.data.notExpandNodeInit=s;for(var o=0;o<s.length&&(i.expandNode(s[o],!0,!0,!1,!0),!((r+=s[o].children.length)>=200));o++);},fencing.prototype.zTreeBeforeCheck=function(e,t){var a=!0;if(!t.checked){if("group"===t.type||"assignment"===t.type){var n=(o=$.fn.zTree.getZTreeObj(e)).getCheckedNodes(!0),i=0;json_ajax("post","/clbs/a/search/getMonitorNum","json",!1,{id:t.id,type:t.type},(function(e){e.success?i+=e.obj:layer.msg("限制校验异常")}));for(var r=[],s=0;s<n.length;s++){if(l=n[s].id,"people"===n[s].type||"vehicle"===n[s].type||"thing"===n[s].type)null==o.getNodeByParam("tId",n[s].tId,t)&&-1===$.inArray(l,r)&&r.push(l)}i+=r.length}else if("people"===t.type||"vehicle"===t.type||"thing"===t.type){var o,l;for(n=(o=$.fn.zTree.getZTreeObj(e)).getCheckedNodes(!0),i=0,r=[],s=0;s<n.length;s++)l=n[s].id,"people"!==n[s].type&&"vehicle"!==n[s].type&&"thing"!==n[s].type||-1===$.inArray(l,r)&&r.push(l);i=r.length+1}i>5e3&&(layer.msg("最多勾选5000个监控对象"),a=!1)}return a&&("group"!==t.type||t.checked||(this.state.data.checkFlag=!0)),a},fencing.prototype.onCheckFenceVehicle=function(e,t,a){var n=$.fn.zTree.getZTreeObj("treeDemoFence"),i=n.getCheckedNodes(!0),r="";a.checked&&n.expandNode(a,!0,!0,!0,!0);r="";for(var s=0,o=i.length;s<o;s++)"vehicle"!==i[s].type&&"people"!==i[s].type&&"thing"!==i[s].type||(r+=i[s].id+",");this.state.data.vehicleFenceList=r},fencing.prototype.zTreeOnExpand=function(e,t,a){var n=this;if("group"!==a.type||this.state.data.checkFlag){var i=$.fn.zTree.getZTreeObj("treeDemoFence");if(this.state.data.checkFlag=!1,"group"===a.type){json_ajax("post","/clbs/m/functionconfig/fence/bindfence/putMonitorByGroup","json",!1,{groupId:a.id,isChecked:a.checked,monitorType:"monitor"},(function(e){var t=e.obj;null!=t&&void 0!==t&&$.each(t,(function(e){var a=e,r=(t[e],n.state.data.fenceZTreeIdJson[a][0]),s=i.getNodeByTId(r);void 0===s.children&&i.addNodes(s,[])}))}))}}},fencing.prototype.zTreeOnNodeCreated=function(e,t,a){var n=this.state.data.fenceZTreeIdJson,i=($.fn.zTree.getZTreeObj("treeDemoFence"),a.id.toString()),r=[];void 0===n[i]||null==n[i]?(r=[a.tId],n[i]=r):n[i].push(a.tId)},fencing.prototype.tableInit=function(){var e;$(".modal-body").css({height:"auto","max-height":document.body.clientHeight-194+"px"}),$("#realtimeAreaSearchCarBody").css({height:"auto","max-height":document.body.clientHeight-240+"px"}),$(".treeArea").css("height",document.body.clientHeight-295+"px"),$("#bindTableByFence").css("height",document.body.clientHeight-295+"px"),$(window).resize((function(){$(".modal-body").css({height:"auto","max-height":document.body.clientHeight-194+"px"}),$("#realtimeAreaSearchCarBody").css({height:"auto","max-height":document.body.clientHeight-240+"px"}),$(".treeArea").css("height",document.body.clientHeight-295+"px"),$("#bindTableByFence").css("height",document.body.clientHeight-295+"px")}));var t=this,a=$("#dataTableBind tr th:gt(1)"),n="";n+='<li><label><input type="checkbox" checked="checked" class="toggle-vis" data-column="'+parseInt(String(2))+'" disabled />'+a[0].innerHTML+"</label></li>";for(var i=1;i<a.length;i++)n+='<li><label><input type="checkbox" checked="checked" class="toggle-vis" data-column="'+parseInt(String(i+2))+'" />'+a[i].innerHTML+"</label></li>";$("#Ul-menu-text-bind").html(n),laydate.render({elem:"#arriveTime",type:"datetime",theme:"#6dcff6"}),laydate.render({elem:"#leaveTime",type:"datetime",theme:"#6dcff6"}),laydate.render({elem:"#msStartTime",type:"datetime",theme:"#6dcff6"}),laydate.render({elem:"#msEndTime",type:"datetime",theme:"#6dcff6"}),laydate.render({elem:"#muStartTime",type:"datetime",theme:"#6dcff6"}),laydate.render({elem:"#muEndTime",type:"datetime",theme:"#6dcff6"});var r={listUrl:"/clbs/m/functionconfig/fence/bindfence/list",editUrl:"/clbs/m/functionconfig/fence/bindfence/editById",deleteUrl:"/clbs/m/functionconfig/fence/bindfence/delete_",deletemoreUrl:"/clbs/m/functionconfig/fence/bindfence/deletemore",enableUrl:"/clbs/c/user/enable_",disableUrl:"clbs/c/user/disable_",columnDefs:[{searchable:!1,orderable:!1,targets:0}],columns:[{data:null,class:"text-center"},{data:null,class:"text-center",render:function(e,t,a,n){var i="",r={};return r.fenceConfigId=a.id,r.paramId=a.paramId,r.vehicleId=a.vehicle_id,r.fenceId=a.fence_id,i+="<input  type='checkbox' name='subChk'  value='"+JSON.stringify(r)+"' />"}},{data:null,class:"text-center",render:function(t,a,n,i){var r="";return r+='<button href="'+(e.editUrl+".gsp?id="+n.id+"&vehicleId="+n.vehicle_id+"&name="+encodeURI(n.name)+"&type="+n.type+"&alarmSource="+n.alarm_source)+'" data-target="#commonWin" data-toggle="modal"  type="button" class="editBtn editBtn-info"><i class="fa fa-pencil"></i>修改</button>&ensp;',"zw_m_marker"===n.type||1===n.alarm_source||"0"!==n.deviceType&&"1"!==n.deviceType&&"11"!==n.deviceType&&"12"!==n.deviceType&&"13"!==n.deviceType&&"14"!==n.deviceType&&"15"!==n.deviceType&&"16"!==n.deviceType&&"17"!==n.deviceType&&"18"!==n.deviceType?r+=' <button id="fenceSend" data-id = "'+n.id+'" data-paramId = "'+n.paramId+'" data-vehicle_id = "'+n.vehicle_id+'" data-fence_id = "'+n.fence_id+'" disabled class="editBtn btn-default" type="button"><i class="glyphicon glyphicon-circle-arrow-down"></i>围栏下发</button>&ensp;':r+=' <button id="fenceSend" data-id = "'+n.id+'" data-paramId = "'+n.paramId+'" data-vehicle_id = "'+n.vehicle_id+'" data-fence_id = "'+n.fence_id+'" class="editBtn editBtn-info" type="button"><i class="glyphicon glyphicon-circle-arrow-down"></i>围栏下发</button>&ensp;',r+='<button type="button"  data-id = "'+n.id+'" class="deleteButton editBtn disableClick"><i class="fa fa-trash-o"></i>解除绑定</button>'}},{data:"type",class:"text-center",render:function(e,a,n,i){return t.fencetypepid(e)}},{data:"name",class:"text-center",render:function(e,t,a,n){return'<a class="fenceval" data-fenceId = "'+a.fenceId+'" >'+html2Escape(e,null)+"</a>"}},{data:"send_down_id",class:"text-center"},{data:"brand",class:"text-center"},{data:"dirStatus",class:"text-center",render:function(e,t,a,n){return"0"==e?"参数已生效":"1"==e?"参数未生效":"2"==e?"参数消息有误":"3"==e?"参数不支持":"4"==e?"参数下发中":"5"==e?"终端离线，未下发":"7"==e?"终端处理中":"8"==e?"终端接收失败":""}},{data:"send_fence_type",class:"text-center",render:function(e,t,a,n){return 1===a.alarm_source?"":0===e?"更新":1===e?"追加":2===e?"修改":void 0}},{data:"alarm_source",class:"text-center",render:function(e,t,a,n){return 0===e?"终端报警":1===e?"平台报警":"2"==e?"平台与终端":void 0}},{data:"alarm_start_time",class:"text-center",render:function(e,t,a,n){return null!=e&&""!==e?e.substring(0,10):""}},{data:"alarm_end_time",class:"text-center",render:function(e,t,a,n){return null!=e&&""!==e?e.substring(0,10):""}},{data:"alarm_start_date",class:"text-center",render:function(e,t,a,n){return null!=e&&""!==e?e.substring(10):""}},{data:"alarm_end_date",class:"text-center",render:function(e,t,a,n){return null!=e&&""!==e?e.substring(10):""}},{data:"alarm_in_platform",class:"text-center",render:function(e,t,a,n){return 1===e?"V":0===e?"X":""}},{data:"alarm_out_platform",class:"text-center",render:function(e,t,a,n){return 1===e?"V":0===e?"X":""}},{data:"alarm_in_driver",class:"text-center",render:function(e,t,a,n){return 1===a.alarm_source?"":1===e?"V":0===e?"X":""}},{data:"alarm_out_driver",class:"text-center",render:function(e,t,a,n){return 1===a.alarm_source?"":1===e?"V":0===e?"X":""}},{data:"speed",class:"text-center",render:function(e,t,a,n){return e}},{data:"night_max_speed",class:"text-center",render:function(e,t,a,n){return e||""}},{data:"night_limit_time",class:"text-center",render:function(e,t,a,n){return e||""}},{data:"over_speed_last_time",class:"text-center",render:function(e,t,a,n){return 1===a.alarm_source?"":e}},{data:"travel_long_time",class:"text-center",render:function(e,t,a,n){return 1===a.alarm_source?"":e}},{data:"travel_small_time",class:"text-center",render:function(e,t,a,n){return 1===a.alarm_source?"":e}},{data:"open_door",class:"text-center",render:function(e,t,a,n){return 1===a.alarm_source?"":0===e?"V":1===e?"X":""}},{data:"communication_flag",class:"text-center",render:function(e,t,a,n){return 1===a.alarm_source?"":0===e?"V":1===e?"X":""}},{data:"gnss_flag",class:"text-center",render:function(e,t,a,n){return 1===a.alarm_source?"":0===e?"V":1===e?"X":""}}],dataTableDiv:"dataTableBind",ajaxDataParamFun:function(e){e.simpleQueryParam=$("#simpleQueryParam").val(),e.queryFenceIdStr=t.state.data.queryFenceId.unique3().join(",")},pageable:!0,showIndexColumn:!0,enabledChange:!0,pageNumber:4,setPageNumber:!1};(e=new TG_Tabel.createNew(r)).init(),this.state.data.myTable=e,$("#fenceBindTable").on("click",".deleteButton",(function(e){var a=$(e.target).attr("data-id");t.deleteItem(a)})),$("#fenceBindTable").on("click",".fenceval",(function(e){var a=$(e.target).attr("data-fenceid");t.tableFence(a)})),$("#fenceBindTable").on("click","#fenceSend",(function(e){var a=$(e.target).attr("data-id"),n=$(e.target).attr("data-paramid"),i=$(e.target).attr("data-vehicle_id"),r=$(e.target).attr("data-fence_id");t.sendFenceOne(a,n,i,r)}))},fencing.prototype.deleteItem=function(e){this.state.data.myTable.deleteItem(e)},fencing.prototype.tableFence=function(e){var t=this.dependency.get("realtimeAMap").state.data.map,a=[],n=$.fn.zTree.getZTreeObj("fenceDemo").getNodeByParam("id",e,null);a.push(n),this.getFenceDetail(a,t)},fencing.prototype.searchBindTable=function(){this.state.data.myTable.filter()},fencing.prototype.tableCheckAll=function(e){var t=$(e.target).prop("checked");$('input[name="subChk"]').prop("checked",t)},fencing.prototype.sendModelClick=function(){if(0!==$("input[name='subChk']:checked").length){var e=new Array;$("input[name='subChk']:checked").each((function(t){var a=$("input[name='subChk']:checked")[t];a=$(a).attr("value");var n=$.parseJSON(a);e.push(n)})),this.sendFence(JSON.stringify(e))}else layer.msg("至少选择一条数据")},fencing.prototype.sendFence=function(e){json_ajax("POST","/clbs/m/functionconfig/fence/bindfence/sendFence","json",!0,{sendParam:e},this.sendFenceCallback.bind(this))},fencing.prototype.sendFenceCallback=function(e){var t=this;layer.msg('臣这就去办，陛下想了解情况，关注"状态"就好了',{closeBtn:0},(function(e){$("#checkAll").prop("checked",!1),$("input[name=subChk]").prop("checked",!1),t.state.data.myTable.refresh(),layer.close(e)}))},fencing.prototype.delModelClick=function(){if(0!==$("input[name='subChk']:checked").length){var e=new Array;$("input[name='subChk']:checked").each((function(t){var a=$("input[name='subChk']:checked")[t];a=$(a).attr("value");var n=$.parseJSON(a);e.push(n.fenceConfigId)})),this.state.data.myTable.deleteItems({deltems:e.toString()})}else layer.msg("至少选择一条数据")},fencing.prototype.bingListClick=function(){if($(this).children("i").hasClass("fa-chevron-down")){$(this).children("i").removeClass("fa-chevron-down").addClass("fa-chevron-up"),$(".panel-body.fixed-table-body").slideUp();var e=document.body.clientHeight;$("#realtimeMapContainer").animate({height:e-102+"px"})}else{$(this).children("i").removeClass("fa-chevron-up").addClass("fa-chevron-down");$("#dataTableBind tbody tr").length;$(".panel-body.fixed-table-body").slideDown();e=document.body.clientHeight;$("#realtimeMapContainer").animate({height:e-320+"px"})}},fencing.prototype.sendFenceOne=function(e,t,a,n){var i=[],r={};r.fenceConfigId=e,r.paramId=t,r.vehicleId=a,r.fenceId=n,i.push(r);var s=JSON.stringify(i);this.sendFence(s)},fencing.prototype.searchVehicleSearch=function(){var e=this;void 0!==this.state.data.fenceInputChange&&clearTimeout(this.state.data.fenceInputChange),this.state.data.fenceInputChange=setTimeout((function(){var t=$("#searchVehicle").val();""===t?e.initBindFenceTree():e.searchBindFenceTree(t)}),500)},fencing.prototype.searchBindFenceTree=function(e){var t={async:{url:"/clbs/a/search/monitorTreeFuzzy",type:"post",enable:!0,autoParam:["id"],dataType:"json",sync:!1,otherParam:{type:"multiple",queryParam:e,webType:"1"},dataFilter:this.ajaxQueryDataFilter.bind(this)},check:{enable:!0,chkStyle:"checkbox",chkboxType:{Y:"s",N:"s"},radioType:"all"},view:{dblClickExpand:!1,nameIsHTML:!0,fontCss:setFontCss_ztree,countClass:"group-number-statistics"},data:{simpleData:{enable:!0}},callback:{beforeClick:this.beforeClickFenceVehicle,onAsyncSuccess:this.fuzzyZTreeOnAsyncSuccess,onCheck:this.fuzzyOnCheckVehicle.bind(this)}};$.fn.zTree.init($("#treeDemoFence"),t,null)},fencing.prototype.ajaxQueryDataFilter=function(e,t,a){a=JSON.parse(Object(_framework_utils_unzip__WEBPACK_IMPORTED_MODULE_5__.a)(a));var n=[],i=this.state.data.vehicleFenceList;null!=i&&void 0!==i&&""!==i&&(n=(","===i.slice(i.length-1)?i.slice(0,-1):i).split(","));return filterQueryResult(a,n)},fencing.prototype.fuzzyZTreeOnAsyncSuccess=function(e,t,a){$.fn.zTree.getZTreeObj(t).expandAll(!0)},fencing.prototype.fuzzyOnCheckVehicle=function(e,t,a){var n=$.fn.zTree.getZTreeObj("treeDemoFence"),i=n.getChangeCheckedNodes();if(a.checked){for(var r=n.getCheckedNodes(!0),s=0,o=0;o<r.length;o++)"people"!==r[o].type&&"vehicle"!==r[o].type&&"thing"!==r[o].type||(s+=1);if(s>5e3){layer.msg("最多勾选5000个监控对象");for(o=0;o<i.length;o++)i[o].checked=!1,n.updateNode(i[o])}}for(o=0;o<i.length;o++)i[o].checkedOld=i[o].checked;for(var l="",d=n.getCheckedNodes(!0),c=(o=0,d.length);o<c;o++)"vehicle"!==d[o].type&&"people"!==d[o].type&&"thing"!==d[o].type||(l+=d[o].id+",");this.state.data.vehicleFenceList=l},fencing.prototype.doSubmits1=function(){var e=this;this.validate_key()&&$("#monitoringTag").ajaxSubmit((function(t){(t=JSON.parse(t)).success?($("#addMonitoringTag").modal("hide"),$("#monitoringTag").clearForm(),e.resetFance()):layer.msg(t.msg,{move:!1})}))},fencing.prototype.validate_key=function(){return $("#monitoringTag").validate({rules:{name:{required:!0,maxlength:20},arriveTime:{required:!0},leaveTime:{required:!0,compareDate:"#arriveTime"},description:{maxlength:100}},messages:{name:{required:"请输入关键点名称",maxlength:"长度不超过20位"},arriveTime:{required:"请选择到达时间"},leaveTime:{required:"请选择离开时间",compareDate:"离开时间必须大于到达时间"},description:{maxlength:"长度不超过100位"}}}).form()},fencing.prototype.deleteKeyPoint=function(e){var t=$(e.target).attr("data-id");this.dependency.get("realtimeAMap").state.data.infoWindow.close();json_ajax("post","/clbs/m/functionconfig/fence/bindfence/deleteKeyPoint","json",!1,{kid:t},this.deleteKeyPointCallBack.bind(this))},fencing.prototype.deleteKeyPointCallBack=function(e){!0===e.success?this.resetFance():e.msg.toString().indexOf("系统错误")>-1&&layer.msg(e.msg,{move:!1})},fencing.prototype.monitorClose=function(){$("#addMonitoringTag input").each((function(e,t){$(t).val("")})),$("#addMonitoringTag #description").val("")},fencing.prototype.doSubmitsMonitor=function(){var e=this;this.sectionRateLimitLngLat(),this.validate_Monitor()&&$("#monitoringSection").ajaxSubmit((function(t){(t=JSON.parse(t)).success?($("#addMonitoringSection").modal("hide"),$("#monitoringSection").clearForm(),e.resetFance()):layer.msg(t.msg,{move:!1})}))},fencing.prototype.sectionRateLimitLngLat=function(){var e=$("#lineId").val();this.clearLine(),$("#lineId").val(e);for(var t=$("#tenples li").length,a="",n="",i=-1,r="",s=0;s<t;s++){var o="route"+(s+1),l=$("#"+o).children("div.pointList").children("div.sectionLngLat").length;if(s<t-1){for(var d=0;d<l;d++){var c=""===(f=$("#"+o).children("div.pointList").children("div.sectionLngLat:eq("+d+")").children(".sectionLng").children("input")).val()?f.attr("value"):f.val(),p=""===(b=$("#"+o).children("div.pointList").children("div.sectionLngLat:eq("+d+")").children(".sectionLat").children("input")).val()?b.attr("value"):b.val();""!==c&&""!==p&&(a+=c+",",n+=p+",",r+=++i+",",c+";"+p+",")}var u="route"+(s+2),h=$("#"+u).children("div.pointList").children("div.sectionLngLat:eq(0)").children(".sectionLng").children("input"),m=""===h.val()?h.attr("value"):h.val(),v=$("#"+u).children("div.pointList").children("div.sectionLngLat:eq(0)").children(".sectionLat").children("input"),g=""===v.val()?v.attr("value"):v.val();""!==m&&""!==g&&m+";"+g+"]"}else{for(d=0;d<l;d++){var f,b;c=""===(f=$("#"+o).children("div.pointList").children("div.sectionLngLat:eq("+d+")").children(".sectionLng").children("input")).val()?f.attr("value"):f.val(),p=""===(b=$("#"+o).children("div.pointList").children("div.sectionLngLat:eq("+d+")").children(".sectionLat").children("input")).val()?b.attr("value"):b.val();d!==l-1?""!==c&&""!==p&&(a+=c+",",n+=p+",",r+=++i+",",c+";"+p+","):""!==c&&""!==p&&(a+=c+",",n+=p+",",r+=++i+",",c+";"+p+"]")}"section-lng"+(s+1)}}a=a.substring(0,a.length-1),n=n.substring(0,n.length-1),r=r.substring(0,r.length-1),this.editLngLat()},fencing.prototype.validate_Monitor=function(){return $("#monitoringSection").validate({ignore:"",rules:{offset:{required:!0,range:[0,255]},overlengthThreshold:{required:!1,range:[0,65535],digits:!0},shortageThreshold:{required:!1,range:[0,65535],digits:!0},maximumSpeed:{required:!0,range:[0,65535]},nightMaxSpeed:{range:[0,65535]},overspeedTime:{required:!0,range:[0,65535],digits:!0},lng:{required:!0,range:[73.66,135.05]},lat:{required:!0,range:[3.86,53.55]}},messages:{offset:{required:"请输入偏移量",maxlength:"输入值必须介于0和255之间"},overlengthThreshold:{required:"请输入路段行驶过长阈值",range:"输入值必须介于0和65535之间",digits:"必须为整数"},shortageThreshold:{required:"请输入路段行驶不足阈值",range:"输入值必须介于0和65535之间",digits:"必须为整数"},maximumSpeed:{required:"请输入最高限速",range:"输入值必须介于0和65535之间"},nightMaxSpeed:{range:"输入值必须介于0和65535之间"},overspeedTime:{required:"请输入超速持续时间",range:"输入值必须介于0和65535之间",digits:"必须为整数"},lng:{required:"请输入经度",range:"输入范围：73.66~135.05"},lat:{required:"请输入纬度",range:"输入范围：3.86~53.55"}}}).form()},fencing.prototype.editLngLat=function(){var e=$("#lineId").val();$("#addOrUpdateLineFlag").val("1");ajax_submit("POST","/clbs/m/functionconfig/fence/managefence/previewFence","json",!1,{fenceIdShape:e+"#zw_m_line"},!0,this.editCallBack)},fencing.prototype.editCallBack=function(e){if(e.success){var t=e.obj[0],a=t.line.description,n=t.line.type,i=t.line.width,r=t.line.name;$("#lineWidth1").val(i),$("#lineDescription1").val(a),$("#lineType1").val(n),$("#lineName1").val(r)}else layer.msg(e.msg,{move:!1})},fencing.prototype.clearErrorMsg=function(){this.dependency.get("realtimeAMap").mouseToolClose(),$("label.error").hide(),$(".error").removeClass("error")},fencing}();__webpack_exports__.a=fencing},205:function(e,t){e.exports='<div class="row lkyw-fence-search">\r\n  <div class="col-md-10 col-sm-8 col-xs-4">\r\n    <input id="searchFence" name="search" class="form-control" style="margin-bottom:10px;" type="text"\r\n      placeholder="请输入关键字" />\r\n  </div>\r\n  <div class="col-md-1 col-sm-8 col-xs-4" style="padding: 0px 5px 0px 0px;">\r\n    <button id="refreshFence" class="btn btn-default" type="button" title="刷新">\r\n      <i class="glyphicon glyphicon-refresh icon-refresh"></i>\r\n    </button>\r\n  </div>\r\n</div>\r\n\r\n<div class="col-md-12 groupzTree" id="fenceZtree">\r\n  <ul id="fenceDemo" class="ztree"></ul>\r\n</div>\r\n\r\n\r\n\x3c!-- 标注 --\x3e\r\n<div class="modal fade" id="mark" aria-hidden="true" data-backdrop="static" role="dialog"\r\n  aria-labelledby="myModalLabel">\r\n  <div class="modal-dialog" role="document">\r\n    <div class="modal-content">\r\n      <div class="modal-header">\r\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close"></button>\r\n        <h4 class="modal-title">标注</h4>\r\n      </div>\r\n      <div class="modal-body">\r\n        \x3c!-- 新增标注表单 --\x3e\r\n        <form class="form-horizontal" action="/clbs/m/functionconfig/fence/managefence/marker" id="marker" role="form"\r\n          method="post">\r\n          <div class="row">\r\n            <div class="form-group" style="display:none;">\r\n              <input type="hidden" id="addOrUpdateMarkerFlag" name="addOrUpdateMarkerFlag" value="" />\r\n              <input type="hidden" id="markerId" name="markerId" value="" />\r\n              <label class="col-md-3 control-label">标注经度：</label>\r\n              <div class=" col-md-3">\r\n                <input id="mark-lng" type="text" value="" class="form-control" readonly="readonly" name="longitude" />\r\n              </div>\r\n              <label class="col-md-2 control-label">标注纬度：</label>\r\n              <div class=" col-md-3">\r\n                <input id="mark-lat" type="text" value="" class="form-control" readonly="readonly" name="latitude" />\r\n              </div>\r\n            </div>\r\n            <div class="form-group">\r\n              <label class="col-md-3 control-label"><label class="text-danger">*</label> 标注名称：</label>\r\n              <div class=" col-md-8">\r\n                <input type="text" placeholder="请输入标注名称" class="form-control" id="markerName" name="name" />\r\n              </div>\r\n            </div>\r\n            <div class="form-group">\r\n              <label class="col-md-3 control-label">标注类型：</label>\r\n              <div class=" col-md-8">\r\n                <select class="form-control" id="markerType" name="type">\r\n                  <option value="普通标记">普通标记</option>\r\n                  <option value="线路点">线路点</option>\r\n                </select>\r\n              </div>\r\n            </div>\r\n            <div class="form-group">\r\n              <label class="col-md-3 control-label">标注类型图标：</label>\r\n              <div class=" col-md-8">\r\n                <label class="radio-inline">\r\n                  <input type="radio" name="markIcon" value="0" checked="checked" id="waterDropsRadio">\r\n                  \x3c!--<span>小水滴</span>--\x3e\r\n                  <i class="marker-drops-water"></i>\r\n                </label>\r\n                <label class="radio-inline">\r\n                  <input type="radio" name="markIcon" value="1" id="circleRadio">\r\n                  \x3c!--<span>其他</span>--\x3e\r\n                  <i class="marker-circle"></i>\r\n                </label>\r\n              </div>\r\n            </div>\r\n            <div class="form-group">\r\n              <label class="col-md-3 control-label">描述：</label>\r\n              <div class=" col-md-8">\r\n                <textarea class="form-control" rows="4" id="markerDescription" name="description"></textarea>\r\n              </div>\r\n            </div>\r\n            <div class="form-group">\r\n              <label class="col-md-3 control-label lngLat_show">\r\n                经纬度\r\n                <span class="fa fa-chevron-down" aria-hidden="true"></span>\r\n              </label>\r\n            </div>\r\n            <div class="pointList" style="display: block;">\r\n              <div class="form-group">\r\n                <label class="col-md-3 control-label">经度：</label>\r\n                <div class=" col-md-8">\r\n                  <input id="markerLng" name="markerLngName" type="text" placeholder="请输入经度" class="form-control">\r\n                </div>\r\n              </div>\r\n              <div class="form-group">\r\n                <label class="col-md-3 control-label">纬度：</label>\r\n                <div class=" col-md-8">\r\n                  <input id="markerLat" name="markerLatName" type="text" placeholder="请输入纬度" class="form-control">\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class="modal-footer">\r\n            <button type="button" data-type="zw_m_marker" id="annotatedSave" class="btn btn-primary">保存\r\n            </button>\r\n            <button type="button" id="markFenceClose" class="btn btn-default btn-off" data-dismiss="modal">\r\n              取消\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n\x3c!-- 标注点气泡框--\x3e\r\n<div style="width: 220px;position: absolute;display: none;z-index:999;" id="markerInfoWindow">\r\n  <div class="amap-info-content amap-info-outer">\r\n    <div>名称：<span id="createName"></span></div>\r\n    \x3c!--<div>类型：<span id="createType"></span></div>--\x3e\r\n    <div>创建人：<span id="createPer"></span></div>\r\n    <div>创建时间：<span id="createTime"></span></div>\r\n    <div>描述：<span id="createDesc"></span></div>\r\n  </div>\r\n  <div class="amap-info-sharp" style="height: 23px;"></div>\r\n</div>\r\n\r\n\x3c!-- 详情 --\x3e\r\n<div class="modal fade" id="detailsModel" aria-hidden="true" data-backdrop="static" role="dialog"\r\n  aria-labelledby="myModalLabel">\r\n  <div class="modal-dialog modal-lg" role="document">\r\n    <div class="modal-content">\r\n      <div class="modal-header">\r\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close"></button>\r\n        <h4 class="modal-title">围栏详情</h4>\r\n      </div>\r\n      <div class="modal-body">\r\n        <form class="form-horizontal" role="form" action="#" method="post">\r\n          <div class="row">\r\n            <div class="form-group">\r\n              <label class="col-md-3 control-label">名称：</label>\r\n              <div class=" col-md-3 textShow">\r\n                <span id="detailsFenceName"></span>\r\n              </div>\r\n              <label class="col-md-3 control-label">类型：</label>\r\n              <div class=" col-md-3 textShow">\r\n                <span id="detailsFenceType"></span>\r\n              </div>\r\n            </div>\r\n            <div class="form-group">\r\n              <label class="col-md-3 control-label">形状：</label>\r\n              <div class=" col-md-3 textShow">\r\n                <span id="detailsFenceShape"></span>\r\n              </div>\r\n              <label class="col-md-3 control-label">创建人：</label>\r\n              <div class=" col-md-3 textShow">\r\n                <span id="detailsFenceCreateName"></span>\r\n              </div>\r\n            </div>\r\n            <div class="form-group">\r\n              <label class="col-md-3 control-label">创建时间：</label>\r\n              <div class=" col-md-3 textShow">\r\n                <span id="detailsFenceCreateTime"></span>\r\n              </div>\r\n            </div>\r\n            <div class="form-group">\r\n              <label class="col-md-3 control-label">描述：</label>\r\n              <div class="col-md-8 textShow">\r\n                <span id="detailsFenceDescribe" style="word-break:break-all"></span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </form>\r\n      </div>\r\n      <div class="modal-footer">\r\n        <button type="button" class="btn btn-default btn-off" data-dismiss="modal">取消</button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n\x3c!-- 围栏绑定 --\x3e\r\n<div style="cursor: default;" class="modal fade" id="fenceBind" aria-hidden="true" data-backdrop="static" role="dialog"\r\n  aria-labelledby="myModalLabel">\r\n  <div class="modal-dialog modal-lg" role="document" style="width:80%">\r\n    <div class="modal-content">\r\n      <div class="modal-header">\r\n        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>\r\n        <h4 class="modal-title">围栏绑定</h4>\r\n      </div>\r\n      <div class="modal-body">\r\n        <div class="form-horizontal">\r\n          <div class="row">\r\n            <input id="fenceID" name="search" class="form-control" type="hidden" />\r\n            <input id="fenceName" name="search" class="form-control" type="hidden" />\r\n            <input id="fenceInfoId" name="search" class="form-control" type="hidden" />\r\n            <div id="charAll" class="col-md-4">\r\n              <h5 class="fwb">监控对象列表</h5>\r\n              <div class="col-md-12" style="padding-right:0px;padding-left:0px;">\r\n                <input id="searchVehicle" name="search" autocomplete="off" class="form-control"\r\n                  style="margin-bottom:10px;" type="text" placeholder="请输入关键字" />\r\n              </div>\r\n              <div id="bindVehicleTreeDiv" class="treeArea">\r\n                <ul id="treeDemoFence" class="ztree"></ul>\r\n              </div>\r\n            </div>\r\n            <div class="col-md-1 addAreaFance">\r\n              <div class="add-button-right" id="addBtn">\r\n                <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>\r\n              </div>\r\n              <div class="add-button-left" id="removeBtn">\r\n                <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>\r\n              </div>\r\n            </div>\r\n            <div class="col-md-7" id="tableArea">\r\n              <h5 class="fwb fenceTc-realtime">绑定详情</h5>\r\n              <div class="form-group" style="margin-bottom:0;">\r\n                <div class="col-sm-11 col-md-12 control-label" style="padding-top:0;padding-bottom:6px;">\r\n                  <button type="button" id="setAll" class="btn btn-primary nextBtn">依例全设</button>\r\n                  <button th:if="${hasRole}" id="fenceSaveBtn" type="button"\r\n                    class="btn btn-primary nextBtn">&nbsp;保存&nbsp;\r\n                  </button>\r\n                  <button id="fenceCancelBtn" type="button" class="btn btn-default btn-off" data-dismiss="modal">取消\r\n                  </button>\r\n                </div>\r\n              </div>\r\n              <div id="bindTableByFence" class="bindFence">\r\n                <table id="tableList" name="fenceTable" class="table table-bordered " cellspacing="0">\r\n                  <thead>\r\n                    <tr>\r\n                      <th style="background: none;"><input type="checkbox" id="checkAll" class="checkAll" />\r\n                      </th>\r\n                      <th>围栏名称</th>\r\n                      <th>监控对象</th>\r\n                      <th>围栏类型</th>\r\n                      <th>下发类型</th>\r\n                      <th>报警来源</th>\r\n                      <th>开始日期</th>\r\n                      <th>结束日期</th>\r\n                      <th>开始时间</th>\r\n                      <th>结束时间</th>\r\n                      <th>驶入报警给平台</th>\r\n                      <th>驶出报警给平台</th>\r\n                      <th>驶入报警给驾驶员</th>\r\n                      <th>驶出报警给驾驶员</th>\r\n                      <th>最高速度(km/h)</th>\r\n                      <th class="addFenceTh">夜间最高速度(km/h)</th>\r\n                      <th class="addFenceTh">夜间限速时间段</th>\r\n                      <th>超速持续时间(s)</th>\r\n                      <th>行驶时间过长阈值(s)</th>\r\n                      <th>行驶时间不足阈值(s)</th>\r\n                      <th>允许开门</th>\r\n                      <th>进区域开启通信模块</th>\r\n                      <th>进区域不采集GNSS详细定位数据</th>\r\n                      <th class="hidden">围栏id</th>\r\n                      <th class="hidden">车id</th>\r\n                    </tr>\r\n                  </thead>\r\n                  <tbody>\r\n                  </tbody>\r\n                </table>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n\x3c!--线--\x3e\r\n<div class="modal fade" id="addLine" aria-hidden="true" data-backdrop="static" role="dialog"\r\n  aria-labelledby="myModalLabel">\r\n  <div class="modal-dialog" role="document">\r\n    <div class="modal-content">\r\n      <div class="modal-header">\r\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close"></button>\r\n        <h4 class="modal-title">路线</h4>\r\n      </div>\r\n      <div class="modal-body" style="height: auto; max-height: 425px; overflow: hidden auto;">\r\n        \x3c!-- 新增围栏表单 --\x3e\r\n        <form class="form-horizontal" action="/clbs/m/functionconfig/fence/managefence/add" id="addLineForm" role="form"\r\n          method="post">\r\n          <table id="table-lng-lat" class="table table-striped table-bordered table-hover table-lng-lat">\r\n          </table>\r\n          <div class="row">\r\n            <div class="form-group">\r\n              <input type="hidden" id="addOrUpdateLineFlag" name="addOrUpdateLineFlag" />\r\n              <input type="hidden" id="lineId" name="lineId" />\r\n              <label class="col-md-3 control-label"><label class="text-danger">*</label> 路线名称：</label>\r\n              <div class=" col-md-8">\r\n                <input type="text" placeholder="请输入路线名称" class="form-control" id="lineName1" name="name" />\r\n              </div>\r\n            </div>\r\n            <div class="form-group">\r\n              <label class="col-md-3 control-label">路线类型：</label>\r\n              <div class=" col-md-8">\r\n                <select class="form-control" id="lineType1" name="type">\r\n                  <option value="国道">国道</option>\r\n                  <option value="省道">省道</option>\r\n                  <option value="县道">县道</option>\r\n                  <option value="高速">高速</option>\r\n                  <option value="高架立交">高架立交</option>\r\n                  <option value="其他小路">其他小路</option>\r\n                </select>\r\n              </div>\r\n            </div>\r\n            <div class="form-group">\r\n              <label class="col-md-3 control-label"><label class="text-danger">*</label> 偏移量(m)：</label>\r\n              <div class=" col-md-8">\r\n                <input placeholder="请输入数字" onkeyup="value=value.replace(/[^0-9]/g,\'\') " class="form-control"\r\n                  id="lineWidth1" name="width" />\r\n              </div>\r\n            </div>\r\n            <div class="form-group">\r\n              <label class="col-md-3 control-label">描述：</label>\r\n              <div class=" col-md-8">\r\n                <textarea class="form-control" rows="3" id="lineDescription1" name="description"></textarea>\r\n              </div>\r\n            </div>\r\n            <div class="form-group" id="inflectionPointBox"></div>\r\n          </div>\r\n          <div class="modal-footer">\r\n            <input type="hidden" id="pointSeqs" name="pointSeqs" />\r\n            <input type="hidden" id="longitudes" name="longitudes" />\r\n            <input type="hidden" id="latitudes" name="latitudes" />\r\n            <button type="button" data-type="zw_m_line" id="threadSave" class="btn btn-primary">保存</button>\r\n            <button type="button" id="lineEditClose" class="btn btn-default btn-off" data-dismiss="modal">\r\n              取消\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n\x3c!-- 矩形 --\x3e\r\n<div class="modal fade" id="rectangle-form" aria-hidden="true" data-backdrop="static" role="dialog"\r\n  aria-labelledby="myModalLabel">\r\n  <div class="modal-dialog" role="document">\r\n    <div class="modal-content">\r\n      <div class="modal-header">\r\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close"></button>\r\n        <h4 class="modal-title">矩形</h4>\r\n      </div>\r\n      <div class="modal-body">\r\n        \x3c!-- 新增围栏表单 --\x3e\r\n        <form class="form-horizontal" action="/clbs/m/functionconfig/fence/managefence/rectangles" id="rectangles"\r\n          role="form" method="post">\r\n          <table id="rectangle-lng-lat1" class="table table-striped table-bordered table-hover table-lng-lat">\r\n          </table>\r\n          <div class="row">\r\n            <div class="form-group">\r\n              <input type="hidden" id="addOrUpdateRectangleFlag" name="addOrUpdateRectangleFlag" />\r\n              <input type="hidden" id="rectangleId" name="rectangleId" />\r\n              <label class="col-md-3 control-label"><label class="text-danger">*</label> 区域名称：</label>\r\n              <div class=" col-md-8">\r\n                <input type="text" placeholder="请输入区域名称" class="form-control" id="rectangleName" name="name" />\r\n              </div>\r\n            </div>\r\n            <div class="form-group">\r\n              <label class="col-md-3 control-label">区域类型：</label>\r\n              <div class=" col-md-8">\r\n                <select class="form-control" id="rectangleType" name="type">\r\n                  <option value="普通区域">普通区域</option>\r\n                  <option value="危险区域">危险区域</option>\r\n                  <option value="违规区域">违规区域</option>\r\n                  <option value="休息区">休息区</option>\r\n                  <option value="接驳点">接驳点</option>\r\n                  <option value="风控点">风控点</option>\r\n                  <option value="途经点">途经点</option>\r\n                </select>\r\n              </div>\r\n            </div>\r\n            <div class="form-group hidden">\r\n              <label class="col-md-3 control-label">形状：</label>\r\n              <div class=" col-md-8">\r\n                <select class="form-control" id="rectangleShape" name="shape">\r\n                  <option value="矩形">矩形</option>\r\n                </select>\r\n              </div>\r\n            </div>\r\n            <div class="form-group">\r\n              <label class="col-md-3 control-label">描述：</label>\r\n              <div class=" col-md-8">\r\n                <textarea class="form-control" rows="3" id="rectangleDescription" name="description"></textarea>\r\n              </div>\r\n            </div>\r\n            <div class="form-group">\r\n              <label class="col-md-3 control-label lngLat_show">经纬度<span class="fa fa-chevron-up"\r\n                  aria-hidden="true"></span></label>\r\n            </div>\r\n            <div class="pointList">\r\n              <div class="form-group">\r\n                <label class="col-md-3 control-label">左上点经、纬度：</label>\r\n                <div class=" col-md-8">\r\n                  <input id="LUPointLngLat" name="lnglatQuery_LU" type="text" placeholder="请输入左上点经、纬度"\r\n                    class="form-control" />\r\n                </div>\r\n              </div>\r\n              <div class="form-group">\r\n                <label class="col-md-3 control-label">右下点经、纬度：</label>\r\n                <div class=" col-md-8">\r\n                  <input id="RDPointLngLat" name="lnglatQuery_RD" type="text" placeholder="请输入右下点经、纬度"\r\n                    class="form-control" />\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class="modal-footer">\r\n            <input type="hidden" id="pointSeqsRectangles" name="pointSeqs" />\r\n            <input type="hidden" id="longitudesRectangles" name="longitudes" />\r\n            <input type="hidden" id="latitudesRectangles" name="latitudes" />\r\n            <button type="button" data-type="zw_m_rectangle" id="rectangleSave" class="btn btn-primary">保存\r\n            </button>\r\n            <button type="button" id="rectangleEditClose" class="btn btn-default btn-off" data-dismiss="modal">取消\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n\x3c!-- 多边形 --\x3e\r\n<div class="modal fade" id="myModal" aria-hidden="true" data-backdrop="static" role="dialog"\r\n  aria-labelledby="myModalLabel">\r\n  <div class="modal-dialog" role="document">\r\n    <div class="modal-content">\r\n      <div class="modal-header">\r\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close"></button>\r\n        <h4 class="modal-title">多边形</h4>\r\n      </div>\r\n      <div class="modal-body">\r\n        \x3c!-- 新增围栏表单 --\x3e\r\n        <form class="form-horizontal" action="/clbs/m/functionconfig/fence/managefence/polygons" id="polygons"\r\n          role="form" method="post">\r\n          <table id="table-lng-lat1" class="table table-striped table-bordered table-hover table-lng-lat">\r\n            <tbody></tbody>\r\n          </table>\r\n          <div class="row">\r\n            <div class="form-group">\r\n              <input type="hidden" id="addOrUpdatePolygonFlag" name="addOrUpdatePolygonFlag" />\r\n              <input type="hidden" id="polygonId" name="polygonId" />\r\n              <label class="col-md-3 control-label"><label class="text-danger">*</label> 区域名称：</label>\r\n              <div class=" col-md-8">\r\n                <input type="text" placeholder="请输入区域名称" class="form-control" id="polygonName" name="name" />\r\n              </div>\r\n            </div>\r\n            <div class="form-group">\r\n              <label class="col-md-3 control-label">区域类型：</label>\r\n              <div class=" col-md-8">\r\n                <select class="form-control" id="polygonType" name="type">\r\n                  <option value="普通区域">普通区域</option>\r\n                  <option value="危险区域">危险区域</option>\r\n                  <option value="违规区域">违规区域</option>\r\n                  <option value="休息区">休息区</option>\r\n                  <option value="接驳点">接驳点</option>\r\n                  <option value="途经点">途经点</option>\r\n                </select>\r\n\r\n              </div>\r\n            </div>\r\n            <div class="form-group hidden">\r\n              <label class="col-md-3 control-label">形状：</label>\r\n              <div class=" col-md-8">\r\n                <select class="form-control" id="polygonShape" name="shape">\r\n                  <option value="多边形">多边形</option>\r\n                </select>\r\n              </div>\r\n            </div>\r\n            <div class="form-group">\r\n              <label class="col-md-3 control-label">描述：</label>\r\n              <div class=" col-md-8">\r\n                <textarea class="form-control" rows="3" id="polygonDescription" name="description"></textarea>\r\n              </div>\r\n            </div>\r\n            <div class="form-group">\r\n              <label class="col-md-3 control-label lngLat_show">经纬度<span class="fa fa-chevron-up"\r\n                  aria-hidden="true"></span></label>\r\n            </div>\r\n            <div class="pointList">\r\n              <div id="rectangleAllPointShow">\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class="modal-footer">\r\n            <input type="hidden" id="pointSeqsPolygons" name="pointSeqs" />\r\n            <input type="hidden" id="longitudesPolygons" name="longitudes" />\r\n            <input type="hidden" id="latitudesPolygons" name="latitudes" />\r\n            <button type="button" data-type="zw_m_polygon" id="polygonSave" class="btn btn-primary">保存\r\n            </button>\r\n            <button type="button" id="polygonFenceClose" class="btn btn-default btn-off" data-dismiss="modal">取消\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n\x3c!-- 圆形 --\x3e\r\n<div class="modal fade" id="circleArea" aria-hidden="true" data-backdrop="static" role="dialog"\r\n  aria-labelledby="myModalLabel">\r\n  <div class="modal-dialog" role="document">\r\n    <div class="modal-content">\r\n      <div class="modal-header">\r\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close"></button>\r\n        <h4 class="modal-title">圆形</h4>\r\n      </div>\r\n      <div class="modal-body">\r\n        \x3c!-- 新增圆形区域表单 --\x3e\r\n        <form class="form-horizontal" action="/clbs/m/functionconfig/fence/managefence/circles" id="circles" role="form"\r\n          method="post">\r\n          <div class="row">\r\n            <div class="form-group" style="display:none;">\r\n              <input type="hidden" id="addOrUpdateCircleFlag" name="addOrUpdateCircleFlag" />\r\n              <input type="hidden" id="circleId" name="circleId" />\r\n            </div>\r\n            <div class="form-group">\r\n              <label class="col-md-3 control-label"><label class="text-danger">*</label> 区域名称：</label>\r\n              <div class=" col-md-8">\r\n                <input type="text" placeholder="请输入区域名称" class="form-control" id="circleName" name="name" />\r\n              </div>\r\n            </div>\r\n            <div class="form-group">\r\n              <label class="col-md-3 control-label">区域类型：</label>\r\n              <div class=" col-md-8">\r\n                <select class="form-control" id="circleType" name="type">\r\n                  <option value="普通区域">普通区域</option>\r\n                  <option value="危险区域">危险区域</option>\r\n                  <option value="违规区域">违规区域</option>\r\n                  <option value="休息区">休息区</option>\r\n                  <option value="接驳点">接驳点</option>\r\n                  <option value="风控点">风控点</option>\r\n                  <option value="途经点">途经点</option>\r\n                </select>\r\n              </div>\r\n            </div>\r\n            <div class="form-group">\r\n              <label class="col-md-3 control-label">描述：</label>\r\n              <div class=" col-md-8">\r\n                <textarea class="form-control" rows="3" id="circleDescription" name="description"></textarea>\r\n              </div>\r\n            </div>\r\n            <div class="form-group">\r\n              <label class="col-md-3 control-label lngLat_show">经纬度<span class="fa fa-chevron-up"\r\n                  aria-hidden="true"></span></label>\r\n            </div>\r\n            <div class="pointList">\r\n              <div class="form-group">\r\n                <label class="col-md-3 control-label">中心点纬度：</label>\r\n                <div class=" col-md-8">\r\n                  <input id="editCircleLat" type="text" name="centerPointLat" value="" class="form-control" />\r\n                </div>\r\n                <div class="col-md-8 hidden">\r\n                  <input id="circle-lat" type="text" value="" class="form-control" name="latitude" />\r\n                </div>\r\n              </div>\r\n              <div class="form-group">\r\n                <label class="col-md-3 control-label">中心点经度：</label>\r\n                <div class=" col-md-8">\r\n                  <input id="editCircleLng" type="text" name="centerPointLng" value="11" class="form-control" />\r\n                </div>\r\n                <div class=" col-md-8 hidden">\r\n                  <input id="circle-lng" type="text" value="11" class="form-control" name="longitude" />\r\n                </div>\r\n              </div>\r\n              <div class="form-group">\r\n                <label class="col-md-3 control-label">半径(米)：</label>\r\n                <div class=" col-md-8">\r\n                  <input id="editCircleRadius" name="centerRadius" type="text" value="" class="form-control" />\r\n                </div>\r\n                <div class=" col-md-8 hidden">\r\n                  <input id="circle-radius" type="text" value="" class="form-control" name="radius" />\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </form>\r\n      </div>\r\n      <div class="modal-footer">\r\n        <button type="button" data-type="zw_m_circle" id="roundSave" class="btn btn-primary">保存</button>\r\n        <button type="button" id="circleFenceClose" class="btn btn-default btn-off" data-dismiss="modal">取消\r\n        </button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n\x3c!--行政区域--\x3e\r\n<div class="modal fade" id="administrativeArea" aria-hidden="true" data-backdrop="static" role="dialog"\r\n  aria-labelledby="myModalLabel">\r\n  <div class="modal-dialog modal-sm" role="document" style="width:360px !important;">\r\n    <div class="modal-content">\r\n      <div class="modal-header">\r\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close"></button>\r\n        <h4 class="modal-title">行政区划</h4>\r\n      </div>\r\n      <div class="modal-body">\r\n        \x3c!-- 新增围栏表单 --\x3e\r\n        <form class="form-horizontal" action="/clbs/m/functionconfig/fence/managefence/addAdministration"\r\n          id="administration" role="form" method="post">\r\n          <table class="table table-striped table-bordered table-hover table-lng-lat">\r\n          </table>\r\n          <div class="row">\r\n            <div class="form-group">\r\n              <label class="col-md-3 control-label Administrative-label"><label class="text-danger">*</label> 省：</label>\r\n              <div class=" col-md-8">\r\n                <input type="hidden" id="provinceVal" name="province" />\r\n                <select class="form-control" id="province"></select>\r\n                <label id="provinceError"\r\n                  style="display: none;color: #fff;background: #b94a48;border: solid thin #fff;padding: 3px 5px;">请选择行政区划省份</label>\r\n              </div>\r\n            </div>\r\n            <div class="form-group">\r\n              <label class="col-md-3 control-label Administrative-label">市：</label>\r\n              <div class=" col-md-8">\r\n                <input type="hidden" id="cityVal" name="city" />\r\n                <select class="form-control" id="city">\r\n                </select>\r\n              </div>\r\n            </div>\r\n            <div class="form-group">\r\n              <label class="col-md-3 control-label Administrative-label">区：</label>\r\n              <div class=" col-md-8">\r\n                <input type="hidden" id="districtVal" name="district" />\r\n                <select class="form-control" id="district">\r\n                </select>\r\n              </div>\r\n            </div>\r\n            <div class="form-group">\r\n              <label class="col-md-3 control-label Administrative-label"><label class="text-danger">*</label>\r\n                名称：</label>\r\n              <div class=" col-md-8">\r\n                <input type="text" placeholder="请输入行政区划名称" class="form-control" id="administrationName" name="name" />\r\n              </div>\r\n            </div>\r\n            <div class="form-group">\r\n              <label class="col-md-3 control-label Administrative-label">描述：</label>\r\n              <div class=" col-md-8">\r\n                <textarea class="form-control" rows="3" id="administrationDistrict" name="description"></textarea>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <input type="hidden" id="administrativeAreaId" name="administrativeAreaId" />\r\n          <input type="hidden" id="administrativeLngLat" name="administrativeLngLat" />\r\n        </form>\r\n      </div>\r\n      <div class="modal-footer">\r\n        <button type="button" data-type="zw_m_administration" id="administrativeSave" class="btn btn-primary">\r\n          保存\r\n        </button>\r\n        <button type="button" id="administrativeClose" class="btn btn-default btn-off" data-dismiss="modal">取消\r\n        </button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n\x3c!--导航路线--\x3e\r\n<div id="drivenRoute">\r\n  <div class="" role="document">\r\n    <div class="modal-content">\r\n      <div class="modal-body">\r\n        <form class="form-horizontal" action="/clbs/m/functionconfig/fence/managefence/travelLine" id="dragRouteLine"\r\n          role="form" method="post">\r\n          <table id="" class="table table-striped table-bordered table-hover table-lng-lat">\r\n          </table>\r\n          <div class="row">\r\n            <div class="form-group">\r\n              <div class="col-md-12">\r\n                <input type="text" placeholder="请输入线路名称(必填)" class="form-control" id="dragRouteLineName" name="name" />\r\n              </div>\r\n            </div>\r\n            <div class="form-group">\r\n              <div class="col-md-12">\r\n                <input type="text" placeholder="请输入起点(或右键地图)" class="form-control" id="startPoint" name="startPoint" />\r\n              </div>\r\n            </div>\r\n            <div id="wayPointArea"></div>\r\n            <div class="form-group">\r\n              <div class="col-md-10">\r\n                <input type="text" placeholder="请输入终点(或右键地图)" class="form-control" id="endPoint" name="endPoint" />\r\n              </div>\r\n              <button id="addWayToPoint" type="button" class="btn btn-primary padBottom">\r\n                <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>\r\n              </button>\r\n            </div>\r\n            <div class="form-group">\r\n              <div class="col-md-12">\r\n                <select class="form-control" id="dragRouteType" name="type">\r\n                  <option value="国道">国道</option>\r\n                  <option value="省道">省道</option>\r\n                  <option value="县道">县道</option>\r\n                  <option value="高速">高速</option>\r\n                  <option value="高架立交">高架立交</option>\r\n                  <option value="其他小路">其他小路</option>\r\n                </select>\r\n              </div>\r\n            </div>\r\n            <div class="form-group">\r\n              <div class="col-md-12">\r\n                <input type="text" placeholder="请输入偏移量(必填)" onkeyup="value=value.replace(/[^0-9]/g,\'\') "\r\n                  class="form-control" id="excursion" name="excursion" />\r\n              </div>\r\n            </div>\r\n            <div class="form-group">\r\n              <div class="col-md-12">\r\n                <textarea class="form-control" placeholder="请输入描述" rows="3" id="dragRouteDescription"\r\n                  name="description"></textarea>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class="modal-footer">\r\n            <input type="hidden" id="travelLineId" name="travelLineId" />\r\n            <input type="hidden" id="addOrUpdateTravelFlag" name="addOrUpdateTravelFlag" />\r\n            <input type="hidden" id="startToEndLng" name="startToEndLng" />\r\n            <input type="hidden" id="startToEndLat" name="startToEndLat" />\r\n            <input type="hidden" id="wayPointLng" name="wayPointLng" />\r\n            <input type="hidden" id="wayPointLat" name="wayPointLat" />\r\n            <input type="hidden" id="allPointLng" name="allPointLng" />\r\n            <input type="hidden" id="allPointLat" name="allPointLat" />\r\n            <button type="button" data-type="zw_m_travel_line" id="lineDragRouteSave" class="btn btn-primary">\r\n              保存\r\n            </button>\r\n            <button type="button" id="lineDragRouteClose" class="btn btn-default btn-off" data-dismiss="modal">取消\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n\x3c!-- 围栏关键点 --\x3e\r\n<div class="modal fade" id="addMonitoringTag" aria-hidden="true" data-backdrop="static" role="dialog"\r\n  aria-labelledby="myModalLabel">\r\n  <div class="modal-dialog" role="document">\r\n    <div class="modal-content">\r\n      <div class="modal-header">\r\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close"></button>\r\n        <h4 class="modal-title">添加关键点</h4>\r\n      </div>\r\n      <div class="modal-body">\r\n        \x3c!-- 新增标注表单 --\x3e\r\n        <form class="form-horizontal" action="/clbs/m/functionconfig/fence/managefence/addMonitoringTag"\r\n          id="monitoringTag" role="form" method="post">\r\n          <div class="row">\r\n            <div class="form-group hidden">\r\n              <input id="lineIDs" name="lineId" value="" />\r\n              <div class="col-md-3">\r\n                <input id="marking-lng" name="longitude" />\r\n              </div>\r\n              <div class="col-md-3">\r\n                <input id="marking-lat" name="latitude" />\r\n              </div>\r\n            </div>\r\n            <div class="form-group">\r\n              <label class="col-md-3 control-label"><label class="text-danger">*</label> 名称：</label>\r\n              <div class=" col-md-8">\r\n                <input type="text" placeholder="请输入名称" class="form-control" id="TagName" name="name" />\r\n              </div>\r\n            </div>\r\n            <div class="form-group">\r\n              <label class="col-md-3 control-label"><label class="text-danger">*</label> 到达时间：</label>\r\n              <div class="col-md-8 searchListSelect">\r\n                <input placeholder="请选择到达时间" style="cursor: pointer; background-color: #fafafa;"\r\n                  class="form-control layer-date laydate-icon" id="arriveTime" name="arriveTime" readonly />\r\n              </div>\r\n            </div>\r\n            <div class="form-group">\r\n              <label class="col-md-3 control-label"><label class="text-danger">*</label> 离开时间：</label>\r\n              <div class="col-md-8 searchListSelect">\r\n                <input placeholder="请选择离开时间" style="cursor: pointer; background-color: #fafafa;"\r\n                  class="form-control layer-date laydate-icon" id="leaveTime" name="leaveTime" readonly />\r\n              </div>\r\n            </div>\r\n            <div class="form-group">\r\n              <label class="col-md-3 control-label">描述：</label>\r\n              <div class=" col-md-8">\r\n                <textarea class="form-control" rows="4" id="description" name="description"></textarea>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class="modal-footer">\r\n            <button type="button" id="save" class="btn btn-primary">添加</button>\r\n            <button type="button" id="monitoringTagClose" class="btn btn-default btn-off" data-dismiss="modal">取消\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n\x3c!-- 分段限速 --\x3e\r\n<div class="modal fade" id="addMonitoringSection" aria-hidden="true" data-backdrop="static" role="dialog"\r\n  aria-labelledby="myModalLabel">\r\n  <div class="modal-dialog" role="document">\r\n    <div class="modal-content">\r\n      <div class="modal-header">\r\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close"></button>\r\n        <h4 class="modal-title">分段限速</h4>\r\n      </div>\r\n      <div class="modal-body">\r\n        \x3c!-- 新增标注表单 --\x3e\r\n        <form class="form-horizontal" action="/clbs/m/functionconfig/fence/managefence/addSegment"\r\n          id="monitoringSection" role="form" method="post">\r\n          <div class="row" id="pages">\r\n            <div class="col-md-12">\r\n              <div class="panel-heading">\r\n                <div class="dropdown panel-title fwb">\r\n                  <ul class="nav nav-tabs" id="tenples">\r\n                  </ul>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div class="panel-body" style="margin-top: 45px">\r\n              <div id="pagecontent" class="tab-content">\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class="modal-footer">\r\n            <button type="button" id="saveSection" class="btn btn-primary">提交</button>\r\n            <button type="button" id="sectionRateLimitingClose" class="btn btn-default btn-off" data-dismiss="modal">取消\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>'},206:function(e,t,a){},207:function(e,t){e.exports='\x3c!--状态信息--\x3e\r\n<div id="statusTableWrap" class="table-wrap active"></div>\r\n\r\n\x3c!--808报警--\x3e\r\n<div id="waringTableWrap" class="table-wrap"></div>\r\n\r\n\x3c!--主动安全--\x3e\r\n<div id="securityTableWrap" class="table-wrap"></div>\r\n\r\n\x3c!-- 主动安全 弹窗 --\x3e\r\n<div class="popover fade top" id="activeSafetyPop">\r\n    <div class="popover-title">\r\n        <span id="closePopover" style="cursor: pointer;">关闭</span>\r\n    </div>\r\n    <div class="popover-content">\r\n        <div id="popoverBox">\r\n            \x3c!-- <table class="table table-striped table-bordered table-hover text-center">\r\n              <thead>\r\n              <tr>\r\n                  <th>报警类型</th>\r\n                  <th>报警事件</th>\r\n                  <th>报警等级</th>\r\n                  <th>开始报警时间</th>\r\n                  <th>结束报警时间</th>\r\n                  <th>车辆速度</th>\r\n                  <th>经度</th>\r\n                  <th>纬度</th>\r\n                  <th>道路类型</th>\r\n                  <th>路网限速</th>\r\n                  <th>事件编号</th>\r\n                  <th>车辆状态</th>\r\n                  <th>预览</th>\r\n                  <th>终端证据</th>\r\n              </tr>\r\n              </thead>\r\n              <tbody id="activeSafetyPopTody">\r\n\r\n              </tbody>\r\n          </table> --\x3e\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n\x3c!-- 主动安全 -> 弹窗 -> 图片或视频弹窗 --\x3e\r\n<div class="modal fade in" id="eventMediaModal" role="dialog" aria-labelledby="eventMediaModalLabel"\r\n    aria-hidden="false">\r\n    <div class="modal-dialog" role="document">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span\r\n                        aria-hidden="true">×</span></button>\r\n                <h4 class="modal-title" id="eventMediaModalLabel"></h4>\r\n            </div>\r\n            <div class="modal-body" style="height: 500px; max-height: 750px;">\r\n                <div>\r\n                    <span class="media_tab">\r\n                        <button id="img" href="javascript:void(0)" class="btn btn-primary Img"\r\n                            data-value="1">终端图片</button>\r\n                    </span>\r\n                    <span class="media_tab">\r\n                        <button id="video" href="javascript:void(0)" class="btn btn-primary Video"\r\n                            data-value="2">终端视频</button>\r\n                    </span>\r\n                </div>\r\n                <div class="col-md-1" style="padding: 0">\r\n                    <span class="prevMedia"></span>\r\n                </div>\r\n                <div class="col-md-10" style="min-height: 370px;padding-bottom: 20px;position: relative;">\r\n                    <img id="eventMediaPic" style="max-width: 100%;" src="">\r\n                    <div id="videoBox" style="width: 100%;min-height: 370px;">\r\n                        <video width="100%" height="370" id="eventMediaVideo" controls="true" controlslist="nodownload"\r\n                            src=""></video>\r\n                    </div>\r\n                    <p id="picCount"><span id="whichNum">1</span>/<span id="allNum">10</span></p>\r\n                </div>\r\n                <div class="col-md-1" style="padding: 0">\r\n                    <span class="nextMedia"></span>\r\n                </div>\r\n\r\n            </div>\r\n            <div class="modal-footer">\r\n                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n\x3c!--从业人员详情--\x3e\r\n<div class="modal fade" id="professionalsDetail" aria-hidden="true" data-backdrop="static" role="dialog"\r\n    aria-labelledby="myModalLabel">\r\n    <div class="modal-dialog" role="document" style="width: 700px">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>\r\n                <h4 class="modal-title">从业人员</h4>\r\n            </div>\r\n            <div class="modal-body">\r\n                <div class="infoScrollBox" id="professionalsInfoScrollBox">\r\n                    <div class="prevBtnBox">\r\n                        <i class="fa fa-caret-left"></i>\r\n                    </div>\r\n                    <div class="nextBtnBox">\r\n                        <i class="fa fa-caret-right"></i>\r\n                    </div>\r\n\r\n                    <div class="infoScrollCont" id="professionalsInfoScrollCont">\r\n                        <div class="col-md-12 singleInfoCont">\r\n                            <div class="col-md-2 driverPhoto">\r\n                                <img id="professionalsPhoto" src="/clbs/resources/img/peoplems.png" />\r\n                            </div>\r\n                            <div class="col-md-10 infoCont">\r\n                                <div class="col-md-5">司机姓名：未知</div>\r\n                                <div class="col-md-7">岗位类型：未知</div>\r\n                                <div class="col-md-5">手机号：未知</div>\r\n                                <div class="col-md-7">身份证号：未知</div>\r\n                                <div class="col-md-12">所属企业：未知</div>\r\n                                <div class="col-md-12">从业资格证号：未知</div>\r\n                                <div class="col-md-12">从业资格类别：未知</div>\r\n                                <div class="col-md-12">发证机关：未知</div>\r\n                                <div class="col-md-12">有效期至：未知</div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class="modal-footer">\r\n                <button type="button" class="btn btn-default btn-off" data-dismiss="modal">关闭\r\n                </button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\x3c!--终端IO状态--\x3e\r\n<div class="modal fade" id="ioModalTerminal" aria-hidden="true" data-backdrop="static" role="dialog"\r\n    aria-labelledby="myModalLabel">\r\n    <div class="modal-dialog" role="document">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>\r\n                <h4 class="modal-title">终端I/O状态</h4>\r\n            </div>\r\n            <div class="modal-body">\r\n                <div>\r\n                    <table class="io-modal-table">\r\n                        <tbody id="ioModalTerminalContent">\r\n\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n            </div>\r\n            <div class="modal-footer">\r\n                <button type="button" class="btn btn-default btn-off" data-dismiss="modal">关闭\r\n                </button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\x3c!--传感器IO状态--\x3e\r\n<div class="modal fade" id="ioModalSensor" aria-hidden="true" data-backdrop="static" role="dialog"\r\n    aria-labelledby="myModalLabel">\r\n    <div class="modal-dialog" role="document">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>\r\n                <h4 class="modal-title" id="ioStatusModalTitle">传感器I/O状态</h4>\r\n            </div>\r\n            <div class="modal-body">\r\n                <ul class="nav nav-tabs" role="tablist" id="ioModalTabTitleContainer">\r\n                    <li role="presentation" class="active" id="sensorIOModalLi1"><a href="#sensorIOModalTab1"\r\n                            aria-controls="home" role="tab" data-toggle="tab">I/O采集1</a></li>\r\n                    <li role="presentation" id="sensorIOModalLi2"><a href="#sensorIOModalTab2" aria-controls="profile"\r\n                            role="tab" data-toggle="tab">I/O采集2</a></li>\r\n                </ul>\r\n                <div class="tab-content" id="ioModalTabTitleContent">\r\n                    <div role="tabpanel" class="tab-pane active" id="sensorIOModalTab1">\r\n                        <div>\r\n                            <table class="io-modal-table">\r\n                                <tbody id="ioModalSensorContent1">\r\n\r\n                                </tbody>\r\n                            </table>\r\n                        </div>\r\n                    </div>\r\n                    <div role="tabpanel" class="tab-pane" id="sensorIOModalTab2">\r\n                        <div>\r\n                            <table class="io-modal-table">\r\n                                <tbody id="ioModalSensorContent2">\r\n\r\n                                </tbody>\r\n                            </table>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class="modal-footer">\r\n                <button type="button" class="btn btn-default btn-off" data-dismiss="modal">关闭\r\n                </button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'},208:function(e,t,a){},209:function(module,exports){module.exports=function anonymous(locals,filters,escape,rethrow){escape=escape||function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;")};var __stack={lineno:1,input:'<table class="table table-striped table-bordered table-hover text-center">\r\n  <thead>\r\n  <tr>\r\n      <th>报警类型</th>\r\n      <th>报警事件</th>\r\n      <th>报警等级</th>\r\n      <th>开始报警时间</th>\r\n      <th>结束报警时间</th>\r\n      <th>车辆速度</th>\r\n      <th>经度</th>\r\n      <th>纬度</th>\r\n      <th>道路类型</th>\r\n      <th>路网限速</th>\r\n      <th>事件编号</th>\r\n      <th>车辆状态</th>\r\n      <th>预览</th>\r\n      <th>终端证据</th>\r\n  </tr>\r\n  </thead>\r\n  <tbody id="activeSafetyPopTbody">\r\n    <% data.forEach(function(item){ %>\r\n      <tr>\r\n        <td data-id="<%- item.eventId %>" data-vid="<%- vid %>"><%- item.riskType %></td>\r\n        <td data-id="<%- item.eventId %>" data-vid="<%- vid %>"><%- item.riskEvent %></td>\r\n        <td data-id="<%- item.eventId %>" data-vid="<%- vid %>"><%- item.level %></td>\r\n        <td data-id="<%- item.eventId %>" data-vid="<%- vid %>"><%- item.eventTime %></td>\r\n        <td data-id="<%- item.eventId %>" data-vid="<%- vid %>"><%- item.warningEndTime %></td>\r\n        <td data-id="<%- item.eventId %>" data-vid="<%- vid %>"><%- item.speedNumber %></td>\r\n        <td data-id="<%- item.eventId %>" data-vid="<%- vid %>"><%- item.originalLongitude %></td>\r\n        <td data-id="<%- item.eventId %>" data-vid="<%- vid %>"><%- item.originalLatitude %></td>\r\n        <td data-id="<%- item.eventId %>" data-vid="<%- vid %>"><%- item.roadTypeStr %></td>\r\n        <td data-id="<%- item.eventId %>" data-vid="<%- vid %>"><%- item.roadLimitSpeed %></td>\r\n        <td data-id="<%- item.eventId %>" data-vid="<%- vid %>"><%- item.eventNumber %></td>\r\n        <td data-id="<%- item.eventId %>" data-vid="<%- vid %>"><a href="javascript:void(0)" class="stateInfoTd" data-id="<%- item.monitoring  %>,<%- item.riskEvent %>,<%- item.vehicleStatus %>">状态信息</a></td>\r\n        <td data-id="<%- item.eventId %>" data-vid="<%- vid %>">\r\n          <% if(item.hasPic) { %> \r\n            <img class="eventhasInfo" data-eventId="<%- item.eventId %>" data-idx="1" src="/clbs/resources/img/previewimg-blue.svg" style="cursor: pointer" width="20" alt="图片" />\r\n          <% } else { %> \r\n            <img class="eventhasNotInfo" src="/clbs/resources/img/previewimg-grey.svg" width="20" alt="图片">\r\n          <% } %>\r\n          <% if(item.hasVideo) { %> \r\n            <img class="eventhasInfo" data-eventId="<%- item.eventId %>" data-idx="2" src="/clbs/resources/img/video-blue.svg" style="cursor: pointer" width="20" alt="视频">\r\n          <% } else { %> \r\n            <img class="eventhasNotInfo" src="/clbs/resources/img/video-grey.svg" width="20" alt="视频">\r\n          <% } %>\r\n        </td>\r\n        <td data-id="<%- item.eventId %>" data-vid="<%- vid %>"><%- item.downloadHtml %></td>\r\n      </tr>\r\n    <% }); %>\r\n  </tbody>\r\n</table>',filename:"."};function rethrow(e,t,a,n){var i=t.split("\n"),r=Math.max(n-3,0),s=Math.min(i.length,n+3),o=i.slice(r,s).map((function(e,t){var a=t+r+1;return(a==n?" >> ":"    ")+a+"| "+e})).join("\n");throw e.path=a,e.message=(a||"ejs")+":"+n+"\n"+o+"\n\n"+e.message,e}try{var buf=[];with(locals||{})buf.push('<table class="table table-striped table-bordered table-hover text-center">\n  <thead>\n  <tr>\n      <th>报警类型</th>\n      <th>报警事件</th>\n      <th>报警等级</th>\n      <th>开始报警时间</th>\n      <th>结束报警时间</th>\n      <th>车辆速度</th>\n      <th>经度</th>\n      <th>纬度</th>\n      <th>道路类型</th>\n      <th>路网限速</th>\n      <th>事件编号</th>\n      <th>车辆状态</th>\n      <th>预览</th>\n      <th>终端证据</th>\n  </tr>\n  </thead>\n  <tbody id="activeSafetyPopTbody">\n    '),__stack.lineno=21,data.forEach((function(e){buf.push('\n      <tr>\n        <td data-id="',(__stack.lineno=23,e.eventId),'" data-vid="',(__stack.lineno=23,vid),'">',(__stack.lineno=23,e.riskType),'</td>\n        <td data-id="',(__stack.lineno=24,e.eventId),'" data-vid="',(__stack.lineno=24,vid),'">',(__stack.lineno=24,e.riskEvent),'</td>\n        <td data-id="',(__stack.lineno=25,e.eventId),'" data-vid="',(__stack.lineno=25,vid),'">',(__stack.lineno=25,e.level),'</td>\n        <td data-id="',(__stack.lineno=26,e.eventId),'" data-vid="',(__stack.lineno=26,vid),'">',(__stack.lineno=26,e.eventTime),'</td>\n        <td data-id="',(__stack.lineno=27,e.eventId),'" data-vid="',(__stack.lineno=27,vid),'">',(__stack.lineno=27,e.warningEndTime),'</td>\n        <td data-id="',(__stack.lineno=28,e.eventId),'" data-vid="',(__stack.lineno=28,vid),'">',(__stack.lineno=28,e.speedNumber),'</td>\n        <td data-id="',(__stack.lineno=29,e.eventId),'" data-vid="',(__stack.lineno=29,vid),'">',(__stack.lineno=29,e.originalLongitude),'</td>\n        <td data-id="',(__stack.lineno=30,e.eventId),'" data-vid="',(__stack.lineno=30,vid),'">',(__stack.lineno=30,e.originalLatitude),'</td>\n        <td data-id="',(__stack.lineno=31,e.eventId),'" data-vid="',(__stack.lineno=31,vid),'">',(__stack.lineno=31,e.roadTypeStr),'</td>\n        <td data-id="',(__stack.lineno=32,e.eventId),'" data-vid="',(__stack.lineno=32,vid),'">',(__stack.lineno=32,e.roadLimitSpeed),'</td>\n        <td data-id="',(__stack.lineno=33,e.eventId),'" data-vid="',(__stack.lineno=33,vid),'">',(__stack.lineno=33,e.eventNumber),'</td>\n        <td data-id="',(__stack.lineno=34,e.eventId),'" data-vid="',(__stack.lineno=34,vid),'"><a href="javascript:void(0)" class="stateInfoTd" data-id="',(__stack.lineno=34,e.monitoring),",",(__stack.lineno=34,e.riskEvent),",",(__stack.lineno=34,e.vehicleStatus),'">状态信息</a></td>\n        <td data-id="',(__stack.lineno=35,e.eventId),'" data-vid="',(__stack.lineno=35,vid),'">\n          '),__stack.lineno=36,e.hasPic?(buf.push(' \n            <img class="eventhasInfo" data-eventId="',(__stack.lineno=37,e.eventId),'" data-idx="1" src="/clbs/resources/img/previewimg-blue.svg" style="cursor: pointer" width="20" alt="图片" />\n          '),__stack.lineno=38):(buf.push(' \n            <img class="eventhasNotInfo" src="/clbs/resources/img/previewimg-grey.svg" width="20" alt="图片">\n          '),__stack.lineno=40),buf.push("\n          "),__stack.lineno=41,e.hasVideo?(buf.push(' \n            <img class="eventhasInfo" data-eventId="',(__stack.lineno=42,e.eventId),'" data-idx="2" src="/clbs/resources/img/video-blue.svg" style="cursor: pointer" width="20" alt="视频">\n          '),__stack.lineno=43):(buf.push(' \n            <img class="eventhasNotInfo" src="/clbs/resources/img/video-grey.svg" width="20" alt="视频">\n          '),__stack.lineno=45),buf.push('\n        </td>\n        <td data-id="',(__stack.lineno=47,e.eventId),'" data-vid="',(__stack.lineno=47,vid),'">',(__stack.lineno=47,e.downloadHtml),"</td>\n      </tr>\n    "),__stack.lineno=49})),buf.push("\n  </tbody>\n</table>");return buf.join("")}catch(err){rethrow(err,__stack.input,__stack.filename,__stack.lineno)}}},210:function(e,t){e.exports='<div class="modal customList" id="customList" tabindex="-1" role="dialog" style="display: block;" data-backdrop="static">\r\n    <div class="modal-dialog" role="document">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <button type="button" id="doXAdd" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\r\n                <h4 class="modal-title">设置</h4>\r\n            </div>\r\n            <div class="modal-body">\r\n                <input type="text" id="resultList" th:value="${resultList}" hidden>\r\n                <ul id="columnSetUl" class="nav nav-tabs">\r\n                    <li class="active"><a href="#onlineTab" data-toggle="tab">全部车辆</a></li>\r\n                    <li><a href="#alarmTab" data-toggle="tab">808报警</a></li>\r\n                    <li><a href="#safetyTab" data-toggle="tab">主动安全</a></li>\r\n                    <li><a href="#filterTab" data-toggle="tab">快速筛选</a></li>\r\n                    <li><a href="#popupTab" data-toggle="tab">动态弹框</a></li>\r\n                    <li><a href="#alarmWarningTab" data-toggle="tab">报警提醒</a></li>\r\n                </ul>\r\n                <div class="panel-body">\r\n                    <div class="tab-content entry-content">\r\n                        \x3c!-- 状态信息 --\x3e\r\n                        <div class="tab-pane active" id="onlineTab">\r\n                            <div class="col-md-10">\r\n                                <h3 class="tabHead">显示和排序</h3>\r\n                                <label>\r\n                                    <input type="checkbox" class="allCheck"> 全部显示\r\n                                </label>\r\n                                <div id="onlineCheckBox" class="checkBox"></div>\r\n                                <div class="radioBox">\r\n                                    <h3 class="tabHead">锁定</h3>\r\n                                    <label>\r\n                                        <input type="radio" name="onlineRadio" value="1"> 1列\r\n                                    </label>\r\n                                    <label>\r\n                                        <input type="radio" name="onlineRadio" value="2"> 2列\r\n                                    </label>\r\n                                    <label>\r\n                                        <input type="radio" name="onlineRadio" value="3"> 3列\r\n                                    </label>\r\n                                    <label>\r\n                                        <input type="radio" name="onlineRadio" value="4"> 4列\r\n                                    </label>\r\n                                    <label>\r\n                                        <input type="radio" name="onlineRadio" value="0"> 不锁定\r\n                                    </label>\r\n                                </div>\r\n                            </div>\r\n                            <div class="col-md-2">\r\n                                <button class="sortUp" type="button" disabled>\r\n                                    <i class="glyphicon glyphicon-arrow-up"></i>\r\n                                </button>\r\n                                <button class="sortDown" type="button" disabled>\r\n                                    <i class="glyphicon glyphicon-arrow-down"></i>\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                        \x3c!-- 808报警 --\x3e\r\n                        <div class="tab-pane" id="alarmTab">\r\n                            <div class="col-md-10">\r\n                                <h3 class="tabHead">显示和排序</h3>\r\n                                <label>\r\n                                    <input type="checkbox" class="allCheck"> 全部显示\r\n                                </label>\r\n                                <div id="alarmCheckBox" class="checkBox"></div>\r\n                                <div class="radioBox">\r\n                                    <h3 class="tabHead">锁定</h3>\r\n                                    <label>\r\n                                        <input type="radio" name="alarmRadio" value="1"> 1列\r\n                                    </label>\r\n                                    <label>\r\n                                        <input type="radio" name="alarmRadio" value="2"> 2列\r\n                                    </label>\r\n                                    <label>\r\n                                        <input type="radio" name="alarmRadio" value="3"> 3列\r\n                                    </label>\r\n                                    <label>\r\n                                        <input type="radio" name="alarmRadio" value="4"> 4列\r\n                                    </label>\r\n                                    <label>\r\n                                        <input type="radio" name="alarmRadio" value="0"> 不锁定\r\n                                    </label>\r\n                                </div>\r\n                            </div>\r\n                            <div class="col-md-2">\r\n                                <button class="sortUp" type="button" disabled>\r\n                                    <i class="glyphicon glyphicon-arrow-up"></i>\r\n                                </button>\r\n                                <button class="sortDown" type="button" disabled>\r\n                                    <i class="glyphicon glyphicon-arrow-down"></i>\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                        \x3c!-- 主动安全 --\x3e\r\n                        <div class="tab-pane" id="safetyTab">\r\n                            <div class="col-md-10">\r\n                                <h3 class="tabHead">显示和排序</h3>\r\n                                <label>\r\n                                    <input type="checkbox" class="allCheck"> 全部显示\r\n                                </label>\r\n                                <div id="safetyCheckBox" class="checkBox"></div>\r\n                                <div class="radioBox">\r\n                                    <h3 class="tabHead">锁定</h3>\r\n                                    <label>\r\n                                        <input type="radio" name="safetyRadio" value="1"> 1列\r\n                                    </label>\r\n                                    <label>\r\n                                        <input type="radio" name="safetyRadio" value="2"> 2列\r\n                                    </label>\r\n                                    <label>\r\n                                        <input type="radio" name="safetyRadio" value="3"> 3列\r\n                                    </label>\r\n                                    <label>\r\n                                        <input type="radio" name="safetyRadio" value="4"> 4列\r\n                                    </label>\r\n                                    <label>\r\n                                        <input type="radio" name="safetyRadio" value="0"> 不锁定\r\n                                    </label>\r\n                                </div>\r\n                            </div>\r\n                            <div class="col-md-2">\r\n                                <button class="sortUp" type="button" disabled>\r\n                                    <i class="glyphicon glyphicon-arrow-up"></i>\r\n                                </button>\r\n                                <button class="sortDown" type="button" disabled>\r\n                                    <i class="glyphicon glyphicon-arrow-down"></i>\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                        \x3c!-- 快速筛选 --\x3e\r\n                        <div class="tab-pane" id="filterTab">\r\n                            <div class="col-md-10">\r\n                                <h3 class="tabHead">显示和排序</h3>\r\n                                <label>\r\n                                    <input type="checkbox" class="allCheck"> 全部显示\r\n                                </label>\r\n                                <div id="filterCheckBox" class="checkBox"></div>\r\n                                <div class="radioBox">\r\n                                    <h3 class="tabHead">锁定</h3>\r\n                                    <label>\r\n                                        <input type="radio" name="filterRadio" value="1" disabled> 1列\r\n                                    </label>\r\n                                    <label>\r\n                                        <input type="radio" name="filterRadio" value="2" disabled> 2列\r\n                                    </label>\r\n                                    <label>\r\n                                        <input type="radio" name="filterRadio" value="3" disabled> 3列\r\n                                    </label>\r\n                                    <label>\r\n                                        <input type="radio" name="filterRadio" value="4" disabled> 4列\r\n                                    </label>\r\n                                    <label>\r\n                                        <input type="radio" name="filterRadio" value="0"> 不锁定\r\n                                    </label>\r\n                                </div>\r\n                            </div>\r\n                            <div class="col-md-2">\r\n                                <button class="sortUp" type="button" disabled>\r\n                                    <i class="glyphicon glyphicon-arrow-up"></i>\r\n                                </button>\r\n                                <button class="sortDown" type="button" disabled>\r\n                                    <i class="glyphicon glyphicon-arrow-down"></i>\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                        \x3c!-- 动态弹框 --\x3e\r\n                        <div class="tab-pane" id="popupTab">\r\n                            <div class="col-md-10">\r\n                                <h3 class="tabHead">显示和排序<span style="color: red;font-size: 14px">(重新订阅监控对象生效)</span>\r\n                                </h3>\r\n                                <label>\r\n                                    <input type="checkbox" class="allCheck"> 全部显示\r\n                                </label>\r\n                                <div id="popupCheckBox" class="checkBox"></div>\r\n                            </div>\r\n                            <div class="col-md-2">\r\n                                <button class="sortUp" type="button" disabled>\r\n                                    <i class="glyphicon glyphicon-arrow-up"></i>\r\n                                </button>\r\n                                <button class="sortDown" type="button" disabled>\r\n                                    <i class="glyphicon glyphicon-arrow-down"></i>\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                        \x3c!-- 报警提醒 --\x3e\r\n                        <div class="tab-pane" id="alarmWarningTab">\r\n                            <div class="col-md-10">\r\n                                <h3 class="tabHead">报警提醒设置</h3>\r\n                                <label style="font-weight: normal;">\r\n                                  <input type="checkbox" class="allCheck" id="voiceCheck"> 提示声音\r\n                                </label>\r\n                                <br />\r\n                                <label style="font-weight: normal;">\r\n                                  <input type="checkbox" class="allCheck"  id="flashCheck"> 闪烁效果\r\n                                </label>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class="modal-footer">\r\n                <button id="submitBtn" class="btn btn-primary" type="button">\r\n                    <strong>提 交</strong>\r\n                </button>\r\n                <button id="closeBtn" type="button" class="btn btn-default" data-dismiss="modal">\r\n                    <strong>关 闭</strong>\r\n                </button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'},211:function(e,t,a){},212:function(e,t){e.exports='<div id="divSlideWrap" class="lkyw-table-filter">\r\n    <i class="fa fa-sort-desc lkyw-arrow" data-value="left"></i>\r\n    <div id="lkywFilter" class="lkyw-filter">\r\n        <div id="lkywListWrap" class="lkyw-lists-wrap">\r\n\r\n        </div>\r\n    </div>\r\n    <i class="fa fa-sort-asc lkyw-arrow" data-value="right"></i>\r\n    <i class="fa fa-cog lkyw-icon-settting"></i>\r\n</div>'},213:function(e,t,a){},214:function(module,exports){module.exports=function anonymous(locals,filters,escape,rethrow){escape=escape||function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;")};var __stack={lineno:1,input:'<ul class="lkyw-filter-lists">\r\n    <% data.forEach(function(item){ %>\r\n    <li data-type="<%- item.alarmType ? item.alarmType : item.columnName -%>">\r\n        <span class="icon"></span>\r\n        <%- item.title -%>\r\n        <span class="num"></span>\r\n        <i data-id="<%= item.columnId %>" class="fa fa-close"></i>\r\n    </li>\r\n    <% }) %>\r\n</ul>',filename:"."};function rethrow(e,t,a,n){var i=t.split("\n"),r=Math.max(n-3,0),s=Math.min(i.length,n+3),o=i.slice(r,s).map((function(e,t){var a=t+r+1;return(a==n?" >> ":"    ")+a+"| "+e})).join("\n");throw e.path=a,e.message=(a||"ejs")+":"+n+"\n"+o+"\n\n"+e.message,e}try{var buf=[];with(locals||{})buf.push('<ul class="lkyw-filter-lists">\n    '),__stack.lineno=2,data.forEach((function(e){buf.push('\n    <li data-type="',(__stack.lineno=3,e.alarmType?e.alarmType:e.columnName),'">        <span class="icon"></span>\n        ',(__stack.lineno=4,e.title),'        <span class="num"></span>\n        <i data-id="',escape((__stack.lineno=5,e.columnId)),'" class="fa fa-close"></i>\n    </li>\n    '),__stack.lineno=7})),buf.push("\n</ul>");return buf.join("")}catch(err){rethrow(err,__stack.input,__stack.filename,__stack.lineno)}}},215:function(e,t){e.exports='<div class="row">\r\n  <div class="col-md-12">\r\n    <div class="panel panel-default">\r\n      <div class="panel-heading">\r\n        <h3 class="panel-title fwb">绑定列表</h3>\r\n        <div class="pull-right" id="bingListClick">\r\n          <i class="fa fa-chevron-up"></i>\r\n        </div>\r\n      </div>\r\n      <div class="panel-body fixed-table-body" style="display: none;">\r\n        \x3c!--工具面板--\x3e\r\n        <div class="ToolPanel">\r\n          <div class="bars pull-left">\r\n            <div class="btn-group pull-left barsMargin" role="group">\r\n              <form role="form">\r\n                <label><input type="text" class="Inlinesearch form-control" id="simpleQueryParam"\r\n                    name="simpleQueryParam" style="width:300px" placeholder="请输入监控对象/围栏 关键字"></label>\r\n                <button id="search_button" type="button" class="btn btn-outline btn-default">搜索\r\n                </button>\r\n                <input id="hiddenText" type="text" style="display:none" />\r\n              </form>\r\n            </div>\r\n            <div th:if="${hasRole}" class="dropdown pull-left">\r\n              <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown"\r\n                aria-haspopup="true" aria-expanded="true">\r\n                操作菜单<span class="caret"></span>\r\n              </button>\r\n              <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">\r\n                <li><a href="javascript:void(0);" id="send_model"><i\r\n                      class="glyphicon glyphicon-circle-arrow-down icoPaddingLeft"></i>批量下发</a>\r\n                </li>\r\n                <li><a href="javascript:void(0);" id="del_model"><i\r\n                      class="glyphicon glyphicon-trash icoPaddingLeft"></i>批量解除</a>\r\n                </li>\r\n              </ul>\r\n            </div>\r\n          </div>\r\n          <div class="columns btn-group pull-right fenceBinding">\r\n            <button id="refreshTable" class="btn btn-default" type="button" name="refresh" title="刷新">\r\n              <i class="glyphicon glyphicon-refresh icon-refresh"></i>\r\n            </button>\r\n            <div class="keep-open btn-group" title="定制显示列">\r\n              <button id="customizeColumns" type="button" class="btn btn-default dropdown-toggle"\r\n                data-toggle="dropdown">\r\n                <i class="glyphicon glyphicon-th icon-th"></i> <span class="caret"></span>\r\n              </button>\r\n              <ul class="dropdown-menu" role="menu" id="Ul-menu-text-bind">\r\n              </ul>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <table id="dataTableBind" class="table table-striped table-bordered table-hover" cellspacing="0" width="100%">\r\n          <thead>\r\n            <tr>\r\n              <th style=" width:1px; padding:0"></th>\r\n              <th style="width:30px; padding:8px"><input type="checkbox" id="tableCheckAll">\r\n              </th>\r\n              <th>操作设置</th>\r\n              <th>围栏类型</th>\r\n              <th>围栏名称</th>\r\n              <th>围栏ID</th>\r\n              <th>监控对象</th>\r\n              <th>下发状态</th>\r\n              <th>下发类型</th>\r\n              <th>报警来源</th>\r\n              <th>开始日期</th>\r\n              <th>结束日期</th>\r\n              <th>开始时间</th>\r\n              <th>结束时间</th>\r\n              <th>驶入报警给平台</th>\r\n              <th>驶出报警给平台</th>\r\n              <th>驶入报警给驾驶员</th>\r\n              <th>驶出报警给驾驶员</th>\r\n              <th>最高速度(km/h)</th>\r\n              <th>夜间最高速度(km/h)</th>\r\n              <th>夜间限速时间段</th>\r\n              <th>超速持续时间(s)</th>\r\n              <th>行驶时间过长阈值(s)</th>\r\n              <th>行驶时间不足阈值(s)</th>\r\n              <th>允许开门</th>\r\n              <th>进区域开启通信模块</th>\r\n              <th>进区域不采集GNSS定位数据</th>\r\n            </tr>\r\n          </thead>\r\n        </table>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>'},216:function(e,t,a){},217:function(e,t){e.exports='<div class="videoDrawer">\r\n    <div class="realTimeVideoReal" id="realTimeVideoReal">\r\n        <div id="videoCont">\r\n            <div class="videoplayer-box">\r\n                <div id="videoplayer">\r\n                    <div class="pull-left video-box v-one">\r\n                        <video autoplay width="100%" height="100%" id="v_0_Source">\r\n                            <source src="" type="video/mp4">\r\n                            <source src="" type="video/ogg">\r\n                            您的浏览器不支持 video 标签。\r\n                        </video>\r\n                    </div>\r\n                    <div class="pull-left video-box v-two">\r\n                        <video autoplay width="100%" height="100%" id="v_1_Source">\r\n                            <source src="" type="video/mp4">\r\n                            <source src="" type="video/ogg">\r\n                            您的浏览器不支持 video 标签。\r\n                        </video>\r\n                    </div>\r\n                    <div class="pull-left video-box v-three">\r\n                        <video autoplay width="100%" height="100%" id="v_2_Source">\r\n                            <source src="" type="video/mp4">\r\n                            <source src="" type="video/ogg">\r\n                            您的浏览器不支持 video 标签。\r\n                        </video>\r\n                    </div>\r\n                    <div class="pull-left video-box v-four">\r\n                        <video autoplay width="100%" height="100%" id="v_3_Source">\r\n                            <source src="" type="video/mp4">\r\n                            <source src="" type="video/ogg">\r\n                            您的浏览器不支持 video 标签。\r\n                        </video>\r\n                    </div>\r\n                </div>\r\n                <input type="hidden" id="videoHost" th:value="${videoHost}" />\r\n                <input type="hidden" id="videoPort" th:value="${videoPort}" />\r\n                <div id="taskmsg" style="display:none"></div>\r\n                <div id="locmsg" style="display:none"></div>\r\n            </div>\r\n            <div class="form-group" style="height:50px;margin: 5px 0 -5px">\r\n                <div class="video-control-panel" id="videoSeparated">\r\n                    <i id="videoFour" class="video-four video-check" title=""></i>\r\n                    <i id="videoSix" class="video-six" title=""></i>\r\n                    <i id="videoNine" class="video-nine" title=""></i>\r\n                    <i id="videoTen" class="video-ten" title=""></i>\r\n                    <i id="videoSixteen" class="video-sixteen" title=""></i>\r\n                    <i id="videoFullScreen" class="video-full-screen" title=""></i>\r\n                    <div class="btn-box">\r\n                        <button type="button" class="editBtn btn-primary" id="toTextInfoSend">TTS读播\r\n                        </button>\r\n                    </div>\r\n                    <div id="videoToolCopy" style="display: none"></div>\r\n                </div>\r\n            </div>\r\n            <div id="videoTool">\r\n                <div class="talkback">\r\n                    <div class="icon-area" id="callSelect">\r\n                        <div class="icon" title="对讲">\r\n                            <i class="icon-off"></i><i class="icon-on"></i>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class="videoSwitch">\r\n                    <div class="icon-area" id="videoSelect">\r\n                        <div class="icon" title="视频">\r\n                            <i class="icon-off"></i><i class="icon-on"></i>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class="monitorSwitch" style="display:none;">\r\n                    <div class="icon-area" id="monitorSelect">\r\n                        <div class="icon" title="监听">\r\n                            <i class="icon-off"></i><i class="icon-on"></i>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            \x3c!--司机信息--\x3e\r\n            <div class="driverInfoBox">\r\n                \x3c!--驾驶员静态信息--\x3e\r\n                <div class="panel panel-default" id="driverInfoDiv">\r\n                    <div class="panel-heading" id="stretch2"\r\n                        style="position:relative;background-color: #51bbeb;color: #fff;">\r\n                        <h3 class="panel-title fwb">\r\n                            <i class="fa fa-file-text"></i>\r\n                            司机信息\r\n                        </h3>\r\n                        <div class="actions pull-right listActions">\r\n                            <i style="color:#fff;" class="fa chevron-down" id="stretch2-chevron"></i>\r\n                        </div>\r\n                    </div>\r\n                    <div class="panel-body fixed-table-body" id="stretch2-body">\r\n                        <div class="infoScrollBox" id="infoScrollBox">\r\n                            <div class="prevBtnBox">\r\n                                <i class="fa fa-caret-left"></i>\r\n                            </div>\r\n                            <div class="nextBtnBox">\r\n                                <i class="fa fa-caret-right"></i>\r\n                            </div>\r\n\r\n                            <div class="infoScrollCont" id="infoScrollCont">\r\n                                <div class="col-md-12 singleInfoCont">\r\n                                    <div class="col-md-2 driverPhoto">\r\n                                        <img id="driverPhoto" src="/clbs/resources/img/peoplems.png" />\r\n                                    </div>\r\n                                    <div class="col-md-10 infoCont">\r\n                                        <div class="col-md-6">司机姓名：未知</div>\r\n                                        <div class="col-md-6">岗位类型：未知</div>\r\n                                        <div class="col-md-12">所属企业：未知</div>\r\n                                        <div class="col-md-12">从业资格证号：未知</div>\r\n                                        <div class="col-md-12">从业资格类别：未知</div>\r\n                                        <div class="col-md-12">发证机关：未知</div>\r\n                                        <div class="col-md-12">有效期至：未知</div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                \x3c!--驾驶员插卡信息--\x3e\r\n                <div id="icDriverInfo" class="panel panel-default hide">\r\n                    <div class="panel-heading" id="stretch3"\r\n                        style="position:relative;background-color: #51bbeb;color: #fff;">\r\n                        <h3 class="panel-title fwb">\r\n                            插卡信息\r\n                        </h3>\r\n                        <div class="actions pull-right listActions">\r\n                            <i style="color:#fff;" class="fa chevron-down" id="stretch3-chevron"></i>\r\n                        </div>\r\n                    </div>\r\n                    <div class="panel-body fixed-table-body" id="stretch3-body">\r\n                        <div id="icMsg" class="icMsg">\r\n                            <div class="col-md-6">插卡时间：<span id="insertCardTime">\r\n                                    \x3c!--2019-01-07 12:08:12--\x3e</span></div>\r\n                            <div class="col-md-6">拔卡时间：<span id="removeCardTime">\r\n                                    \x3c!--2019-01-07 12:08:12--\x3e</span></div>\r\n                            <div class="col-md-6">单次行驶时长：<span id="todayLastTravelTime">\r\n                                    \x3c!--1小时23分34秒--\x3e</span></div>\r\n                            <div class="col-md-6">当天累计行驶时长：<span id="todayTravelTime">\r\n                                    \x3c!--1小时23分34秒--\x3e</span></div>\r\n                            <div class="col-md-6">单次行驶里程：<span id="todayLastTravelMileStr">\r\n                                    \x3c!--89.7km--\x3e</span>km</div>\r\n                            <div class="col-md-6">当天累计行驶里程：<span id="todayTravelMileStr">\r\n                                    \x3c!--489.7km--\x3e</span>km</div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'},218:function(e,t,a){},255:function(e,t,a){"use strict";a.r(t);var n=a(186),i=a.n(n),r=(a(187),a(7)),s=a(188),o=a.n(s),l=(a(189),a(14)),d=a(175),c=a(198),p=a.n(c),u=a(22),h=a(33),m=a(48),v=a(199),g=function(e,t,a,n){return new(a||(a=Promise))((function(i,r){function s(e){try{l(n.next(e))}catch(e){r(e)}}function o(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(s,o)}l((n=n.apply(e,t||[])).next())}))},f=function(e,t){var a,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function o(r){return function(o){return function(r){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],n=0}finally{a=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,o])}}},b=function(){function e(e,t){this.dependency=t,this.setOption(e)}return e.prototype.setOption=function(e){this.option=e,this.state={$origin:null,$dom:{$allVihecle:null,$onlineVihecle:null,$missVihecle:null,$allVsize:null,$onlineVsize:null,$missVsize:null,$searchCondition:null,$searchType:null,$showAliases:null,$monitorCountInput:null,$refresh:null},data:{monitorStatusMap:new Map,isInit:!0,vlimitSize:5e3,allVsize:0,onlineVsize:0,missVsize:0,runVarr:[],stopVarr:[],allVarr:[],ztreeType:0,ztreeObj:null,ztreeBeforeAsync:!0,aliasesClass:"aliasesStyle",treeOtherParam:null,vStatusStop:[],vStatusRun:[],vStatusWarn:[],vStatusNoPos:[],vStatusMiss:[],vStatusSpeed:[],vStatusHeart:[],zTreeIdJson:{},queryParam:"",queryType:"name",queryInputChange:null,origionData:null,stompClientSocket:null,stompClientOriginal:null,hostUrl:"",origionDeviceType:"",isSearch:!1,countClass:"countStyle",configTreeCountFlag:"0"}},this.state.$origin=$(e.selector),this.initHtml(),this.bindEvent()},e.prototype.initHtml=function(){var e=$(o.a);this.state.$origin.empty(),this.state.$origin.append(e),this.state.$dom.$allVihecle=e.find("#allVihecle"),this.state.$dom.$onlineVihecle=e.find("#onlineVihecle"),this.state.$dom.$missVihecle=e.find("#missVihecle"),this.state.$dom.$allVsize=e.find(".allSize"),this.state.$dom.$onlineVsize=e.find(".onlineSize"),this.state.$dom.$missVsize=e.find(".missSize"),this.state.$dom.$searchType=e.find("#searchType"),this.state.$dom.$searchCondition=e.find("#searchCondition"),this.state.$dom.$showAliases=e.find("#showAliases"),this.state.$dom.$monitorCountInput=e.find("#monitorCountInput"),this.state.$dom.$refresh=e.find("#refresh"),this.getMonitorNumber(),this.getHostUrl()},e.prototype.bindEvent=function(){var e=this.dependency.get("data"),t=this.state.$dom,a=t.$allVihecle,n=t.$onlineVihecle,i=t.$missVihecle,r=t.$searchCondition,s=t.$searchType,o=t.$showAliases,l=t.$monitorCountInput,d=t.$refresh;$("input").inputClear().on("onClearEvent",this.searchClear.bind(this)),a.on("click",{type:0},this.vTypeTab.bind(this)),n.on("click",{type:1},this.vTypeTab.bind(this)),i.on("click",{type:7},this.vTypeTab.bind(this)),s.on("change",this.searchVTypeChange.bind(this)),r.on("input propertychange",this.searchVConditionChange.bind(this)),o.on("change",this.showAliasesChange.bind(this)),l.on("change",this.showMonitorNum.bind(this)),d.on("click",this.refreshVtree.bind(this)),$("#rMenu").on("click",this.searchOriginalData.bind(this)),$("#originalDataList").on("click",".analysis",this.analysisOriginal.bind(this)),$("#originalDataModalClose").on("click",this.modalCloseFun.bind(this)),$("#clearOriginalData").on("click",this.clearDataFun.bind(this)),$("#copyOriginalData").on("click",this.copyDataFun.bind(this)),$("#controlGetData").on("click",this.origionSwitch.bind(this)),e.on("onTreeOnlineSizeChange",this.renderMonitorSize.bind(this)),$("ul.dropdown-menu").on("click","[data-stopPropagation]",(function(e){e.stopPropagation()})),e.on("onCurrentSelectVehicleChange",this.onCurrentSelectVehicleChange.bind(this)),e.on("onCurrentActiveVehicleChange",this.onCurrentActiveVehicleChange.bind(this))},e.prototype.getMonitorNumber=function(){return g(this,void 0,void 0,(function(){var e,t,a,n,i,s,o,d,c,p,u;return f(this,(function(h){switch(h.label){case 0:return(e=new FormData).set("isNeedMonitorId","true"),e.set("userName",l.get("userName")),[4,r.a.post("/clbs/m/functionconfig/fence/bindfence/getRunAndStopMonitorNum",e)];case 1:return 200==(t=h.sent()).status&&(a=t.data.obj,n=a.allV,i=a.onlineNum,s=a.runVidArray,o=a.stopVidArray,d=a.vehicleIdArray,c=a.showTreeCountFlag,p=a.configTreeCountFlag,this.state.data.allVsize=n,this.state.data.onlineVsize=i,this.state.data.missVsize=n-i,this.state.data.runVarr=s,this.state.data.stopVarr=o,this.state.data.allVarr=d,this.state.data.configTreeCountFlag=p,(u=this.dependency.get("data")).set("treeAllSize",n),u.set("treeOnlineSize",i),u.set("treeOfflineSize",this.state.data.missVsize),u.set("runVidArray",s),u.set("stopVidArray",o),u.set("vehicleIdArray",d),"1"==p?$("#showMonitorCountLi").show():$("#showMonitorCountLi").hide(),"1"==c&&(this.state.$dom.$monitorCountInput.prop("checked",!0),this.state.data.countClass="countStyle countShow"),u.set("alarmInfoList",new mapVehicle),this.renderMonitorSize(),this.state.data.isInit&&(this.initMonitorTree(),this.state.data.isInit=!1)),[2]}}))}))},e.prototype.renderMonitorSize=function(){var e=this.dependency.get("data"),t=e.get("treeAllSize"),a=e.get("treeOnlineSize"),n=e.get("treeOfflineSize");this.state.$dom.$allVsize.text(t),this.state.$dom.$onlineVsize.text(a),this.state.$dom.$missVsize.text(n)},e.prototype.initMonitorTree=function(){var e=this.state.data,t=e.vlimitSize,a=e.allVsize,n=e.aliasesClass,i=e.countClass;this.state.data.treeOtherParam=a>t?null:{webType:1};var r={async:{url:this.getTreeUrl.bind(this),type:"post",enable:!0,autoParam:["id"],dataType:"json",otherParam:this.state.data.treeOtherParam,dataFilter:this.ajaxDataFilter.bind(this)},check:{enable:!1},view:{dblClickExpand:!1,nameIsHTML:!0,fontCss:setFontCss_ztree,aliasesClass:n,countClass:i,addHoverDom:this.addHoverDom.bind(this),removeHoverDom:this.removeHoverDom.bind(this)},data:{simpleData:{enable:!0}},callback:{onAsyncSuccess:this.zTreeOnAsyncSuccess.bind(this),onAsyncError:this.zTreeOnAsyncError.bind(this),beforeAsync:this.zTreeBeforeAsync.bind(this),onExpand:this.zTreeOnExpand.bind(this),onNodeCreated:this.zTreeOnNodeCreated.bind(this),onRightClick:this.zTreeShowRightMenu.bind(this),onClick:this.zTreeOnClick.bind(this),onDblClick:this.onDbClickV.bind(this)}};this.state.data.ztreeObj=$.fn.zTree.init($("#lkywRealtimeTree"),r,null),this.isGetSocket()},e.prototype.zTreeOnAsyncError=function(e,t,a,n,i){"error"==i&&($("#treeLoad i").css("visibility","hidden"),$("#treeLoad span").text("加载失败"))},e.prototype.addHoverDom=function(e,t){var a="<span class='button trackreplay' id='trackreplay_"+t.tId+"'></span>",n=$("#"+t.tId+"_span");n.nextAll().hasClass("trackreplay")||"vehicle"!=t.type&&"people"!=t.type&&"thing"!=t.type||n.closest("a").append(a);var i={pid:t.pId,type:t.deviceType,vehicleId:t.id},r=this,s=$("#trackreplay_"+t.tId);s&&s.off().bind("click",(function(e){r.dependency.get("layout").go("track-playback",i)}))},e.prototype.removeHoverDom=function(e,t){$("#trackreplay_"+t.tId).unbind().remove()},e.prototype.getTreeUrl=function(e,t){var a=this.state.data,n=a.allVsize,i=a.vlimitSize;return t?"/clbs/m/functionconfig/fence/bindfence/monitorTree":n>i?"/clbs/m/functionconfig/fence/bindfence/bigDataMonitorTree":"/clbs/m/functionconfig/fence/bindfence/monitorTree"},e.prototype.onlinesTree=function(e){var t=this.state.data,a=t.vlimitSize,n=t.aliasesClass,i=t.ztreeType,r=(t.onlineVsize,t.missVsize),s=t.countClass;this.state.data.treeOtherParam=1==i||7==i&&r<=a?{type:i,webType:1}:null;var o={async:{url:this.getStatusTreeUrl.bind(this),type:"post",enable:!0,autoParam:["id"],dataType:"json",otherParam:this.state.data.treeOtherParam,dataFilter:this.ajaxDataFilter.bind(this)},view:{dblClickExpand:!1,nameIsHTML:!0,fontCss:setFontCss_ztree,aliasesClass:n,countClass:s,addHoverDom:this.addHoverDom.bind(this),removeHoverDom:this.removeHoverDom.bind(this)},check:{enable:!1},data:{simpleData:{enable:!0},key:{title:"name"}},callback:{onAsyncSuccess:this.zTreeOnAsyncSuccess.bind(this),onAsyncError:this.zTreeOnAsyncError.bind(this),beforeAsync:this.zTreeBeforeAsync.bind(this),onExpand:this.zTreeOnExpand.bind(this),onNodeCreated:this.zTreeOnNodeCreated.bind(this),onRightClick:this.zTreeShowRightMenu.bind(this),onClick:this.zTreeOnClick.bind(this),onDblClick:this.onDbClickV.bind(this)}};this.state.data.ztreeObj=$.fn.zTree.init($("#lkywRealtimeTree"),o,null)},e.prototype.getStatusTreeUrl=function(){var e=this.state.data,t=e.vlimitSize,a=e.ztreeType,n=(e.onlineVsize,e.missVsize);return 1==a||7==a&&n<=t?"/clbs/m/basicinfo/monitoring/vehicle/treeStateInfo":"/clbs/m/functionconfig/fence/bindfence/bigDataMonitorTree"},e.prototype.vTypeTab=function(e){this.resetLoad();var t=e.data.type,a=e.currentTarget.id;$("#"+a);$("#treeLoad").show(),this.resetZtreeData(),this.state.data.ztreeType=t,0==t?this.initMonitorTree():(1==t||7==t)&&this.onlinesTree(t)},e.prototype.resetZtreeData=function(){this.state.data.ztreeBeforeAsync=!0,this.state.data.zTreeIdJson={},this.state.data.vStatusStop=[],this.state.data.vStatusRun=[],this.state.data.vStatusWarn=[],this.state.data.vStatusNoPos=[],this.state.data.vStatusMiss=[],this.state.data.vStatusSpeed=[],this.state.data.vStatusHeart=[],this.state.$dom.$searchCondition.val(""),this.state.$dom.$searchType.val("name"),this.state.data.queryParam="",this.state.data.queryType="name",$("#rMenu").hide()},e.prototype.searchClear=function(e){var t=$(e.currentTarget).attr("id");this.state.data.isSearch=!1,this.state.data.ztreeBeforeAsync=!0,this.state.data.queryParam="","searchCondition"==t&&(this.resetLoad(),this.state.data.ztreeType=0,this.initMonitorTree())},e.prototype.searchVTypeChange=function(e){var t=this,a=this.state.data,n=a.queryParam,i=a.queryInputChange;this.state.data.queryType=e.target.value,""!=n&&(i||clearTimeout(i),this.state.data.queryInputChange=setTimeout((function(){t.resetLoad(),t.state.data.ztreeBeforeAsync=!0,t.searchMonitorTree()}),500))},e.prototype.searchVConditionChange=function(e){var t=this;this.state.data.queryParam=e.target.value;var a=this.state.data,n=a.queryParam,i=a.queryInputChange;i||clearTimeout(i),this.state.data.queryInputChange=setTimeout((function(){$("#treeLoad i").css("visibility","visible"),$("#treeLoad span").html("正在查询, 请稍后"),$("#treeLoad").show(),t.state.data.ztreeBeforeAsync=!0,t.state.data.zTreeIdJson={},n&&""!=n?(t.state.data.isSearch=!0,t.searchMonitorTree()):(t.state.data.isSearch=!1,t.state.data.ztreeType=0,t.initMonitorTree())}),500)},e.prototype.searchMonitorTree=function(){var e=this.state.data,t=e.aliasesClass,a=e.queryParam,n=e.queryType,i=e.countClass,r={async:{url:"/clbs/m/functionconfig/fence/bindfence/monitorTreeFuzzy",type:"post",enable:!0,autoParam:["id"],dataType:"json",otherParam:{queryParam:a,queryType:n,webType:1},dataFilter:this.ajaxQueryDataFilter.bind(this)},view:{dblClickExpand:!1,nameIsHTML:!0,fontCss:setFontCss_ztree,aliasesClass:t,countClass:i,addHoverDom:this.addHoverDom.bind(this),removeHoverDom:this.removeHoverDom.bind(this)},check:{enable:!1},data:{simpleData:{enable:!0},key:{title:"name"}},callback:{onAsyncSuccess:this.zTreeOnAsyncSuccess.bind(this),onAsyncError:this.zTreeOnAsyncError.bind(this),beforeAsync:this.zTreeBeforeAsync.bind(this),onExpand:this.zTreeOnExpand.bind(this),onClick:this.zTreeOnClick.bind(this),onDblClick:this.onDbClickV.bind(this),onNodeCreated:this.zTreeOnNodeCreated.bind(this),onRightClick:this.zTreeShowRightMenu.bind(this)}};$.fn.zTree.init($("#lkywRealtimeTree"),r,null)},e.prototype.ajaxQueryDataFilter=function(e,t,a){a=JSON.parse(Object(d.a)(a));for(var n=this.state.data.ztreeType,i=0;i<a.length;i+=1){var r=a[i];"assignmentSkin"===r.iconSkin&&(0===n?r.count=r.onLine+"/"+r.canCheck:1===n?r.count=r.onLine:7===n&&(r.count=r.offLine))}return filterQueryResult(a,null)},e.prototype.ajaxDataFilter=function(e,t,a){var n=a;try{Object(d.a)(a)&&(n=JSON.parse(Object(d.a)(a)))}catch(e){}for(var i=this.state.data.ztreeType,r=n.length-1;r>=0;r-=1){var s=n[r];"assignmentSkin"===s.iconSkin&&(0===i?s.count=s.onLine+"/"+s.canCheck:(1===i?s.count=s.onLine:7===i&&(s.count=s.offLine),0===s.count&&n.splice(r,1)))}return 1===i&&this.state.data.isSearch&&(n=filterQueryResult(n,null)),n},e.prototype.zTreeOnAsyncSuccess=function(e,t,a){var n=this.state.data,i=n.vlimitSize,r=n.ztreeType,s=n.allVsize,o=(n.onlineVsize,n.missVsize),l=n.isSearch,d=$.fn.zTree.getZTreeObj(t);0==d.getNodes().length?($("#treeLoad i").css("visibility","hidden"),this.state.data.isSearch?$("#treeLoad span").text("未找到查询对象"):$("#treeLoad span").text("您没有数据")):$("#treeLoad").hide();var c=d.getNodesByFilter(assignmentNotExpandFilter);if(0==r&&s<=i||1==r||7==r&&o<=i||l){for(var p=0;p<c.length;p+=1){var u=c[p];d.expandNode(u,!0,!0,!1,!0)}this.state.data.ztreeBeforeAsync=1!==r}else this.state.data.ztreeBeforeAsync=!1;this.state.data.isSearch=!1},e.prototype.zTreeBeforeAsync=function(){return this.state.data.ztreeBeforeAsync},e.prototype.zTreeOnNodeCreated=function(e,t,a){var n=this.state.data.zTreeIdJson,i=a.id.toString(),r=[];if(n[i]?this.state.data.zTreeIdJson[i].push(a.tId):(r=[a.tId],this.state.data.zTreeIdJson[i]=r),$("#showName").is(":checked")){var s=$("#lkywRealtimeTree .aliasesStyle");s.length>0&&s.is(":hidden")&&s.show()}},e.prototype.zTreeOnExpand=function(e,t,a){return g(this,void 0,void 0,(function(){var e;return f(this,(function(t){switch(t.label){case 0:return null==a.pId?[3,5]:void 0!==a.children||"assignment"!=a.type?[3,2]:[4,this.getAssignmentChild(a)];case 1:return t.sent(),[3,4];case 2:return"group"!=a.type?[3,4]:[4,this.getGroupChild(a)];case 3:t.sent(),t.label=4;case 4:e=this.getSubscribeVid(a),this.subscribeVstatus(e),t.label=5;case 5:return[2]}}))}))},e.prototype.zTreeShowRightMenu=function(e,t,a){if(null!=a){this.state.data.origionDeviceType=a.deviceType;var n=this.state.data.origionDeviceType;if(null!=n&&"vehicle"==a.type){var i="8"!=n?a.deviceNumber:this.IntegerMobileIPAddress(a.simcardNumber);this.state.data.origionData={id:a.id,name:a.name,deviceNumber:i,simcardNumber:a.simcardNumber};var r=$("#rMenu");r.css({visibility:"visible",top:e.clientY-50+"px",left:e.clientX+"px"}),r.show()}}},e.prototype.zTreeOnClick=function(e,t,a){var n=this.dependency.get("data"),i=this.dependency.get("realtimeMonitorTable");if(a){var r=n.get("currentSelectVehicle"),s=n.get("currentActiveVehicle");if(s&&$("#"+s.tId).parent().removeAttr("class"),r&&($("#"+r.tId).parent().removeClass("curSelectedNode_dbClick"),n.set("currentSelectVehicle",null),r.id==a.id&&$(".videoDrawer-container").hasClass("active")&&$("#btn-videoRealTime-show").click()),s&&s.id==a.id)return n.set("currentActiveVehicle",null),void i.setActiveRow(void 0);n.set("currentActiveVehicle",{id:a.id,skin:a.iconSkin,tid:e.target.id}),i.setLockedRow(void 0),i.setActiveRow(a.id)}},e.prototype.onDbClickV=function(e,t,a){var n=this.dependency.get("data"),i=this.dependency.get("realtimeMonitorTable");if(a){var r=e.target.id,s=a.id;if("assignmentSkin"!=a.iconSkin&&"groupSkin"!=a.iconSkin&&$("#"+r).parent().addClass("curSelectedNode_dbClick"),$("#callSelect").hasClass("active")&&realtimeMonitoringVideoSeparate.callOrder(),n.set("currentSelectVehicle",{id:s,skin:a.iconSkin,tId:r}),i.setActiveRow(void 0),i.setLockedRow(a.id),"group"!==a.type&&"assignment"!==a.type){var o=a.name;this.dependency.get("data").set("videoMonitor",{vehicleId:s,name:o}),$(".videoDrawer-container").hasClass("active")&&(realtimeMonitoringVideoSeparate.startPlayVideo({vid:s,brand:o}),activeSafety.riskInformationDetails(s))}}},e.prototype.checkVehicleOnlineStatus=function(e){var t=!0;return json_ajax("POST","/clbs/v/oilmassmgt/oilcalibration/checkVehicleOnlineStatus","json",!1,{vehicleId:e},(function(e){e.success||(t=!1)})),t},e.prototype.getNodeById=function(e){return $.fn.zTree.getZTreeObj("lkywRealtimeTree").getNodeByParam("id",e,null)},e.prototype.IntegerMobileIPAddress=function(e){var t,a=[],n=[];if(13==e.length&&e.startsWith("106")&&(e="1"+e.substring(3)),11==e.length)a[0]=parseInt(e.substring(3,5)),a[1]=parseInt(e.substring(5,7)),a[2]=parseInt(e.substring(7,9)),a[3]=parseInt(e.substring(9,11)),t=parseInt(e.substring(1,3)),t-=t>45?46:30;else if(10==e.length)a[0]=parseInt(e.substring(2,4)),a[1]=parseInt(e.substring(4,6)),a[2]=parseInt(e.substring(6,8)),a[3]=parseInt(e.substring(8,10)),t=parseInt(e.substring(0,2)),t-=t>45?46:30;else if(9==e.length)a[0]=parseInt(e.substring(1,3)),a[1]=parseInt(e.substring(3,5)),a[2]=parseInt(e.substring(5,7)),a[3]=parseInt(e.substring(7,9)),t=parseInt(e.substring(0,1));else{if(!(e.length<9))return"";switch(e.length){case 8:e="140"+e;break;case 7:e="1400"+e;break;case 6:e="14000"+e;break;case 5:e="140000"+e;break;case 4:e="1400000"+e;break;case 3:e="14000000"+e;break;case 2:e="140000000"+e;break;case 1:e="1400000000"+e}a[0]=parseInt(e.substring(3,5)),a[1]=parseInt(e.substring(5,7)),a[2]=parseInt(e.substring(7,9)),a[3]=parseInt(e.substring(9,11)),t=parseInt(e.substring(1,3)),t-=t>45?46:30}return n[0]=0!=(8&t)?128|a[0]:a[0],n[1]=0!=(4&t)?128|a[1]:a[1],n[2]=0!=(2&t)?128|a[2]:a[2],n[3]=0!=(1&t)?128|a[3]:a[3],n[0]+""+n[1]+n[2]+n[3]},e.prototype.getHostUrl=function(){return g(this,void 0,void 0,(function(){var e;return f(this,(function(t){switch(t.label){case 0:return[4,r.a.post("/clbs/v/monitoring/getHost",null)];case 1:return 200==(e=t.sent()).status&&(this.state.data.hostUrl=e.data.obj.host),[2]}}))}))},e.prototype.searchOriginalData=function(){$("#rMenu").hide();var e=this.state.data.origionData;$("#searchForName").text(e.name),$("#searchDviceNumber").text(e.deviceNumber),$("#searchSimNumber").text(e.simcardNumber),$("#controlGetData").text("暂停"),$("#originalDataList").html(""),$("#originalDataModal").addClass("show"),this.sendOrigionSocket()},e.prototype.sendOrigionSocket=function(){var e,t=this,a=this.state.data,n=a.origionData,i=a.stompClientSocket,r=a.hostUrl,s={socketId:n.deviceNumber,deviceNumber:n.deviceNumber,plateNumber:n.name,mobile:n.simcardNumber};null!=i&&i.close(),e="http:"===document.location.protocol?"http://"+r+"/webSocket":"/proxy/webSocket",this.state.data.stompClientSocket=new h(e),this.state.data.stompClientOriginal=m.over(this.state.data.stompClientSocket);var o=this.state.data.stompClientOriginal;o.connect({},(function(e){o.subscribe("/user/"+n.deviceNumber+"/t808Msg",t.originalFunCallBack.bind(t)),o.send("/app/webSocket/updateDevice",{},JSON.stringify(s))}))},e.prototype.closeOrigionSocket=function(){var e=this.state.data.stompClientSocket;null!=e&&e.close(),this.state.data.stompClientSocket=null,this.state.data.stompClientOriginal=null},e.prototype.originalFunCallBack=function(e){var t=e.body.split("code:"),a={tit:t[0]+"code:",con:t[1].trim()},n=p()(a);$("#originalDataList").append(n)},e.prototype.analysisOriginal=function(e){var t=$(e.currentTarget).data("con").replace(/\(.*?\)/g,""),a=this.state.data;!function(e,t){var a=$('<form target="_blank" method="POST" action="'+e+'">');$.each(t,(function(e,t){a.append($('<input type="hidden" name="'+e+'" value="'+t+'">'))})),$("body").append(a),a.submit(),a.remove()}("http://"+a.hostUrl+"/f3/analysisclbs.do",{deviceType:a.origionDeviceType,value:t})},e.prototype.copyDataFun=function(){new v("#copyOriginalData",{text:function(){return $("#originalDataList").text()}}).on("success",(function(e){layer.msg("复制成功")}))},e.prototype.clearDataFun=function(){$("#originalDataList").html("")},e.prototype.origionSwitch=function(){var e=$("#controlGetData"),t="暂停"==e.text(),a=t?"打开":"暂停";t?this.closeOrigionSocket():this.sendOrigionSocket(),e.text(a)},e.prototype.modalCloseFun=function(){this.closeOrigionSocket(),$("#originalDataModal").removeClass("show")},e.prototype.refreshVtree=function(){this.resetLoad(0),this.resetZtreeData(),this.initMonitorTree(),$(".lkyw-thetree").scrollTop()},e.prototype.showAliasesChange=function(e){var t=e.target.checked,a=$("#lkywRealtimeTree .aliasesStyle");t?a.show():a.hide()},e.prototype.showMonitorNum=function(e){var t=e.target.checked,a={aliasesFlag:0,showTreeCountFlag:0},n=$("#lkywRealtimeTree .countStyle");t?(n.addClass("countShow").show(),this.state.data.countClass="countStyle countShow",a.showTreeCountFlag=1):(n.removeClass("countShow").hide(),this.state.data.countClass="countStyle");json_ajax("POST","/clbs/v/monitoring/setTreeShow","json",!1,a,(function(e){}))},e.prototype.getAssignmentChild=function(e){return g(this,void 0,void 0,(function(){var t,a,n,i;return f(this,(function(s){switch(s.label){case 0:return(t=new FormData).set("assignmentId",e.id),t.set("isChecked",e.checked.toString()),t.set("monitorType","monitor"),t.set("webType","1"),[4,r.a.post("/clbs/m/functionconfig/fence/bindfence/putMonitorByAssign",t)];case 1:return 200==(a=s.sent()).status&&(n=$.fn.zTree.getZTreeObj("lkywRealtimeTree"),i=JSON.parse(Object(d.a)(a.data.msg)),n.addNodes(e,i),this.getMonitorNumber()),[2]}}))}))},e.prototype.getGroupChild=function(e){return g(this,void 0,void 0,(function(){var t,a,n,i;return f(this,(function(s){switch(s.label){case 0:return(t=new FormData).set("groupId",e.id),t.set("isChecked",e.checked.toString()),t.set("monitorType","vehicle"),[4,r.a.post("/clbs/m/functionconfig/fence/bindfence/putMonitorByGroup",t)];case 1:return 200==(a=s.sent()).status&&(n=$.fn.zTree.getZTreeObj("lkywRealtimeTree"),null!=(i=a.data.obj)&&null!=i&&$.each(i,(function(e){var t=e,a=i[e],r=this.state.data.zTreeIdJson[t][0],s=n.getNodeByTId(r);void 0===s.children&&n.addNodes(s,a)}))),[2]}}))}))},e.prototype.isGetSocket=function(){var e=this,t=this.dependency.get("data"),a=Object(u.a)({access_token:t.get("access_token")});if(a.conFlag){var n={access_token:t.get("access_token")};a.subscribe(n,"/user/topic/cachestatus",this.updataRealTree.bind(this),null,null),a.subscribe(n,"/user/topic/alarm",this.updataRealAlarmMessage.bind(this),"/app/vehicle/subscribeStatus",null)}else setTimeout((function(){e.isGetSocket()}),200)},e.prototype.updataRealAlarmMessage=function(e){var t=e.body,a=JSON.parse(t),n=a.data.msgBody,i=a.data.msgBody.monitorInfo.monitorId,r=n.alarmName,s=this.dependency.get("data"),o=s.get("alarmInfoList");o.isEmpty()?o.put(i,r):o.containsKey(i)?(o.remove(i),o.put(i,r)):o.put(i,r),s.set("alarmInfoList",o),window.Table&&window.Table.table.subscribeAlarmFn(e)},e.prototype.updataRealTree=function(e){var t=$.parseJSON(e.body),a=t.desc.msgID,n=t.data;this.updateVehicleArray(n),this.initVstatus(n);var i=$.fn.zTree.getZTreeObj("lkywRealtimeTree");if(34952==a){var r=n[0].vehicleId,s=this.state.data.monitorStatusMap.get(r);if(n[0].vehicleStatus!==s){this.state.data.monitorStatusMap.set(r,n[0].vehicleStatus);var o=n[0].assignmentIds;if("1"==this.state.data.configTreeCountFlag){for(var l=0;l<o.length;l+=1){var d=i.getNodesByParam("id",o[l],null),c=i.getNodesByParam("id",r,d[l]);if(d&&d.length>0&&0===c.length){var p=void 0;switch(n[0].vehicleStatus){case 4:p="btnImage iconArea onlineParking";break;case 10:p="button btnImage iconArea onlineDriving";break;case 5:p="button btnImage iconArea warning";break;case 2:p="button btnImage iconArea onlineNotPositioning";break;case 9:p="btnImage iconArea speedLimitWarning";break;case 11:p="btnImage iconArea heartBeatWarning";break;case 3:p="vehicleSkin"}i.addNodes(d[0],-1,[{name:n[0].brand,id:r,pId:o[l],iconSkin:p,type:"vehicle",monitorType:n[0].monitorType,status:n[0].vehicleStatus}]),i.updateNode(d[0]),this.initVstatus([n[0]])}}this.updateAssignmentMonitorNum(o,"add")}}}else if(30583==a){s=this.state.data.monitorStatusMap.get(n[0].vehicleId);if(3==n[0].vehicleStatus&&3!==s){o=n[0].assignmentIds;"1"==this.state.data.configTreeCountFlag&&(this.updateAssignmentMonitorNum(o,"reduce"),this.state.data.monitorStatusMap.set(n[0].vehicleId,3))}}void 0!==window.Tree&&window.Tree.tree.subscribeStatusCallback(e)},e.prototype.updateAssignmentMonitorNum=function(e,t){var a=1;"reduce"===t&&(a=-1);for(var n=this.state.data.ztreeType,i=0;i<e.length;i++)for(var r=$.fn.zTree.getZTreeObj("lkywRealtimeTree").getNodesByParam("id",e[i],null),s=0;s<r.length;s++){var o=r[s].tId+"_count",l=$("#"+o);if(0===n){var d=l.text().replace(/[()]/g,""),c=parseInt(d.split("/")[0]),p=(c+a>=0?c+a:0)+"/"+d.split("/")[1];l.text("("+p+")")}else if(1===n){p=(u=parseInt(l.text().replace(/[()]/g,"")))+a>=0?u+a:0;l.text("("+p+")")}else if(7===n){var u;p=(u=parseInt(l.text().replace(/[()]/g,"")))-a>=0?u-a:0;l.text("("+p+")")}}},e.prototype.getSubscribeVid=function(e){for(var t=[],a=0;a<e.children.length;a++){var n={vehicleID:e.children[a].id};t.push(n)}return t},e.prototype.subscribeVstatus=function(e){if(e&&0!=e.length){var t={access_token:this.dependency.get("data").get("access_token")},a={desc:{MsgId:40964,UserName:l.get("userName")},data:e};Object(u.a)(t).subscribe(t,"/user/topic/cachestatus",this.updataRealTree.bind(this),"/app/vehicle/subscribeCacheStatusNew",a)}},e.prototype.initVstatus=function(e){for(var t=this.dependency.get("realtimeAMap"),a="",n="",i=function(i){var s=e[i],o=s.vehicleStatus,l=s.vehicleId,d=r.state.data,c=d.ztreeType,p=d.zTreeIdJson,u=d.vStatusStop,h=d.vStatusRun,m=d.vStatusWarn,v=d.vStatusNoPos,g=d.vStatusSpeed,f=d.vStatusHeart,b=d.vStatusMiss;switch(a="",n="",o){case 4:a="#c80002",n="btnImage iconArea onlineParking",-1==u.indexOf(l)&&r.state.data.vStatusStop.push(l),r.state.data.vStatusRun.remove(l),r.state.data.vStatusWarn.remove(l),r.state.data.vStatusNoPos.remove(l),r.state.data.vStatusSpeed.remove(l),r.state.data.vStatusHeart.remove(l),r.state.data.vStatusMiss.remove(l);break;case 10:a="#78af3a",n="button btnImage iconArea onlineDriving",-1==h.indexOf(l)&&r.state.data.vStatusRun.push(l),r.state.data.vStatusStop.remove(l),r.state.data.vStatusWarn.remove(l),r.state.data.vStatusNoPos.remove(l),r.state.data.vStatusSpeed.remove(l),r.state.data.vStatusHeart.remove(l),r.state.data.vStatusMiss.remove(l);break;case 5:a="#ffab2d",n="button btnImage iconArea warning",-1==m.indexOf(l)&&r.state.data.vStatusWarn.push(l),r.state.data.vStatusRun.remove(l),r.state.data.vStatusStop.remove(l),r.state.data.vStatusNoPos.remove(l),r.state.data.vStatusSpeed.remove(l),r.state.data.vStatusHeart.remove(l),r.state.data.vStatusMiss.remove(l);break;case 2:a="#754801",n="button btnImage iconArea onlineNotPositioning",-1==v.indexOf(l)&&r.state.data.vStatusNoPos.push(l),r.state.data.vStatusRun.remove(l),r.state.data.vStatusWarn.remove(l),r.state.data.vStatusStop.remove(l),r.state.data.vStatusSpeed.remove(l),r.state.data.vStatusHeart.remove(l),r.state.data.vStatusMiss.remove(l);break;case 9:a="#960ba3",n="btnImage iconArea speedLimitWarning",-1==g.indexOf(l)&&r.state.data.vStatusSpeed.push(l),r.state.data.vStatusRun.remove(l),r.state.data.vStatusWarn.remove(l),r.state.data.vStatusStop.remove(l),r.state.data.vStatusNoPos.remove(l),r.state.data.vStatusHeart.remove(l),r.state.data.vStatusMiss.remove(l);break;case 11:a="#fb8c96",n="btnImage iconArea heartBeatWarning",-1==f.indexOf(l)&&r.state.data.vStatusHeart.push(l),r.state.data.vStatusRun.remove(l),r.state.data.vStatusWarn.remove(l),r.state.data.vStatusStop.remove(l),r.state.data.vStatusNoPos.remove(l),r.state.data.vStatusSpeed.remove(l),r.state.data.vStatusMiss.remove(l);break;case 3:n="vehicleSkin",-1==b.indexOf(l)&&r.state.data.vStatusMiss.push(l),r.state.data.vStatusRun.remove(l),r.state.data.vStatusWarn.remove(l),r.state.data.vStatusStop.remove(l),r.state.data.vStatusNoPos.remove(l),r.state.data.vStatusHeart.remove(l),r.state.data.vStatusSpeed.remove(l)}t.updateNameMarker(l,n);var y=$.fn.zTree.getZTreeObj("lkywRealtimeTree"),k=p[l];if(!k)return{value:void 0};$.each(k,(function(e,t){var i=y.getNodeByTId(t);i&&i.type&&"group"!==i.type&&"assignment"!==i.type&&(i.iconSkin=n,y.updateNodeIconSkin(i),$("#"+t+"_span").css("color",a),$("#"+t+"_aliases")&&$("#"+t+"_aliases").css("color",a),7==c&&3!=o&&y.hideNode(i))}))},r=this,s=0;s<e.length;s++){var o=i(s);if("object"==typeof o)return o.value}},e.prototype.updateVehicleArray=function(e){for(var t=this.dependency.get("data"),a=t.get("runVidArray"),n=t.get("stopVidArray"),i=t.get("vehicleIdArray"),r=0;r<e.length;r+=1){var s=e[r],o=this.statusNumber2Text(s.vehicleStatus),l=s.vehicleId,d=a.indexOf(l),c=n.indexOf(l);"offline"===o?(d>-1&&a.splice(d,1),c>-1&&n.splice(c,1)):-1===d&&-1===c&&(-1===d?a.push(l):-1===c&&n.push(l))}var p=a.length+n.length,u=i.length-p;t.set("treeOnlineSize",p),t.set("treeOfflineSize",u),t.set("runVidArray",a),t.set("stopVidArray",n),this.state.data.allVsize=i.length,this.state.data.onlineVsize=p,this.state.data.missVsize=u,this.state.$dom.$allVsize.text(i.length),this.state.$dom.$onlineVsize.text(p),this.state.$dom.$missVsize.text(u)},e.prototype.statusNumber2Text=function(e){switch(e){case 11:return"heartBeat";case 2:return"notPosition";case 5:return"alarm";case 10:return"run";case 4:return"stop";case 9:return"overSpeed";case 3:return"offline"}},e.prototype.onCurrentSelectVehicleChange=function(){var e=this.dependency.get("data").get("currentSelectVehicle");if(e){$(".ztree li a").removeClass("curSelectedNode_dbClick"),$(".ztree li a").removeClass("curSelectedNode");var t=e.id,a=this.state.data.zTreeIdJson[t],n="";if(a)for(var i=0;i<a.length;i++){var r=a[i];$("#"+r).children("a").addClass("curSelectedNode_dbClick"),n=$("#"+r+" .node_name").text()}a?(this.dependency.get("data").set("videoMonitor",{vehicleId:t,name:n}),$(".videoDrawer-container").hasClass("active")&&(realtimeMonitoringVideoSeparate.startPlayVideo({vid:t,brand:n}),activeSafety.riskInformationDetails(t))):(this.dependency.get("data").set("videoMonitor",{vehicleId:t,name:n}),$(".videoDrawer-container").removeClass("active"),$("#btn-videoRealTime-show").css({right:"10px","z-index":99}),$("#videoSelect").removeClass("active"),realtimeMonitoringVideoSeparate.closeTerminalVideo())}},e.prototype.onCurrentActiveVehicleChange=function(){var e=this.dependency.get("data").get("currentActiveVehicle");if($(".ztree li a").removeClass("curSelectedNode_dbClick"),$(".ztree li a").removeClass("curSelectedNode"),e){var t=e.id,a=this.state.data.zTreeIdJson[t];if(a)for(var n=0;n<a.length;n++){var i=a[n];$("#"+i).children("a").addClass("curSelectedNode")}}},e.prototype.resetLoad=function(e){$("#treeLoad i").css("visibility","visible"),0==e?$("#treeLoad span").text("加载中，请稍后"):$("#treeLoad span").text("正在查询，请稍后"),$("#treeLoad").show()},e.prototype.destory=function(){this.state.$origin.empty()},e}(),y=a(200),k=a.n(y),T=(a(201),a(202)),w=a(21),S=a.n(w),x=a(203),M=a.n(x),C=(a(55),function(){function e(e,t){this.dependency=t,this.setOption(e)}return e.prototype.setOption=function(e){},e.prototype.initHtml=function(){},e.prototype.bindEvent=function(){},e.prototype.destory=function(){},e.prototype.setMarkerInfo=function(e,t){var a=e,n=512,i=a.monitorInfo;this.currentMonitorInfo=i;i.monitorId,a.monitorInfo.monitorName;var r=a.gpsTime,s=(r.substring(0,2),r.substring(2,4),r.substring(4,6),r.substring(6,8),r.substring(8,10),r.substring(10,12),a.uploadtime),o=(s.substring(0,2),s.substring(2,4),s.substring(4,6),s.substring(6,8),s.substring(8,10),s.substring(10,12),a.monitorInfo.assignmentName,i.groupName,a.monitorInfo.vehicleType,a.monitorInfo.plateColorName);"null"!=o&&null!=o||(o="-");a.monitorInfo.deviceNumber,a.monitorInfo.simcardNumber,a.monitorInfo.professionalsName;var l=a.acc;if(1==(l+"").length)l=0==l?"关":"开";else if("21"==l)l="点火静止";else if("16"==l)l="熄火拖车";else if("1A"==l)l="熄火假拖车";else if("11"==l)l="熄火静止";else if("12"==l)l="熄火移动";else if("22"==l)l="点火移动";else if("41"==l)l="无点火静止";else{if("42"!=l)return void layer.msg("ACC状态异常");l="无点火移动"}a.gpsSpeed;var d=a.signalState,c="";null!=d&&0!=d?""!=(c=this.signalStateFlagAnalysis(d))&&(c=c.substring(0,c.length-1)):c="-";a.gpsSpeed;var p=a.direction;a.batteryVoltage,a.signalStrength;if(0==(b=a.locationPattern))b="卫星+基站定位";else if(1==b)b="基站定位";else if(2==b){if(b="卫星定位","-",a.gpsAttachInfoList)for(var u=0;u<a.gpsAttachInfoList.length;u++){var h=a.gpsAttachInfoList[u];if(void 0!==h.signalIntensity){h.signalIntensity;break}}}else b=3==b?"WIFI+基站定位":4==b?"卫星+WIFI+基站定位":"-";var m,v=a.dayMileage;v=parseFloat(v),m=null!=a.mileageSensor&&null!=a.mileageSensor?null==a.mileageSensor.mileage?0:a.mileageSensor.mileage:null==a.gpsMileage?0:a.gpsMileage;var g,f=a.dayOilWear;f=(f=parseFloat(f)).toFixed(2),g=void 0!==a.oilExpend&&null!=a.oilExpend&&a.oilExpend.length>0?null==a.oilExpend[0].allExpend?0:a.oilExpend[0].allExpend:null==a.gpsOil?0:a.gpsOil,g=(g=parseFloat(g)).toFixed(2);a.gpsOil,a.altitude,a.grapherSpeed,a.positionDescription,a.monitorInfo.monitorId,a.roadLimitSpeed;if(null==(C=a.roadType)||""==C?"":this.roadTypeJudge(C),void 0!==a.durationTime&&null!==a.durationTime)Number(a.gpsSpeed)<=1?this.formatDuring(a.durationTime):this.formatDuring(a.durationTime);else Number(a.gpsSpeed);if("5"==a.protocolType){i=a.monitorInfo,p=a.direction,this.toDirectionStr(p);(y=[]).push(parseDate2Str(a.gpsTime)),y.push(i.monitorName),y.push("null"==i.assignmentName||null==i.assignmentName?"-":i.assignmentName),y.push(i.deviceNumber),y.push(i.simcardNumber),y.push(a.batteryVoltage),y.push(a.signalStrength),y.push(a.gpsSpeed),y.push(a.altitude),y.push(a.latitude),y.push(a.longitude),y.push("people"),y.push(i.monitorId);a.latitude,a.longitude;var b=a.locationType;b="北斗";new AMap.Geocoder({radius:1e3,extensions:"all",batch:!1}),a.formattedAddress;return y.push(p),y.push(a.stateInfo),y.push(null==i.monitorType||"null"==i.monitorType||null==i.monitorType?"0":i.monitorType),y.push(i.monitorIcon),y.push(a.dayMileage),null==(C=a.roadType)||""==C?y.push(""):y.push(this.roadTypeJudge(C)),y.push(a.roadLimitSpeed),this.renderMarkerContent(y,null,null)}var y=[],k=(i=a.monitorInfo).monitorId,$=(+a.status).toString(2),T=[];0==($=(Array(32).join("0")+$).slice(-32)).substring(29,30)?T.push("北纬："+a.latitude):1==$.substring(30,31)&&T.push("南纬："+a.latitude),0==$.substring(28,29)?T.push("东经："+a.longitude):1==$.substring(28,29)&&T.push("西经："+a.longitude);var w="";0==$.substring(27,28)?w="运营":1==$.substring(27,28)&&(w="停运");var S="",x="",M="";0==$.substring(21,22)?S="车辆油路正常":1==$.substring(21,22)&&(S="车辆油路断开"),0==$.substring(20,21)?x="车辆电路正常":1==$.substring(20,21)&&(x="车辆电路断开"),0==$.substring(19,20)?M="车门解锁":1==$.substring(19,20)&&(M="车门加锁");var C,_={gpsTime:parseDate2Str(a.gpsTime),monitorName:i.monitorName,vehicleType:i.vehicleType,assignmentName:"null"==i.assignmentName||null==i.assignmentName?"-":i.assignmentName,deviceNumber:i.deviceNumber,simcardNumber:i.simcardNumber,travelState:a.gpsSpeed<=1?"停止":"行驶",gpsSpeed:a.gpsSpeed,formattedAddress:a.positionDescription,groupName:i.groupName,monitorType:null==i.monitorType||"null"==i.monitorType||null==i.monitorType?"0":i.monitorType,acc:l,todayMileage:parseFloat(a.deviceDayMile?a.deviceDayMile:0),longitudeAndLatitude:T,allMileage:m,direction:a.direction,grapherSpeed:"null"==a.grapherSpeed||null==a.grapherSpeed?0:a.grapherSpeed,altitude:a.altitude,electronicWaybill:"",professionalsName:"null"==i.professionalsName?"-":i.professionalsName,idCardNo:"",identity:"",tcb:"",batteryVoltage:a.batteryVoltage,signalStrength:a.signalStrength,monitorTypeName:"vehicle",monitorId:k,angle:p,roadLimitSpeed:a.roadLimitSpeed,monitorIcon:i.monitorIcon,roadType:a.roadType?this.roadTypeJudge(a.roadType):"",msgID:513==n?1:0,status:a.status,alarmTypeId:"",deviceType:i.deviceType,signalStateFlagDetails:void 0===c?"-":c,stateInfo:a.stateInfo,protocolType:a.protocolType,plateColor:o,alarmType:a.alarmType?a.alarmType:"",operatingState:w,oilStatus:S,circuitStatus:x,carDoorStatus:M};return y.push(i.monitorName),y.push(i.vehicleType),y.push(i.assignmentName),y.push(i.deviceNumber),y.push(i.simcardNumber),y.push(a.dayMileage),y.push(""==a.gpsMileage||null==a.gpsMileage||null==a.gpsMileage?0:a.gpsMileage),y.push(a.gpsSpeed),y.push(l),y.push(a.gpsSpeed<=1?"停止":"行驶"),y.push(parseDate2Str(a.gpsTime)),y.push(a.latitude),y.push(a.longitude),y.push(i.monitorId),y.push("null"==i.professionalsName?"-":i.professionalsName),y.push(o),y.push(this.toDirectionStr(a.direction)),y.push(a.positionDescription),y.push(513==n?1:0),y.push(a.status),y.push(""),y.push(""),y.push(a.altitude),y.push("null"==a.grapherSpeed||null==a.grapherSpeed?0:a.grapherSpeed),y.push(a.direction),y.push(i.monitorIcon),y.push("null"==i.groupName||null==i.groupName?"-":i.groupName),y.push(i.deviceType),y.push(void 0===c?"-":c),y.push(a.stateInfo),y.push(null==i.monitorType||"null"==i.monitorType||null==i.monitorType?"0":i.monitorType),y.push(a.protocolType),null==(C=a.roadType)||""==C?y.push(""):y.push(this.roadTypeJudge(C)),y.push(a.roadLimitSpeed),this.renderMarkerContent(y,_,t)},e.prototype.renderMarkerContent=function(e,t,a){var n=[];if("people"==e[11]){var i=[],r=e[9],s=e[10];i.push(s),i.push(r);var o={vehicleId:e[12],vehicleName:e[1]},l=JSON.stringify(o).replace(/"/g,"'");n.push("<div>时间："+e[0]+"</div>"),n.push("<div>监控对象："+e[1]+"</div>"),n.push("<div>所属分组："+e[2]+"</div>"),n.push("<div>终端号："+e[3]+"</div>"),n.push("<div>终端手机号："+e[4]+"</div>"),n.push("<div>电池电压："+e[5]+"</div>"),n.push("<div>信号强度："+e[6]+"</div>"),n.push("<div>速度："+e[7]+"</div>"),n.push("<div>海拔："+e[8]+"</div>"),n.push('<div class="infoWindowSetting"><a class="col-md-3 jumpLink" id="jumpTo" data-jumpInfo="'+l+'" data-jumpKey="track-playback"><img src="/clbs/resources/img/v-track.svg" style="height:28px;width:28px;"/>轨迹</a></div>')}else if("people"!=e[11]){e[13],i=[],r=e[11],s=e[12];for(var d=[],c=0;c<e.length;c++)2!=c&&14!=c&&20!=c&&d.push(e[c]);i.push(s),i.push(r);n=[];var p="<div id='basicStatusInformation' style='padding:0px;'><input id='infowindowShowVid' value='"+t.monitorId+"' hidden>";n.push(p);for(c=0;c<a.length;c++){var u=a[c];c<11&&this.renderContent(u,t,n)}$.fn.zTree.getZTreeObj("treeDemo");var h=e[27]?e[27]:e[31],m=e[31],v=e[29];this.markerDetailArray=[d,e[2],e[14],e[20]];o={vehicleId:e[13],vehicleName:e[0]},l=JSON.stringify(o).replace(/"/g,"'");var g=["0","1","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28"];if("number"==typeof h&&(h=h.toString()),-1!==g.indexOf(h)){var f='<div class="infoWindowSetting"><a class="col-md-2 jumpLink" id="jumpTo" data-jumpInfo="'+l+'" data-jumpKey="track-playback"><img src="/clbs/resources/img/v-track.svg" style="height:28px;width:28px;"/>轨迹</a>';-1!==(g=["1","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28"]).indexOf(m)&&"3"!=v&&(f+='<a class="col-md-2 callName jumpLink" data-jumpInfo="'+l+'" data-jumpKey="realtime-video"><img src="/clbs/resources/img/video_info_jump.svg" style="height:28px;width:28px;"/>视频</a>'),a.length>11&&(f+='<a class="col-md-2 text-right pull-right" style="padding-top:24px;"><i class="fa fa-chevron-circle-right fa-2x vStatusInfoShowMore" id="vStatusInfoShowMore"></i></a>'),f+="</div>",n.push(f)}else if("8"==h||"9"==h||"10"==h){f='<div class="infoWindowSetting"><a class="col-md-3 jumpLink" id="jumpTo" data-jumpInfo="'+l+'" data-jumpKey="track-playback"><img src="/clbs/resources/img/v-track.svg" style="height:28px;width:28px;"/>轨迹</a>';"1"==m&&"3"!=v&&(f+='<a class="col-md-2 callName jumpLink" data-jumpInfo="'+l+'" data-jumpKey="realtime-video"><img src="/clbs/resources/img/video_info_jump.svg" style="height:28px;width:28px;"/>视频</a>'),a.length>11&&(f+='<a class="col-md-3 text-right pull-right" style="padding-top:24px;"><i class="fa fa-chevron-circle-right fa-2x vStatusInfoShowMore" id="vStatusInfoShowMore"></i></a>'),f+="</div>",n.push(f)}else{f='<div class="infoWindowSetting"><a class="col-md-3 jumpLink" id="jumpTo" data-jumpInfo="'+l+'" data-jumpKey="track-playback"><img src="/clbs/resources/img/v-track.svg" style="height:28px;width:28px;"/>轨迹</a>';"1"==m&&"3"!=v&&(f+='<a class="col-md-2 callName jumpLink" data-jumpInfo="'+l+'" data-jumpKey="realtime-video"><img src="/clbs/resources/img/video_info_jump.svg" style="height:28px;width:28px;"/>视频</a>'),a.length>11&&(f+='<a class="col-md-3 text-right pull-right" style="padding-top:24px;"><i class="fa fa-chevron-circle-right fa-2x vStatusInfoShowMore" id="vStatusInfoShowMore"></i></a>'),f+="</div>",n.push(f)}n.push("</div>");if(a.length>11){n.push("<div class='mapInfoDetail centerMapInfoDetail'>");for(c=11;c<a.length;c++){u=a[c];c<25&&this.renderContent(u,t,n)}n.push("<div><span id='bombBox0'></span></div></div>")}if(a.length>25){n.push("<div class='mapInfoDetail rightMapInfoDetail'>");for(c=25;c<a.length;c++){u=a[c];this.renderContent(u,t,n)}n.push("</div>")}}return $("#realtimeMapContainer").off().on("click",".jumpLink",this.jumpPage.bind(this)),$("#realtimeMapContainer").on("click","#vStatusInfoShowMore",this.vStatusInfoShow.bind(this)),n.join("")},e.prototype.renderContent=function(e,t,a){var n=null!==t[e.name]&&void 0!==t[e.name]?t[e.name]:"";switch(e.title){case"监控对象":""==t.plateColor?a.push("<div>监控对象："+n+"</div>"):a.push("<div>监控对象："+n+"("+t.plateColor+")</div>");break;case"行驶状态":"行驶"==n?a.push("<div>行驶状态：<font color='#78af3a'>"+n+"</font></div>"):"停止"==n&&a.push("<div>行驶状态：<font color='#c80002'>"+n+"</font></div>");break;case"ACC状态":"开"==n||-1==n.indexOf("无")&&n.indexOf("点火")>-1?a.push("<div>ACC："+n+" <img src='/clbs/resources/img/acc_on.svg' style='margin: -3px 0px 0px 0px;height:24px;'/></div>"):a.push("<div>ACC："+n+" <img src='/clbs/resources/img/acc_off.svg' style='margin: -3px 0px 0px 0px;height:24px;'/></div>");break;case"经纬度":a.push("<div>"+n[0]+"</div>"),a.push("<div>"+n[1]+"</div>");break;case"当日里程":case"总里程":a.push('<div class="popupColumns popup_'+e.name+'">'+e.title+"："+Number(n).toFixed(1)+"公里</div>");break;case"方向":a.push('<div class="popupColumns popup_'+e.name+'">'+e.title+"："+this.toDirectionStr(n)+"</div>");break;case"对象类型":a.push('<div class="popupColumns popup_'+e.name+'">'+e.title+"："+(t.vehicleType?t.vehicleType:"")+"</div>");break;default:a.push('<div class="popupColumns popup_'+e.name+'">'+e.title+"："+n+"</div>")}},e.prototype.vStatusInfoShow=function(){var e=this.markerDetailArray,t=e[0],a=(e[1],e[2]),n=(e[3],$(".amap-info-contentContainer .amap-info-content").outerWidth());if($(".mapInfoDetail").is(":hidden")){var i=$(".amap-info-contentContainer .mapInfoDetail").length,r=1===i?"424px":"620px";2===i&&($(".centerMapInfoDetail").addClass("centerMapInfo"),$(".rightMapInfoDetail").css("border","none")),$(".amap-info-contentContainer .amap-info-content").css("width",r),$("#vStatusInfoShowMore").removeClass("fa-chevron-circle-right").addClass("fa-chevron-circle-left"),$(".mapInfoDetail").show(),this.amapInfoSharpAdaptiveFn(n),$("#basicStatusInformation").css({width:"158px","margin-right":"20px"});var s=t,o=(+s[17]).toString(2);o=(Array(32).join("0")+o).slice(-32),1==s[16]&&$("#bombBox0").text("单次回报应答"),0==o.substring(29,30)?$("#bombBox2").text("北纬："+s[10]):1==o.substring(30,31)&&$("#bombBox2").text("南纬："+s[10]),0==o.substring(28,29)?$("#bombBox3").text("东经："+s[11]):1==o.substring(28,29)&&$("#bombBox3").text("西经："+s[11]),$("#bombBox4").text("方向："+this.toDirectionStr(s[21])),$("#bombBox5").text("记录仪速度："+s[20]),$("#bombBox6").text("高程："+s[19]),$("#rateLimiting").text("路网限速："+s[30]),$("#roadType").text("道路类型："+s[29]),"null"==a&&(a="");var l="";l="null"==s[18]?"":s[18];var d=s[12];$("#infowindowShowVid").val(d),$(".popup_electronicWaybill").text("电子运单："),$(".popup_professionalsName").text("从业人员："+(a||"")),$(".popup_idCardNo").text("身份证号："),$(".popup_identity").text("从业资格证号："+(l||"")),$(".popup_tcb").text("发证机构："),0==o.substring(27,28)?$("#bombBox10").text("运营状态"):1==o.substring(27,28)&&$("#bombBox10").text("停运状态"),0==o.substring(21,22)?$("#bombBox11").text("车辆油路正常"):1==o.substring(21,22)&&$("#bombBox11").text("车辆油路断开"),0==o.substring(20,21)?$("#bombBox12").text("车辆电路正常"):1==o.substring(20,21)&&$("#bombBox12").text("车辆电路断开"),0==o.substring(19,20)?$("#bombBox13").text("车门解锁"):1==o.substring(19,20)&&$("#bombBox13").text("车门加锁")}else $("#basicStatusInformation").removeAttr("class"),$("#basicStatusInformation").addClass("col-md-12"),$("#basicStatusInformation").parent().css("width","196px"),$("#vStatusInfoShowMore").removeClass("fa-chevron-circle-left").addClass("fa-chevron-circle-right"),$(".mapInfoDetail").hide(),this.amapInfoSharpAdaptiveFn(n),$("#basicStatusInformation").css("width","none")},e.prototype.amapInfoSharpAdaptiveFn=function(e){var t=$(".amap-info"),a=parseInt(t.css("left")),n=e>300?e:$(".amap-info-contentContainer .amap-info-content").outerWidth(),i=Math.ceil((n-196)/2);$(".mapInfoDetail").is(":hidden")?(isNaN(a)||t.css("left",a+i+"px"),$(".amap-info-sharp").removeClass("amap-info-sharp-marleft-hide"),$(".amap-info-sharp").removeClass("amap-info-sharp-marleft-show"),$(".amap-info-sharp").addClass("amap-info-sharp-marleft-hide")):(isNaN(a)||t.css("left",a-i+"px"),$(".amap-info-sharp").removeClass("amap-info-sharp-marleft-hide"),$(".amap-info-sharp").removeClass("amap-info-sharp-marleft-show"),$(".amap-info-sharp").addClass("amap-info-sharp-marleft-show"))},e.prototype.jumpPage=function(e){var t=$(e.target);"IMG"==e.target.nodeName&&(t=$(e.target).closest(".jumpLink"));var a=t.attr("data-jumpkey"),n=JSON.parse(t.attr("data-jumpinfo").replace(/'/g,'"')),i=this.currentMonitorInfo;n.pid=i.assignmentId,n.type=i.deviceType,"realtime-video"===a&&window.realTimeVideLoad&&realTimeVideLoad.init(null,null,n),this.dependency.get("layout").go(a,n)},e.prototype.getAssignmentInfo=function(e){var t={assignmentId:"",deviceType:""};return json_ajax("POST","/clbs/lkyw/v/monitoring/getMonitorBubble","json",!1,{monitorId:e},(function(e){var a=e.obj.monitorInfo;a&&(t=a)})),t},e.prototype.toDirectionStr=function(e){return e>=0&&e<=22.5||e>337.5&&e<=360?"北":e>22.5&&e<=67.5?"东北":e>67.5&&e<=112.5?"东":e>112.5&&e<=157.5?"东南":e>157.5&&e<=202.5?"南":e>202.5&&e<=247.5?"西南":e>247.5&&e<=292.5?"西":e>292.5&&e<=337.5?"西北":"未知数据"},e.prototype.signalStateFlagAnalysis=function(e){var t=e.toString(),a="";return 1==(t=(Array(32).join("0")+t).slice(-32)).substring(31,32)&&(a+="近光灯,"),1==t.substring(30,31)&&(a+="远光灯,"),1==t.substring(29,30)&&(a+="右转向灯,"),1==t.substring(28,29)&&(a+="左转向灯,"),1==t.substring(27,28)&&(a+="制动,"),1==t.substring(26,27)&&(a+="倒挡,"),1==t.substring(25,26)&&(a+="雾灯,"),1==t.substring(24,25)&&(a+="示廊灯,"),1==t.substring(23,24)&&(a+="喇叭,"),1==t.substring(22,23)&&(a+="空调开,"),1==t.substring(21,22)&&(a+="空挡,"),1==t.substring(20,21)&&(a+="缓速器工作,"),1==t.substring(19,20)&&(a+="ABS工作,"),1==t.substring(18,19)&&(a+="加热器工作,"),1==t.substring(17,18)&&(a+="离合器状态,"),a},e.prototype.roadTypeJudge=function(e){var t;switch(e){case 1:t="高速路";break;case 2:t="都市高速路";break;case 3:t="国道";break;case 4:t="省道";break;case 5:t="县道";break;case 6:t="乡村道路";break;case 7:t="其他道路"}return t},e.prototype.formatDuring=function(e){var t=parseInt(e/864e5),a=parseInt(e%864e5/36e5),n=parseInt(e%36e5/6e4),i=parseInt(e%6e4/1e3);return 0===t&&0===a&&0==n?i+" 秒 ":0===t&&0===a&&0!==n?n+" 分 "+i+" 秒 ":0===t&&0!==a?a+" 小时 "+n+" 分 "+i+" 秒 ":0!==t?t+" 天 "+a+" 小时 "+n+" 分 "+i+" 秒 ":void 0},e}()),_=function(e,t,a,n){return new(a||(a=Promise))((function(i,r){function s(e){try{l(n.next(e))}catch(e){r(e)}}function o(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(s,o)}l((n=n.apply(e,t||[])).next())}))},I=function(e,t){var a,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function o(r){return function(o){return function(r){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],n=0}finally{a=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,o])}}},A=function(){function e(e,t){this.dependency=t,this.setOption(e)}return e.prototype.setOption=function(e){this.option=e,this.state={$origin:null,$dom:{},data:{mapDatas:null,map:null,standardLayer:null,gdSatelliteLayer:null,satellLayer:null,realTimeTraffic:null,mouseTool:null,googleMapLayer:null,mouseToolEdit:null,drawShapeEdit:null,drawRectangle:null,textMarker:null,picPrint:null,contextMenu:null,infoWindow:null,mouseTool1:null,changeArray:null,massMarks:null,massData:null,nameMarker:null,nameMarkerHoverVid:null,nameMarkerClickVid:null,fenceIDMap:new mapVehicle,PolyEditorMap:new mapVehicle,polyFence:null,amendPolygon:null,lineRoute:void 0,travelLineMap:new mapVehicle,administrationMap:new mapVehicle,administrativeAreaFence:[],webWorker:null}},this.state.$origin=$(e.selector),this.initHtml(),this.bindEvent()},e.prototype.initHtml=function(){var e=$(k.a);this.state.$origin.empty(),this.state.$origin.append(e),this.state.data.webWorker=new Worker("/clbs/resources/lkyw/webWorker/updateRealtimeMap.js"),this.state.data.webWorker.onmessage=this.handleWebWorkerMessage.bind(this),this.state.data.webWorker.postMessage({cmd:"getVehicle"}),this.initMap()},e.prototype.bindEvent=function(){$("#toolClick").on("click",this.showMaptool.bind(this)),$("#toolOperateClick").on("click",".fenceA",this.maptoolOpera.bind(this)),$("#measurementMenu").on("click",".item",this.measurementFun.bind(this)),$("#mapDropSettingMenu").on("change",".monitoringSelect",this.mapTypeSet.bind(this)),$("#drawGraphics").on("click","p",this.drawGraphicsFun.bind(this));var e=this.dependency.get("data");e.on("onCurrentSelectVehicleChange",this.handlePointFocus.bind(this)),e.on("onCurrentActiveVehicleChange",this.handlePointActive.bind(this)),e.on("onCurrentVLocationChange",this.getMapBounds.bind(this)),$("#searchCarClose").on("click",this.searchCarClose.bind(this)),e.on("onCurrentSelectVehicleChange",this.fenceChange.bind(this)),$("#fenceToolBtn").on("click",this.fenceToolClickSHFn.bind(this)),$("#vFenceSearch").bind("input oninput",this.vsearchFenceCarSearch.bind(this)),$("input").inputClear().on("onClearEvent",this.searchClear.bind(this))},e.prototype.handleWebWorkerMessage=function(e){var t=e.data;switch(t.cmd){case"updateVehicle":this.updateMassMark(t.data);break;case"getMapBounds":this.getMapBounds()}},e.prototype.getMapBounds=function(){var e=this.state.data.map.getBounds(),t=e.getNorthEast(),a=e.getSouthWest();this.state.data.webWorker.postMessage({cmd:"getVehicle",data:[t.getLng(),t.getLat(),a.getLng(),a.getLat()]})},e.prototype.updateMassMark=function(e){var t=e.data,a=e.styleArray,n=e.mapAllPoints,i=this.dependency.get("data");i.set("mapAllPoints",n);for(var r=this.state.data,s=r.nameMarker,o=r.massMarks,l=(r.nameMarkerClickVid,r.map),d=new AMap.Pixel(21,14),c=new AMap.Size(50,28),p=0;p<a.length;p++){var u=a[p];u.anchor=d,u.size=c}if(this.state.data.massData=t,o)this.state.data.massMarks.setStyle(a),this.state.data.massMarks.setData(t);else{var h=new AMap.MassMarks(t,{zIndex:111,cursor:"pointer",alwaysRender:!0,style:a,zooms:[3,20]});h.setMap(l),h.on("mouseover",this.handlePointMouseOver.bind(this)),h.on("mouseout",this.handlePointMouseOut.bind(this)),h.on("click",this.handlePointClick.bind(this)),this.state.data.massMarks=h}var m=i.get("currentSelectVehicle");if(m&&m.id){var v=m.id,g=this.getPointByVid(v);g&&(s&&this.state.data.nameMarkerHoverVid===v?s.setPosition(new AMap.LngLat(g.longitude,g.latitude)):s.hide(),l.panTo(new AMap.LngLat(g.longitude,g.latitude)))}},e.prototype.initMap=function(){this.state.data.standardLayer=new AMap.TileLayer,this.state.data.gdSatelliteLayer=new AMap.TileLayer.Satellite,this.state.data.gdSatelliteLayer.hide(),this.state.data.map=new AMap.Map("realtimeMapContainer",{resizeEnable:!0,zoom:18,layers:[this.state.data.gdSatelliteLayer,this.state.data.standardLayer]});var e=this.state.data.map;e.plugin(["AMap.ToolBar","AMap.Scale"],(function(){e.addControl(new AMap.ToolBar),e.addControl(new AMap.Scale)}));this.state.data.mouseTool=new AMap.MouseTool(e),this.state.data.mouseTool1=new AMap.MouseTool(e),this.state.data.mouseTool.on("draw",this.createSuccess.bind(this)),this.state.data.contextMenu=new AMap.ContextMenu,this.state.data.infoWindow=new AMap.InfoWindow({offset:new AMap.Pixel(0,-10),closeWhenClickMap:!0}),this.state.data.satellLayer=new AMap.TileLayer({tileUrl:"https://mt{1,2,3,0}.google.cn/maps/vt?lyrs=s@194&hl=zh-CN&gl=cn&x=[x]&y=[y]&z=[z]",zIndex:100}),this.state.data.satellLayer.setMap(e),this.state.data.satellLayer.hide(),this.state.data.realTimeTraffic=new AMap.TileLayer.Traffic,this.state.data.realTimeTraffic.setMap(e),this.state.data.realTimeTraffic.hide()},e.prototype.showMaptool=function(){$("#toolOperateClick .fenceA").removeClass("active"),$(".dropDown").hide(),$("#toolOperateClick").toggleClass("active")},e.prototype.maptoolOpera=function(e){var t=e.currentTarget.id,a=$("#"+t);a.hasClass("item")?a.toggleClass("active").siblings(".item").removeClass("active"):a.toggleClass("active").siblings(".fenceA").removeClass("active"),$(".dropDown").hide();var n=a.hasClass("active"),i=this.state.data.mouseTool;switch(this.removeShapeTool(),t){case"previewImage":this.htmlTocanvas();break;case"queryClick":n&&(this.removeShapeTool(),$("#drawGraphics").find("p").removeClass("active"),i.rectangle());break;case"magnifyClick":n&&i.rectZoomIn();break;case"shrinkClick":n&&i.rectZoomOut();break;case"displayClick":var r=$("#disSetMenu");n?r.slideDown():r.slideUp();break;case"mapDropSetting":var s=$("#mapDropSettingMenu");n?s.slideDown():s.slideUp();break;case"countClick":var o=$("#measurementMenu");n?o.slideDown():($("#drawGraphics p, #measurementMenu .item").removeClass("active"),o.slideUp())}},e.prototype.htmlTocanvas=function(){window.Promise?(layer.load(2),setTimeout((function(){T(document.querySelector(".amap-maps"),{useCORS:!0,backgroundColor:null}).then((function(e){layer.closeAll("loading");var t=e.toDataURL("image/jpg");$("#picImg").attr("src",t),localStorage.setItem("printPicBase64",t),$("#lkywRealtimePreview").modal("show")}))}),10),$("#downloadPic").on("click",this.downloadPic.bind(this)),$("#print").on("click",this.printMapPic.bind(this))):layer.msg("本浏览器暂不支持该功能!")},e.prototype.downloadPic=function(){var e=document.createElement("a");e.href=$("#picImg").attr("src"),e.download="downLoad.jpg";var t=document.createEvent("MouseEvents");t.initEvent("click",!0,!0),e.dispatchEvent(t)},e.prototype.printMapPic=function(){this.state.data.picPrint=window.open("/clbs/m/web/print/list.html","_blank")},e.prototype.mapTypeSet=function(e){var t=e.currentTarget.id,a=$("#"+t).prop("checked"),n=this.state.data,i=n.map,r=n.googleMapLayer,s=n.realTimeTraffic,o=n.satellLayer,l=n.standardLayer,d=n.gdSatelliteLayer;switch(t){case"realTimeRCInput":a?($("#googleMapInput").prop("checked",!1),r&&r.setMap(null),s.show()):s.hide();break;case"defaultMapInput":a?($("#googleMapInput").prop("checked",!1),r&&r.setMap(null),d.show(),l.hide()):(d.hide(),l.show(),o.hide());break;case"googleMapInput":a?($("#realTimeRCInput,#defaultMapInput").prop("checked",!1),s.hide(),o.hide(),this.state.data.googleMapLayer=new AMap.TileLayer({tileUrl:"http://mt{1,2,3,0}.google.cn/vt/lyrs=m@142&hl=zh-CN&gl=cn&x=[x]&y=[y]&z=[z]&s=Galil",zIndex:100}),this.state.data.googleMapLayer.setMap(i)):r.setMap(null)}},e.prototype.measurementFun=function(e){this.removeShapeTool();var t=e.currentTarget.id,a=$("#"+t),n=this.state.data,i=n.mouseTool,r=n.map;$("#toolOperateClick .mapOpra").removeClass("active"),a.toggleClass("active").siblings(".item").removeClass("active"),$("#drawGraphics").find("p").removeClass("active"),a.hasClass("active")&&i.rule({zIndex:5e4,bubble:!0,map:r})},e.prototype.drawGraphicsFun=function(e){e.stopPropagation(),this.removeShapeTool();var t=e.currentTarget,a=t.dataset.type,n=this.state.data.mouseTool;$(t).addClass("active").siblings().removeClass("active"),"circle"==a?n.circle({fillColor:"#00b0ff",strokeColor:"#80d8ff"}):"rectangle"==a&&n.rectangle({fillColor:"#00b0ff",strokeColor:"#80d8ff"})},e.prototype.createSuccess=function(e){var t=this,a=e.obj.CLASS_NAME,n=this.state.data,i=n.map,r=n.mouseTool;if($("#queryClick").hasClass("active")){var s=e.obj.getBounds();this.areaVSearch(s)}else if("AMap.Circle"===a)r.close(!1),this.state.data.drawShapeEdit=new AMap.CircleEditor(i,e.obj),this.state.data.drawShapeEdit.open(),this.createCircleText(e),this.state.data.drawShapeEdit.on("move",(function(){t.createCircleText(e)})),this.state.data.drawShapeEdit.on("adjust",(function(){t.createCircleText(e)}));else if("AMap.Polygon"==a){r.close(!0);var o=e.obj.getBounds();this.state.data.drawRectangle=new AMap.Rectangle({bounds:o,fillColor:"#00b0ff",strokeColor:"#80d8ff",fillOpacity:.4,map:i});var l=this.state.data.drawRectangle;this.state.data.drawShapeEdit=new AMap.RectangleEditor(i,l),this.state.data.drawShapeEdit.open(),this.createRectangleText(l),this.state.data.drawShapeEdit.on("adjust",(function(){t.createRectangleText(l)}))}},e.prototype.areaVSearch=function(e){return _(this,void 0,void 0,(function(){var t,a,n,i,r,s,o,l,d,c;return I(this,(function(p){switch(p.label){case 0:return[4,S.a.post("/clbs/v/monitoring/regionalQuery",null)];case 1:if(200==(t=p.sent()).status&&t.data.success){for(a=t.data.obj?t.data.obj:[],n=0,i=[],r=0;r<a.length;r++)s=a[r],o=s[2],l=s[1],d=null,e.contains([o,l])&&(n++,d={carName:s[4],carGroup:s[3]},i.push(d));if(0==i.length)return layer.msg("该区域没有任何监控对象"),this.state.data.mouseTool.close(!0),$("#queryClick").removeClass("active"),[2];c=M()({data:i}),$("#areaSearchCarTable").html(c),$("#sumRegionalQuery").text("共计"+n+"监控对象！"),$("#realtimeAreaSearchCar").modal("show")}return[2]}}))}))},e.prototype.searchCarClose=function(){$("#areaSearchCar").modal("hide"),$("#queryClick").removeClass("active"),this.state.data.mouseTool.close(!0)},e.prototype.createCircleText=function(e){var t=this.state.data,a=t.map,n=t.textMarker,i=e.obj,r=i.getCenter(),s=i.getRadius(),o=Number((2*s).toFixed(2)),l='<div class="text-marker"><span>直径：'+o+"m</span><br><span>周长："+(3.14159*o).toFixed(2)+"m</span><br><span>面积："+(s*s*3.14159).toFixed(2)+"m²</span></div>";n?(n.setPosition(r),n.setLabel({content:l})):(this.state.data.textMarker=new AMap.Marker({position:r,offset:new AMap.Pixel(5,5),map:a,label:{content:l,direction:"right",offset:new AMap.Pixel(0,30)},icon:"/clbs/resources/img/destroy.png"}),this.state.data.textMarker.on("click",this.removeShapeTool.bind(this)))},e.prototype.createRectangleText=function(e){var t=this.state.data,a=t.textMarker,n=t.map,i=e.getPath(),r='<div class="text-marker"><span>周长：'+(2*(i[0].distance(i[1])+i[1].distance(i[2]))).toFixed(2)+"m</span><br><span>面积："+e.getArea()+"m²</span></div>";null==a?(this.state.data.textMarker=new AMap.Marker({position:i[1],label:{content:r,direction:"right",offset:new AMap.Pixel(-2,24)},offset:new AMap.Pixel(0,0),map:n,zIndex:999999,icon:"/clbs/resources/img/destroy.png"}),this.state.data.textMarker.on("click",this.removeShapeTool.bind(this))):(a.setPosition(i[1]),a.setLabel({content:r}))},e.prototype.removeShapeTool=function(){var e=this.state.data,t=e.map,a=e.mouseTool,n=e.textMarker,i=e.drawShapeEdit,r=e.drawRectangle;a&&a.close(!0),n&&(t.remove([n]),this.state.data.textMarker=null),i&&i.close(),r&&t.remove([r])},e.prototype.mouseToolClose=function(){this.state.data.mouseTool.close(!0)},e.prototype.mouseToolMarker=function(e,t){this.state.data.mouseTool.marker({offset:new AMap.Pixel(e,t)})},e.prototype.mouseToolRectangle=function(){this.state.data.mouseTool1.rectangle()},e.prototype.mouseToolCircle=function(){this.state.data.mouseTool1.circle()},e.prototype.mouseToolPolygon=function(){this.state.data.mouseTool1.polygon()},e.prototype.mouseToolPolyline=function(){this.state.data.mouseTool.polyline()},e.prototype.drawLineToMap=function(e,t,a,n){var i=e[0].lineId;if(this.state.data.fenceIDMap.containsKey(i)){var r=this.state.data.fenceIDMap.get(i);if(Array.isArray(r))for(var s=0;s<r.length;s++)r[s].hide();else r.hide();this.state.data.fenceIDMap.remove(i)}var o=new Array;if(null!=e&&e.length>0)for(s=0;s<e.length;s++)"0"==e[s].type&&(o[s]=[e[s].longitude,e[s].latitude]);var l=new AMap.Polyline({path:o,strokeColor:"#3366FF",strokeOpacity:1,strokeWeight:5,strokeStyle:"solid",strokeDasharray:[10,5],zIndex:51});[].push(l),this.state.data.fenceIDMap.put(i,l),l.setMap(n),n.setFitView(l)},e.prototype.drawMark=function(e,t){var a=e.id;if(this.state.data.fenceIDMap.containsKey(a)){var n=this.state.data.fenceIDMap.get(a);t.remove(n),this.state.data.fenceIDMap.remove(a)}var i=[];i.push(e.longitude),i.push(e.latitude),this.state.data.polyFence=new AMap.Marker({position:i,offset:new AMap.Pixel(-9,-23)}),1===e.markIcon&&this.state.data.polyFence.setIcon("/clbs/resources/img/circleIcon.png"),this.state.data.polyFence.on("mouseover",(function(t){$("#createName").html(html2Escape(e.name,null)),$("#createType").html(html2Escape(e.type,null)),$("#createPer").html(html2Escape(e.createDataUsername,null)),$("#createTime").html(e.createDataTime),$("#createDesc").html(html2Escape(e.description,null));var a=$("#markerInfoWindow").height();$("#markerInfoWindow").css({left:t.pixel.x+220+"px",top:t.pixel.y-a-25+"px"}).show()})),this.state.data.polyFence.on("mouseout",(function(e){$("#markerInfoWindow").hide()})),t.on("resize",(function(e){$("#markerInfoWindow").hide()})),this.state.data.polyFence.setMap(t),t.setFitView(this.state.data.polyFence),this.state.data.fenceIDMap.put(a,this.state.data.polyFence)},e.prototype.drawRectangle=function(e,t){$("#LUPointLngLat").val(e.leftLongitude+","+e.leftLatitude),$("#RDPointLngLat").val(e.rightLongitude+","+e.rightLatitude);var a=e.id;if(this.state.data.fenceIDMap.containsKey(a)){var n=this.state.data.fenceIDMap.get(a);n.show(),this.state.data.map.setFitView(n)}else{var i=new Array;null!=e&&(i.push([e.leftLongitude,e.leftLatitude]),i.push([e.rightLongitude,e.leftLatitude]),i.push([e.rightLongitude,e.rightLatitude]),i.push([e.leftLongitude,e.rightLatitude])),this.state.data.polyFence=new AMap.Polygon({path:i,strokeColor:"#FF33FF",strokeOpacity:.2,strokeWeight:3,fillColor:"#1791fc",fillOpacity:.35}),this.state.data.polyFence.setMap(t),t.setFitView(this.state.data.polyFence),this.state.data.fenceIDMap.put(a,this.state.data.polyFence)}},e.prototype.drawCircle=function(e,t){var a=this.state.data.fenceIDMap,n=e.id;a.containsKey(n)&&(a.get(n).hide(),a.remove(n));this.state.data.PolyEditorMap.containsKey(n)&&this.state.data.PolyEditorMap.get(n).close();var i=new AMap.Circle({center:new AMap.LngLat(e.longitude,e.latitude),radius:e.radius,strokeColor:"#F33",strokeOpacity:1,strokeWeight:3,fillColor:"#ee2200",fillOpacity:.35});this.state.data.polyFence=i,i.setMap(t),t.setFitView(i),a.put(n,i)},e.prototype.drawPolygon=function(e,t){var a=e[0].polygonId,n=this.state.data.fenceIDMap;n.containsKey(a)&&(n.get(a).hide(),n.remove(a));this.state.data.PolyEditorMap.containsKey(a)&&this.state.data.PolyEditorMap.get(a).close();this.state.data.map.off("rightclick",this.state.data.amendPolygon);var i=new Array;if(null!=e&&e.length>0)for(var r=0;r<e.length;r++)i.push([e[r].longitude,e[r].latitude]);var s="";for(r=0;r<i.length;r++)s+='<div class="form-group"><label class="col-md-3 control-label">顶点'+(r+1)+'经纬度：</label><div class=" col-md-8"><input type="text" placeholder="请输入顶点经纬度" value="'+i[r][0]+","+i[r][1]+'" class="form-control rectangleAllPointLngLat"/></div></div>';$("#rectangleAllPointShow").html(s);var o=new AMap.Polygon({path:i,strokeColor:"#FF33FF",strokeOpacity:.2,strokeWeight:3,fillColor:"#1791fc",fillOpacity:.35});o.setMap(t),this.state.data.polyFence=o,t.setFitView(o),n.put(a,o)},e.prototype.drawTravelLine=function(e,t,a,n){$("#drivenRoute").hide(),void 0!==this.state.data.lineRoute&&this.state.data.lineRoute.destroy();var i=a.id,r=[],s=(a.startLongitude,a.startLatitude,a.endLongitude,a.endLatitude,[]);if(void 0!==n)for(var o=0,l=n.length;o<l;o++)s.push([n[o].longitude,n[o].latitude]);var d=0;for(l=e.length;d<l;d++)r.push([e[d].longitude,e[d].latitude]);if(this.state.data.travelLineMap.containsKey(i)){var c=this.state.data.travelLineMap.get(i);this.state.data.map.remove([c]),this.state.data.travelLineMap.remove(i)}var p=new AMap.Polyline({path:r,strokeColor:"#3366FF",strokeOpacity:1,strokeWeight:5,strokeStyle:"solid",strokeDasharray:[10,5],zIndex:51});p.setMap(this.state.data.map),this.state.data.map.setFitView(p),this.state.data.travelLineMap.put(i,p)},e.prototype.drawAdministration=function(e,t,a){var n=[];if(this.state.data.administrationMap.containsKey(t)){var i=this.state.data.administrationMap.get(t);this.state.data.map.remove(i),this.state.data.administrationMap.remove(t)}var r=0;for(e.length;r<1;r++){var s=new AMap.Polygon({map:this.state.data.map,strokeWeight:1,strokeColor:"#CC66CC",fillColor:"#CCF3FF",fillOpacity:.5,path:e});n.push(s),this.state.data.administrativeAreaFence.push(s)}this.state.data.administrationMap.put(t,n),this.state.data.map.setFitView(s)},e.prototype.fenceToolClickSHFn=function(){$("#fenceTool>.dropdown-menu").is(":hidden")?$("#fenceTool>.dropdown-menu").show():$("#fenceTool>.dropdown-menu").hide()},e.prototype.searchClear=function(e){if("vFenceSearch"==$(e.currentTarget).attr("id")){var t=this.dependency.get("data").get("currentSelectVehicle").id;this.getFenceTree(t)}},e.prototype.vsearchFenceCarSearch=function(){if(""!=$("#vFenceSearch").val())search_ztree("vFenceTree","vFenceSearch","fence",null);else{var e=this.dependency.get("data").get("currentSelectVehicle");if(!e)return;var t=e.id;this.getFenceTree(t)}},e.prototype.fenceChange=function(){return _(this,void 0,void 0,(function(){var e,t;return I(this,(function(a){return(e=this.dependency.get("data").get("currentSelectVehicle"))?((t=e.id)&&(""==$("#vFenceSearch").val()&&null==$("#vFenceSearch").val()||$("#vFenceSearch").val(""),this.delFenceListAndMapClear(),this.getFenceTree(t),$("#vFenceTree").removeClass("hidden"),$("#vSearchContent").removeClass("hidden"),$("#vFenceMsg").addClass("hidden")),[2]):[2]}))}))},e.prototype.getFenceTree=function(e){var t={async:{url:"/clbs/m/functionconfig/fence/bindfence/fenceTreeByVid",type:"post",enable:!0,autoParam:["id"],dataType:"json",otherParam:{vid:e},dataFilter:this.FenceAjaxDataFilter},view:{dblClickExpand:!1,nameIsHTML:!0},check:{enable:!0,chkStyle:"checkbox",chkboxType:{Y:"s",N:"s"},radioType:"all"},data:{simpleData:{enable:!0},key:{title:"name"}},callback:{onClick:this.vFenceTreeClick.bind(this),onCheck:this.vFenceTreeCheck.bind(this)}};$.fn.zTree.init($("#vFenceTree"),t,null)},e.prototype.FenceAjaxDataFilter=function(e,t,a){if(a)for(var n=0;n<a.length;n++){var i=a[n];i.open=!1,i.name=html2Escape(i.name,null),1==i.markIcon&&(i.iconSkin="zw_m_marker_circle_skin")}return a},e.prototype.delFenceListAndMapClear=function(){var e=$.fn.zTree.getZTreeObj("vFenceTree");if(null!=e){for(var t=e.getCheckedNodes(!0),a=0,n=t.length;a<n;a++)e.checkNode(t[a],!1,!1);var i=e.getChangeCheckedNodes();for(a=0;a<i.length;a++)i[a].checkedOld=!1;var r=this.state.data,s=r.map,o=r.fenceIDMap,l=r.administrationMap,d=r.travelLineMap;if(o.elements.length>0){var c=o.elements.length;for(a=0;a<c;a++){var p=o.elements[a].key,u=o.get(p);"AMap.Marker"!=u.CLASS_NAME&&"AMap.Polyline"!=u.CLASS_NAME&&"AMap.Polygon"!=u.CLASS_NAME&&"AMap.Circle"!=u.CLASS_NAME||u.hide()}o.clear()}if(l.elements.length>0){var h=l.elements.length;for(a=0;a<h;a++){var m=l.elements[a].key,v=l.get(m);s.remove(v)}l.clear()}if(d.elements.length>0){var g=d.elements.length;for(a=0;a<g;a++){var f=d.elements[a].key,b=d.get(f);s.remove([b])}d.clear()}}},e.prototype.vFenceTreeClick=function(e,t,a){$.fn.zTree.getZTreeObj("vFenceTree").checkNode(a,!a.checked,!0)},e.prototype.vFenceTreeCheck=function(e,t,a){var n=$.fn.zTree.getZTreeObj("vFenceTree");a.checked&&n.expandNode(a,!0,!0,!0,!0);n.getCheckedNodes(!0);this.showZtreeCheckedToMap(a,n)},e.prototype.showZtreeCheckedToMap=function(e,t){if(1==e.checked){for(var a=0,n=(s=t.getChangeCheckedNodes()).length;a<n;a++)s[a].checkedOld=!0;for(var i=0;i<s.length;i++){var r=s[i].id;this.showFenceInfo(r,s[i])}}else{var s;for(a=0,n=(s=t.getChangeCheckedNodes()).length;a<n;a++){s[a].checkedOld=!1,t.cancelSelectedNode(s[a]);r=s[a].id;this.hideFenceInfo(r)}}},e.prototype.showFenceInfo=function(e,t){var a=this.state.data,n=a.map,i=a.fenceIDMap;if(i.containsKey(e)){var r=i.get(e);if(null!=r)if(Array.isArray(r))for(var s=0;s<r.length;s++)r[s].show(),n.setFitView(r[s]);else r.show(),n.setFitView(r)}else this.getFenceDetailInfo([t])},e.prototype.hideFenceInfo=function(e){var t=this.state.data.fenceIDMap;if(t.containsKey(e)){var a=t.get(e);if(Array.isArray(a))for(var n=0;n<a.length;n++)a[n].hide();else a.hide()}this.hideRegionsOrTravel(e)},e.prototype.hideRegionsOrTravel=function(e){var t=this.state.data,a=t.map,n=t.administrationMap,i=t.travelLineMap;if(n.containsKey(e)){var r=n.get(e);a.remove(r),n.remove(e)}if(i.containsKey(e)){r=i.get(e);a.remove(r),i.remove(e)}},e.prototype.getFenceDetailInfo=function(e){return _(this,void 0,void 0,(function(){var t,a,n,i,r,s,o,l,d,c,p,u;return I(this,(function(h){switch(h.label){case 0:return layer.load(2),(t=new FormData).set("fenceNodes",JSON.stringify(e)),[4,S.a.post("/clbs/m/functionconfig/fence/bindfence/getFenceDetails",t)];case 1:if(200==(a=h.sent()).status&&(layer.closeAll("loading"),a.data.success&&(n=this.state.data.map,null!=(i=a.data.obj)&&i.length>0)))for(r=0;r<i.length;r++)switch(s=i[r],o=s.fenceType,l=s.fenceData,o){case"zw_m_line":d=null==i[r].lineSpot?[]:i[r].lineSpot,c=null==i[r].lineSegment?[]:i[r].lineSegment,this.drawLineToMap(l,d,c,n);break;case"zw_m_marker":this.drawMark(l,n);break;case"zw_m_rectangle":this.drawRectangle(l,n);break;case"zw_m_polygon":this.drawPolygon(l,n);break;case"zw_m_circle":this.drawCircle(l,n);break;case"zw_m_administration":p=i[0].aId,this.drawAdministration(l,p,n);break;case"zw_m_travel_line":l=s.allPoints,u=s.passPointData,this.drawTravelLine(l,n,i[r].travelLine,u)}return[2]}}))}))},e.prototype.getBubbleData=function(e){return _(this,void 0,void 0,(function(){var t,a;return I(this,(function(n){switch(n.label){case 0:return(t=new FormData).set("monitorId",e),[4,r.a.post("/clbs/lkyw/v/monitoring/getMonitorBubble",t)];case 1:return a=n.sent(),[2,a.data.obj]}}))}))},e.prototype.handlePointMouseOver=function(e){var t=e.data.extra,a=this.dependency.get("realtimeMonitorTree");if(a.subscribeVstatus([{vehicleID:t.vehicleId}]),null===t.status){t.status=3;var n=a.getNodeById(t.vehicleId);if(n){var i=this.iconSkin2Status(n.iconSkin);i&&(t.status=i)}}this.showNameMarker(t)},e.prototype.showNameMarker=function(e){var t=this.state.data,a=t.nameMarkerHoverVid,n=t.nameMarker,i=t.map,r=e.vehicleId;if(r!==a){this.state.data.nameMarkerHoverVid=r;var s='<span class="lkyw-car-name">\n                            <i class="'+this.status2ColorClass(this.statusNumber2Text(e.status))+'"></i>&ensp;\n                            <span class="lkyw-monitor-name-box">'+e.brand+"</span>\n                        </span>";null!==n?(n.setContent(s),n.setPosition(new AMap.LngLat(e.longitude,e.latitude)),n.show()):this.state.data.nameMarker=new AMap.Marker({map:i,position:new AMap.LngLat(e.longitude,e.latitude),content:s,offset:new AMap.Pixel(25,14),autoRotation:!1,zIndex:200})}},e.prototype.updateNameMarker=function(e,t){var a=this.state.data,n=a.nameMarkerHoverVid,i=a.nameMarker;if(e===n){var r=this.getPointByVid(n);if(r){var s=this.iconSkin2Status(t);r.status=s;var o='<span class="lkyw-car-name">\n                            <i class="'+this.status2ColorClass(this.statusNumber2Text(r.status))+'"></i>&ensp;\n                            <span class="lkyw-monitor-name-box">'+r.brand+"</span>\n                        </span>";null!==i&&(i.setContent(o),i.setPosition(new AMap.LngLat(r.longitude,r.latitude)))}}},e.prototype.handlePointMouseOut=function(e){},e.prototype.handlePointClick=function(e){return _(this,void 0,void 0,(function(){var t,a,n,i,r,s,o,l,d,c,p;return I(this,(function(u){switch(u.label){case 0:return t=this.dependency.get("data"),a=e.data.extra,n=a.vehicleId,i=this.state.data,r=i.nameMarkerClickVid,s=i.infoWindow,n!==r?[3,1]:(s.close(),this.state.data.nameMarkerClickVid=null,[3,3]);case 1:return[4,this.getBubbleData(n)];case 2:o=u.sent(),l=t.get("popupColumns"),o.alarmType="",(d=t.get("alarmInfoList")).containsKey(n)&&(o.alarmType=d.get(n)),c=new C({selector:""},this.dependency),p=c.setMarkerInfo(o,l),s.setContent(p),s.open(this.state.data.map,new AMap.LngLat(a.longitude,a.latitude)),this.state.data.nameMarkerClickVid=n,u.label=3;case 3:return[2]}}))}))},e.prototype.handlePointActive=function(){var e=this.dependency.get("data").get("currentActiveVehicle");if(e){var t,a=e.id,n=this.state.data.map,i=this.getPointByVid(a);if(i)t=e.skin?this.iconSkin2Status(e.skin):this.getVstatus(a),i.status=t,n.panTo(new AMap.LngLat(i.longitude,i.latitude)),this.showNameMarker(i)}},e.prototype.handlePointFocus=function(){var e=this.dependency.get("data").get("currentSelectVehicle");if(e){var t,a=e.id,n=this.state.data.map,i=this.getPointByVid(a);if(i)t=e.skin?this.iconSkin2Status(e.skin):this.getVstatus(a),i.status=t,n.panTo(new AMap.LngLat(i.longitude,i.latitude)),this.showNameMarker(i)}},e.prototype.getVstatus=function(e){var t=this.dependency.get("realtimeMonitorTree");t.subscribeVstatus([{vehicleID:e}]);var a=3,n=t.getNodeById(e);if(n){var i=this.iconSkin2Status(n.iconSkin);i&&(a=i)}return a},e.prototype.getPointByVid=function(e){for(var t,a=this.dependency.get("data").get("mapAllPoints"),n=0;n<a.length;n++){var i=a[n];if(i.vehicleId===e){t=i;break}}return t},e.prototype.statusNumber2Text=function(e){switch(e){case 11:return"heartBeat";case 2:return"notPosition";case 5:return"alarm";case 10:return"run";case 4:return"stop";case 9:return"overSpeed";case 3:return"offline"}},e.prototype.status2ColorClass=function(e){var t;switch(e){case"stop":t="carStateStop";break;case"run":t="carStateRun";break;case"alarm":t="carStateAlarm";break;case"notPosition":t="carStateMiss";break;case"offline":t="carStateOffLine";break;case"overSpeed":t="carStateOverSpeed";break;case"heartBeat":t="carStateheartbeat"}return t},e.prototype.iconSkin2Status=function(e){return e.indexOf("onlineParking")>-1?4:e.indexOf("onlineDriving")>-1?10:e.indexOf("warning")>-1?5:e.indexOf("onlineNotPositioning")>-1?2:e.indexOf("speedLimitWarning")>-1?9:e.indexOf("heartBeatWarning")>-1?11:3},e.prototype.destory=function(){this.state.$origin.empty()},e}(),L=a(204),D=a(207),F=a.n(D),P=(a(208),a(180),a(209)),N=a.n(P),O=[{title:"序号",name:"sequenceNumber",width:60,isSequence:!0},{title:"监控对象",name:"monitorName",width:120,maxWidth:200,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:!0},{title:"定位时间",name:"gpsTime",width:160,maxWidth:200,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:!0,render:function(e,t,a,n){if(e){var i=e.toString().split("");return"20"+i[0]+i[1]+"-"+i[2]+i[3]+"-"+i[4]+i[5]+" "+i[6]+i[7]+":"+i[8]+i[9]+":"+i[10]+i[11]}return"-"}},{title:"服务器时间",name:"uploadTime",width:160,maxWidth:200,minWidth:100,resizable:!0,sorter:!0,sortDirections:["ascend","descend"],render:function(e,t,a,n){if(e){var i=e.toString().split("");return"20"+i[0]+i[1]+"-"+i[2]+i[3]+"-"+i[4]+i[5]+" "+i[6]+i[7]+":"+i[8]+i[9]+":"+i[10]+i[11]}return"-"}},{title:"所属分组",name:"assignmentName",width:200,maxWidth:600,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:!0},{title:"所属企业",name:"groupName",width:100,maxWidth:200,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:!0},{title:"对象类型",name:"vehicleType",width:100,maxWidth:200,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:!0},{title:"标识颜色",name:"plateColorName",width:120,maxWidth:200,minWidth:80,resizable:!0,sortDirections:["ascend","descend"],sorter:!0},{title:"终端号",name:"deviceNumber",width:100,maxWidth:200,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:!0},{title:"终端手机号",name:"simcardNumber",width:140,maxWidth:200,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:!0},{title:"从业人员",name:"professionalsName",width:140,maxWidth:200,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:!0,render:function(e,t,a,n){return"-"===e&&(e=""),'<img src="/clbs/resources/img/search-list.svg" class="search-list" data-id="'+n.id+'" data-type="professionalsDetail"/>'+e}},{title:"ACC",name:"acc",width:80,maxWidth:200,minWidth:60,resizable:!0,sortDirections:["ascend","descend"],sorter:!0,render:function(e,t,a,n){return 1==(e+"").length?0==e?"<span style='color:#ff0000'>关</span>":"<span style='color:#00bfff'>开</span>":"21"==e?"点火静止":"16"==e?"熄火拖车":"1A"==e?"熄火假拖车":"11"==e?"熄火静止":"12"==e?"熄火移动":"22"==e?"点火移动":"41"==e?"无点火静止":"42"==e?"无点火移动":"-"}},{title:"对象状态",name:"objectState",width:200,maxWidth:300,minWidth:200,resizable:!0,sortDirections:["ascend","descend"],sorter:!0},{title:"信号状态",name:"signalState",width:100,maxWidth:200,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:!0,render:function(e,t,a,n){if(!e)return"-";var i=e.toString(2),r="";return 1==(i=(Array(32).join("0")+i).slice(-32)).substring(31,32)&&(r+="近光灯,"),1==i.substring(30,31)&&(r+="远光灯,"),1==i.substring(29,30)&&(r+="右转向灯,"),1==i.substring(28,29)&&(r+="左转向灯,"),1==i.substring(27,28)&&(r+="制动,"),1==i.substring(26,27)&&(r+="倒挡,"),1==i.substring(25,26)&&(r+="雾灯,"),1==i.substring(24,25)&&(r+="示廊灯,"),1==i.substring(23,24)&&(r+="喇叭,"),1==i.substring(22,23)&&(r+="空调开,"),1==i.substring(21,22)&&(r+="空挡,"),1==i.substring(20,21)&&(r+="缓速器工作,"),1==i.substring(19,20)&&(r+="ABS工作,"),1==i.substring(18,19)&&(r+="加热器工作,"),1==i.substring(17,18)&&(r+="离合器状态,"),""==r?"-":r}},{title:"速度(km/h)",name:"gpsSpeed",width:120,maxWidth:200,minWidth:60,resizable:!0,sortDirections:["ascend","descend"],sorter:window.numberSortFunction},{title:"方向",name:"direction",width:80,maxWidth:200,minWidth:60,resizable:!0,sortDirections:["ascend","descend"],sorter:!0,render:function(e,t,a,n){return e>=0&&e<=22.5||e>337.5&&e<=360?"北":e>22.5&&e<=67.5?"东北":e>67.5&&e<=112.5?"东":e>112.5&&e<=157.5?"东南":e>157.5&&e<=202.5?"南":e>202.5&&e<=247.5?"西南":e>247.5&&e<=292.5?"西":e>292.5&&e<=337.5?"西北":"-"}},{title:"电池电压",name:"batteryVoltage",width:100,maxWidth:200,minWidth:80,resizable:!0,sortDirections:["ascend","descend"],sorter:window.numberSortFunction},{title:"信号强度",name:"signalStrength",width:100,maxWidth:200,minWidth:80,resizable:!0,sortDirections:["ascend","descend"],sorter:!0},{title:"定位方式",name:"locationType",width:100,maxWidth:200,minWidth:80,resizable:!0,sortDirections:["ascend","descend"],sorter:!0,render:function(e,t,a,n){return 0==e?"卫星+基站定位":1==e?"基站定位":2==e?"卫星定位":3==e?"WIFI+基站定位":4==e?"卫星+WIFI+基站定位":"-"}},{title:"卫星颗数",name:"satellitesNumber",width:100,maxWidth:200,minWidth:80,resizable:!0,sortDirections:["ascend","descend"],sorter:!0},{title:"终端当日里程(km)",name:"terminalDayMileage",width:170,maxWidth:200,minWidth:80,resizable:!0,sortDirections:["ascend","descend"],sorter:window.numberSortFunction},{title:"终端总里程(km)",name:"terminalTotalMileage",width:170,maxWidth:200,minWidth:80,resizable:!0,sortDirections:["ascend","descend"],sorter:window.numberSortFunction},{title:"CAN油量(L)",name:"gpsOil",width:120,maxWidth:200,minWidth:80,resizable:!0,sortDirections:["ascend","descend"],sorter:window.numberSortFunction},{title:"高程",name:"altitude",width:80,maxWidth:200,minWidth:80,resizable:!0,sortDirections:["ascend","descend"],sorter:window.numberSortFunction},{title:"路网限速",name:"roadLimitSpeed",width:120,maxWidth:200,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:window.numberSortFunction},{title:"道路类型",name:"roadType",width:120,maxWidth:200,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:window.numberSortFunction},{title:"记录仪速度",name:"grapherSpeed",width:120,maxWidth:200,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:window.numberSortFunction,render:function(e,t,a,n){return e||"-"}},{title:"经度",name:"longitude",width:120,maxWidth:200,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:window.numberSortFunction},{title:"纬度",name:"latitude",width:120,maxWidth:200,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:window.numberSortFunction},{title:"位置",name:"positionDescription",width:400,maxWidth:700,minWidth:200,resizable:!0,render:function(e,t,a,n){return 0==e?'<a class="getPosition" href="#" data-id="'+n.id+'">点击获取位置信息</a>':e}},{title:"传感器液体量(L)",name:"oilMass",width:150,maxWidth:200,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:!0,render:function(e,t,a,n){if(null==e)return"";for(var i="",r=0;r<e.length;r++)1===e[r].unusual?i+="异常":null!==e[r].oilMass&&void 0!==e[r].oilMass&&(i+=e[r].oilMass.toString()),r!==e.length-1&&(i+=",");return i}},{title:"传感器当日油耗(L)",name:"dayOilWear",width:160,maxWidth:200,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:!0},{title:"传感器总油耗(L)",name:"oilExpend",width:150,maxWidth:200,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:!0,render:function(e,t,a,n){if(void 0===n.oilExpend||null===n.oilExpend)return"";var i="";n.oilExpend=n.oilExpend.sort((function(e,t){return e.id-t.id}));for(var r=0;r<n.oilExpend.length;r++)1===e[r].unusual?i+="异常":null!==n.oilExpend[r].allExpend&&void 0!==n.oilExpend[r].allExpend&&(i+=n.oilExpend[r].allExpend.toString()),r!==n.oilExpend.length-1&&(i+=",");return i}},{title:"电量电压",name:"elecData",width:150,maxWidth:200,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:!0,render:function(e,t,a,n){if(null==e)return"";var i="";return void 0!==e.deviceElectricity&&null!==e.deviceElectricity&&(1===e.unusual?i+="异常":i+=e.deviceElectricity.toString()+","),void 0!==e.drivingElectricity&&null!==e.drivingElectricity&&(1===e.unusual?i+="异常":i+=e.drivingElectricity.toString()+","),void 0!==e.coldStorageElectricity&&null!==e.coldStorageElectricity&&(1===e.unusual?i+="异常":e.coldStorageElectricity<=100&&(i+=e.coldStorageElectricity.toString()+",")),i.lastIndexOf(",")===i.length-1&&(i=i.substr(0,i.length-1)),i}},{title:"传感器温度(℃)",name:"temperatureSensor",width:150,maxWidth:200,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:!0,render:function(e,t,a,n){if(null==e)return"";for(var i="",r=0;r<e.length;r++)1===e[r].unusual?i+="异常":null!==e[r].temperature&&void 0!==e[r].temperature&&(i+=e[r].temperature.toString()),r!==e.length-1&&(i+=",");return i}},{title:"传感器湿度(%)",name:"temphumiditySensor",width:150,maxWidth:200,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:!0,render:function(e,t,a,n){if(null==e)return"";for(var i="",r=0;r<e.length;r++)1===e[r].unusual?i+="异常":null!==e[r].temperature&&void 0!==e[r].temperature&&(i+=e[r].temperature.toString()),r!==e.length-1&&(i+=",");return i}},{title:"传感器正反转状态",name:"positiveNegative",width:160,maxWidth:200,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:!0,render:function(e,t,a,n){if(null==e)return"";for(var i="",r=0;r<e.length;r++){var s="";s=1===e[r].spinState?"停转":1===e[r].spinDirection?"正转":"反转",1===e[r].unusual?i+="异常":i+=s,r!==e.length-1&&(i+=",")}return i}},{title:"传感器当日里程(km)",name:"sensorDayMileage",width:180,maxWidth:200,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:!0},{title:"传感器总里程(km)",name:"sensorTotalMileage",width:160,maxWidth:200,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:!0},{title:"传感器载荷重量(kg)",name:"loadInfos",width:180,maxWidth:200,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:!0,render:function(e,t,a,n){if(null==e)return"";for(var i="",r=0;r<e.length;r++)1===e[r].unusual?i+="异常":e[r].loadWeight&&(i+=e[r].loadWeight.toString()),r!==e.length-1&&(i+=",");return i}},{title:"传感器工时状态",name:"workHourSensor",width:150,maxWidth:200,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:!0,render:function(e,t,a,n){if(null==e)return"";for(var i="",r=0;r<e.length;r++){var s="";0===e[r].workInspectionMethod||1===e[r].workInspectionMethod?0===e[r].workingPosition?s="停机":1===e[r].workingPosition?s="工作":2===e[r].workingPosition&&1===e[r].workInspectionMethod&&(s="待机"):2===e[r].workInspectionMethod&&(0===e[r].workingPosition?s="停机":1===e[r].workingPosition&&(s="非停机")),1===e[r].unusual?i+="异常":i+=s,r!==e.length-1&&(i+=",")}return i}},{title:"终端IO状态",name:"terminalIOStatus",width:150,maxWidth:200,minWidth:100,resizable:!0,render:function(e,t,a,n){return'<img src="/clbs/resources/img/search-list.svg" class="search-list" data-id="'+n.id+'" data-type="terminalIo"/>'}},{title:"传感器IO状态",name:"sensorIOStatus",width:150,maxWidth:200,minWidth:100,resizable:!0,render:function(e,t,a,n){return'<img src="/clbs/resources/img/search-list.svg" class="search-list" data-id="'+n.id+'" data-type="sensorIo"/>'}},{title:"传感器轮胎气压(bar)",name:"tyreInfos",width:180,maxWidth:700,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:!0,render:function(e,t,a,n){if(null==e)return"";if(1===e.unusual)return"异常";if(void 0===e.list||null===e.list)return"";for(var i="",r=e.list,s=0;s<r.length;s++)i+=r[s].pressure.toString(),s!==r.length-1&&(i+=",");return i}},{title:"限速值 (km/h)",name:"driverSpeedLimit",width:80,maxWidth:200,minWidth:60,resizable:!0},{title:"",name:"empty",width:40}],R=[{title:"序号",name:"sequenceNumber",width:60,isSequence:!0},{title:"监控对象",name:"monitorName",width:120,maxWidth:200,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:!0},{title:"报警开始时间",name:"alarmTime",width:160,maxWidth:200,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:!0},{title:"报警结束时间",name:"alarmEndTime",width:160,maxWidth:200,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:!0},{title:"处理状态",name:"handleStatus",width:160,maxWidth:200,minWidth:100,resizable:!0,render:function(e,t,a,n){return 0===e?"22"==n.deviceType?"未处理":'<a class="handleStatusDeal" href="#" data-id="'+n.id+'">未处理</a>':"已处理"}},{title:"所属分组",name:"assignmentName",width:200,maxWidth:600,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:!0},{title:"对象类型",name:"vehicleType",width:100,maxWidth:200,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:!0,render:function(e,t,a,n){return 0===e?"车":1==e?"人":"物"}},{title:"标识颜色",name:"plateColorName",width:120,maxWidth:200,minWidth:80,resizable:!0,sortDirections:["ascend","descend"],sorter:!0},{title:"报警类型",name:"alarmType",width:200,maxWidth:700,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:!0,render:function(e,t,a,n){return n.description}},{title:"报警开始速度",name:"speed",width:200,maxWidth:700,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:!0},{title:"行车记录仪速度",name:"recorderSpeed",width:200,maxWidth:700,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:!0},{title:"驾驶员",name:"professionalsName",width:140,maxWidth:200,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:!0},{title:"驾驶证号",name:"drivingLicenseNo",width:100,maxWidth:200,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:!0},{title:"围栏类型",name:"defenceType",width:100,maxWidth:200,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:!0},{title:"围栏名称",name:"defenceName",width:200,maxWidth:300,minWidth:200,resizable:!0,sortDirections:["ascend","descend"],sorter:!0},{title:"路网限速",name:"roadLimitSpeed",width:120,maxWidth:200,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:window.numberSortFunction},{title:"道路类型",name:"roadType",width:120,maxWidth:200,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:window.numberSortFunction},{title:"经度",name:"longtitude",width:120,maxWidth:200,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:window.numberSortFunction},{title:"纬度",name:"latitude",width:120,maxWidth:200,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:window.numberSortFunction},{title:"报警位置",name:"alarmPosition",width:400,maxWidth:700,minWidth:200,resizable:!0,sortDirections:["ascend","descend"],sorter:!1,render:function(e,t,a,n){return 0==e?'<a class="getPosition" href="#" data-id="'+n.id+'">点击获取位置信息</a>':e}},{title:"",name:"empty",width:40}],z=[{title:"序号",name:"sequenceNumber",width:60,isSequence:!0},{title:"操作",name:"ope",width:250,className:"ope-buttons",render:function(e,t,a,n){return'<button type="button" class="editBtn editBtn-security security-deal" data-id="'+n.id+'">处理</button><button style="margin-left: 10px;" type="button" class="editBtn editBtn-security security-video" data-row="'+JSON.stringify(n).replace(/"/g,"'")+'">实时视频</button>'}},{title:"监控对象",name:"brand",width:160,maxWidth:200,minWidth:120,resizable:!0,sortDirections:["ascend","descend"],sorter:!0},{title:"驾驶员",name:"driverName",width:160,maxWidth:200,minWidth:120,resizable:!0,sortDirections:["ascend","descend"],sorter:!0},{title:"驾驶证号",name:"drivingLicenseNo",width:220,maxWidth:200,minWidth:120,resizable:!0,sortDirections:["ascend","descend"],sorter:!0},{title:"报警类型",name:"riskType",width:200,maxWidth:700,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:!0},{title:"报警等级",name:"riskLevel",width:160,maxWidth:200,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:!0,render:function(e){if(!e)return"";switch(Number(e)){case 1:return"一般(低)";case 2:return"一般(中)";case 3:return"一般(高)";case 4:return"较重(低)";case 5:return"较重(中)";case 6:return"较重(高)";case 7:return"严重(低)";case 8:return"严重(中)";case 9:return"严重(高)";case 10:return"特重(低)";case 11:return"特重(中)";case 12:return"特重(高)";default:return""}}},{title:"速度",name:"speed",width:120,maxWidth:200,minWidth:60,resizable:!0,sortDirections:["ascend","descend"],render:function(e){return e+"km/h"}},{title:"报警位置",name:"address",width:500,maxWidth:700,minWidth:200,resizable:!0,sortDirections:["ascend","descend"],sorter:!0,render:function(e,t,a,n){return e||"未定位"}},{title:"开始报警时间",name:"warningTime",width:200,maxWidth:300,minWidth:160,resizable:!0,sortDirections:["ascend","descend"],sorter:!0},{title:"结束报警时间",name:"warningEndTime",width:200,maxWidth:300,minWidth:160,resizable:!0,sortDirections:["ascend","descend"],sorter:!0},{title:"视频/图片",name:"picVideo",width:200,maxWidth:300,minWidth:160,resizable:!0,render:function(e,t,a,n){var i="";return 1==n.picFlag?i+='<img class="hasInfo" src="/clbs/resources/img/previewimg-blue.svg" data-id="'+n.id+'" data-type="0" width="20" alt="图片"> ':i+='<img class="hasNotInfo" src="/clbs/resources/img/previewimg-grey.svg" width="20" alt="图片"> ',1==n.videoFlag?i+='<img class="hasInfo" src="/clbs/resources/img/video-blue.svg" data-id="'+n.id+'" data-type="2" width="20" alt="视频">':i+='<img class="hasNotInfo" src="/clbs/resources/img/video-grey.svg" width="20" alt="视频">',i}},{title:"",name:"empty",width:40}],E=[{name:"gpsTime",title:"时间"},{name:"monitorName",title:"监控对象"},{name:"deviceNumber",title:"终端号"},{name:"simcardNumber",title:"终端手机号"},{name:"travelState",title:"行驶状态"},{name:"gpsSpeed",title:"行驶速度"},{name:"formattedAddress",title:"位置"},{name:"groupName",title:"所属企业"},{name:"assignmentName",title:"所属分组"},{name:"monitorType",title:"对象类型"},{name:"acc",title:"ACC状态"},{name:"todayMileage",title:"当日里程"},{name:"longitudeAndLatitude",title:"经纬度"},{name:"allMileage",title:"总里程"},{name:"direction",title:"方向"},{name:"grapherSpeed",title:"记录仪速度"},{name:"altitude",title:"高程"},{name:"electronicWaybill",title:"电子运单"},{name:"professionalsName",title:"从业人员"},{name:"idCardNo",title:"身份证号"},{name:"identity",title:"从业资格证号"},{name:"tcb",title:"发证机构"},{name:"operatingState",title:"运营状态"},{name:"alarmType",title:"报警类型"},{name:"roadType",title:"道路类型"},{name:"roadLimitSpeed",title:"路网限速"},{name:"oilStatus",title:"油路状态"},{name:"circuitStatus",title:"电路状态"},{name:"carDoorStatus",title:"车门状态"}],V=function(e,t,a,n){return new(a||(a=Promise))((function(i,r){function s(e){try{l(n.next(e))}catch(e){r(e)}}function o(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(s,o)}l((n=n.apply(e,t||[])).next())}))},B=function(e,t){var a,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function o(r){return function(o){return function(r){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],n=0}finally{a=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,o])}}},j=function(){for(var e=0,t=0,a=arguments.length;t<a;t++)e+=arguments[t].length;var n=Array(e),i=0;for(t=0;t<a;t++)for(var r=arguments[t],s=0,o=r.length;s<o;s++,i++)n[i]=r[s];return n},W=function(){function e(e,t){var a=this;this.professionalsDetail=function(e){json_ajax("POST","/clbs/v/monitoring/getRiskProfessionalsInfo","json",!1,{vehicleId:e},(function(e){a.state.data.scrollIndex=0,a.state.data.scrollNum=0,a.state.data.lockType=!1,$("#professionalsInfoScrollCont").removeAttr("style");var t=a.state.data.infoScrollBoxW,n="";if(e.success&&e.obj.length){e=e.obj;$("#professionalsInfoScrollCont").css("width",t*e.length+"px"),a.state.data.scrollNum=e.length;for(var i=(new Date).getTime(),r=0;r<e.length;r++)e[r]?(e[r].icCardEndDateStr&&e[r].icCardEndDateStr,n+='<div class="col-md-12 singleInfoCont" style="width:'+t+'px;"><div class="col-md-2 driverPhoto"><img src='+activeSafety.handleImgSrc(e[r].photograph)+"?t="+i+'></div><div class="col-md-10 infoCont"><div class="col-md-5">司机姓名：'+activeSafety.handleHtml(e[r].name)+'</div><div class="col-md-7">岗位类型：'+activeSafety.handleHtml(e[r].type)+'</div><div class="col-md-5">手机号：'+activeSafety.handleHtml(e[r].phone)+'</div><div class="col-md-7">身份证号：'+activeSafety.handleHtml(e[r].identity)+'</div><div class="col-md-12">所属企业：'+activeSafety.handleHtml(e[r].groupName)+'</div><div class="col-md-12">从业资格证号：'+activeSafety.handleHtml(e[r].cardNumber)+'</div><div class="col-md-12">从业资格类别：'+activeSafety.handleHtml(e[r].qualificationCategory)+'</div><div class="col-md-12">发证机关：'+activeSafety.handleHtml(e[r].icCardAgencies)+'</div><div class="col-md-12">有效期至：'+activeSafety.handleHtml(e[r].icCardEndDateStr)+"</div></div></div>"):n+='<div class="col-md-12 singleInfoCont" style="width:'+t+'px;"><div class="col-md-2 driverPhoto"><img src="/clbs/resources/img/peoplems.png"/></div><div class="col-md-10 infoCont"><div class="col-md-5">司机姓名：未知</div><div class="col-md-7">岗位类型：未知</div><div class="col-md-5">手机号：未知</div><div class="col-md-7">身份证号：未知</div><div class="col-md-12">所属企业：未知</div><div class="col-md-12">从业资格证号：未知</div><div class="col-md-12">从业资格类别：未知</div><div class="col-md-12">发证机关：未知</div><div class="col-md-12">有效期至：未知</div></div></div>';e.length>0&&e[0]&&1==e[0].lockType&&(a.state.data.lockType=!0),$("#professionalsDetail .nextBtnBox").off().click((function(){a.scrollLeftAnimate()})),$("#professionalsDetail .prevBtnBox").off().click((function(){a.scrollRightAnimate()})),$("#professionalsInfoScrollCont").html(n),$("#professionalsDetail").modal("show")}else layer.msg("未绑定从业人员")}))},this.scrollLeftAnimate=function(){var e=a.state.data,t=e.infoScrollBoxW,n=e.scrollIndex;n<e.scrollNum-1&&(a.state.data.scrollIndex++,$("#professionalsInfoScrollCont").css("left","-"+(n+1)*t+"px"))},this.scrollRightAnimate=function(){var e=a.state.data,t=e.infoScrollBoxW,n=e.scrollIndex;e.scrollNum;n>0&&(a.state.data.scrollIndex--,$("#professionalsInfoScrollCont").css("left","-"+(n-1)*t+"px"))},this.dependency=t,this.setOption(e)}return e.prototype.setOption=function(e){this.option=e,this.state={$origin:null,$dom:{$tableRightMenu:null,$activeSafetyPop:null,$eventMediaModal:null},data:{alarmTypeList:["1","2","4","5","6","7","8","9","10","11","12","13","14","29","30","18","19","23","24","25","26"],allOrderKey:["TGAC_REALTIME_MONITORING_LIST","TGAC_REALTIME_MONITORING_ALARM_LIST","TGAC_REALTIME_MONITORING_ACTIVE_SAFETY_LIST","TGAC_AlERT_WINDOW_REALTIME_DATA_LIST","TGAC_RAPID_SCREENING"],columnKeys:["TGAC_REALTIME_MONITORING_LIST","TGAC_REALTIME_MONITORING_ALARM_LIST","TGAC_REALTIME_MONITORING_ACTIVE_SAFETY_LIST","TGAC_AlERT_WINDOW_REALTIME_DATA_LIST"],dragBar:null,securityDatas:null,statusDatas:null,alarmDatas:null,securityCurDatas:null,statusColumns:O,alarmColumns:R,securityColumns:z,popupColumns:E,statusTable:null,alarmTable:null,securityTable:null,ifLoadPageData:!0,isUpdateTable:!1,lastAlarmTime:"",latestAlarmTime:"",latestAlarm:null,lastAlarm:null,partRefreshTimer:null,securityCurrentPage:1,securityExstAlarmIds:[],lastLockedRowId:void 0,lastClickRowId:void 0,safetyTimer:null,riskIdGloabal:null,multimediaFlag:!1,MediaInfoId:"",EventMediaInfoId:"",eventMediaPicArr:[],eventMediaVideoArr:[],eventMediaVideoSingNum:0,eventMediaPicSingNum:0,ifPicOrVideo:"",rightClickRowId:null,statusScrollTimer:null,scrollNum:3,scrollIndex:0,infoScrollBoxW:641,lockType:!1,webWorker:null,sortColumnIndex:null,sortDirection:null,statusClickTimer:null,lastStatusHoverField:null,lastStatusHoverRowId:null}},this.state.$origin=$(e.selector),this.initHtml(),this.bindEvent(),this.initRender(),this.initDragBar()},e.prototype.initHtml=function(){var e=$(F.a);this.state.$origin.empty(),this.state.$origin.append(e),this.state.$dom.$tableRightMenu=$("#tableRightMenu"),this.state.$dom.$activeSafetyPop=$("#activeSafetyPop"),this.state.$dom.$eventMediaModal=$("#eventMediaModal")},e.prototype.bindEvent=function(){var e=this,t=this,a=t.state.$dom.$activeSafetyPop,n=t.state.$dom.$eventMediaModal,i=this.dependency.get("data");this.state.data.webWorker=new Worker("/clbs/resources/lkyw/webWorker/componentTable.js"),this.state.data.webWorker.onmessage=this.handleWebWorkerMessage.bind(this),i.on("onCustomColumnsStatuChange",t.onColumnsChange.bind(t)),i.on("onSecurityAlarmTypeChange",t.securityAlarmTypeChange.bind(t)),i.on("onTerminalAlarmTypeChange",t.terminalAlarmTypeChange.bind(t)),$("#securityTableWrap").on("click",".security-deal",t.securityDeal.bind(t)),$("#securityTableWrap").on("click",".security-video",t.lookRealTimeVideo.bind(t)),$("#securityTableWrap").on("click",".hasInfo",t.riskMediaClick.bind(t)),n.on("show.bs.modal",(function(){$("#img").prop("disabled",!1),$("#img").removeClass("disabled"),$("#video").removeClass("disabled"),$("#video").prop("disabled",!1)})),a.on("click",".loadAccessory",t.getAccessoryDownLoad.bind(t)),a.on("click",".getAccessory",t.getAccessoryRequest.bind(t)),a.on("click","#closePopover",t.closePopover.bind(t)),a.on("click",".eventhasInfo",(function(e){var a=$(e.target),n=a.attr("data-eventId"),i=a.attr("data-idx");if(!n.length||!i.length)return!1;t.getEventMediaInfo(n,i,e)})),n.on("click",".nextMedia",t.nextMedia.bind(t)),n.on("click",".prevMedia",t.prevMedia.bind(t)),n.on("click",".media_tab .btn",t.videoChange.bind(t)),$("#waringTableWrap").on("click",".handleStatusDeal",this.handleHandleStatusClick.bind(this)),$("#warningManageListening").on("click",this.getListen.bind(this)),$("#warningManagePhoto").on("click",this.getPhoto.bind(this)),$("#warningManageSend").on("click",this.send.bind(this)),$("#warningManageAffirm").on("click",(function(){return e.handleAlarm("人工确认报警")})),$("#warningManageCancel").on("click",(function(){return e.handleAlarm("不做处理")})),$("#warningManageFuture").on("click",(function(){return e.handleAlarm("将来处理")})),$("#goListeningForAlarm").bind("click",this.listenForAlarm.bind(this)),$("#goPhotographsForAlarm").bind("click",this.takePhotoForAlarm.bind(this)),$("#goTxtSendForAlarm").bind("click",this.goTxtSendForAlarm.bind(this)),$("#waringTableWrap").on("click",".getPosition",t.getAlarmAdreessInfo.bind(t)),this.state.$dom.$tableRightMenu.on("click",this.handleRightMenuClick.bind(this)),$("#statusTableWrap").on("click",".getPosition",t.getVehicleAdreessInfo.bind(t)),$("#statusTableWrap").on("click",".search-list",t.terminalIOClick.bind(t))},e.prototype.getEventMediaInfo=function(e,t,a){return V(this,void 0,void 0,(function(){var n,i,r;return B(this,(function(s){switch(s.label){case 0:return this.state.data.multimediaFlag=!1,this.state.data.EventMediaInfoId=e,window.event?window.event.cancelBubble=!0:a.stopPropagation(),layer.load(2),[4,Promise.all([this.getEventMedias(e,"0"),this.getEventMedias(e,"2")])];case 1:return n=s.sent(),i=n[0],r=n[1],0==i.length&&setTimeout((function(){$("#img").prop("disabled",!0)})),0==r.length&&setTimeout((function(){$("#video").prop("disabled",!0)})),this.handleMediaInfo(t,[i,r]),layer.closeAll("loading"),[2]}}))}))},e.prototype.tableRightMenu=function(e,t,a,n){return this.state.data.rightClickRowId=e,this.state.$dom.$tableRightMenu.css({top:n.clientY-200+"px",left:n.clientX+20+"px"}).show(),!1},e.prototype.initRender=function(){return V(this,void 0,void 0,(function(){return B(this,(function(e){switch(e.label){case 0:return[4,this.initNeedQueryAlarmMonitorIds()];case 1:return e.sent(),[4,this.getTableColumnsSetting()];case 2:return e.sent(),this.initTable(!1),this.statusAllRefresh(),this.renderAlarmTable(),this.renderSecurityTable(),[2]}}))}))},e.prototype.initNeedQueryAlarmMonitorIds=function(){return V(this,void 0,void 0,(function(){var e;return B(this,(function(t){switch(t.label){case 0:return[4,r.a.post("/clbs/lkyw/v/monitoring/initNeedQueryAlarmMonitorIds",null)];case 1:return 200===(e=t.sent()).status||e.data.success||layer.msg("查询报警的监控对象id失败!"),[2]}}))}))},e.prototype.renderAlarmTable=function(){return V(this,void 0,void 0,(function(){var e;return B(this,(function(t){switch(t.label){case 0:return[4,this.getAlarmDatas()];case 1:return e=t.sent(),this.state.data.isUpdateTable?(this.state.data.alarmDatas.concat(e),this.state.data.alarmTable.appendOptionData(e)):(this.state.data.alarmDatas=e,this.state.data.alarmTable.replaceOptionData(e)),this.state.data.ifLoadPageData=!0,this.state.data.isUpdateTable=!1,e.length>0&&this.getExistAlarm(e),[2]}}))}))},e.prototype.renderSecurityTable=function(){return V(this,void 0,void 0,(function(){var e;return B(this,(function(t){switch(t.label){case 0:return[4,this.getSecurityDatas()];case 1:return e=t.sent(),this.state.data.securityCurDatas=e,0==this.state.data.securityExstAlarmIds.length?(this.state.data.securityDatas=e,this.state.data.securityTable.replaceOptionData(e)):(this.state.data.securityDatas.concat(e),this.state.data.securityTable.appendOptionData(e)),this.state.data.ifLoadPageData=!0,e.length>0&&this.getExistSecurityAlarmIds(e),[2]}}))}))},e.prototype.getTableColumnsSetting=function(){return V(this,void 0,void 0,(function(){var e,t,a,n,i,s,o,l,d,c,p,u,h,m,v,g,f,b;return B(this,(function(y){switch(y.label){case 0:return e=this.dependency.get("data"),t=this.state.data,a=t.allOrderKey,n=t.columnKeys,(i=new FormData).set("marks",a.join(",")),[4,r.a.post("/clbs/core/uum/custom/findCustomColumnInfoByMark",i)];case 1:if(200==(s=y.sent()).status){if(o=s.data.obj,l=[$.extend({},O[0])],d=[$.extend({},R[0])],c=[$.extend({},z[0])],p=[],o){for(u=[l,d,c,p],h=[O,R,z,E],e.set("tableFilterColumns",o.TGAC_RAPID_SCREENING),m=0;m<n.length;m++)if(v=n[m],g=o[v])for(f=function(e){var t=g[e],a=h[m].find((function(e){return e.name===t.columnName}));if(void 0!==a){var n=$.extend({},a);1===t.isFix&&(n.isFrozen=!0),u[m].push(n)}},b=0;b<g.length;b++)f(b);l.push(O[O.length-1]),d.push(R[R.length-1]),c.push(z[z.length-1])}this.state.data.statusColumns=l,this.state.data.alarmColumns=d,this.state.data.securityColumns=c,this.state.data.popupColumns=p,e.set("popupColumns",p)}return[2]}}))}))},e.prototype.onColumnsChange=function(){return V(this,void 0,void 0,(function(){return B(this,(function(e){switch(e.label){case 0:return[4,this.getTableColumnsSetting()];case 1:return e.sent(),this.initTable(!0),[2]}}))}))},e.prototype.statusAllRefresh=function(){this.postMessage("statusDatas",[])},e.prototype.postMessage=function(e,t){this.state.data.webWorker.postMessage({cmd:e,params:{monitorIds:t.toString(),userName:l.get("userName")}})},e.prototype.handleWebWorkerMessage=function(e){var t=e.data.cmd,a=e.data.res;switch(t){case"statusDatas":this.renderStatusTable(a);break;case"partStatusDatas":this.renderPartStatusTable(a);break;case"statusSort":this.renderStatusSort(a);break;case"timeout":layer.closeAll(),layer.msg("加载超时，请重试")}},e.prototype.renderStatusTable=function(e){e.length>0&&this.state.data.dragBar.setDelta(-242),this.state.data.statusDatas=e,this.state.data.statusTable.replaceOptionData(e),this.setLocaleRefreshTimer()},e.prototype.renderPartStatusTable=function(e){for(var t=this.state.data.statusDatas,a=this.state.data.statusTable.getState(),n=a.visibleStartIndex,i=a.visibleEndIndex,r=n;r<i;r++)for(var s=t[r],o=0;o<e.length;o++){var l=e[o];l.id===s.id&&(t[r]=l)}for(r=0;r<e.length;r++){var d=e[r];this.state.data.statusTable.updateOptionData(d)}},e.prototype.renderStatusSort=function(e){var t=this.state.data,a=t.statusTable,n=t.sortColumnIndex,i=t.sortDirection,r=a.getOption();r.data=e;for(var s=0;s<r.columns.length;s++){var o=r.columns[s];s==n?o.defaultSortOrder=i:delete o.defaultSortOrder}a.setOption(r),a.render(),layer.closeAll(),this.state.data.statusDatas=a.getState().data},e.prototype.setLocaleRefreshTimer=function(){this.closeLocalTimer(),this.state.data.partRefreshTimer=setTimeout(this.localRefresh.bind(this),3e4)},e.prototype.closeLocalTimer=function(){var e=this.state.data.partRefreshTimer;e&&(clearTimeout(e),this.state.data.partRefreshTimer=null)},e.prototype.localRefresh=function(){this.setLocaleRefreshTimer();var e=this.state.data.statusDatas,t=this.state.data.statusTable.getState(),a=t.visibleStartIndex,n=t.visibleEndIndex;if(a||0==a){var i=e.slice(a,n).map((function(e){return e.id}));this.postMessage("partStatusDatas",i)}},e.prototype.initTable=function(e){var t=this.state.data,a=t.statusColumns,n=t.alarmColumns,i=t.securityColumns,r=t.statusDatas,s=t.alarmDatas,o=t.securityDatas,l=this.countTableWidth(a),d={tableId:"tableStatus",data:e?r:[],columns:a,freezeHead:!0,freezeColumn:l.freezeColumn,getUniqueId:"id",width:l.width,cancelActiveRow:!0,clickMeansActive:!0,dblClickMeansLock:!0,handleTdRightClick:this.tableRightMenu.bind(this),virtualRender:!0,visibleRowsCount:50,scrollThreshold:30,activeScrollDuration:0,handleScroll:this.statusScrollPage.bind(this),handleTdClick:this.handleStatusTableClick.bind(this),handleTdDblClick:this.handleStatusTableDblClick.bind(this),customHandleSort:this.customHandleStatusSort.bind(this),handleTdHover:this.handleStatusTableHover.bind(this)};this.state.data.statusTable=$("#statusTableWrap").itable(d);var c=this.countTableWidth(n),p={tableId:"tableAlarm",data:e?s:[],columns:n,freezeHead:!0,freezeColumn:c.freezeColumn,getUniqueId:"id",width:c.width,cancelActiveRow:!0,clickMeansActive:!0,dblClickMeansLock:!0,handleTdRightClick:this.tableRightMenu.bind(this),handleScroll:this.alarmScrollPage.bind(this)};this.state.data.alarmTable=$("#waringTableWrap").itable(p);var u=this.countTableWidth(i),h={tableId:"tableSecurity",data:e?o:[],columns:i,freezeHead:!0,freezeColumn:u.freezeColumn,getUniqueId:"id",width:u.width,cancelActiveRow:!0,clickMeansActive:!0,dblClickMeansLock:!0,handleTdRightClick:this.tableRightMenu.bind(this),handleTdClick:this.handleSecurityTableClick.bind(this),handleScroll:this.securityScrollPage.bind(this)};this.state.data.securityTable=$("#securityTableWrap").itable(h),e&&(this.state.data.statusTable.render(),this.state.data.alarmTable.render(),this.state.data.securityTable.render())},e.prototype.countTableWidth=function(e){for(var t=0,a=!1,n=0;n<e.length;n++){var i=e[n];t+=i.width,i.isFrozen&&!a&&(a=!0),i.isFrozen&&(i.resizable=!1)}return a&&(e[0].isFrozen=!0),{width:t,freezeColumn:a}},e.prototype.formatDuring=function(e){var t=parseInt((e/864e5).toString()),a=parseInt((e%864e5/36e5).toString()),n=parseInt((e%36e5/6e4).toString()),i=parseInt((e%6e4/1e3).toString());return 0===t&&0===a&&0==n?i+" 秒 ":0===t&&0===a&&0!==n?n+" 分 "+i+" 秒 ":0===t&&0!==a?a+" 小时 "+n+" 分 "+i+" 秒 ":0!==t?t+" 天 "+a+" 小时 "+n+" 分 "+i+" 秒 ":void 0},e.prototype.toFixed=function(e,t){if(void 0===t&&(t=1),e||0==e)return parseFloat(Number(e).toFixed(1))},e.prototype.isEmpty=function(e,t){return void 0===t&&(t="-"),null==e||null==e||""==e?t:e},e.prototype.getAlarmDatas=function(){return V(this,void 0,void 0,(function(){var e,t,a,n,i,s,o,l,d,c,p,u,h,m,v,g;return B(this,(function(f){switch(f.label){case 0:return e=this.state.data,t=e.lastAlarm,a=e.latestAlarm,n=e.latestAlarmTime,i=e.lastAlarmTime,s=this.dependency.get("data").get("terminalAlarmType"),o=s||"",l=this.dependency.get("data").get("terminalAlarmMarker"),d=l||"808Alarm",(c=new FormData).set("latestTime",n.toString()),c.set("latestAlarmDataStr",a?a.join(","):""),c.set("oldestTime",i.toString()),c.set("oldestAlarmDataStr",t?t.join(","):""),c.set("alarmTypeStr",o),c.set("mark",d),layer.load(2),[4,r.a.post("/clbs/lkyw/v/monitoring/getTodayAlarmRecord",c)];case 1:if(200==(p=f.sent()).status){for(u=p.data.obj?p.data.obj:[],h=[],m=0;m<u.length;m++)v=u[m],{},g={sequenceNumber:0,monitorName:v.monitorName,speed:v.speed,recorderSpeed:v.recorderSpeed,alarmTime:v.startTime,alarmEndTime:v.endTime,handleStatus:v.status,assignmentName:v.assignmentName,vehicleType:v.monitorType,plateColorName:v.plateColorString,alarmType:v.alarmType,description:v.description,professionalsName:v.employeeName,drivingLicenseNo:v.drivingLicenseNo,defenceType:v.fenceType,defenceName:v.fenceName,roadLimitSpeed:v.roadNetSpeedLimit,roadType:v.roadTypeStr,longtitude:v.alarmStartLongitude,latitude:v.alarmStartLatitude,alarmPosition:0,simCardNumber:v.simCardNumber,deviceNumber:v.deviceNumber,swiftNumber:v.swiftNumber,alarmSource:v.alarmSource,vehicleId:v.monitorId,id:v.id,deviceType:v.item,alarmStartTime:v.alarmStartTime},h.push(g);return layer.closeAll("loading"),[2,h]}return[2]}}))}))},e.prototype.terminalAlarmTypeChange=function(){this.state.data.ifLoadPageData=!0,this.state.data.isUpdateTable=!1,this.state.data.latestAlarmTime="",this.state.data.lastAlarmTime="",this.state.data.latestAlarm=null,this.state.data.lastAlarm=null,this.renderAlarmTable()},e.prototype.alarmScrollPage=function(e){var t=this.state.data,a=t.alarmTable,n=t.ifLoadPageData,i=a.rightTable?a.rightTable.getState().$dom.$table:a.getState().$dom.$table,r=a.rightTable?a.rightTable.getState().$dom.$inner:a.getState().$dom.$inner;if(i.height()-r.innerHeight()-r.scrollTop()<=0){if(!n)return;this.state.data.ifLoadPageData=!1,this.state.data.isUpdateTable=!0,this.renderAlarmTable()}},e.prototype.getExistAlarm=function(e){for(var t=0;t<e.length;t++){var a=this.state.data,n=a.latestAlarmTime,i=a.lastAlarmTime,r=e[t].alarmTime;(""==i||r<i)&&(this.state.data.lastAlarmTime=r,this.state.data.lastAlarm=[]),r>n&&(this.state.data.latestAlarmTime=r,this.state.data.latestAlarm=[])}this.getExistAlarmItem(e)},e.prototype.getExistAlarmItem=function(e){var t=this.state.data,a=t.latestAlarmTime,n=t.lastAlarmTime;if(a&&n)for(var i=0;i<e.length;i++){var r=this.state.data,s=r.latestAlarmTime,o=r.lastAlarmTime,l=e[i],d=l.vehicleId+"|"+l.alarmType+"|"+l.alarmStartTime;l.alarmTime==s&&this.state.data.latestAlarm.push(d),l.alarmTime==o&&this.state.data.lastAlarm.push(d)}},e.prototype.getSecurityDatas=function(){return V(this,void 0,void 0,(function(){var e,t,a,n,i,s,o,l,d,c,p,u;return B(this,(function(h){switch(h.label){case 0:return e=this.state.data,t=e.securityCurrentPage,a=e.securityExstAlarmIds,n=this.dependency.get("data").get("securityAlarmType"),i=n||null,(s=new FormData).set("pageNum",t.toString()),s.set("pageSize","20"),i&&s.set("eventField",i),s.set("riskIds",a.join(",")),layer.load(2),[4,r.a.post("/clbs/adas/v/monitoring/getRiskList",s)];case 1:if(200==(o=h.sent()).status){for(l=o.data.obj?o.data.obj:[],d=[],c=0;c<l.length;c++)p=l[c],{},u={sequenceNumber:0,ope:"",brand:p.brand,driverName:p.driverName,drivingLicenseNo:p.driverLicenseNo,riskType:p.riskType,riskLevel:p.riskLevel,speed:p.speed,address:p.address,warningTime:p.warningTime,warningEndTime:p.warningEndTime,picFlag:p.picFlag,videoFlag:p.videoFlag,id:p.id,vehicleId:p.vehicleId},d.push(u);return layer.closeAll("loading"),[2,d]}return[2]}}))}))},e.prototype.securityAlarmTypeChange=function(){this.state.data.ifLoadPageData=!0,this.state.data.securityCurrentPage=1,this.state.data.securityExstAlarmIds=[],this.renderSecurityTable()},e.prototype.getExistSecurityAlarmIds=function(e){var t=e.map((function(e){return e.id.toString()})),a=this.state.data.securityExstAlarmIds;this.state.data.securityExstAlarmIds=j(a,t)},e.prototype.securityScrollPage=function(e){var t=this.state.data,a=t.securityTable,n=t.ifLoadPageData,i=a.rightTable?a.rightTable.getState().$dom.$table:a.getState().$dom.$table,r=a.rightTable?a.rightTable.getState().$dom.$inner:a.getState().$dom.$inner;if(i.height()-r.innerHeight()-r.scrollTop()<=0){if(!n)return;this.state.data.ifLoadPageData=!1,this.state.data.securityCurrentPage++,this.renderSecurityTable()}},e.prototype.securityDeal=function(e){var t=this;e.preventDefault(),e.stopPropagation();var a=e.currentTarget,n=$(a).data("id");this.state.data.securityTable.setActiveRow(void 0);return layer.confirm("<label>确认处理此条报警信息？</label>    <div>      <label class='radioLabel'><input type='radio' name='accident' value='0' checked>事故未发生</label>      <label class='radioLabel' style='margin-left: 20px'><input type='radio' name='accident' value='1'>事故已发生</label>    </div>",{btn:["确定","取消"]},(function(){t.securitySure(n)})),!1},e.prototype.lookRealTimeVideo=function(e){e.preventDefault(),e.stopPropagation();var t=e.currentTarget,a=JSON.parse($(t).attr("data-row").replace(/'/g,'"')),n=a.vehicleId,i=a.brand;realtimeMonitoringVideoSeparate.checkVehicleOnlineStatus(n)?($(".videoDrawer-container").addClass("active"),$("#btn-videoRealTime-show").css({right:"680px","z-index":9999}),this.dependency.get("data").set("videoMonitor",{vehicleId:n,name:i}),realtimeMonitoringVideoSeparate.startPlayVideo({vid:n,brand:i}),$("#callSelect").hasClass("active")&&realtimeMonitoringVideoSeparate.callOrder(),activeSafety.riskInformationDetails(n)):layer.msg("监控对象离线")},e.prototype.securitySure=function(e){return V(this,void 0,void 0,(function(){var t,a,n;return B(this,(function(i){switch(i.label){case 0:return t=$("input[name='accident']:checked").val(),(a=new FormData).set("status","6"),a.set("riskId",e),a.set("riskResult",t.toString()),[4,r.a.post("/clbs/r/riskManagement/disposeReport/dealRisk",a)];case 1:if(200==(n=i.sent()).status){if(1!=n.data.success)return n.data.msg&&layer.msg(n.data.msg),[2];layer.msg("处理成功"),this.dependency.get("data").set("dealSecurityAlarm","change"),this.securityAlarmTypeChange()}return[2]}}))}))},e.prototype.handleSecurityTableClick=function(e,t,a){if("ope"!==a.data("field")){var n=e||a.attr("data-id");if(!n)return this.closePopover(),!1;var i=this.state.data.securityTable,r=41*(a.closest("tr").index()+1),s=i.findRow(i.getState().data,i.getOption(),n)[0].vehicleId;this.ifshowActiveSafetyPop(n,s,r)}},e.prototype.ifshowActiveSafetyPop=function(e,t,a){var n=this,i=n.state.data.riskIdGloabal,r=n.state.data.safetyTimer;r&&clearTimeout(r),r=setTimeout((function(){i==e&&$("#activeSafetyPop").hasClass("show")?n.closePopover():n.getActiveSafetyData(e,t,a)}),500)},e.prototype.getActiveSafetyData=function(e,t,a){return V(this,void 0,void 0,(function(){var n,i,s,o,l,d,c,p,u,h,m,v,g;return B(this,(function(f){switch(f.label){case 0:return n=this,layer.load(2),i=n.state.data.securityTable,s=i.rightTable?i.rightTable.getState().$dom.$inner:i.getState().$dom.$inner,o=s.scrollTop(),(l=new FormData).append("riskId",e),l.append("vehicleId",t),[4,r.a.post("/clbs/r/riskManagement/disposeReport/eventList",l)];case 1:if((d=f.sent()).data.success){for(c=d.data.obj,p=[],u=0;u<c.length;u++)h=c[u].roadType,c[u].roadTypeStr=null==h||""==h?"-":n.roadTypeJudge(h),c[u].roadLimitSpeed=""==c[u].roadLimitSpeed||"null"==c[u].roadLimitSpeed?"":c[u].roadLimitSpeed+"km/h",c[u].monitoring=c[u].brand+"("+c[u].plateColor+")",c[u].speedNumber=(c[u].speed?c[u].speed:"0.0")+"km/h",c[u].downloadHtml=n.adjunctDownload(c[u],t),c[u].warningEndTime=n.handleShow(c[u].warningEndTime),p.push(c[u]);m=N()({data:p,vid:t}),$("#activeSafetyPop #popoverBox").html(m),c.length>0&&"25"==c[0].eventProtocolType&&$("#activeSafetyPop #popoverBox").find("tr").each((function(e,t){$($(t).children()[11]).hide()})),$(".stateInfoTd").mouseover((function(e){for(var t=$(this),a=$(e.target).attr("data-id").split(","),i=a.splice(2),r=new Array,s=0;s<i.length;s++)r.push(i[s].split(":")[1]);var o='<div><ul style="padding:0; margin:0;"><li>监控对象：<span>'+n.handleShow(a[0])+"</span></li><li>报警事件：<span>"+n.handleShow(a[1])+"</span></li><li>ACC状态：<span>"+n.handleShow(r[0])+"</span></li><li>左转向灯：<span>"+n.handleShow(r[1])+"</span></li><li>右转向灯：<span>"+n.handleShow(r[2])+"</span></li><li>制动状态：<span>"+n.handleShow(r[4])+"</span></li><li>插卡状态：<span>"+n.handleShow(r[5])+"</span></li></ul></div>";t.justToolsTip({animation:"moveInTop",width:"auto",contents:o,gravity:"top",events:"mouseover"})})),n.state.data.riskIdGloabal=e,v=$("#activeSafetyPop").height(),null!=(g=i.findRow(i.getState().data,i.getOption(),e))&&(g[0].vehicleId,g[0].brand),$("#activeSafetyPop").css({top:a-v-o+"px","min-width":"1400px","max-width":"1590px"}),layer.closeAll("loading"),n.showActiveSafetyPop()}return[2]}}))}))},e.prototype.vehicleCheck=function(e,t){},e.prototype.handleShow=function(e){return e||"-"},e.prototype.adjunctDownload=function(e,t){var a='<a href="javascript:void(0)" data-eventId="'+e.eventId+'" data-eventNumber="'+e.eventNumber+'"  class="editBtn eventTerminalEvidence loadAccessory btn-primary">附件下载</a>';return e.hasMedia||(a='<a href="javascript:void(0)" style="cursor: default" class="editBtn btn-default" onclick="event.stopPropagation()">附件下载</a>'),0==e.attachmentStatus?a+='<a href="javascript:void(0)" data-eventId="'+e.eventId+'" data-vehicleId="'+t+'" class="editBtn eventTerminalEvidence getAccessory btn-primary" style="margin-left:10px;">获取附件</a>':1==e.attachmentStatus?a+='<a href="javascript:void(0)"  class="editBtn eventTerminalEvidence btn-default" style="margin-left:10px;">附件失效</a>':2==e.attachmentStatus&&(a+='<a href="javascript:void(0)"  class="editBtn eventTerminalEvidence btn-default btn-defaultr" style="margin-left:10px;">获取中···</a>'),a},e.prototype.riskMediaClick=function(e){e.preventDefault(),e.stopPropagation();var t=$(e.currentTarget),a=t.data("id"),n=t.data("type");this.state.data.EventMediaInfoId=a;var i=this.getMedias(a,"0"),r=this.getMedias(a,"2");0==i.length&&setTimeout((function(){$("#img").prop("disabled",!0)})),0==r.length&&setTimeout((function(){$("#video").prop("disabled",!0)}));var s="0"==n?"1":n;this.handleMediaInfo(s,[i,r])},e.prototype.getEventMedias=function(e,t){return V(this,void 0,void 0,(function(){var a,n,i;return B(this,(function(s){switch(s.label){case 0:return(a=new FormData).append("eventId",e),a.append("mediaType",t),n=[],[4,r.a.post("/clbs/r/riskManagement/disposeReport/getEventMedia",a)];case 1:return(i=s.sent()).data&&i.data.obj&&(n=i.data.obj),[2,n]}}))}))},e.prototype.getMedias=function(e,t){var a={riskId:e,mediaType:t},n="";return layer.load(2),json_ajax("POST","/clbs/r/riskManagement/disposeReport/getRiskMedia","json",!1,a,(function(e){e.success?n=e.obj:layer.msg("失败了")})),layer.closeAll("loading"),n},e.prototype.handleMediaInfo=function(e,t){if(!t.length)return!1;this.state.data.eventMediaPicArr=t[0],this.state.data.eventMediaVideoArr=t[1],this.state.data.eventMediaPicSingNum=0,this.state.data.eventMediaVideoSingNum=0,"1"==e&&(this.state.data.ifPicOrVideo="pic",$("#allNum").html(this.state.data.eventMediaPicArr.length),$("#whichNum").html("1"),$("#eventMediaVideo").hide(),$("#videoBox").hide(),$("#eventMediaPic").show(),$(".Video").removeClass("btn-primary").addClass("btn-default"),$(".Img").removeClass("btn-default").addClass("btn-primary"),this.state.data.eventMediaPicArr[0]&&($("#eventMediaModalLabel").html(this.state.data.eventMediaPicArr[0].riskType+" -- "+this.state.data.eventMediaPicArr[0].riskEventType),$("#eventMediaPic").attr("src",this.state.data.eventMediaPicArr[0].mediaUrl)),$("#eventMediaModal").modal("show")),"2"==e&&(this.state.data.ifPicOrVideo="video",$("#allNum").html(this.state.data.eventMediaVideoArr.length),$("#whichNum").html("1"),$("#eventMediaVideo").show(),$("#videoBox").show(),$("#eventMediaPic").hide(),$(".Video").removeClass("btn-default").addClass("btn-primary"),$(".Img").removeClass("btn-primary").addClass("btn-default"),this.state.data.eventMediaVideoArr[0]&&($("#eventMediaModalLabel").html(this.state.data.eventMediaVideoArr[0].riskType+" -- "+this.state.data.eventMediaVideoArr[0].riskEventType),window.navigator.userAgent.toLowerCase().indexOf("ie")>=0?$("#videoBox").empty().append("<embed  src="+this.state.data.eventMediaVideoArr[0].mediaUrl+' autostart=false id="eventMediaVideo" style="width: 100%;height:370px; "  windowlessVideo="true" wmode="transparent" align="middle" type="application/x-shockwave-flash"></embed>'):$("#eventMediaVideo").attr("src",this.state.data.eventMediaVideoArr[0].mediaUrl)),$("#eventMediaModal").modal("show"))},e.prototype.nextMedia=function(){var e=this.state.data;"pic"==e.ifPicOrVideo&&e.eventMediaPicSingNum<e.eventMediaPicArr.length-1&&(e.eventMediaPicSingNum++,$("#whichNum").html(e.eventMediaPicSingNum+1+""),$("#eventMediaModalLabel").html(e.eventMediaPicArr[e.eventMediaPicSingNum].riskType+" -- "+e.eventMediaPicArr[e.eventMediaPicSingNum].riskEventType),$("#eventMediaPic").attr("src",e.eventMediaPicArr[e.eventMediaPicSingNum].mediaUrl)),"video"==e.ifPicOrVideo&&e.eventMediaVideoSingNum<e.eventMediaVideoArr.length-1&&(e.eventMediaVideoSingNum++,$("#whichNum").html(e.eventMediaVideoSingNum+1+""),$("#eventMediaModalLabel").html(e.eventMediaVideoArr[e.eventMediaVideoSingNum].riskType+" -- "+e.eventMediaVideoArr[e.eventMediaVideoSingNum].riskEventType),window.navigator.userAgent.toLowerCase().indexOf("ie")>=0?$("#videoBox").empty().append("<embed  src="+e.eventMediaVideoArr[e.eventMediaVideoSingNum].mediaUrl+' autostart=false id="eventMediaVideo" style="width: 100%;height:350px; "  windowlessVideo="true" wmode="transparent" align="middle" type="application/x-shockwave-flash"></embed>'):$("#eventMediaVideo").attr("src",e.eventMediaVideoArr[e.eventMediaVideoSingNum].mediaUrl))},e.prototype.prevMedia=function(){var e=this.state.data;"pic"==e.ifPicOrVideo&&e.eventMediaPicSingNum>0&&(e.eventMediaPicSingNum--,$("#whichNum").html(e.eventMediaPicSingNum+1+""),$("#eventMediaModalLabel").html(e.eventMediaPicArr[e.eventMediaPicSingNum].riskType+" -- "+e.eventMediaPicArr[e.eventMediaPicSingNum].riskEventType),$("#eventMediaPic").attr("src",e.eventMediaPicArr[e.eventMediaPicSingNum].mediaUrl)),"video"==e.ifPicOrVideo&&e.eventMediaVideoSingNum>0&&(e.eventMediaVideoSingNum--,$("#whichNum").html(e.eventMediaVideoSingNum+1+""),$("#eventMediaModalLabel").html(e.eventMediaVideoArr[e.eventMediaVideoSingNum].riskType+" -- "+e.eventMediaVideoArr[e.eventMediaVideoSingNum].riskEventType),$("#eventMediaPic").attr("src",e.eventMediaVideoArr[e.eventMediaVideoSingNum].mediaUrl))},e.prototype.videoChange=function(e){var t=$(e.target).attr("data-value"),a=this.state.data;"1"==t?($("#allNum").html(this.state.data.eventMediaPicArr.length),$(".Video").removeClass("btn-primary").addClass("btn-default"),$(".Img").removeClass("btn-default").addClass("btn-primary"),$("#videoBox").hide(),$("#videoBox video").hide(),$("#eventMediaPic").show(),$("#eventMediaPic img").show(),$("#whichNum").html(a.eventMediaPicSingNum+1+""),$("#eventMediaModalLabel").html(a.eventMediaPicArr[a.eventMediaPicSingNum].riskType+" -- "+a.eventMediaPicArr[a.eventMediaPicSingNum].riskEventType),$("#eventMediaPic").attr("src",a.eventMediaPicArr[a.eventMediaPicSingNum].mediaUrl),this.state.data.ifPicOrVideo="pic"):"2"==t&&($("#allNum").html(this.state.data.eventMediaVideoArr.length),$(".Video").removeClass("btn-default").addClass("btn-primary"),$(".Img").removeClass("btn-primary").addClass("btn-default"),$("#eventMediaPic").hide(),$("#eventMediaPic img").hide(),$("#videoBox").show(),$("#videoBox video").show(),$("#whichNum").html(a.eventMediaVideoSingNum+1+""),$("#eventMediaModalLabel").html(a.eventMediaVideoArr[a.eventMediaVideoSingNum].riskType+" -- "+a.eventMediaVideoArr[a.eventMediaVideoSingNum].riskEventType),$("#eventMediaVideo").attr("src",a.eventMediaVideoArr[a.eventMediaVideoSingNum].mediaUrl),this.state.data.ifPicOrVideo="video")},e.prototype.getAccessoryRequest=function(e){return V(this,void 0,void 0,(function(){var t,a,n;return B(this,(function(i){switch(i.label){case 0:return t=$(e.target).attr("data-eventId"),a=$(e.target).attr("data-vehicleId"),(n=new FormData).append("riskEventId",t),n.append("vehicleId",a),[4,r.a.post("/clbs/v/oilmassmgt/oilcalibration/checkVehicleOnlineStatus",n)];case 1:return i.sent().data.success?[4,r.a.post("/clbs/adas/v/monitoring/getAdasMedia",n)]:[3,3];case 2:return i.sent().data.success&&(layer.msg("下发成功"),$(e.target).text("获取中···"),$(e.target).removeClass("eventTerminalEvidence btn-primary").addClass("btn-default btn-defaultr"),$(e.target).attr("disabled","disabled").css("pointer-events","none")),[3,4];case 3:layer.msg("终端离线"),i.label=4;case 4:return[2]}}))}))},e.prototype.getAccessoryDownLoad=function(e){return V(this,void 0,void 0,(function(){var t,a,n,i,s;return B(this,(function(o){switch(o.label){case 0:return t=$(e.target).attr("data-eventId"),a=$(e.target).attr("data-eventNumber"),n={downLoadId:t,isEvent:!0,number:a},[4,r.a.get("/clbs/r/riskManagement/disposeReport/terminalEvidence",n)];case 1:return(i=o.sent()).data.success?(s=i.data).obj.hasNotFile?layer.msg(s.obj.msg):window.location.href="/clbs/r/riskManagement/disposeReport/downloadFile?filePath="+s.obj.filePath+"&fileName="+s.obj.fileName+"&isRiskEvidence="+s.obj.isRiskEvidence:layer.msg("失败了"),[2]}}))}))},e.prototype.roadTypeJudge=function(e){var t;switch(e){case 1:t="高速路";break;case 2:t="都市高速路";break;case 3:t="国道";break;case 4:t="省道";break;case 5:t="县道";break;case 6:t="乡村道路";break;case 7:t="其他道路"}return t},e.prototype.showActiveSafetyPop=function(){$("#activeSafetyPop").addClass("in show")},e.prototype.closePopover=function(){$("#activeSafetyPop").removeClass("in show")},e.prototype.initDragBar=function(){this.state.data.dragBar=new DragBar("#tableMapDrag",{min:-500,max:0,onDragEnd:this.onDragBarDragEnd.bind(this)})},e.prototype.onDragBarDragEnd=function(e){var t=$("#lkywRealtimeTop"),a=$("#lkywRealtimeBottom");t.css("bottom",108-e+"px"),a.css("height",58-e+"px")},e.prototype.terminalIOClick=function(e){return V(this,void 0,void 0,(function(){var t,a,n,i,s,o,l;return B(this,(function(d){switch(d.label){case 0:return t=$(e.currentTarget),a=new FormData,n=t.data("id"),"terminalIo"===(i=t.data("type"))?[2]:"professionalsDetail"==i?(this.professionalsDetail(n),[2]):(a.set("monitorId",n),a.set("type",i),s="获取终端IO状态失败","terminalIo"!==i&&(s="获取传感器IO状态失败"),[4,r.a.post("/clbs/v/monitoring/getIoSignalInfo",a)]);case 1:if(200==(o=d.sent()).status){if(!o.data.success)return layer.msg(s),[2];l=o.data.obj,"terminalIo"==i?(this.terminalIoCallback(l),$("#ioModalTerminal").modal("show")):"sensorIo"==i&&(this.sensorIoCallback(l),$("#ioModalSensor").modal("show"))}return[2,!1]}}))}))},e.prototype.terminalIoCallback=function(e){if(e&&1===e.length&&e[0].ioData&&e[0].ioData.length>0){var t=$("#ioModalTerminalContent");t.empty();for(var a=0;a<e[0].ioData.length;a++){var n="",i=e[0].ioData[a];n=(n="<tr><td>$0</td><td>$1</td></tr>".replace("$0",i.ioName+"：")).replace("$1",i.ioStatusName),t.append($(n))}}},e.prototype.sensorIoCallback=function(e){var t=$("#ioModalSensorContent1");t.empty();var a=$("#ioModalSensorContent2");if(a.empty(),$("#sensorIOModalLi1").addClass("active"),$("#sensorIOModalLi2").removeClass("active"),$("#sensorIOModalTab1").addClass("active"),$("#sensorIOModalTab2").removeClass("active"),e&&e.length>0){var n="<tr><td>$0</td><td>$1</td></tr>",i=e.find((function(e){return 145===e.id})),r=e.find((function(e){return 146===e.id}));if(void 0!==i&&void 0!==i.ioData&&null!==i.ioData)for(var s=0;s<i.ioData.length;s++){var o="",l=i.ioData[s];o=(o=n.replace("$0",l.ioName+"：")).replace("$1",l.ioStatusName),t.append($(o))}if(void 0!==r&&void 0!==r.ioData&&null!==r.ioData)for(var d=0;d<r.ioData.length;d++){var c="",p=r.ioData[d];c=(c=n.replace("$0",p.ioName+"：")).replace("$1",p.ioStatusName),a.append($(c))}}},e.prototype.handleHandleStatusClick=function(e){var t=$(e.currentTarget).data("id"),a=this.state.data.alarmTable,n=a.findRow(a.getState().data,a.getOption(),t);if(null!==n){var i=n[0],r=i.monitorName+"|"+i.alarmTime+"|"+i.assignmentName+"|"+i.vehicleType+"|"+i.plateColorName+"|"+i.description+"|"+i.professionalsName+"|"+i.field11+"|"+i.simCardNumber+"|"+i.deviceNumber+"|"+i.swiftNumber+"|"+i.alarmType+"|"+i.alarmSource+"|"+i.vehicleId+"|"+i.id;this.warningManage(r)}return!1},e.prototype.warningManage=function(e){return V(this,void 0,void 0,(function(){var t,a,n,i,r,s,o;return B(this,(function(l){switch(l.label){case 0:return this.resetWarningModal(),t=e.split("|"),[4,this.getAlarmProtoType(t)];case 1:for(a=l.sent(),n=a.warningType,i=a.deviceTypeTxt,$("#deviceTypeTxt").val(i),"11"==i||"20"==i||"21"==i||"24"==i||"25"==i||"26"==i||"28"==i?($(".newDeviceInfo").show(),$(".oldDeviceInfo").hide(),$(".minResolution, .maxResolution").show(),$(".defaultValue").prop("selected",!1)):($(".newDeviceInfo").hide(),$(".oldDeviceInfo").show(),$(".minResolution,.maxResolution").hide(),$(".defaultValue").prop("selected",!0)),r=t[11].split(", "),s=this.state.data.alarmTypeList,o=0;o<r.length;o++)if(-1!=$.inArray(r[o],s)){$("#warningManagePhoto").attr("disabled","disabled"),$("#warningManageSend").attr("disabled","disabled"),$("#warningManageAffirm").attr("disabled","disabled"),$("#warningManageFuture").attr("disabled","disabled"),$("#warningManageCancel").attr("disabled","disabled"),$("#color").show(),$("#color").text("alarmDisabled");break}return $("#warningManageListening").removeAttr("disabled"),$("#warningManagePhoto").removeAttr("disabled"),$("#warningManageSend").removeAttr("disabled"),$("#warningManageAffirm").removeAttr("disabled"),$("#warningManageFuture").removeAttr("disabled"),$("#warningManageCancel").removeAttr("disabled"),$("#color").hide(),$("#colorMore").hide(),$("#listeningContent,#takePicturesContent,#sendTextMessages").hide(),1==n||"1"==t[12]?($("#warningHiden").removeAttr("style"),$("#warningManageListening").hide(),$("#warningManagePhoto").hide(),$("#warningManageSend").hide(),$("#sno").val("0")):($("#warningHiden").attr("style","text-align:center"),$("#warningManageListening").show(),$("#warningManagePhoto").show(),$("#warningManageSend").show(),$("#sno").val(t[10])),$("#warningCarName").text(t[0]),$("#warningTime").text(t[1]),$("#warningGroup").text(t[2]),$("#warningDescription").text(t[5]),"车"!==t[3]?($("#professionLabel").hide(),$("#professionValue").hide()):($("#professionLabel").show(),$("#professionValue").show()),$("#warningPeo").text(t[6]),$("#simcard").val(t[8]),$("#device").val(t[9]),$("#warningType").val(t[11]),$("#vUuid").val(t[13]),$("#alarmId").val(t[14]),[2]}}))}))},e.prototype.resetWarningModal=function(){$(".sendTextFooter").hide(),$(".takePicturesFooter").hide(),$("#alarm-remark").show(),$("#smsTxt").val(""),$("#time").val(""),$("#alarmRemark").val(""),layer.closeAll(),$("#warningManage").modal("show"),$("#warningManage .checkbox input").prop("checked",!0),$("#warningManage #checkboxOne").prop("checked",!1),$("#warningManage #messageTypeOne").val("1"),$("#warningManage #messageTypeTwo").val("0"),$("#textTypeOne").prop("checked",!0),$("#textTypeTwo").prop("checked",!1)},e.prototype.getAlarmProtoType=function(e){return V(this,void 0,void 0,(function(){var t,a,n;return B(this,(function(i){switch(i.label){case 0:return(t=new FormData).set("vehicleId",e[13]),[4,r.a.post("/clbs/v/monitoring/getDeviceTypeByVid",t)];case 1:return 200==(a=i.sent()).status&&a.data.success?(n=a.data.obj,[2,{warningType:n.warningType,deviceTypeTxt:n.deviceType}]):[2]}}))}))},e.prototype.findEndTime=function(e){return V(this,void 0,void 0,(function(){var t,a;return B(this,(function(n){switch(n.label){case 0:return(t=new FormData).set("vehicleId",e[13]),t.set("type",e[11]),t.set("startTime",e[1]),[4,r.a.post("/clbs/a/search/findEndTime",t)];case 1:return 200==(a=n.sent()).status?[2,a.data]:[2]}}))}))},e.prototype.func=function(e){return V(this,void 0,void 0,(function(){var t,a;return B(this,(function(n){switch(n.label){case 0:return(t=new FormData).set("vehicleId",e[13]),t.set("alarm",e[5]),[4,r.a.post("/clbs/v/monitoring/getAlarmParam",t)];case 1:return 200==(a=n.sent()).status&&this.getAlarmParam(a.data),[2]}}))}))},e.prototype.getAlarmParam=function(e){$(".warningDeal").hide();var t=e.obj.length,a=e.obj;if(0!=t)for(var n=0;n<t;n++){var i=a[n],r=i.name,s=i.parameterValue,o=i.paramCode,l=i.type;"超速预警"==r&&($("#overSpeedGap").show(),$("#overSpeedGapValue").text(s)),"疲劳驾驶预警"==r&&($("#tiredDriveGap").show(),$("#tiredDriveGapValue").text(s)),"碰撞预警"==r&&($("#crashWarning").show(),"param1"==o?$("#crashTime").text(s):"param2"==o&&$("#crashSpeed").text(s)),"侧翻预警"==r&&($("#turnOnWarning").show(),$("#turnOnValue").text(s)),"超速报警"==r&&"driverAlarm"==l&&($("#overSpeeds").show(),"param1"==o?$("#warningSpeed").text(s):"param2"==o&&$("#warningAllTime").text(s)),"疲劳驾驶"==r&&($("#tiredDrive").show(),"param1"==o?$("#continuousDriveTime").text(s&&"null"!==s?s:""):"param2"==o&&$("#breakTime").text(s)),"当天累积驾驶超时"==r&&($("#addUpDrive").show(),$("#addUpDriveTime").text(s)),"超时停车"==r&&($("#overTimeStop").show(),$("#overTimeStopTime").text(s)),"凌晨2-5点行驶报警"==r&&($("#earlyRun").show(),$("#earlyRunValue").text(s)),"车辆非法位移"==r&&($("#displacementCar").show(),$("#displacementCarDistance").text(s)),"车机疑似屏蔽报警"==r&&($("#shieldWarning").show(),"param1"==o?$("#offLineTime").text(s):"param2"==o?$("#offLineStartTime").text(s):"param3"==o&&$("#offLineEndTime").text(s))}},e.prototype.getListen=function(){$("#listeningContent").is(":hidden")?($("#listeningContent").slideDown(),$(".listenFooter").show(),$("#takePicturesContent").hide(),$(".takePicturesFooter").hide(),$("#sendTextMessages").hide(),$(".sendTextFooter").hide()):($("#listeningContent").slideUp(),$(".listenFooter").hide())},e.prototype.getPhoto=function(){$("#takePicturesContent").is(":hidden")?($("#takePicturesContent").slideDown(),$(".takePicturesFooter").show(),$("#sendTextMessages").hide(),$(".sendTextFooter").hide(),$("#listeningContent").hide(),$(".listenFooter").hide()):($("#takePicturesContent").slideUp(),$(".takePicturesFooter").hide())},e.prototype.send=function(){$("#sendTextMessages").is(":hidden")?($("#sendTextMessages").slideDown(),$(".sendTextFooter").show(),$("#takePicturesContent").hide(),$(".takePicturesFooter").hide(),$("#listeningContent").hide(),$(".listenFooter").hide()):($("#sendTextMessages").slideUp(),$(".sendTextFooter").hide())},e.prototype.handleAlarm=function(e){return V(this,void 0,void 0,(function(){var t,a,n,i,s,o,l,d,c,p,u;return B(this,(function(h){switch(h.label){case 0:return t=$("#warningTime").text(),a=$("#warningCarName").text(),n=$("#warningDescription").text(),i=$("#vUuid").val(),s=$("#simcard").val(),o=$("#device").val(),l=$("#sno").val(),d=$("#warningType").val(),c=$("#alarmRemark").val(),(p=new FormData).set("vehicleId",i.toString()),p.set("plateNumber",a.toString()),p.set("alarm",d.toString()),p.set("description",n.toString()),p.set("handleType",e.toString()),p.set("startTime",t.toString()),p.set("simcard",s.toString()),p.set("device",o.toString()),p.set("sno",l.toString()),p.set("remark",c.toString()),u=this.getHandleAlarmUrl(d.toString()),[4,r.a.post(u,p)];case 1:return h.sent(),setTimeout(window.pagesNav.gethistoryno,3e3),$("#warningManage").modal("hide"),"realtime-video"===$(".layout-header .links .active").attr("data-key")?(realTimeVideLoad.updateHandleStatus($("#warningCarName").text()),setTimeout("realTimeVideLoad.logFindCilck()",500)):this.update808AlarmStatus(),[2]}}))}))},e.prototype.getHandleAlarmUrl=function(e){var t="/clbs/v/monitoring/handleAlarm";return-1!=["14100","14101","14102","14103","14104","14105","14106","14107","14108","14109","14110","14111","14112","14113","14114","14115","14116","14117","14118","14119","14120","14121","14122","14123","14124","14125","14126","14127","14128","14129","14130","14131","14200","14201","14202","14203","14204","14205","14206","14207","14208","14209","14210","14211","14212","14213","14214","14215","14216","14217","14218","14219","14220","14221","14222","14223","14224","14225","14226","14227","14228","14229","14230","14231","14000","14001","14002","14003","14004","141000","142000"].indexOf(e)&&(t="/clbs/v/switchSignalAlarm/updateIOAlarm"),t},e.prototype.listenForAlarm=function(){var e=this;if(this.listenValidate()){var t=$("#vUuid").val();$("#vidforAlarmListen").val(t),$("#brandListen").val($("#warningCarName").text()),$("#alarmListen").val($("#warningType").val()),$("#startTimeListen").val($("#warningTime").text()),$("#simcardListen").val($("#simcard").val()),$("#deviceListen").val($("#device").val()),$("#snoListen").val($("#sno").val()),$("#handleTypeListen").val("监听"),$("#descriptionListen").val($("#warningDescription").text()),$("#remarkListen").val($("#alarmRemark").val()),$("#goListeningForAlarm").attr("disabled","disabled"),$("#listeningAlarm").ajaxSubmit((function(t){JSON.parse(t).success?(layer.msg("指令发送成功"),e.update808AlarmStatus()):layer.msg("设备离线,下发失败"),$("#warningManage").modal("hide"),$("#goListeningForAlarm").removeAttr("disabled")}))}$("#goListeningForAlarm").removeAttr("disabled")},e.prototype.listenValidate=function(){return $("#listeningAlarm").validate({rules:{monitorPhone:{isNewTel:!0,required:!0}},messages:{monitorPhone:{required:"请输入电话号码"}}}).form()},e.prototype.takePhotoForAlarm=function(){var e=this;if(this.photoValidateForAlarm()){var t=$("#vUuid").val();$("#vidforAlarm").val(t),$("#brandPhoto").val($("#warningCarName").text()),$("#alarmPhoto").val($("#warningType").val()),$("#startTimePhoto").val($("#warningTime").text()),$("#simcardPhoto").val($("#simcard").val()),$("#devicePhoto").val($("#device").val()),$("#snoPhoto").val($("#sno").val()),$("#handleTypePhoto").val("拍照"),$("#description-photo").val($("#warningDescription").text()),$("#remark-photo").val($("#alarmRemark").val()),$("#goPhotographsForAlarm").attr("disabled","disabled"),$("#takePhotoForAlarm").ajaxSubmit((function(t){($("#warningManage").modal("hide"),$("#goPhotographsForAlarm").removeAttr("disabled"),JSON.parse(t).success)?(layer.msg("指令发送成功"),"realtime-video"===$(".layout-header .links .active").attr("data-key")?(realTimeVideLoad.updateHandleStatus($("#warningCarName").text()),setTimeout("realTimeVideLoad.logFindCilck()",500)):e.update808AlarmStatus()):layer.msg("设备离线,下发失败")}))}$("#goPhotographsForAlarm").removeAttr("disabled")},e.prototype.photoValidateForAlarm=function(){return $("#takePhotoForAlarm").validate({rules:{wayID:{required:!0},time:{required:!0,digits:!0,range:[0,65535]},command:{range:[0,10],required:!0},saveSign:{required:!0},distinguishability:{required:!0},quality:{range:[1,10],required:!0},luminance:{range:[0,255],required:!0},contrast:{range:[0,127],required:!0},saturability:{range:[0,127],required:!0},chroma:{range:[0,255],required:!0}},messages:{wayID:{required:"请输入通道ID"},time:{required:"请输入间隔时间",digits:"间隔时间有误",range:"间隔时间必须>=0且<=65535"},command:{range:"拍照张数必须>=1且<=10",required:"请输入拍照张数"},saveSign:{required:"请选择保存标志"},distinguishability:{required:"请选择分辨率"},quality:{range:"图像质量必须>=1且<=10",required:"请输入图像质量"},luminance:{range:"亮度必须>=0且<=255",required:"请输入亮度"},contrast:{range:"对比度必须>=0且<=127",required:"请输入亮度"},saturability:{range:"饱和度必须>=0且<=127",required:"请输入饱和度"},chroma:{range:"色度必须>=0且<=255",required:"请输入色度"}}}).form()},e.prototype.goTxtSendForAlarm=function(){var e=this,t=$("#vUuid").val();$("#vidSendTxtForAlarm").val(t),$("#brandTxt").val($("#warningCarName").text()),$("#alarmTxt").val($("#warningType").val()),$("#startTimeTxt").val($("#warningTime").text()),$("#simcardTxt").val($("#simcard").val()),$("#deviceTxt").val($("#device").val()),$("#snoTxt").val($("#sno").val()),$("#handleTypeTxt").val("下发短信"),$("#description-Txt").val($("#warningDescription").text()),$("#remark-Txt").val($("#alarmRemark").val()),this.txtSendForAlarmValidate()&&($("#goTxtSendForAlarm").attr("disabled","disabled"),$("#txtSendForAlarm").ajaxSubmit((function(t){($("#goTxtSendForAlarm").removeAttr("disabled"),$("#warningManage").modal("hide"),JSON.parse(t).success)?(layer.msg("指令发送成功"),"realtime-video"===$(".layout-header .links .active").attr("data-key")?(realTimeVideLoad.updateHandleStatus($("#warningCarName").text()),setTimeout("realTimeVideLoad.logFindCilck()",500)):e.update808AlarmStatus()):layer.msg("设备离线,下发失败")})))},e.prototype.txtSendForAlarmValidate=function(){return $("#txtSendForAlarm").validate({rules:{txt:{required:!0,maxlength:512}},messages:{txt:{required:"下发内容不能为空",maxlength:"最多输入512个字符"}}}).form()},e.prototype.update808AlarmStatus=function(){for(var e=this.state.data.alarmDatas,t=$("#vUuid").val(),a=$("#alarmId").val(),n=$("#warningDescription").text(),i=0;i<e.length;i++){var r=e[i],s=r.id;r.vehicleId==t&&r.description==n&&r.id==a&&this.state.data.alarmTable.updateOptionData({id:s,handleStatus:1})}this.dependency.get("data").set("deal808Alarm","change")},e.prototype.getVehicleAdreessInfo=function(e){return V(this,void 0,void 0,(function(){var t,a,n,i,r;return B(this,(function(s){switch(s.label){case 0:return t=this.state.data.statusTable,a=$(e.currentTarget).data("id"),(n=t.findRow(t.getState().data,t.getOption(),a))?(i=n[0],[4,this.getAlarmAddress(i.longitude,i.latitude)]):[3,2];case 1:r=s.sent(),t.updateOptionData({id:a,positionDescription:$.isPlainObject(r)?"未定位":r}),s.label=2;case 2:return[2]}}))}))},e.prototype.getAlarmAdreessInfo=function(e){return V(this,void 0,void 0,(function(){var t,a,n,i,r;return B(this,(function(s){switch(s.label){case 0:return t=this.state.data.alarmTable,a=$(e.currentTarget).data("id"),(n=t.findRow(t.getState().data,t.getOption(),a))?(i=n[0],[4,this.getAlarmAddress(i.longtitude,i.latitude)]):[3,2];case 1:r=s.sent(),t.updateOptionData({id:a,alarmPosition:$.isPlainObject(r)?"未定位":r}),s.label=2;case 2:return[2]}}))}))},e.prototype.getAlarmAddress=function(e,t){return V(this,void 0,void 0,(function(){var a,n;return B(this,(function(i){switch(i.label){case 0:return(a=new FormData).set("addressReverse",[t,e,"","","vehicle"].toString()),[4,r.a.post("/clbs/v/monitoring/address",a)];case 1:return 200==(n=i.sent()).status?[2,n.data]:[2]}}))}))},e.prototype.getMonitorInfo=function(e){return V(this,void 0,void 0,(function(){var t,a,n,i,s,o,l,d,c,p,u,h,m;return B(this,(function(v){switch(v.label){case 0:for(t="",a=this.state.data.statusTable.getState().data,n=this.state.data.alarmTable.getState().data,i=this.state.data.securityTable.getState().data,s="all",o=a,$("#waringTableWrap").hasClass("active")&&(o=n,s="alarm"),$("#securityTableWrap").hasClass("active")&&(o=i,s="security"),d=0;d<o.length;d++)if(o[d].id===e){t=o[d].vehicleId,l=o[d];break}return(c=new FormData).set("monitorId",t),[4,r.a.post("/clbs/lkyw/v/monitoring/getMonitorBubble",c)];case 1:return p=v.sent(),u=p.data.obj,h={monitorName:""},(m=u.monitorInfo)&&(h={sequenceNumber:0,monitorName:this.isEmpty(m.monitorName),plateColorName:m.plateColorName,gpsTime:u.gpsTime,uploadtime:u.uploadtime,assignmentName:m.assignmentName,groupName:m.groupName,vehicleType:m.vehicleType,objectState:u.objectState,simcardNumber:m.simcardNumber,professionalsName:m.professionalsName,acc:u.acc,deviceNumber:m.deviceNumber,signalState:this.isEmpty(u.signalState),gpsSpeed:u.gpsSpeed,direction:u.direction,batteryVoltage:u.batteryVoltage,elecData:u.batteryVoltage,signalStrength:u.signalStrength,locationType:u.locationType,satellitesNumber:u.satellitesNumber,terminalDayMileage:this.toFixed(u.deviceDayMile),terminalTotalMileage:this.toFixed(u.gpsMileage),gpsOil:u.gpsOil,altitude:u.altitude,roadLimitSpeed:this.toFixed(u.roadLimitSpeed),roadType:u.roadType,longitude:u.longitude,latitude:u.latitude,grapherSpeed:this.toFixed(u.grapherSpeed),positionDescription:0,oilExpend:u.oilExpend,temperatureSensor:u.temperatureSensor,temphumiditySensor:u.temphumiditySensor,positiveNegative:u.positiveNegative,sensorDayMileage:u.sensorDayMileage,dayOilWear:u.sensorDayMileage,sensorTotalMileage:u.sensorTotalMileage,oilMass:u.sensorTotalMileage,loadInfos:u.loadInfos,workHourSensor:u.workHourSensor,terminalIOStatus:u.terminalIOStatus,sensorIOStatus:u.sensorIOStatus,tyreInfos:u.tyreInfos,driverSpeedLimit:u.driverSpeedLimit,groupId:this.isEmpty(m.groupId),assignmentId:this.isEmpty(m.assignmentId),deviceType:this.isEmpty(m.deviceType),id:m.monitorId}),[2,{row:l,monitorInfo:h,type:s}]}}))}))},e.prototype.longTimeFormator=function(e){var t,a,n,i,r=e.getFullYear().toString(),s=e.getMonth()+1;t=s<10?"0"+s.toString():s.toString();var o=e.getDate();a=o<10?"0"+o.toString():o.toString();var l=e.getHours();n=l<10?"0"+l.toString():l.toString();var d=e.getMinutes();i=d<10?"0"+d.toString():d.toString();var c=e.getSeconds();return r+"-"+t+"-"+a+" "+n+":"+i+":"+(c<10?"0"+c.toString():c.toString())},e.prototype.isInstantAlarm=function(e){"string"!=typeof e&&(e=e.toString());return["3","157","158","0","2011","2012","20","2111","2112","21","2211","2212","22","164","27","28","31","6641","6811","6821","6831","6841","6812","6822","6832","6842","12522","12540","12617","12640","128","131","129","75","147","7211","7212","7311","7312","11911","11912","32","118","11511","11512","11611","11612","123","1111","1112","113","114","107","106","104","105","108","109","18712","18715","18710","18716","18717","18714","18711","18713"].indexOf(e)>-1},e.prototype.isTiredAlarm=function(e){"string"!=typeof e&&(e=e.toString());return["2","79"].indexOf(e)>-1},e.prototype.handleRightMenuClick=function(e){return V(this,void 0,void 0,(function(){var t,a,n,i,r,s,o,l,d,c,p,u,h,m,v,g,f,b,y;return B(this,(function(k){switch(k.label){case 0:return e.preventDefault(),e.stopPropagation(),t=this.dependency.get("layout"),a=$(e.target),n=a.data("key"),$("#tableRightMenu").hide(),i=this.state.data.rightClickRowId,[4,this.getMonitorInfo(i)];case 1:if(r=k.sent(),s=r.monitorInfo,o=r.type,l=r.row,d=s.id?s.id:"",c=s.monitorName?s.monitorName:"",p={vehicleId:d},"realtime-video"===n){if(!realtimeMonitoringVideoSeparate.checkVehicleOnlineStatus(d))return layer.msg("监控对象离线"),[2];$(".videoDrawer-container").addClass("active"),$("#btn-videoRealTime-show").css({right:"680px","z-index":9999}),this.dependency.get("data").set("videoMonitor",{vehicleId:d,name:c}),realtimeMonitoringVideoSeparate.startPlayVideo({vid:d,brand:c}),activeSafety.riskInformationDetails(d),$("#callSelect").hasClass("active")&&realtimeMonitoringVideoSeparate.callOrder()}else if("history-capture"===n)this.handleCapture(d);else{if("track-playback"===n)b=null,s.assignmentId&&"-"!==s.assignmentId&&(y=s.assignmentId.split(",")).length>0&&(b=y[0]),p.pid=b,p.type=s.deviceType,u=new Date,(h=new Date).setMinutes(h.getMinutes()-10),(m=new Date).setMinutes(m.getMinutes()-20),"security"===o?(v=new Date(l.warningTime.replace(/-/g,"/")))>h?(p.startTime=this.longTimeFormator(m),p.endTime=this.longTimeFormator(u)):(v.setMinutes(v.getMinutes()-10),p.startTime=this.longTimeFormator(v),v.setMinutes(v.getMinutes()+20),p.endTime=this.longTimeFormator(v)):"alarm"===o&&(this.isInstantAlarm(l.alarmType)?(g=new Date(l.alarmTime.replace(/-/g,"/")))>h?(p.startTime=this.longTimeFormator(m),p.endTime=this.longTimeFormator(u)):(g.setMinutes(g.getMinutes()-10),p.startTime=this.longTimeFormator(g),g.setMinutes(g.getMinutes()+20),p.endTime=this.longTimeFormator(g)):this.isTiredAlarm(l.alarmType)?(g=new Date(l.alarmTime.replace(/-/g,"/")),(f=new Date(l.alarmEndTime.replace(/-/g,"/"))).getTime()-g.getTime()>6048e5?(layer.msg("只能查询7天的轨迹数据"),p.endTime=this.longTimeFormator(f),f.setDate(f.getDate()-7),p.startTime=this.longTimeFormator(f)):(g.setHours(g.getHours()-4),p.startTime=this.longTimeFormator(g),p.endTime=this.longTimeFormator(f))):((g=new Date(l.alarmTime.replace(/-/g,"/"))).setMinutes(g.getMinutes()-10),(f=new Date(l.alarmEndTime.replace(/-/g,"/"))).setMinutes(f.getMinutes()+10),p.startTime=this.longTimeFormator(g),p.endTime=f>u?this.longTimeFormator(u):this.longTimeFormator(f)));else if("group-message"===n){if(-1==["0","1","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28"].indexOf(s.deviceType))return layer.msg("该监控对象不支持发送消息"),[2];p.id=d,p.name=c,p.type=s.deviceType}else"video-playback"===n&&(p.id=d,p.name=c,p.type=s.deviceType,b=null,s.assignmentId&&"-"!==s.assignmentId&&(y=s.assignmentId.split(",")).length>0&&(b=y[0]),p.pid=b);t.go(n,p)}return[2]}}))}))},e.prototype.handleCapture=function(e){return V(this,void 0,void 0,(function(){var t,a;return B(this,(function(n){switch(n.label){case 0:return(t=new FormData).set("vehicleId",e),[4,r.a.post("/clbs/lkyw/historicalSnapshot/photograph",t)];case 1:return(a=n.sent()).data.success?layer.msg("指令下发成功"):a.data.msg&&layer.msg(a.data.msg),[2]}}))}))},e.prototype.statusTableRowActive=function(){var e=this.state.data.statusTable,t=this.dependency.get("data").get("currentActiveVehicle");if(t){var a=t.id;a&&(e.setActiveRow(a),this.activeVehicleChange())}else e.setActiveRow(void 0)},e.prototype.statusTableRowTop=function(){var e=this.state.data,t=e.statusTable,a=e.statusDatas,n=this.dependency.get("data").get("currentSelectVehicle");if(n){var i=n.id;if(i){t.getState().lastClickRowId&&t.setActiveRow(void 0),t.setLockedRow(i);for(var r=0;r<a.length;r++){var s=a[r];s.vehicleId==i&&(a.splice(r,1),a.unshift(s))}this.activeVehicleChange()}}else t.setLockedRow(void 0)},e.prototype.activeVehicleChange=function(){var e=this;this.state.data.statusClickTimer&&(clearTimeout(this.state.data.statusClickTimer),this.state.data.statusClickTimer=null),this.state.data.statusClickTimer=setTimeout((function(){e.localRefresh()}),500)},e.prototype.handleStatusTableDblClick=function(e,t,a){var n=this.state.data.statusDatas;$.fn.zTree.getZTreeObj("lkywRealtimeTree").getNodeByParam("id",e,null);if(e){this.dependency.get("data").set("currentActiveVehicle",null),this.dependency.get("data").set("currentSelectVehicle",{id:e}),this.dependency.get("data").set("currentVLocation");for(var i=0;i<n.length;i++){var r=n[i];r.vehicleId==e&&(n.splice(i,1),n.unshift(r))}this.activeVehicleChange()}},e.prototype.handleStatusTableClick=function(e,t,a){var n=this.dependency.get("data").get("currentSelectVehicle");!e||n&&e==n.id?(this.dependency.get("data").set("currentActiveVehicle",null),this.dependency.get("data").set("currentSelectVehicle",null)):(this.dependency.get("data").set("currentSelectVehicle",null),this.dependency.get("data").set("currentActiveVehicle",{id:e}),this.dependency.get("data").set("currentVLocation"),this.activeVehicleChange())},e.prototype.handleStatusTableHover=function(e,t,a){return V(this,void 0,void 0,(function(){var e,t,n,i,r,s;return B(this,(function(o){switch(o.label){case 0:if(e=a.data("field"),t=a.data("id"),n=this.state.data.statusTable,null===(i=n.findRow(n.getState().data,n.getOption(),t)))return[2];switch(r=i[0],s="",e){case"positionDescription":return[3,1];case"oilMass":return[3,2];case"oilExpend":return[3,3];case"elecData":return[3,4];case"temperatureSensor":return[3,5];case"temphumiditySensor":return[3,6];case"positiveNegative":return[3,7];case"loadInfos":return[3,8];case"workHourSensor":return[3,9];case"tyreInfos":return[3,10];case"terminalIOStatus":return[3,11]}return[3,13];case 1:return s=this.buildPositionDescriptionTable(r.positionDescription),[3,14];case 2:return s=this.buildOilMassTable(r.oilMass),[3,14];case 3:return s=this.buildOilExpendTable(r.oilExpend,!0),[3,14];case 4:return s=this.buildElecDataTable(r.elecData),[3,14];case 5:return s=this.buildTemperatureSensorTable(r.temperatureSensor),[3,14];case 6:return s=this.buildTemphumiditySensorTable(r.temphumiditySensor),[3,14];case 7:return s=this.buildPositiveNegativeTable(r.positiveNegative),[3,14];case 8:return s=this.buildLoadInfosTable(r.loadInfos),[3,14];case 9:return s=this.buildWorkHourTable(r.workHourSensor),[3,14];case 10:return s=this.buildTyreInfosTable(r.tyreInfos),[3,14];case 11:return[4,this.buildTerminalIOStatus(t)];case 12:return s=o.sent(),[3,14];case 13:return[2];case 14:return s.length>0&&(this.state.data.lastStatusHoverRowId=t,this.state.data.lastStatusHoverField=e,a.justToolsTip({animation:"moveInTop",width:"auto",contents:s,gravity:"top",events:"mouseover",onRemove:function(){this.state.data.lastStatusHoverRowId=void 0,this.state.data.lastStatusHoverField=void 0}.bind(this)})),[2]}}))}))},e.prototype.buildOilMassTable=function(e){var t=[],a=[],n="";if(e&&1===e.length&&1===e[0].unusual)return"";if(e&&e.length>0){e=e.sort((function(e,t){return e.id-t.id}));for(var i=0;i<e.length;i++){a.push([]);var r=e[i];t.push(r.id.toString(16)+"液位传感器");var s=r.oilTem;s=void 0===r.oilTem||null===r.oilTem||r.oilTem<-50?"-":r.oilTem;var o=r.envTem;o=void 0===r.envTem||null===r.envTem||r.envTem<-50?"-":r.envTem,a[i].push("液位高度:",1===e[i].unusual?"异常":this.nvl(r.oilHeight,"mm")),a[i].push("AD值:",1===e[i].unusual?"异常":this.nvl(r.aDHeight,"")),a[i].push("液体温度:",1===e[i].unusual?"异常":this.nvl(s,"°C")),a[i].push("环境温度:",1===e[i].unusual?"异常":this.nvl(o,"°C")),a[i].push("加液量:",1===e[i].unusual?"异常":this.nvl(r.add,"L")),a[i].push("漏液量:",1===e[i].unusual?"异常":this.nvl(r.del,"L")),a[i].push("液体量:",1===e[i].unusual?"异常":this.nvl(r.oilMass,"L")),a[i].push("液位百分比:",1===e[i].unusual?"异常":this.nvl(r.percentage,"%"))}t.length>0&&a.length>0&&(n=this.buildHoverTable(t,a))}return n},e.prototype.buildOilExpendTable=function(e,t){var a=[],n=[],i="";if(e&&1===e.length&&1===e[0].unusual)return"";if(e&&e.length>0){e=e.sort((function(e,t){return e.id-t.id}));for(var r=0;r<e.length;r++){n.push([]);var s=e[r];a.push(s.id.toString(16)+"油耗传感器"),n[r].push("瞬时流量:",1===e[r].unusual?"异常":this.nvl(s.momentExpend,"L")),n[r].push("温度:",1===e[r].unusual?"异常":this.nvl(s.oilTem,"°C")),n[r].push("累计时间:",1===e[r].unusual?"异常":this.nvl(s.deltaTime,"h")),t?n[r].push("总流量:",1===e[r].unusual?"异常":this.nvl(s.allExpend,"L")):n[r].push("当日流量:",1===e[r].unusual?"异常":this.nvl(s.dayOilWear,"L"))}a.length>0&&n.length>0&&(i=this.buildHoverTable(a,n))}return i},e.prototype.buildElecDataTable=function(e){var t=[],a=[[]],n="";if(e&&1===e.unusual)return"";return null!=e&&(t.push(e.id.toString(16)+"电量电压"),void 0!==e.deviceElectricity&&null!==e.deviceElectricity&&(0===e.type?e.deviceElectricity<=100&&a[0].push("设备电量:",1===e.unusual?"异常":this.nvl(e.deviceElectricity,"%")):e.deviceElectricity<6e3&&a[0].push("设备电压:",1===e.unusual?"异常":this.nvl(e.deviceElectricity,"V"))),void 0!==e.drivingElectricity&&null!==e.drivingElectricity&&(0===e.type?e.drivingElectricity<=100&&a[0].push("行车电量:",1===e.unusual?"异常":this.nvl(e.drivingElectricity,"%")):e.drivingElectricity<6e3&&a[0].push("行车电压:",1===e.unusual?"异常":this.nvl(e.drivingElectricity,"V"))),void 0!==e.coldStorageElectricity&&null!==e.coldStorageElectricity&&(0===e.type?e.coldStorageElectricity<=100&&a[0].push("冷藏电量:",1===e.unusual?"异常":this.nvl(e.coldStorageElectricity,"%")):e.coldStorageElectricity<=6e3&&a[0].push("冷藏电压:",1===e.unusual?"异常":this.nvl(e.coldStorageElectricity,"V"))),t.length>0&&a.length>0&&(n=this.buildHoverTable(t,a))),n},e.prototype.buildTemperatureSensorTable=function(e){var t=[],a=[],n="";if(e&&1===e.length&&1===e[0].unusual)return"";if(e&&e.length>0){e=e.sort((function(e,t){return e.id-t.id}));for(var i=0;i<e.length;i++){a.push([]);var r=e[i];t.push(r.id.toString(16)+"温度传感器"),a[i].push("温度值:",1===e[i].unusual?"异常":this.nvl(r.temperature,"°C")),a[i].push("状态持续时间:",1===e[i].unusual?"异常":this.nvl(r.outTime,"s"))}t.length>0&&a.length>0&&(n=this.buildHoverTable(t,a))}return n},e.prototype.buildTemphumiditySensorTable=function(e){var t=[],a=[],n="";if(e&&1===e.length&&1===e[0].unusual)return"";if(e&&e.length>0){e=e.sort((function(e,t){return e.id-t.id}));for(var i=0;i<e.length;i++){a.push([]);var r=e[i];t.push(r.id.toString(16)+"湿度传感器"),a[i].push("湿度值:",1===e[i].unusual?"异常":this.nvl(r.temperature,"%")),a[i].push("状态持续时间:",1===e[i].unusual?"异常":this.nvl(r.outTime,"s"))}t.length>0&&a.length>0&&(n=this.buildHoverTable(t,a))}return n},e.prototype.buildPositiveNegativeTable=function(e){var t=[],a=[],n="";if(e&&1===e.length&&1===e[0].unusual)return"";if(e&&e.length>0){e=e.sort((function(e,t){return e.id-t.id}));for(var i=0;i<e.length;i++){a.push([]);var r=e[i],s=1===r.spinState?"停转":"运行",o="";"运行"===s&&(o=1===r.spinDirection?"正转":"反转"),t.push(r.id.toString(16)+"正反转传感器"),a[i].push("旋转状态:",1===e[i].unusual?"异常":s),a[i].push("旋转方向:",1===e[i].unusual?"异常":o),a[i].push("旋转速度:",1===e[i].unusual?"异常":this.nvl(r.spinSpeed,"转/min")),a[i].push("累计运行时间:",1===e[i].unusual?"异常":this.nvl(r.winchTime,"h")),a[i].push("累计脉冲数量:",1===e[i].unusual?"异常":this.nvl(r.winchCounter,"")),a[i].push("旋转方向持续时间:",1===e[i].unusual?"异常":this.nvl(r.winchRotateTime,"min"))}t.length>0&&a.length>0&&(n=this.buildHoverTable(t,a))}return n},e.prototype.buildLoadInfosTable=function(e){var t=[],a=[],n="";if(e&&1===e.length&&1===e[0].unusual)return"";if(e&&e.length>0){e=e.sort((function(e,t){return e.id-t.id}));for(var i=0;i<e.length;i++){a.push([]);var r=e[i],s="";1===r.status?s="空载":2===r.status?s="满载":3===r.status?s="超载":4===r.status?s="装载":5===r.status?s="卸载":6===r.status?s="轻载":7===r.status&&(s="重载"),t.push(r.id.toString(16)+"载重传感器"),a[i].push("载重状态:",1===e[i].unusual?"异常":s),"装载"===s?a[i].push("装载次数:",1===e[i].unusual?"异常":this.nvl(r.countNum,"")):"卸载"===s&&a[i].push("卸载次数:",1===e[i].unusual?"异常":this.nvl(r.countNum,"")),a[i].push("载荷重量:",1===e[i].unusual?"异常":this.nvl(r.loadWeight,"kg")),"装载"===s?a[i].push("装载总量:",1===e[i].unusual?"异常":this.nvl(r.weight,"kg")):"卸载"===s&&a[i].push("卸载总量:",1===e[i].unusual?"异常":this.nvl(r.weight,"kg")),a[i].push("载重相对值:",1===e[i].unusual?"异常":this.nvl(r.weightAd,"")),a[i].push("原始AD值:",1===e[i].unusual?"异常":this.nvl(r.originalAd,"")),a[i].push("浮动零点:",1===e[i].unusual?"异常":this.nvl(r.floatAd,""))}t.length>0&&a.length>0&&(n=this.buildHoverTable(t,a))}return n},e.prototype.buildWorkHourTable=function(e){var t=[],a=[],n="";if(e&&1===e.length&&1===e[0].unusual)return"";if(e&&e.length>0){e=e.sort((function(e,t){return e.id-t.id}));for(var i=0;i<e.length;i++){a.push([]);var r=e[i],s="";0===r.workInspectionMethod?s="电压比较式":1===r.workInspectionMethod?s="油耗阈值式":2===r.workInspectionMethod&&(s="油耗波动式");var o="";0===r.workInspectionMethod||1===r.workInspectionMethod?0===r.workingPosition?o="停机":1===r.workingPosition?o="工作":2===r.workingPosition&&1===r.workInspectionMethod&&(o="待机"):2===r.workInspectionMethod&&(o=0===r.workingPosition?"停机":"非停机"),t.push(r.id.toString(16)+"工时传感器"),a[i].push("工时检测方式:",1===e[i].unusual?"异常":s),a[i].push("工作状态:",1===e[i].unusual?"异常":o),a[i].push("状态持续时长:",1===e[i].unusual?"异常":this.nvl(r.continueTime,"s")),a[i].push("波动值:",1===e[i].unusual?"异常":this.nvl(r.waveValue,0===r.workInspectionMethod?"V":"L/h")),a[i].push("检测数据:",1===e[i].unusual?"异常":this.nvl(r.checkData,""))}t.length>0&&a.length>0&&(n=this.buildHoverTable(t,a))}return n},e.prototype.buildPositionDescriptionTable=function(e){return e},e.prototype.buildAlarmTypeTable=function(e){return e},e.prototype.buildTyreInfosTable=function(e){var t,a,n="";if(e&&1===e.unusual)return"";if(null!=e&&void 0!==e.list&&null!==e.list){var i=e.list.sort((function(e,t){return e.number-t.number}));if(i&&i.length>0)for(var r=0;r<i.length;r+=5){var s=Math.min(r+5,i.length);t=[],a=[];for(var o=r;o<s;o++){a.push([]);var l=i[o];t.push((l.number+1).toString()+"号轮胎"),a[o-r].push("轮胎气压:",1===e.unusual?"异常":this.nvl(l.pressure,"bar")),a[o-r].push("轮胎胎温:",1===e.unusual?"异常":this.nvl(l.temperature,"°C")),a[o-r].push("电池电量:",1===e.unusual?"异常":this.nvl(l.electric,"%"))}t.length>0&&a.length>0&&(n+=this.buildHoverTable(t,a))}}return n},e.prototype.buildHoverTable=function(e,t){var a='<table class="hover-table">$0$1</table>',n="<thead><tr>$0</tr></thead>",i="<tbody>$0</tbody>",r="<td>$0</td>";n=n.replace("$0",e.map((function(e){return'<th colspan="2">$0</th>'.replace("$0",e)})).join(""));var s="";if(0===t.length)return"";for(var o=0;o<t[0].length;o+=2){for(var l="<tr>",d=0;d<t.length;d++)l+=r.replace("$0",t[d][o]),l+=r.replace("$0",t[d][o+1]);s+=l+="</tr>"}return i=i.replace("$0",s),a=a.replace("$0",n).replace("$1",i)},e.prototype.buildTerminalIOStatus=function(e){return V(this,void 0,void 0,(function(){var t,a,n,i,s,o;return B(this,(function(l){switch(l.label){case 0:return t="",(a=new FormData).set("monitorId",e),a.set("type","terminalIo"),[4,r.a.post("/clbs/v/monitoring/getIoSignalInfo",a)];case 1:if(n=l.sent(),(i=n.data).success||(t="获取终端IO状态失败"),i.obj&&1===i.obj.length&&i.obj[0].ioData&&i.obj[0].ioData.length>0)for(s=0;s<i.obj[0].ioData.length;s++)"无接口"!==(o=i.obj[0].ioData[s]).ioStatusName&&(t+='<p style="margin: 0">'+o.ioName+":  "+o.ioStatusName+"</p>");return i.obj&&0===i.obj.length&&(t="暂无数据"),[2,'<div style="padding: 0 5px">'+t+"</div>"]}}))}))},e.prototype.nvl=function(e,t){return null==e?"":e.toString()+"&ensp;"+t},e.prototype.setActiveRow=function(e){this.state.data.statusTable.setActiveRow(e),this.activeVehicleChange()},e.prototype.setLockedRow=function(e){var t=this.state.data,a=t.statusTable,n=t.statusDatas;a.setLockedRow(e);for(var i=0;i<n.length;i++){var r=n[i];r.vehicleId==e&&(n.splice(i,1),n.unshift(r))}this.activeVehicleChange()},e.prototype.statusScrollPage=function(){var e=this,t=this.state.data,a=t.statusScrollTimer,n=t.statusTable;this.state.data.statusClickTimer&&(clearTimeout(this.state.data.statusClickTimer),this.state.data.statusClickTimer=null),a&&(this.state.data.statusScrollTimer=null,clearTimeout(a));var i=n.rightTable?n.rightTable.getState().$dom.$inner:n.getState().$dom.$inner,r=i.scrollTop();this.state.data.statusScrollTimer=setTimeout((function(){var t=i.scrollTop();r==t&&e.localRefresh()}),1e3)},e.prototype.customHandleStatusSort=function(e,t){var a=this;Number($("#allVihecle .allSize").text())<2e3?this.statusSortCB(e,t):layer.confirm("数据过大排序耗时较长，确认继续吗？",{btn:["确定","取消"]},(function(){layer.closeAll(),layer.load(2),a.statusSortCB(e,t)}))},e.prototype.statusSortCB=function(e,t){return V(this,void 0,void 0,(function(){return B(this,(function(a){return this.state.data.sortColumnIndex=e,this.state.data.sortDirection=t,this.setLocaleRefreshTimer(),this.postMessage("statusSort",[]),[2]}))}))},e.prototype.destory=function(){this.state.$origin.empty()},e}(),q=a(210),H=a.n(q),U=(a(211),function(e,t,a,n){return new(a||(a=Promise))((function(i,r){function s(e){try{l(n.next(e))}catch(e){r(e)}}function o(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(s,o)}l((n=n.apply(e,t||[])).next())}))}),G=function(e,t){var a,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function o(r){return function(o){return function(r){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],n=0}finally{a=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,o])}}},K=function(e){for(var t=document.cookie.split("; "),a=0;a<t.length;a++){var n=t[a].split("=");if(n[0]==e)return n[1]}return""},Z=function(){function e(e,t){this.setOption(e),this.dependency=t}return e.prototype.setOption=function(e){this.option=e,this.state={$origin:null,$dom:{$submitBtn:null,$closeBtn:null,$allCheck:null,$sortUp:null,$sortDown:null,$checkBox:null,$onlineCheckbox:null,$alarmCheckbox:null,$safetyCheckbox:null,$filterCheckbox:null,$popupCheckbox:null,$voiceCheck:null,$flashCheck:null},data:{columnKeys:["TGAC_AlERT_WINDOW_REALTIME_DATA_LIST","TGAC_RAPID_SCREENING","TGAC_REALTIME_MONITORING_ACTIVE_SAFETY_LIST","TGAC_REALTIME_MONITORING_ALARM_LIST","TGAC_REALTIME_MONITORING_LIST"],unSelectTab:[],columnUrl:"/clbs/core/uum/custom/getSettingByColumnModule",avoidRepeatSubmitToken:"",onlineData:{},alarmData:{},activeSafetyData:{},filterData:{},popupData:{},reportData:null}},this.state.$origin=$(e.selector),this.initHtml(),this.bindEvent(),this.setVoiceAndFlash()},e.prototype.initHtml=function(){return U(this,void 0,void 0,(function(){var e;return G(this,(function(t){switch(t.label){case 0:return e=$(H.a),this.state.$origin.empty(),this.state.$origin.append(e),this.initElement(e),[4,this.getColumnData()];case 1:return t.sent(),$("#customList").modal("show").on("hidden.bs.modal",this.destory.bind(this)),[2]}}))}))},e.prototype.initElement=function(e){layer.load(2),this.state.$dom.$submitBtn=e.find("#submitBtn"),this.state.$dom.$closeBtn=e.find(".closeBtn"),this.state.$dom.$allCheck=e.find(".allCheck"),this.state.$dom.$sortUp=e.find(".sortUp"),this.state.$dom.$sortDown=e.find(".sortDown"),this.state.$dom.$checkBox=e.find(".checkBox"),this.state.$dom.$voiceCheck=e.find("#voiceCheck"),this.state.$dom.$flashCheck=e.find("#flashCheck"),this.state.$dom.$onlineCheckbox=e.find("#onlineCheckbox"),this.state.$dom.$alarmCheckbox=e.find("#alarmCheckbox"),this.state.$dom.$safetyCheckbox=e.find("#safetyCheckbox"),this.state.$dom.$filterCheckbox=e.find("#filterCheckbox"),this.state.$dom.$popupCheckbox=e.find("#popupCheckbox")},e.prototype.bindEvent=function(){this.state.$dom.$allCheck.bind("click",this.checkAll),this.state.$dom.$sortUp.bind("click",this.sortUpOrDown),this.state.$dom.$sortDown.bind("click",this.sortUpOrDown),this.state.$dom.$checkBox.bind("change",".columnCheck",this.onCheckChange),this.state.$dom.$checkBox.bind("click",".checkLabel",(function(e){var t=$(e.target).parents(".checkLabel");t.addClass("active").siblings("div").removeClass("active"),t.closest(".tab-pane").find("button").removeAttr("disabled")})),this.state.$dom.$submitBtn.bind("click",this.doSubmit.bind(this))},e.prototype.destory=function(){this.state.$origin.empty()},e.prototype.computedTab=function(e){for(var t in e){switch(e[t].mark){case"TGAC_RAPID_SCREENING":this.state.data.filterData=e[t],this.initTabHtml(e[t],"filterTab");break;case"TGAC_REALTIME_MONITORING_ALARM_LIST":this.state.data.alarmData=e[t],this.initTabHtml(e[t],"alarmTab");break;case"TGAC_AlERT_WINDOW_REALTIME_DATA_LIST":this.state.data.popupData=e[t],this.initTabHtml(e[t],"popupTab");break;case"TGAC_REALTIME_MONITORING_LIST":this.state.data.onlineData=e[t],this.initTabHtml(e[t],"onlineTab");break;case"TGAC_REALTIME_MONITORING_ACTIVE_SAFETY_LIST":this.state.data.activeSafetyData=e[t],this.initTabHtml(e[t],"safetyTab")}}},e.prototype.initTabHtml=function(e,t){var a=$("#"+t),n="",i=0,r=e.mark,s=e.fixSize,o=e.dataList;if(!o.length)return!1;o.forEach((function(e,t){var a,s="";"0"==e.status?(s='<input class="columnCheck" type="checkbox" data-index="'+t+'" data-mark="'+r+'" checked>',i++):s='<input class="columnCheck" type="checkbox" data-index="'+t+'" data-mark="'+r+'">',a='<div class="checkLabel">'+s+'<span class="columnTitle"> '+e.title+"</span></div>",n+=a})),a.find(".checkBox").html(n),layer.closeAll("loading"),a.find("input[value="+s+"]").prop("checked",!0),i===o.length&&a.find(".allCheck").prop("checked",!0)},e.prototype.onCheckChange=function(e){for(var t=$(e.target).closest(".checkBox"),a=t.find(".columnCheck"),n=0,i=0;i<a.length;i++)$(a[i]).prop("checked")&&n++;n===a.length?t.siblings("label").find("input").prop("checked",!0):t.siblings("label").find("input").prop("checked",!1)},e.prototype.sortUpOrDown=function(e){var t=e.currentTarget.className,a=$(e.target).closest(".tab-pane").find(".checkLabel.active");0!=a.length&&("sortUp"==t?a.insertBefore(a.prev("div")):a.insertAfter(a.next("div")))},e.prototype.checkAll=function(e){var t=$(e.target);t.prop("checked")?t.closest("label").siblings(".checkBox").find("input").prop("checked",!0):t.closest("label").siblings(".checkBox").find("input").prop("checked",!1)},e.prototype.tabIsNull=function(e){var t=this.state.data.unSelectTab;switch(e){case"TGAC_REALTIME_MONITORING_LIST":t.push("全部车辆");break;case"TGAC_REALTIME_MONITORING_ALARM_LIST":t.push("808报警");break;case"TGAC_REALTIME_MONITORING_ACTIVE_SAFETY_LIST":t.push("主动安全");break;case"TGAC_RAPID_SCREENING":t.push("快速筛选");break;case"TGAC_AlERT_WINDOW_REALTIME_DATA_LIST":t.push("动态弹框")}},e.prototype.doSubmit=function(){return U(this,void 0,void 0,(function(){var e,t,a,n,i,s,o,l,d,c,p,u,h,m,v,g;return G(this,(function(f){switch(f.label){case 0:for(layer.load(2),e=this.state.$dom.$checkBox,t=this.state.data,a=[t.onlineData,t.alarmData,t.activeSafetyData,t.filterData,t.popupData],n=[],t.unSelectTab=[],this.alramSetting(),i=0;i<e.length;i++){if(0==(s=$(e[i]).find(".columnCheck:checked")).length&&(o=$(e[i]).find(".columnCheck").attr("data-mark"),this.tabIsNull(o)),l=$(e[i]).siblings(".radioBox").find('input[type="radio"]:checked').val(),0!==(d=parseInt(l))&&d>=s.length)return[2];for(c=0;c<s.length;c++)p=parseInt($(s[c]).attr("data-index")),u=$(s[c]).attr("data-mark"),h=a[i].dataList,(m={columnId:h[p].columnId,title:h[p].title,mark:u,columnName:h[p].columnName,sort:0,isFix:0}).sort=c+1,m.isFix=0,d>0&&m.sort<=d&&(m.isFix=1),n.push(m)}return t.unSelectTab.length>0?(layer.msg("【"+t.unSelectTab.join(",")+"】页签下请至少选择一列"),layer.closeAll("loading"),[2]):((v=new FormData).append("customColumnConfigJson",JSON.stringify(n)),v.append("title","实时监控状态信息列表"),v.append("avoidRepeatSubmitToken",this.state.data.avoidRepeatSubmitToken),[4,r.a.post("/clbs/core/uum/custom/addCustomColumnConfig",v)]);case 1:return g=f.sent(),this.submitCallback(g.data),[2]}}))}))},e.prototype.submitCallback=function(e){e.success?(this.dependency.get("data").set("customColumnsStatu",1),layer.msg("设置成功"),$("#customList").modal("hide")):e.msg?layer.msg(e.msg):layer.msg("失败了");layer.closeAll("loading")},e.prototype.getColumnData=function(){return U(this,void 0,void 0,(function(){var e,t,a;return G(this,(function(n){switch(n.label){case 0:return this.state.data.columnKeys,e=this.state.data.columnUrl,(t=new FormData).set("columnModule","TWO_GUEST_A_CRISIS_REALTIME_MONITORING"),[4,r.a.post(e,t)];case 1:return(a=n.sent()).data.success?this.computedTab(a.data.obj):a.data.msg,[2]}}))}))},e.prototype.alramSetting=function(){var e=K("userName"),t=$("#voiceCheck").prop("checked"),a=$("#flashCheck").prop("checked"),n=($("#lkywListWrap").find("li[data-voice = 'on']").length,$("#noticeAutoOff")[0]);t?localStorage.setItem("voiceCheck_"+e,"checked"):(localStorage.setItem("voiceCheck_"+e,"unChecked"),n.pause()),a?localStorage.setItem("flashCheck_"+e,"checked"):(localStorage.setItem("flashCheck_"+e,"unChecked"),$("#lkywListWrap").find(".fa-flashicon").removeClass("fa-flashicon"),$("#lkywListWrap li").css({border:""}),$("#lkywListWrap li").prop("unhandled",!1))},e.prototype.setVoiceAndFlash=function(){var e=K("userName"),t=localStorage.getItem("voiceCheck_"+e),a=localStorage.getItem("flashCheck_"+e);"checked"==t||null==t?this.state.$dom.$voiceCheck.prop("checked",!0):"unChecked"==t&&this.state.$dom.$voiceCheck.prop("checked",!1),"checked"==a||null==a?this.state.$dom.$flashCheck.prop("checked",!0):"unChecked"==a&&this.state.$dom.$flashCheck.prop("checked",!1)},e}(),J=a(212),Q=a.n(J),Y=(a(213),a(214)),X=a.n(Y),ee=a(51),te=function(){return(te=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var i in t=arguments[a])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},ae=function(e,t,a,n){return new(a||(a=Promise))((function(i,r){function s(e){try{l(n.next(e))}catch(e){r(e)}}function o(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(s,o)}l((n=n.apply(e,t||[])).next())}))},ne=function(e,t){var a,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function o(r){return function(o){return function(r){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],n=0}finally{a=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,o])}}},ie={_808Alarm:void 0,activitySecurity:void 0,phone:void 0,smoke:void 0,fatigueDriving:void 0,abnormalPosture:void 0,overSpeedAlarm:void 0,tireDriving:void 0,deviationAlarms:void 0,transactionAlarm:void 0,areaAlarm:void 0,emergencyAlarm:void 0,unprocessedAlarm:void 0},re=function(){function e(e,t){this.dependency=t,this.setOption(e)}return e.prototype.setOption=function(e){var t=this;this.option=e,this.state={$origin:null,$dom:{$setting:null},data:{currentType:null,deletSize:0,isInit:!0,securityAlarm:["activitySecurity","phone","smoke","fatigueDriving","abnormalPosture"],terminalAlarm:["808Alarm","overSpeedAlarm","tireDriving","deviationAlarms","transactionAlarm","areaAlarm","emergencyAlarm","unprocessedAlarm"],ITerminalAlarmTypeNum:{deviationAlarms:"23,75,118,149",emergencyAlarm:"0",tireDriving:"2,79",areaAlarm:"2011,2012,20,7211,7212,11511,11512",overSpeedAlarm:"1,164,67,76",transactionAlarm:"77,7702,7703"}}},this.state.$origin=$(e.selector),this.initHtml(),this.bindEvent(),this.renderSecurityAlarmNum(),this.renderTerminalAlarmNum(),setInterval((function(){t.renderSecurityAlarmNum(),t.renderTerminalAlarmNum()}),3e4)},e.prototype.initHtml=function(){var e=$(Q.a);this.state.$origin.empty(),this.state.$origin.append(e),this.state.$dom.$setting=e.find(".lkyw-icon-settting")},e.prototype.bindEvent=function(){this.dependency.get("data").on("onTableFilterColumnsChange",this.onTableFilterColumnsChange.bind(this)),this.dependency.get("data").on("onDealSecurityAlarmChange",this.renderSecurityAlarmNum.bind(this)),this.dependency.get("data").on("onDeal808AlarmChange",this.renderTerminalAlarmNum.bind(this)),$("#lkywListWrap").on("click","li",this.filterDataHandler.bind(this)),$("#lkywListWrap").on("click",".fa-close",this.deleteFilter.bind(this)),this.state.$dom.$setting.on("click",this.handleOpenSetting.bind(this))},e.prototype.handleOpenSetting=function(){new Z({selector:"#"+ee.a.modalContainerId},this.dependency)},e.prototype.onTableFilterColumnsChange=function(){var e=this.dependency.get("data").get("tableFilterColumns"),t={data:e},a=X()(t);if($("#lkywFilter .lkyw-lists-wrap").html(a),$(".lkyw-filter-lists li[data-type="+this.state.data.currentType+"]").addClass("active"),$("#divSlideWrap").divSlide(),this.state.data.isInit){this.state.data.isInit=!1;var n=e[0].columnName;this.getFirstFilter(n)}this.state.data.deletSize=0},e.prototype.renderSecurityAlarmNum=function(){return ae(this,void 0,void 0,(function(){var e;return ne(this,(function(t){switch(t.label){case 0:return[4,this.getSecurityAlarmNum()];case 1:return e=t.sent(),this.setNumDom(e),[2]}}))}))},e.prototype.getSecurityAlarmNum=function(){return ae(this,void 0,void 0,(function(){var e,t,a,n;return ne(this,(function(i){switch(i.label){case 0:return e=new FormData,t=["phone","smoke","fatigueDriving","abnormalPosture"],e.set("eventFields",t.join(",")),[4,r.a.post("/clbs/adas/v/monitoring/getEventCountByEventFields",e)];case 1:return 200==(a=i.sent()).status&&(n=a.data.obj)?(setTimeout((function(){ie=te(te({},ie),n)}),0),[2,n]):[2]}}))}))},e.prototype.renderTerminalAlarmNum=function(){return ae(this,void 0,void 0,(function(){var e;return ne(this,(function(t){switch(t.label){case 0:return[4,this.getTerminalAlarmNum()];case 1:return e=t.sent(),this.setNumDom(e),[2]}}))}))},e.prototype.getTerminalAlarmNum=function(){return ae(this,void 0,void 0,(function(){var e,t,a;return ne(this,(function(n){switch(n.label){case 0:return[4,r.a.post("/clbs/lkyw/v/monitoring/getTodayAlarmQuantity",null)];case 1:return 200==(e=n.sent()).status&&(t=e.data.obj)?(a={deviationAlarms:t.deviateAlarmNum,emergencyAlarm:t.emergencyAlarmNum,tireDriving:t.fatigueDrivingAlarmNum,areaAlarm:t.regionalAlarmNum,overSpeedAlarm:t.speedAlarmNum,transactionAlarm:t.unusualActionAlarmNum},setTimeout((function(){ie=te(te({},ie),a)}),0),[2,a]):[2]}}))}))},e.prototype.setNumDom=function(e){var t=function(e){for(var t=document.cookie.split("; "),a=0;a<t.length;a++){var n=t[a].split("=");if(n[0]==e)return n[1]}return""}("userName"),a=localStorage.getItem("voiceCheck_"+t)?localStorage.getItem("voiceCheck_"+t):"checked",n=localStorage.getItem("flashCheck_"+t)?localStorage.getItem("flashCheck_"+t):"checked",i=function(t){var i,r=$(".lkyw-filter-lists li[data-type="+t+"]:visible"),s=r.find(".icon"),o=r.find(".num"),l=e[t];"808Alarm"==t&&(t="_808Alarm"),i=ie[t];if(l){var d="<span>("+(l>999?"999+":l)+")</span>";"checked"==n&&l>i||1==r.prop("unhandledFlash")?(r.css({border:"1px solid red",borderRadius:"4px"}),r.prop("unhandledFlash",!0),s.html('<i class="fa fa-warning fa-flashicon"></i>')):(r.css({border:""}),s.html('<i class="fa fa-warning"></i>')),function(){if("checked"==a&&l>i&&0!=r.length){var e=$("#noticeAutoOff")[0];e.paused&&(e.currentTime=0,e.play())}}(),o.html(d)}else s.empty(),o.empty()};for(var r in e)i(r)},e.prototype.getFirstFilter=function(e){var t=this.getTableIndex(e);$(".table-wrap").eq(t).addClass("active").siblings(".table-wrap").removeClass("active"),$(".lkyw-filter-lists li[data-type="+e+"]").addClass("active"),this.state.data.currentType=e},e.prototype.filterDataHandler=function(e){$("#activeSafetyPop").hasClass("in show")&&$("#activeSafetyPop").removeClass("in show");var t=e.currentTarget,a=$(t).data("type"),n=this.getTableIndex(a),i=this.state.data,r=i.securityAlarm,s=i.terminalAlarm,o=i.ITerminalAlarmTypeNum,l=this.dependency.get("data");if($(t).addClass("active").siblings("li").removeClass("active"),$(".table-wrap").eq(n).addClass("active").siblings(".table-wrap").removeClass("active"),-1!=r.indexOf(a)){var d="activitySecurity"!=a?a:"";l.set("securityAlarmType",d)}if(-1!=s.indexOf(a)){d="808Alarm"!=a?o[a]:"";l.set("terminalAlarmMarker",a),l.set("terminalAlarmType",d)}$(".lkyw-filter-lists li[data-type="+a+"]").prop("unhandledFlash",!1).css("border","").find(".fa-flashicon").removeClass("fa-flashicon"),$("#noticeAutoOff")[0].pause()},e.prototype.getTableIndex=function(e){var t=0,a=this.state.data,n=a.securityAlarm,i=a.terminalAlarm;return-1!=n.indexOf(e)?t=2:-1!=i.indexOf(e)&&(t=1),t},e.prototype.deleteFilter=function(e){var t=e.currentTarget,a=$(t).data("id"),n=$(".lkyw-filter-lists li").length;this.state.data.deletSize++;var i=$("#noticeAutoOff")[0];if(i.played&&i.pause(),!(this.state.data.deletSize>=n))return $(t).closest("li").hide(),this.senddeleteFilter(a),!1;layer.msg("最后一项不能删除")},e.prototype.senddeleteFilter=function(e){return ae(this,void 0,void 0,(function(){var t,a;return ne(this,(function(n){switch(n.label){case 0:return(t=new FormData).set("columnId",e),t.set("mark","TGAC_RAPID_SCREENING"),[4,r.a.post("/clbs/core/uum/custom/deleteUserMarkColumn",t)];case 1:return 200==(a=n.sent()).status&&(a.data.success?layer.msg("删除成功"):a.data.msg&&layer.msg(a.data.msg)),[2]}}))}))},e.prototype.destory=function(){this.state.$origin.empty()},e}(),se=a(215),oe=a.n(se),le=(a(216),function(e,t,a,n){return new(a||(a=Promise))((function(i,r){function s(e){try{l(n.next(e))}catch(e){r(e)}}function o(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(s,o)}l((n=n.apply(e,t||[])).next())}))}),de=function(e,t){var a,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function o(r){return function(o){return function(r){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],n=0}finally{a=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,o])}}},ce=function(){function e(e,t){this.setOption(e)}return e.prototype.setOption=function(e){this.option=e,this.state={$origin:null,$dom:{},data:{}},this.state.$origin=$(e.selector),this.initHtml(),this.bindEvent()},e.prototype.initHtml=function(){return le(this,void 0,void 0,(function(){var e;return de(this,(function(t){return e=$(oe.a),this.state.$origin.empty(),this.state.$origin.append(e),[2]}))}))},e.prototype.bindEvent=function(){},e.prototype.destory=function(){this.state.$origin.empty()},e.prototype.resize=function(){var e=document.body.clientWidth;$("#fenceBindTable").css("width",e-315+"px"),$(window).resize((function(){var e=document.body.clientWidth;$("#fenceBindTable").css("width",e-315+"px")}))},e}(),pe=a(217),ue=a.n(pe),he=(a(178),a(218),function(e,t,a,n){return new(a||(a=Promise))((function(i,r){function s(e){try{l(n.next(e))}catch(e){r(e)}}function o(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(s,o)}l((n=n.apply(e,t||[])).next())}))}),me=function(e,t){var a,n,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function o(r){return function(o){return function(r){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],n=0}finally{a=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,o])}}},ve=function(){function e(e,t){this.dependency=t,this.setOption(e)}return e.prototype.setOption=function(e){return he(this,void 0,void 0,(function(){return me(this,(function(t){switch(t.label){case 0:return this.option=e,this.state={$origin:null,$dom:{},data:{}},this.state.$origin=$(e.selector),[4,this.initHtml()];case 1:return t.sent(),this.bindEvent(),[2]}}))}))},e.prototype.initHtml=function(){return he(this,void 0,void 0,(function(){return me(this,(function(e){return this.state.$origin.empty(),this.state.$origin.html(ue.a),[2]}))}))},e.prototype.bindEvent=function(){var e=this.dependency.get("data"),t=e.get("videoUrl"),a=e.get("videoPort"),n=e.get("audioPort"),i=Object(u.a)({access_token:e.get("access_token")});realtimeMonitoringVideoSeparate.init(t,a,n,d.a,i),activeSafety.init()},e.prototype.destory=function(){realtimeMonitoringVideoSeparate.closeTerminalVideo(),this.state.$origin.empty()},e}(),ge=function(){function e(e,t){this.dependency=t,this.setOption(e)}return e.prototype.setOption=function(e){this.option=e,this.state={$origin:null,$dom:{$mapContiner:null,$tab:null},data:{filterDatas:null}},this.state.$origin=$(e.selector),this.initHtml(),this.bindEvent()},e.prototype.initHtml=function(){var e=$(i.a);this.state.$origin.empty(),this.state.$origin.append(e),this.renderContent(),this.state.$dom.$tab=e.find(".nav-tabs")},e.prototype.renderContent=function(){var e=new A({selector:"#lkywRealtimeTop"},this.dependency);this.dependency.set("realtimeAMap",e);var t=new b({selector:"#lkywRealtimeMonitors"},this.dependency);this.dependency.set("realtimeMonitorTree",t);new ce({selector:"#fenceBindTable"},this.dependency),new L.a({selector:"#lkywRealtimeFence"},this.dependency);var a=new W({selector:"#lkywRealtimeTables"},this.dependency);this.dependency.set("realtimeMonitorTable",a);new re({selector:"#lkywRealtimeFilter"},this.dependency),new ve({selector:".videoDrawer-container"},this.dependency)},e.prototype.bindEvent=function(){this.state.$dom.$tab.on("click","li",this.tabChange.bind(this)),$("#toggleLeftPart").on("click",this.goHidden.bind(this)),$("#goShow").on("click",this.goShow.bind(this)),$("body").on("click",this.hideModal.bind(this));var e=this,t=$("#btn-videoRealTime-show");t.click((function(){var a=$(".videoDrawer-container"),n=e.dependency.get("data").get("videoMonitor");if(a.hasClass("active"))a.removeClass("active"),t.css({right:"10px","z-index":99}),$("#videoSelect").removeClass("active"),$("#callSelect").hasClass("active")&&realtimeMonitoringVideoSeparate.callOrder(),realtimeMonitoringVideoSeparate.closeTerminalVideo();else if(n){var i=n.vehicleId,r=n.name;if(!realtimeMonitoringVideoSeparate.checkVehicleOnlineStatus(i))return void layer.msg("监控对象离线");a.addClass("active"),t.css({right:"680px","z-index":1040}),realtimeMonitoringVideoSeparate.startPlayVideo({vid:i,brand:r}),activeSafety.riskInformationDetails(i)}else layer.msg("请先双击订阅在线监控对象")}))},e.prototype.tabChange=function(e){var t=e.currentTarget.innerText,a=$("#lkywRealtimeTop");"监控对象"==t?($("#lkywMonitorTableWrap").removeClass("hide").siblings("#fenceBindTable").hide(),a.removeClass("full-height"),$("#realtimeMapContainer").css("height","100%")):"电子围栏"==t&&($("#lkywMonitorTableWrap").addClass("hide").siblings("#fenceBindTable").show(),a.addClass("full-height"),$("#realtimeMapContainer").css("height","calc(100% - 48px)"))},e.prototype.goHidden=function(){var e=$(".lkyw-realtime-bar"),t=$(".lkyw-realtime-content"),a=$("#goShow"),n=$("#toggleLeftPart");t.css({width:"100%"}),e.hide(),a.show(),n.hide()},e.prototype.goShow=function(){var e=$(".lkyw-realtime-bar"),t=$(".lkyw-realtime-content"),a=$("#goShow"),n=$("#toggleLeftPart");t.css({width:"calc(100% - 319px)"}),e.show(),n.show(),a.hide()},e.prototype.hideModal=function(e){$("#tableRightMenu").hide(),$("#rMenu").hide()},e.prototype.destory=function(){$("body").off("click",this.hideModal),this.state.$origin.empty()},e}();t.default=ge}}]);