(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{175:function(t,e,a){"use strict";a.d(e,"a",(function(){return i}));var n=a(177);function i(t){var e=t;return n.inflate(e,{to:"string"})}},178:function(t,e,a){},180:function(t,e){var a=function(t,e){this.options=e,this.$origin=$(t),this.isDragging=!1,this.downY=0,this.downX=0,this.downTop=0,this.moveHandler=null,this.$indicator=null,this.delta=0,this.$origin.on("mousedown",a.prototype.mousedownHandler.bind(this)),$("body").on("mouseup",a.prototype.mouseupHandler.bind(this))};a.prototype.mousedownHandler=function(t){t.preventDefault(),this.isDragging=!0,this.downX=t.clientX,this.downY=t.clientY,this.$indicator=$('<div class="indicator"></div>'),this.$origin.append(this.$indicator);var e=parseFloat(this.$indicator.css("top"));this.downTop=isNaN(e)?0:e,this.moveHandler=a.prototype.mousemoveHandler.bind(this),this.$indicator.css("position","absolute"),$("body").on("mousemove",this.moveHandler)},a.prototype.mousemoveHandler=function(t){if(t.preventDefault(),this.isDragging){var e=t.clientY-this.downY,a=this.delta+e;if(this.options&&void 0!==this.options.min&&a<this.options.min)return;if(this.options&&void 0!==this.options.max&&a>this.options.max)return;this.$indicator.css("top",this.downTop+e+"px")}},a.prototype.mouseupHandler=function(t){if(this.isDragging){var e=t.clientY-this.downY;this.delta+=e,this.options&&void 0!==this.options.min&&this.delta<this.options.min&&(this.delta=this.options.min),this.options&&void 0!==this.options.max&&this.delta>this.options.max&&(this.delta=this.options.max),this.isDragging=!1,this.$origin.empty(),$("body").off("mousemove",this.moveHandler),this.options&&this.options.onDragEnd&&this.options.onDragEnd(this.delta)}},a.prototype.setDelta=function(t){this.options&&void 0!==this.options.min&&t>=this.options.min&&this.options&&void 0!==this.options.max&&t<=this.options.max&&(this.delta=t,this.options&&this.options.onDragEnd&&this.options.onDragEnd(this.delta))},window.DragBar=a},250:function(t,e){t.exports='<div class="main-content-wrapper main-content-wrapper-white main-content-toggle-left track-playback-content">\r\n  <div class="content">\r\n    <div class="left-part" id="leftPart">\r\n      <div class="panel-heading page-heading">\r\n        <h3 class="panel-title page-title">轨迹回放</h3>\r\n      </div>\r\n      <div class="calender-container">\r\n        <div class="calendar calendar4"></div>\r\n      </div>\r\n      <div class="search-input-container">\r\n        <div class="search-input-wraper">\r\n          <input id="citySel" name="search" placeholder="监控对象" style="cursor:auto" type="text" class="form-control"\r\n            autocomplete="off" />\r\n          <input id="savePid" th:value="${vid}" type="hidden" />\r\n        </div>\r\n      </div>\r\n      <div class="tree-container">\r\n        \x3c!-- <div id="treeLoad" class="tree-load">\r\n                    <i class="fa fa-spinner loading-state"></i>正在查询\r\n                </div>\r\n                <div id="treeEmpty" class="tree-empty">未找到监控对象</div> --\x3e\r\n        <div id="trackTreeLoad" style="width: 140px; margin: 20px auto 0 65px">\r\n          <i class="fa fa-spinner loading-state"></i>\r\n          <span>加载中，请稍候</span>\r\n        </div>\r\n        <ul id="treeDemoTrackPlayback" class="ztree ztreeLoadH"></ul>\r\n      </div>\r\n      <div class="form-horizontal" style="padding-top: 10px;">\r\n        <div class="form-group allGroup" style="margin-left:0px;margin-right:0px">\r\n          <div style="cursor:pointer" id="chooseAll_trackPlayback"\r\n            class="col-md-4 col-sm-5 col-xs-5 text-center btnPadding onlineStatus">\r\n            <span>全部</span><span class="value-span">(...)</span>\r\n          </div>\r\n          <div style="cursor:pointer;color: #45a541;" id="online_trackPlayback"\r\n            class="col-md-4 col-sm-5 col-xs-5 text-center btnPaddingOnLine onlineStatus">\r\n            <span>在线</span><span class="value-span">(...)</span>\r\n          </div>\r\n          <div style="cursor:pointer" id="chooseMissLine_trackPlayback"\r\n            class="col-md-4 col-sm-5 col-xs-5 text-center btnPadding onlineStatus">\r\n            <span>不在线</span><span class="value-span">(...)</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class="right-part" id="rightPart">\r\n      <div class="top-part" id="topPart">\r\n        <div class="map-part">\r\n          <div class="map-container" id="mapContainer"></div>\r\n          <div class="toggle-left-part" id="trackToggleLeftPart">\r\n            <i class="fa fa-chevron-left"></i>\r\n          </div>\r\n          \x3c!-- 围栏 --\x3e\r\n          <div id="fenceTool" class="btn-group">\r\n            <button id="fenceToolBtnTrackPlayback" style="top:-6px;padding: 8px 4px !important;" type="button"\r\n              class="btn btn-white dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\r\n              <img src="/clbs/resources/img/FenceIco.svg" style="width:18px;height:15.3px;" /><span\r\n                class="caret"></span>\r\n            </button>\r\n            <div class="dropdown-menu">\r\n              <div id="vFenceMsgTrackPlayback" class="col-md-12 text-center">请选择监控对象！</div>\r\n              <div id="vSearchContentTrackPlayback" class="hidden">\r\n                <input autocomplete="off" type="text" class="form-control" name="search" id="vFenceSearchTrackPlayback"\r\n                  placeholder="请输入关键字" />\r\n              </div>\r\n              <ul id="vFenceTreeTrackPlayback" class="ztree hidden"></ul>\r\n            </div>\r\n          </div>\r\n          <div id="realTimeCanArea">\r\n            <div id="searchMain">\r\n              <div class="form-group clearfix">\r\n                <div class="col-md-12 searchListSelect">\r\n                  <label class="verticalLabel" style="margin-right: 15px">\r\n                    <input type="checkbox" id="dataStatus0" value="0" name="dataStatus" checked /> 非补传\r\n                  </label>\r\n                  <label class="verticalLabel">\r\n                    <input type="checkbox" id="dataStatus1" value="1" name="dataStatus" checked /> 补传\r\n                  </label>\r\n                </div>\r\n              </div>\r\n              <div class="form-group clearfix">\r\n                <div class="col-md-12 searchListSelect">\r\n                  <input style="cursor: pointer; background-color: #fafafa;"\r\n                    class="form-control layer-date laydate-icon" id="timeInterval" name="timeInterval" readonly />\r\n                </div>\r\n              </div>\r\n              <div class="form-group clearfix">\r\n                <div class="col-md-12 control-label text-right">\r\n                  <button type="button" class="btn btn-primary" id="specialTimePlayBack">定时定区域查询\r\n                  </button>\r\n                  <button type="button" class="btn btn-primary" id="trackPlayQuery">查询\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div class="areaTool"><i class="fa fa-search"></i><span>查<br />询</span></div>\r\n          </div>\r\n          \x3c!--定时定区域查询--\x3e\r\n          <div id="fixedTimeArea">\r\n            <div class="modal-content">\r\n              <div class="modal-body">\r\n                <form class="form-horizontal" th:action="@{/m/functionconfig/fence/managefence/travelLine}"\r\n                  id="timeAreaForm" role="form" action="#" method="post">\r\n                  <div class="form-group">\r\n                    <div class="has-feedback fastClear col-md-12">\r\n                      <select name="queryType" id="queryType" class="Inlinesearch form-control treeSelect">\r\n                        <option value="vehicle">监控对象</option>\r\n                        <option value="group">企业</option>\r\n                        <option value="assignment">分组</option>\r\n                      </select>\r\n                      <input style="cursor: pointer; background-color: #fafafa;" type="text" id="areaGroupSelect"\r\n                        name="groupSelect" autocomplete="off" placeholder="请选择" class="form-control moreQueryGroup">\r\n                      <span class="fa fa-chevron-down form-control-feedback" style="top: 0; right: 15px;cursor:pointer;"\r\n                        aria-hidden="true" id="areaGroupSelectSpan"></span>\r\n                      <div id="areaMenuContent" class="menuContent">\r\n                        <ul id="areaTreeDemo" class="ztree"></ul>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  <div class="form-group">\r\n                    <div class="col-md-10" style="padding-right:0;">\r\n                      <input style="cursor: pointer; background-color: #fafafa;float:left;width:45.5%;"\r\n                        class="form-control layer-date laydate-icon" id="searchTimeIntervalStart" readonly>\r\n                      <span style="float: left;width:5%;text-align: center;margin-top:8px;">~</span>\r\n                      <input style="cursor: pointer; background-color: #fafafa;float:left;width:45.5%;"\r\n                        class="form-control layer-date laydate-icon" id="searchTimeIntervalEnd" readonly>\r\n                      <input type="hidden" id="areaSearchTimeInterval" name="timeInterval">\r\n                    </div>\r\n                    <button id="trackAddWayToPoint" type="button" class="btn btn-primary padBottom">\r\n                      <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>\r\n                    </button>\r\n                  </div>\r\n                  <div class="form-group">\r\n                    <div class="col-md-10">\r\n                      <input type="text" class="form-control areaInput" name="area" placeholder="点击后在地图上选择区域" readonly>\r\n                    </div>\r\n                    <button id="addMapArea" type="button" class="btn btn-primary padBottom">\r\n                      <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>\r\n                    </button>\r\n                  </div>\r\n                </form>\r\n              </div>\r\n              <div class="modal-footer">\r\n                <button type="button" id="areaTimeSearch" class="btn btn-primary">\r\n                  查询\r\n                </button>\r\n                <button type="button" id="fixAreaClose" class="btn btn-default btn-off" data-dismiss="modal">取消\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div id="realTimeBtn" class="trackPlay-group">\r\n            \x3c!--<input id="setMap" type="button" class="mapBtn" value="卫星" />--\x3e\r\n            \x3c!--<input type="button" class="mapRC" id="realTimeRC" value="实时路况">--\x3e\r\n\r\n            <a class="fenceA" id="mapDropSettingPlayback"><i class="map-drop-sett"></i><span>地图设置</span></a>\r\n            \x3c!-- 地图设置下拉 --\x3e\r\n            <div class="mapDropSettingMenu" id="mapDropSettingMenuPlayback" style="right: 20px;">\r\n              <p class="m-line" style="height: 22px;">\r\n                <input type="checkbox" id="realTimeRCTrackPlayback" class="monitoringSelect" />\r\n                <label for="realTimeRCTrackPlayback" id="realTimeRCLabTrackPlayback" class="monitoringSelect">路况</label>\r\n              </p>\r\n              <hr>\r\n              <p>\r\n                <input type="checkbox" id="setMap" class="monitoringSelect" />\r\n                <label for="setMap" id="defaultMapLab" class="monitoringSelect">卫星地图</label>\r\n              </p>\r\n              <hr>\r\n              <p style="height: 22px;">\r\n                <input type="checkbox" id="googleMapTrackPlayback" class="monitoringSelect" />\r\n                <label for="googleMapTrackPlayback" id="googleMapLabTrackPlayback" class="monitoringSelect">谷歌地图</label>\r\n              </p>\r\n            </div>\r\n          </div>\r\n          <div class="play-control-container">\r\n            <div class="play-control">\r\n              <div class="play-control-button-container">\r\n                <div class="play-control-button-wraper">\r\n                  <div class="play-control-button prev" onclick="trackPlayback.map.prev()"></div>\r\n                </div>\r\n                <div class="play-control-button-wraper">\r\n                  <div class="play-control-button play" id="playOrPause" onclick="trackPlayback.playOrPause()"></div>\r\n                </div>\r\n                <div class="play-control-button-wraper">\r\n                  <div class="play-control-button reset" onclick="trackPlayback.map.reset()"></div>\r\n                </div>\r\n                <div class="play-control-button-wraper">\r\n                  <div class="play-control-button next" onclick="trackPlayback.map.next()"></div>\r\n                </div>\r\n                <div class="play-control-button-wraper">\r\n                  <div id="paly-more" class="play-control-button more"></div>\r\n                </div>\r\n              </div>\r\n              <div class="clearfix">\r\n                <div class="progress-line pull-left" id="progressLine">\r\n                  <div class="progress-indicator" id="progressIndicator"></div>\r\n                  <div class="progress-back" id="progressBack"></div>\r\n                </div>\r\n\r\n                <div class="speed-control">\r\n                  <img width="14" height="15" src="/clbs/resources/img/speed.png" alt="">\r\n                  <span>x</span>\r\n                  <span id="speed-num" class="speed-num">1</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div class="checkbox-control">\r\n              <div class="box">\r\n                <section class="input-box">\r\n                  <label class="input-label">\r\n                    <input type="radio" name="videoSet" value="all" class="radio-input" id="allRadio" checked>\r\n                    <span class="radio-active"></span>\r\n                    <span>全部数据</span>\r\n                  </label>\r\n                </section>\r\n                <section class="input-box">\r\n                  <label class="input-label">\r\n                    <input type="radio" name="videoSet" value="run" id="runRadio" class="radio-input">\r\n                    <span class="radio-active"></span>\r\n                    <span>行驶数据</span>\r\n                  </label>\r\n                </section>\r\n              </div>\r\n              <div class="box">\r\n                <section class="input-box">\r\n                  <label class="input-label">\r\n                    <input type="checkbox" name="checkboxShowAlarm" id="checkboxShowAlarm" class="check-input">\r\n                    <span class="check-active"></span>\r\n                    <span>显示报警点</span>\r\n                  </label>\r\n                </section>\r\n                <section class="input-box">\r\n                  <label class="input-label">\r\n                    <input type="checkbox" name="checkboxShowStop" id="checkboxShowStop" class="check-input">\r\n                    <span class="check-active"></span>\r\n                    <span>显示停止点</span>\r\n                  </label>\r\n                </section>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class="toggle-chart-part">\r\n            <span id="toggleChartText">曲<br />线<br />报<br />表</span>\r\n          </div>\r\n        </div>\r\n        <div class="chart-part">\r\n          <div class="sensor-part">\r\n            <div class="page-icon prev" id="prevPageIcon"></div>\r\n            <div class="page-icon next" id="nextPageIcon"></div>\r\n            <div class="sensor-container" id="sensorContainer">\r\n              <div class="sensor-wraper" id="sensorWraper">\r\n\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class="chart-container-wraper">\r\n            <div class="chart-container" id="chartContainer">\r\n\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class="bottom-part" id="bottomPart">\r\n        <div class="drag-bar" id="tableMapDragBar"></div>\r\n        <div class="table-area">\r\n          <ul id="myTab" class="nav nav-tabs">\r\n            <li id="allDataLi" class="active table-tab"><a href="#allDataWraper" id="allRunDataA"\r\n                data-toggle="tab">全部数据</a>\r\n            </li>\r\n            <li class="table-tab" id="obdDataLi"><a href="#obdDataWraper" data-toggle="tab">OBD数据</a>\r\n            </li>\r\n            <li class="table-tab" id="runDataLi"><a href="#runDataWraper" data-toggle="tab">行驶段数据</a>\r\n            </li>\r\n            <li class="table-tab" id="stopDataLi"><a href="#stopDataWraper" data-toggle="tab">停止段数据</a>\r\n            </li>\r\n            <li id="alarmDataLi" class="table-tab"><a href="#alarmDataWraper" data-toggle="tab">报警数据</a>\r\n            </li>\r\n            <div style="float:right;margin-top:9px;">\r\n              <li style="display:inline-block;margin:0px 0px 0px 20px; color: #6dcff6;vertical-align: middle;">\r\n                <a href="/clbs/core/uum/custom/setting_TRACKPLAY" data-toggle="modal" data-target="#commonSm2Win"\r\n                  id="customColumnA">\r\n                  <i id="customColumnBtn" class="fa fa-cog" style="color: #6dcff6;font-size: 16px"></i>\r\n                </a>\r\n              </li>\r\n              <li style="display:inline-block;margin:0px 0px 0px 20px; color: #6dcff6;vertical-align: middle;">\r\n                <span id="tableDataExport" class="glyphicon glyphicon-share"></span>\r\n              </li>\r\n              <li style="display:inline-block;margin:0px 20px 0px 15px;color: #6dcff6;"><i id="scalingBtn"\r\n                  class="fa  fa-chevron-up" style="cursor: pointer"></i></li>\r\n            </div>\r\n          </ul>\r\n          <div id="myTabContent" class="tab-content table-wraper">\r\n            <div class="tab-pane fade in active trackPlaybackTable" id="allDataWraper">\r\n              <div id="allDataWraper-div">\r\n\r\n              </div>\r\n            </div>\r\n            <div class="tab-pane fade in trackPlaybackTable" id="obdDataWraper">\r\n              <div id="obdDataWraper-div">\r\n\r\n              </div>\r\n            </div>\r\n            <div class="tab-pane fade in trackPlaybackTable" id="runDataWraper">\r\n              <div id="runDataWraper-div">\r\n\r\n              </div>\r\n            </div>\r\n            <div class="tab-pane fade in trackPlaybackTable" id="stopDataWraper">\r\n              <div id="stopDataWraper-div">\r\n\r\n              </div>\r\n            </div>\r\n            <div class="tab-pane fade in trackPlaybackTable" id="alarmDataWraper">\r\n              <div id="alarmDataWraper-div">\r\n\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  \x3c!--/*******自定义列设置窗口，不使用公共窗口的原因是宽度刚好高不成低不就*******/--\x3e\r\n  <div id="commonSm2Win" class="modal fade" aria-hidden="true" data-keyboard="false" data-backdrop="static">\r\n    <div class="modal-dialog">\r\n      <div class="modal-content"></div>\r\n    </div>\r\n    <script th:inline="javascript">\r\n      /*<![CDATA[*/\r\n            // $(function () {\r\n            //     var windowId = \'commonSm2Win\';\r\n            //     $("#" + windowId).on("hidden.bs.modal", function () {\r\n            //         $(this).removeData("bs.modal");\r\n            //     });\r\n            // });\r\n      /*]]>*/\r\n    <\/script>\r\n  </div>\r\n  \x3c!-- 导出 modal --\x3e\r\n  <div class="modal fade" id="exportModal" tabindex="10" aria-hidden="true" data-backdrop="static" role="dialog"\r\n    aria-labelledby="">\r\n    <div class="modal-dialog">\r\n      <div class="modal-content" style="width:500px;">\r\n        <div class="modal-header">\r\n          <button type="button" class="close" data-dismiss="modal" aria-label="Close">\r\n            <span aria-hidden="true">&times;</span></button>\r\n          <h4 class="modal-title" id="exportTitle">导出全部数据</h4>\r\n        </div>\r\n\r\n        <div class="modal-body">\r\n          <div class="modal-cell">\r\n            <span>是否加载位置信息</span>\r\n            <label class="input-label">\r\n              <input type="radio" name="exportAddress" id="noExportPosition" value="0" class="radio-input" checked>\r\n              <span class="radio-active"></span>\r\n              否\r\n            </label>\r\n            <label class="input-label">\r\n              <input type="radio" name="exportAddress" id="yesExportPosition" value="1" class="radio-input">\r\n              <span class="radio-active"></span>\r\n              是\r\n            </label>\r\n          </div>\r\n          <div class="modal-tips" id="modalTips" style="display:none;">(加载位置信息过程较长, 需耐心等待)</div>\r\n        </div>\r\n\r\n        <div class="modal-footer">\r\n          <button type="button" id="exportBtn" class="btn btn-primary">确定导出</button>\r\n          <button type="button" id="cancelBtn" class="btn" data-dismiss="modal">取消</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  \x3c!-- 区域查车 --\x3e\r\n  <div class="modal fade" id="areaSearchCar" tabindex="-2" role="dialog" style="overflow-y:hidden"\r\n    data-backdrop="static" data-keyboard="false" aria-labelledby="alarmSettingInfo" aria-hidden="true">\r\n    <div class="modal-dialog">\r\n      <div class="modal-content">\r\n        <div class="modal-header">\r\n          <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span\r\n              class="sr-only">Close</span></button>\r\n          <h4 class="modal-title">定时定区域查询</h4>\r\n        </div>\r\n        <div class="modal-body" style="padding-bottom: 10px">\r\n          <div class="row form-horizontal">\r\n            <table id="dataTable" class="table table-striped table-bordered table-hover" cellspacing="0" width="100%">\r\n              <thead>\r\n                <tr>\r\n                  <th>监控对象</th>\r\n                  <th>时段</th>\r\n                  <th>区域</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody class="monitoringObj"></tbody>\r\n            </table>\r\n          </div>\r\n        </div>\r\n        <div class="modal-footer">\r\n          <button id="searchCarExport" type="button" class="btn btn-primary">导出</button>\r\n          <button id="searchCarClose" type="button" class="btn btn-default" data-dismiss="modal">关闭</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  \x3c!-- 将轨迹保存为围栏 --\x3e\r\n  <div id="addFencePage" class="modal fade" tabindex="-1" aria-hidden="true" data-backdrop="static" role="dialog"\r\n    aria-labelledby="myModalLabel">\r\n    <div class="modal-dialog" role="document">\r\n      <div class="modal-content">\r\n        <div class="modal-header">\r\n          <button type="button" class="close" data-dismiss="modal" aria-label="Close"></button>\r\n          <h4 class="modal-title">轨迹</h4>\r\n        </div>\r\n        <div class="modal-body">\r\n          <form class="form-horizontal" action="/clbs/m/functionconfig/fence/managefence/add" id="addLineFormSubmit"\r\n            role="form" method="post">\r\n            <table id="table-lng-lat" class="table table-striped table-bordered table-hover table-lng-lat">\r\n            </table>\r\n            <div class="row">\r\n              <div class="form-group">\r\n                <input type="hidden" id="addOrUpdateLineFlag" name="addOrUpdateLineFlag" value="0" />\r\n                <input type="hidden" id="lineId" name="lineId" />\r\n                <label class="col-md-3 control-label"><label class="text-danger">*</label> 路线名称：</label>\r\n                <div class=" col-md-8">\r\n                  <input autocomplete="off" type="text" placeholder="请输入路线名称" class="form-control" id="trackLineName1"\r\n                    name="name" />\r\n                </div>\r\n              </div>\r\n              <div class="form-group">\r\n                <label class="col-md-3 control-label">路线类型：</label>\r\n                <div class=" col-md-8">\r\n                  <select class="form-control" id="lineType1" name="type">\r\n                    <option value="国道">国道</option>\r\n                    <option value="省道">省道</option>\r\n                    <option value="县道">县道</option>\r\n                    <option value="高速">高速</option>\r\n                    <option value="高架立交">高架立交</option>\r\n                    <option value="其他小路">其他小路</option>\r\n                  </select>\r\n                </div>\r\n              </div>\r\n              <div class="form-group">\r\n                <label class="col-md-3 control-label"><label class="text-danger">*</label>\r\n                  偏移量(m)：</label>\r\n                <div class=" col-md-8">\r\n                  <input autocomplete="off" placeholder="请输入数字" onkeyup="value=value.replace(/[^0-9]/g,\'\') "\r\n                    class="form-control" id="lineWidth1" name="width" />\r\n                </div>\r\n              </div>\r\n              <div class="form-group">\r\n                <label class="col-md-3 control-label">描述：</label>\r\n                <div class=" col-md-8">\r\n                  <textarea class="form-control" rows="3" id="lineDescription1" name="description"></textarea>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div class="modal-footer">\r\n              <input type="hidden" id="historyPointSeqs" name="pointSeqs" />\r\n              <input type="hidden" id="historyLongitudes" name="longitudes" />\r\n              <input type="hidden" id="historyLatitudes" name="latitudes" />\r\n              <button type="button" id="addFenceBtn" class="btn btn-primary">保存</button>\r\n              <button type="button" class="btn btn-default btn-off cancle" id="hideDialog" data-dismiss="modal">取消\r\n              </button>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  <script async src="/clbs/resources/js/d3.v5.min.js"><\/script>\r\n</div>'},251:function(t,e,a){},259:function(t,e,a){"use strict";a.r(e);var n,i,r=a(250),o=a.n(r),s=(a(178),a(175));n=function(t){var e=1;t.fn.calendarTrack=function(a,n){a=a||{};var i=t.extend({},{prefix:"widget",isRange:!1,limitRange:[],highlightRange:[],stopHighlightRange:[],peopleHighlightRange:[],thingHighlightRange:[],onChange:function(){},onSelect:function(){}},a),r=!0;return this.each((function(){var a,n,o,s=t(this),l=t("<table>").appendTo(s),d=t("<caption>").appendTo(l),c=t('<a class="'+i.prefix+'-prevYear" href="javascript:;">&lt;&lt;</a>').appendTo(d),h=t('<a class="'+i.prefix+'-prevMonth" href="javascript:;">&lt;</a>').appendTo(d),p=t("<span>").appendTo(d),u=t('<a class="'+i.prefix+'-nextMonth" href="javascript:;">&gt;</a>').appendTo(d),g=t('<a class="'+i.prefix+'-nextYear" href="javascript:;">&gt;&gt;</a>').appendTo(d),m=t('<a class="'+i.prefix+'-back" href="javascript:;"></a>').appendTo(d),y=[];l.append("<thead><tr><th>日</th><th>一</th><th>二</th><th>三</th><th>四</th><th>五</th><th>六</th></tr></thead>");var f=t("<tbody>").appendTo(l);if(trackPlayback.flags.isFlag)var v=trackPlayback.calendar.nowYear,b=function(t,a,n){var i=arguments.length&&v?new Date(v,e-1,n):new Date,r={year:parseInt(v),month:parseInt(e),day:i.getDate(),week:i.getDay()};return r.code=""+r.year+(r.month>9?r.month:"0"+r.month)+(r.day>9?r.day:"0"+r.day),r};else b=function(t,e,a){var n=arguments.length&&t?new Date(t,e-1,a):new Date,i={year:n.getFullYear(),month:n.getMonth()+1,day:n.getDate(),week:n.getDay()};return i.code=""+i.year+(i.month>9?i.month:"0"+i.month)+(i.day>9?i.day:"0"+i.day),i};var k=function(t){if(i.limitRange.length){t.status="disabled";for(var e=0;e<i.limitRange.length;e++){var n=i.limitRange[e][0],r=i.limitRange[e][1];if("today"==n&&(n=a.code),"today"==r&&(r=a.code),n>r&&(n=[r,r=n][0]),t.code>=n&&t.code<=r){t.status="";break}}}if(t.sign=[],t.mileage=[],i.highlightRange.length)for(e=0;e<i.highlightRange.length;e++){n=i.highlightRange[e][0],r=i.highlightRange[e][1];var o=i.highlightRange[e][2];if("today"==n&&(n=a.code),"today"==r&&(r=a.code),n>r&&(n=[r,r=n][0]),t.code>=n&&t.code<=r){t.sign.push("highlight"),t.mileage.push(o);break}}if(i.stopHighlightRange.length)for(e=0;e<i.stopHighlightRange.length;e++)if(n=i.stopHighlightRange[e][0],r=i.stopHighlightRange[e][1],o=i.stopHighlightRange[e][2],"today"==n&&(n=a.code),"today"==r&&(r=a.code),n>r&&(n=[r,r=n][0]),t.code>=n&&t.code<=r){t.sign.push("stopHighlight"),t.mileage.push(o);break}if(i.peopleHighlightRange.length)for(e=0;e<i.peopleHighlightRange.length;e++)if(n=i.peopleHighlightRange[e][0],r=i.peopleHighlightRange[e][1],o=i.peopleHighlightRange[e][2],"today"==n&&(n=a.code),"today"==r&&(r=a.code),n>r&&(n=[r,r=n][0]),t.code>=n&&t.code<=r){t.sign.push("peopleHighlight"),t.mileage.push(o);break}if(i.thingHighlightRange.length)for(e=0;e<i.thingHighlightRange.length;e++)if(n=i.thingHighlightRange[e][0],r=i.thingHighlightRange[e][1],o=i.thingHighlightRange[e][2],"today"==n&&(n=a.code),"today"==r&&(r=a.code),n>r&&(n=[r,r=n][0]),t.code>=n&&t.code<=r){t.sign.push("thingHighlight"),t.mileage.push(o);break}return t.code==a.code&&t.sign.push("today"),t},T=function(t){void 0===t&&(t=a);for(var e=function(t){return new Date(t.year,t.month,0).getDate()}(o=b(t.year,t.month,1)),n=[],r=(t={},o.week);r>0;r--){(t=b(o.year,o.month,o.day-r)).month===o.month&&(t.month--,0===t.month&&(t.year--,t.month=12),t.code=t.year+(t.month>9?t.month:"0"+t.month)+(t.day>9?t.day:"0"+t.day));var s=k(t);i.limitRange.length||(s.status="disabled"),n.push(s)}for(r=0;r<e;r++)(t={year:o.year,month:o.month,day:o.day+r,week:(o.week+r)%7}).code=""+t.year+(t.month>9?t.month:"0"+t.month)+(t.day>9?t.day:"0"+t.day),s=k(t),n.push(s);var l=t;for(r=1;l.week+r<7;r++)(t=b(l.year,l.month,l.day+r)).month===o.month&&(t.month++,t.month>12&&(t.year++,t.month=1),t.code=t.year+(t.month>9?t.month:"0"+t.month)+(t.day>9?t.day:"0"+t.day)),s=k(t),i.limitRange.length||(s.status="disabled"),n.push(s);return n},x=function(t){i.onChange(o);for(var e="<tr>",a=0,n=t.length;a<n;a++){for(var r=t[a],s=[],l=0;l<r.sign.length;l++)s.push(i.prefix+"-"+r.sign[l]);r.status&&s.push(i.prefix+"-"+r.status);var d=s.join(" ");e+="<td"+(d?' class="'+d+'"':"")+' data-id="'+a+'" title="'+(""===t[a].mileage[0]||null==t[a].mileage[0]||t[a].mileage[0]<0||t[a].mileage[0]>4e3?"-":t[a].mileage[0])+'">                        '+(r.link?'<a href="'+r.link+'">'+r.day+"</a>":'<span class="dayShow">'+r.day+'<br/><span class="mileageList">'+(""===t[a].mileage[0]||null==t[a].mileage[0]||t[a].mileage[0]<0||t[a].mileage[0]>4e3?"-":t[a].mileage[0])+"</span></span>")+"                    </td>",a%7==6&&a<n-1&&(e+="</tr><tr>")}e+="</tr>",p.html(o.year+"年"+o.month+"月"),f.html(e)};a=b(),o={year:a.year,month:a.month},h.click((function(){var a,i,r,s=t(this).next("span").text().replace(/[\u4e00-\u9fa5]+/g,"-");a=s.substring(0,s.length-1)+"-01",parseInt(a.substring(5,a.length))-1<=0?(i=parseInt(a.substring(0,4))-1+"-12-01",r=parseInt(a.substring(0,4))-1,e=12):(i=a.substring(0,5)+(parseInt(a.substring(5,a.length))-1)+"-01",r=a.substring(0,4),e=parseInt(a.substring(5,a.length))-1);var l=trackPlayback.data.getVid(),d=i.split("-"),c=a.split("-");i=d[0]+"-"+(d[1]<10?"0"+d[1]:d[1])+"-"+d[2],a=c[0]+"-"+(c[1]<10?"0"+c[1]:c[1])+"-"+c[2],trackPlayback.calendar.nowMonth=i,trackPlayback.calendar.afterMonth=a,trackPlayback.calendar.nowYear=r,""!=l&&(trackPlayback.flags.isFlag=!0,trackPlayback.data.setNowMonth(i),trackPlayback.data.setAfterMonth(a),trackPlayback.calendar.getValidDate()),o.month--,n=T(o),x(n),t(".track-playback-content .calendar4 tbody td").each((function(){t(this).hasClass("widget-disabled")&&(t(this).removeClass("widget-highlight").removeClass("widget-stopHighlight"),t(this).children("span").children("span.mileageList").text(""))}));var h=t("#leftPart .calendar4 tbody tr").length;5===h?(t(".calender-container").css("height","297px"),t(".tree-container").css("height","calc(100% - 405px)")):6===h&&(t(".calender-container").css("height","341px"),t(".tree-container").css("height","calc(100% - 449px)"))})),u.click((function(){var a,i,r,s=t(this).siblings("span").text().replace(/[\u4e00-\u9fa5]+/g,"-"),l=s.substring(0,s.length-1);a=l.substring(0,4)+"-"+(parseInt(l.substring(5,l.length))+1)+"-01",parseInt(l.substring(5,l.length))+1-12==0?(i=parseInt(l.substring(0,4))+1+"-1-01",r=parseInt(l.substring(0,4)),e=12):parseInt(l.substring(5,l.length))+1-12>0?(i=parseInt(l.substring(0,4))+1+"-2-01",a=parseInt(l.substring(0,4))+1+"-1-01",r=parseInt(l.substring(0,4))+1,e=1):(i=l.substring(0,5)+(parseInt(l.substring(5,l.length))+2)+"-01",r=l.substring(0,4),e=parseInt(l.substring(5,l.length))+1);var d=trackPlayback.data.getVid(),c=a.split("-"),h=i.split("-");a=c[0]+"-"+(c[1]<10?"0"+c[1]:c[1])+"-"+c[2],i=h[0]+"-"+(h[1]<10?"0"+h[1]:h[1])+"-"+h[2],trackPlayback.calendar.nowMonth=a,trackPlayback.calendar.afterMonth=i,trackPlayback.calendar.nowYear=r,""!=d&&(trackPlayback.flags.isFlag=!0,trackPlayback.data.setNowMonth(a),trackPlayback.data.setAfterMonth(i),trackPlayback.calendar.getValidDate()),o.month++,n=T(o),x(n),t(".track-playback-content .calendar4 tbody td").each((function(){t(this).hasClass("widget-disabled")&&(t(this).removeClass("widget-highlight").removeClass("widget-stopHighlight"),t(this).children("span").children("span.mileageList").text(""))}));var p=t("#leftPart .calendar4 tbody tr").length;5===p?(t(".calender-container").css("height","297px"),t(".tree-container").css("height","calc(100% - 405px)")):6===p&&(t(".calender-container").css("height","341px"),t(".tree-container").css("height","calc(100% - 449px)"))})),c.click((function(){var a,i,r,s=t(this).siblings("span").text().replace(/[\u4e00-\u9fa5]+/g,"-"),l=s.substring(0,s.length-1);i=parseInt(l.substring(0,4))-1+"-"+(parseInt(l.substring(5,l.length))+1)+"-01",a=parseInt(l.substring(0,4))-1+"-"+parseInt(l.substring(5,l.length))+"-01",r=parseInt(l.substring(0,4))-1,e=l.substring(5,l.length);var d=trackPlayback.data.getVid(),c=a.split("-"),h=i.split("-");a=c[0]+"-"+(c[1]<10?"0"+c[1]:c[1])+"-"+c[2],i=h[0]+"-"+(h[1]<10?"0"+h[1]:h[1])+"-"+h[2],trackPlayback.calendar.nowMonth=a,trackPlayback.calendar.afterMonth=i,trackPlayback.calendar.nowYear=r,""!=d&&(trackPlayback.flags.isFlag=!0,trackPlayback.data.setNowMonth(a),trackPlayback.data.setAfterMonth(a),trackPlayback.calendar.getValidDate()),o.year--,n=T(o),x(n);var p=t("#leftPart .calendar4 tbody tr").length;5===p?(t(".calender-container").css("height","297px"),t(".tree-container").css("height","calc(100% - 405px)")):6===p&&(t(".calender-container").css("height","341px"),t(".tree-container").css("height","calc(100% - 449px)"))})),g.click((function(){var a,i,r,s=t(this).siblings("span").text().replace(/[\u4e00-\u9fa5]+/g,"-"),l=s.substring(0,s.length-1);i=parseInt(l.substring(0,4))+1+"-"+(parseInt(l.substring(5,l.length))+1)+"-01",a=parseInt(l.substring(0,4))+1+"-"+parseInt(l.substring(5,l.length))+"-01",r=parseInt(l.substring(0,4))+1,e=l.substring(5,l.length);var d=trackPlayback.data.getVid(),c=a.split("-"),h=i.split("-");a=c[0]+"-"+(c[1]<10?"0"+c[1]:c[1])+"-"+c[2],i=h[0]+"-"+(h[1]<10?"0"+h[1]:h[1])+"-"+h[2],trackPlayback.calendar.nowMonth=a,trackPlayback.calendar.afterMonth=i,trackPlayback.calendar.nowYear=r,""!=d&&(trackPlayback.flags.isFlag=!0,trackPlayback.data.setNowMonth(a),trackPlayback.data.setAfterMonth(a),trackPlayback.calendar.getValidDate()),o.year++,n=T(o),x(n);var p=t("#leftPart .calendar4 tbody tr").length;5===p?(t(".calender-container").css("height","297px"),t(".tree-container").css("height","calc(100% - 405px)")):6===p&&(t(".calender-container").css("height","341px"),t(".tree-container").css("height","calc(100% - 449px)"))})),m.click((function(){n=T(),x(n)})),s.unbind("click").on("click","td",(function(e){if(r){r=!1;try{t("#playIcon").attr("class","resultIcon playIcon"),t("#playIcon").removeAttr("data-original-title data-placement data-toggle"),t("#playIcon").attr({"data-toggle":"tooltip","data-placement":"top","data-original-title":"播放"}),isSearch=!0}catch(e){t("#playIcon").attr("class","resultIcon playIcon"),t("#playIcon").removeAttr("data-original-title data-placement data-toggle"),t("#playIcon").attr({"data-toggle":"tooltip","data-placement":"top","data-original-title":"播放"})}t("#chooseStopPoint").attr("checked")&&t("#chooseStopPoint").prop("checked",!1).removeAttr("checked","checked"),t("#myTab").children("li").removeClass("active"),t("#myTab").children("li:first-child").addClass("active"),t("#myTabContent").children("div").removeClass("active in"),t("#myTabContent").children("div:first-child").addClass("active in"),t("#progressBar_Track").removeAttr("style"),t("#peopleGPSData,#stopData,#peopleStopData,#warningData").hide(),t("#GPSData").addClass("active in").show(),t("#chooseAlarmPoint").attr("checked")&&t("#chooseAlarmPoint").prop("checked",!1).removeAttr("checked","checked"),t("#gpsTable3>tbody").html('<tr class=""><td valign="top" colspan="12" class="dataTables_empty">我本将心向明月，奈何明月照沟渠，不行您再用其他方式查一下？</td></tr>'),(t(this).hasClass("widget-highlight")||t(this).hasClass("widget-peopleHighlight"))&&t("#scalingBtn").hasClass("fa-chevron-down")&&t("#scalingBtn").attr("class","fa  fa-chevron-down");var a=t(this),o=t(this).data("id"),s=n[o];if(a.hasClass("widget-highlight")){var l=a.children("span").children("span.mileageList").text(),d=s.year+"-"+(s.month<10?"0"+s.month:s.month)+"-"+(s.day<10?"0"+s.day:s.day)+" 00:00:00",c=s.year+"-"+(s.month<10?"0"+s.month:s.month)+"-"+(s.day<10?"0"+s.day:s.day)+" 23:59:59";o=t(".widget-highlight").index(t(this)),trackPlayback.data.setValidClickedIndex(o),trackPlayback.data.setStartEndTime(d,c),t("#searchTimeInterval").length&&t("#searchTimeInterval").is(":hidden")&&t("#searchTimeInterval").val(d+"--"+c)}a.hasClass("widget-stopHighlight")&&(l=a.children("span").children("span.mileageList").text(),d=s.year+"-"+(s.month<10?"0"+s.month:s.month)+"-"+(s.day<10?"0"+s.day:s.day)+" 00:00:00",c=s.year+"-"+(s.month<10?"0"+s.month:s.month)+"-"+(s.day<10?"0"+s.day:s.day)+" 23:59:59",t("#timeInterval").val(d+"--"+c),o=t(".widget-stopHighlight").index(t(this)),trackPlayback.data.setValidClickedIndex(o),trackPlayback.data.setStartEndTime(d,c)),a.hasClass("widget-peopleHighlight")&&(l=a.children("span").children("span.mileageList").text(),t(".mileageList").parent().parent().attr("title",l),d=s.year+"-"+(s.month<10?"0"+s.month:s.month)+"-"+(s.day<10?"0"+s.day:s.day)+" 00:00:00",c=s.year+"-"+(s.month<10?"0"+s.month:s.month)+"-"+(s.day<10?"0"+s.day:s.day)+" 23:59:59",t("#timeInterval").val(d+"--"+c),o=t(".widget-peopleHighlight").index(t(this)),trackPlayback.data.setValidClickedIndex(o),trackPlayback.data.setStartEndTime(d,c)),"disabled"!=s.status&&(i.isRange?1!=y.length?(y=[s],x(n)):(y.push(s),y.sort((function(t,e){return t.code>e.code})),x(n),i.onSelect(y)):(y=[s],x(n),i.onSelect(y))),t(".track-playback-content .calendar4 tbody td").each((function(){t(this).hasClass("widget-disabled")&&(t(this).removeClass("widget-highlight").removeClass("widget-stopHighlight"),t(this).children("span").children("span.mileageList").text("-"))})),setTimeout((function(){r=!0}),300)}})),n=T(),x(n);var S=t("#leftPart .calendar4 tbody tr").length;5===S?(t(".calender-container").css("height","297px"),t(".tree-container").css("height","calc(100% - 405px)")):6===S&&(t(".calender-container").css("height","341px"),t(".tree-container").css("height","calc(100% - 449px)"))}))}},"function"==typeof define&&a(56)&&!jQuery?define(["jquery"],(function(){n(jQuery)})):n(jQuery),function(t){t.AFTER="AFTER",t.BEFORE="BEFORE",t.NONE="NONE"}(i||(i={}));var l=function(){return(l=Object.assign||function(t){for(var e,a=1,n=arguments.length;a<n;a++)for(var i in e=arguments[a])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},d=function(){function t(t,e){this.getPathPartition=function(t){var e=[],a=[],n=t.color,i=t.data.length>0&&t.data[0].color&&t.data[0].color.length>0?t.data[0].color:n;return t.data.forEach((function(n,r){if(n.color&&n.color.length>0&&n.color!=i){if(e.push({data:[].concat(a),color:i}),a=[n],"BEFORE"===t.autoConnectPartition&&e.length>0){if((s=e[e.length-1].data).length>0){var o=s[s.length-1];a.splice(0,0,o),r==t.data.length-1&&e.push({data:[].concat(a),color:n.color})}}else if("AFTER"===t.autoConnectPartition&&e.length>0){var s;(s=e[e.length-1].data).length>0&&s.push(n)}i=n.color}else a.push(n),r==t.data.length-1&&e.push({data:[].concat(a),color:i})})),e},this.getYValue4Serie=function(t,e){var a=null;if(e.data&&e.data.length>0)for(var n=0;n<e.data.length;n++){var i=e.data[n];if(i.index===t){a=i;break}}return a},this.setOption(e,t)}return t.prototype.setOption=function(e,a){var n=$.extend({series:[],axisFontSize:12,padding:{top:30,bottom:20,left:15,right:15},playIndex:0,axisColor:"#999",axisWidth:1,snap:!0,xAxisInterval:.1,rectWidth:80,rectHeight:36},e);this.options=n,this.state={selector:a,data:this.buildStateData(n.series),width:0,height:0,xScale:null,yScale:null,xAxis:null,yAxis1:null,yAxis2:null,x1:0,y1:null,x2:null,y2:null,xMax:null,xMaxText:null,xMin:null,yMax:null,yMin:null,timeFormater:t.timeFormater,paths:null,linePaths:null,dotts:null,yValue:[],currentXText:null,rectColor:"#30C100"},this.initHtml()},t.prototype.getOption=function(){return this.options},t.prototype.getState=function(){return this.state},t.prototype.initHtml=function(){var e=this;this.state.$dom={$origin:$(this.state.selector)},this.state.$dom.$origin.empty(),this.state.width=this.state.$dom.$origin.width(),this.state.height=this.state.$dom.$origin.height();var a=this.state,n=a.height,i=a.width,r=this.options,o=r.series,s=r.padding,d=r.rectColorFunc,c=r.playIndex,h=o.map((function(t){var e=d3.extent(t.data.filter((function(t){return null!==t.value})),(function(t){return t.value}));return{serieXExtent:[0,t.data.length-1],serieYExtent:[w.isEmpty(t.yMinValue)?e[0]:t.yMinValue,w.isEmpty(t.yMaxValue)?e[1]:t.yMaxValue]}})),p=d3.min(h,(function(t){return t.serieXExtent[0]})),u=d3.max(h,(function(t){return t.serieXExtent[1]}));p===u&&(p=-1,u=1);for(var g=h.map((function(t){return t.serieYExtent[0]?t.serieYExtent[0]:0})),m=h.map((function(t){return t.serieYExtent[1]?t.serieYExtent[1]:0})),y=0;y<g.length;y+=1)g[y]===m[y]&&(0===g[y]||(g[y]-=1),m[y]+=1);var f=d3.scaleLinear().domain([p,u]).range([0+s.left,i-s.right]),v=g.map((function(t,e){return d3.scaleLinear().domain([g[e],m[e]]).range([n-s.bottom,0+s.top])})),b=[{x:p,y:g[0]},{x:u,y:g[0]}],k=[{x:p,y:g[0]},{x:p,y:m[0]}],T=this.getXvalueFromPlayIndex(u),x=this.getXvalueFromPlayIndex(c),S="";null!=T&&null!==T.date&&T.date>0&&(S=t.timeFormater(T.date));var P="";null!=x&&null!==x.date&&x.date>0&&(P=t.timeFormater(x.date));var C,D=d3.line().x((function(t){return f(t.x)+.5})).y((function(t){return v[0](t.y)+.5}))(b),I=d3.line().x((function(t){return f(t.x)+.5})).y((function(t){return v[0](t.y)+.5}))(k);if(2===o.length){var M=[{x:u,y:g[1]},{x:u,y:m[1]}];C=d3.line().x((function(t){return f(t.x)+.5})).y((function(t){return v[1](t.y)+.5}))(M)}var A=[],L=[],W=[];o.forEach((function(t,a){e.getPathPartition(t).forEach((function(e){var n=d3.line().x((function(t){return f(t.index)})).y((function(t){return v[a](t.value)}))(e.data);A.push({path:n,width:t.width,color:e.color})})),t.line&&t.line.length>0&&(L=L.concat(t.line.map((function(t){return l({x1:f(p),y1:v[a](t.value),x2:f(u),text:t.value.toString()},t)})))),t.dott&&t.dott.length>0&&t.dott.forEach((function(n){var i=f(n.x),r=e.getYValue4Serie(n.x,t),o=v[a](r.value);W.push({x:i,y:o,color:n.color})}))}));var F=this.state,O=F.x1,R=F.rectColor;O=f(c);var N=v[0](m[0]),E=O,z=v[0](g[0]),_=this.getYaxisValue(c).data;if("function"==typeof d){var H=d(x);null!==H&&(R=H)}this.setState({width:i,height:n,xScale:f,yScale:v,xAxis:D,yAxis1:I,yAxis2:C,x1:O,y1:N,x2:E,y2:z,xMax:u,xMaxText:S,xMin:p,yMax:m,yMin:g,paths:A,linePaths:L,dotts:W,currentXText:P,yValue:_,rectColor:R}),this.render()},t.prototype.render=function(){var t=this.options,e=t.series,a=t.axisFontSize,n=t.axisColor,i=t.axisWidth,r=(t.padding,t.rectWidth,t.rectHeight,this.state),o=(r.width,r.height,r.xScale),s=r.yScale,l=r.xAxis,d=r.yAxis1,c=r.yAxis2,h=(r.x1,r.y1,r.x2,r.y2,r.xMax),p=r.xMaxText,u=r.xMin,g=r.yMax,m=r.yMin,y=r.paths,f=r.linePaths,v=r.dotts,b=(r.currentXText,r.yValue,r.rectColor,this.mouseDown.bind(this));this.state.$dom.$svg=d3.select(this.state.selector).append("svg").attr("width",this.state.width).attr("height",this.state.height).on("mousedown",(function(){var t=d3.mouse(this);b(t[0],t[1])})),this.drawAxis(l,n,i,o,h,s,m,a,p,d,u,g,e,c),this.drawPaths(y),this.drawDotts(v),this.drawLines(f,n,a),this.drawIndicator()},t.prototype.mouseDown=function(t,e){this.state.prevX=t,this.state.isDragging=!0;var a=this.mouseMove.bind(this);this.state.documentMouseMoveHandler=a;var n=this.mouseUp.bind(this);this.state.documentMouseUpHandler=n,d3.select("body").on("mouseup",(function(){n()})).on("mousemove",(function(){a()})),this.handleOnDrag(t)},t.prototype.mouseMove=function(){d3.event.preventDefault();var t=d3.mouse(this.state.$dom.$svg.node());this.handleOnDrag(t[0])},t.prototype.mouseUp=function(t,e){if(this.state.isDragging){d3.select("body").on("mousemove",null),this.state.isDragging=!1;var a=d3.mouse(this.state.$dom.$svg.node());this.handleOnDragEnd(a[0])}},t.prototype.handleOnDrag=function(t){var e=this.options,a=e.padding,n=a.left,i=a.right,r=e.onDrag,o=e.rectColorFunc,s=this.state,l=s.width,d=s.xScale,c=s.timeFormater,h=this.state.rectColor,p=Math.max(t,n);p=Math.min(p,l-i);var u=d.invert(p),g=this.getXvalueFromPlayIndex(u),m=this.getYaxisValue(u),y="";if(null!=g&&null!==g.date&&g.date>0&&(y=c(g.date),"function"==typeof o)){var f=o(g);null!==f&&(h=f)}this.setState({x1:p,x2:p,currentXText:y,yValue:m.data,rectColor:h}),this.drawIndicator(),"function"==typeof r&&!0===m.hasYValue&&r({xValue:g.index,playIndex:g.index})},t.prototype.handleOnDragEnd=function(t){var e=this.options,a=e.padding,n=a.left,i=a.right,r=e.onDragEnd,o=e.snap,s=e.rectColorFunc,l=this.state,d=l.width,c=l.xScale,h=l.timeFormater,p=this.state.rectColor,u=Math.max(t,n);u=Math.min(u,d-i);var g=Math.max(0,c.invert(u));!0===o&&(u=c(g=this.getClosestXvalue(g)));var m=this.getYaxisValue(g),y=this.getXvalueFromPlayIndex(g),f="";if(null!==y.date&&y.date>0&&(f=h(y.date),"function"==typeof s)){var v=s(y);null!==v&&(p=v)}this.setState({x1:u,x2:u,currentXText:f,yValue:m.data,rectColor:p}),this.drawIndicator(),"function"==typeof r&&!0===m.hasYValue&&r({xValue:y.index,playIndex:y.index})},t.prototype.drawIndicator=function(){var t=this.options,e=(t.series,t.axisFontSize),a=t.padding,n=t.rectWidth,i=t.rectHeight,r=this.state,o=r.width,s=r.x1,l=r.y1,d=r.x2,c=r.y2,h=r.currentXText,p=r.yValue,u=r.rectColor,g=n/2,m=s>n/2?s-n/2:0,y=s>n/2?s-n/2+2:2,f=s>n/2?s-n/2:0,v=s>n/2?s-n/2+17:17;if(s<=g)m=0,y=2,f=0,v=18;else if(s>g&&s<o-g)m=s-g,y=s-g+2,f=s-g,v=s-g+18;else{var b=o-n;m=b,y=b+2,f=b,v=b+18}this.state.$dom.$svg.select(".indicator");this.state.$dom.$svg.select(".indicator").remove();var k=this.state.$dom.$svg.append("g").attr("class","indicator");k.append("line").attr("x1",s).attr("y1",l+23-(40-i)).attr("x2",d).attr("y2",c).attr("stroke","#30C100").attr("stroke-width","1"),k.append("rect").attr("fill",u).attr("width",n).attr("height",i).attr("x",m).attr("y",l-a.top/2).attr("rx",3).attr("ry",3).attr("opacity",.7);for(var T=0;T<p.length;T++)for(var x=p[T],S=0;S<x.formattedText.split("\n").length;S++){var w=x.formattedText.split("\n")[S];k.append("text").attr("x",y).attr("y",l+(e+2)*(T+S)).attr("fill","white").attr("font-size",e-1).text(w)}k.append("rect").attr("fill","#30C100").attr("width",n).attr("height",15).attr("x",f).attr("y",c+1).attr("rx",3).attr("ry",3).attr("opacity",.7),k.append("text").attr("x",v).attr("y",c+12).attr("fill","white").attr("font-size",e-1).text(h)},t.prototype.drawLines=function(t,e,a){for(var n=this.state.$dom.$svg.append("g"),i=0;i<t.length;i++){var r=t[i];n.append("line").attr("x1",r.x1).attr("y1",r.y1).attr("x2",r.x2).attr("y2",r.y1).attr("stroke",r.color),n.append("text").attr("x",r.x1-12).attr("y",r.y1).attr("fill",e).attr("font-size",a-1).text(r.text)}},t.prototype.drawDotts=function(t){for(var e=this.state.$dom.$svg.append("g"),a=0;a<t.length;a++){var n=t[a];e.append("rect").attr("x",n.x-2).attr("y",n.y-2).attr("width",5).attr("height",5).attr("stroke","darkgray").attr("fill",n.color)}},t.prototype.drawPaths=function(t){for(var e=this.state.$dom.$svg.append("g"),a=0;a<t.length;a++){var n=t[a];e.append("path").datum(n.data).attr("fill","none").attr("stroke",n.color).attr("stroke-width",n.width).attr("d",n.path)}},t.prototype.drawAxis=function(t,e,a,n,i,r,o,s,l,d,c,h,p,u){var g=this.state.$dom.$svg.append("g").attr("shape-rendering","crispEdges");g.append("path").attr("d",t).attr("stroke",e).attr("fill","none").attr("stroke-width",a),g.append("text").attr("dx",n(i)-50).attr("dy",r[0](o[0])+15).attr("fill",e).attr("font-size",s-1).attr("letter-spacing","1").text(l),g.append("path").attr("d",d).attr("stroke",e).attr("fill","none").attr("stroke-width",a),g.append("text").attr("dx",n(c)-10).attr("dy",r[0](h[0])-5).attr("fill",e).attr("font-size",s).text(p[0].label),w.isEmpty(u)||(g.append("path").attr("d",u).attr("stroke",e).attr("fill","none").attr("stroke-width",a),g.append("text").attr("dx",n(i)-15).attr("dy",r[1](h[1])-5).attr("fill",e).attr("font-size",s).text(p[1].label))},t.prototype.setState=function(t){for(var e=Object.keys(t),a=0;a<e.length;a++){var n=e[a];this.state[n]=t[n]}},t.prototype.getXvalueFromPlayIndex=function(t){for(var e=this.options,a=e.series,n=e.xAxisInterval,i=0;i<a.length;i+=1){var r=a[i].data;if(r.length>t)for(var o=0;o<r.length;o+=1){var s=r[o],l=s.index;if(l-n<t&&t<l+n)return s}}return null},t.prototype.getPlayIndexFromXvalue=function(t){for(var e=this.options,a=e.series,n=e.xAxisInterval,i=0;i<a.length;i+=1)for(var r=a[i].data,o=0;o<r.length;o+=1){var s=r[o].index;if(s-n<t&&t<s+n)return o}return null},t.prototype.getClosestXvalue=function(t){var e=this.options.series,a=[];e.forEach((function(e){for(var n=e.data,i=[null,null],r=0;r<n.length;r+=1){var o=n[r].index;if(t>=o&&(i[0]=o),t<=o&&null===i[1]){i[1]=o;break}}a.push(i)}));var n=null,i=null;return a.forEach((function(e){var a=Math.abs(t-e[0]),r=Math.abs(e[1]-t),o=Math.min(a,r);(null===i||i>o)&&(i=o,n=a>r?e[1]:e[0])})),n},t.prototype.getYaxisValue=function(t){if(null===t)return{data:[],hasYValue:!1};var e=this.options,a=e.series,n=e.xAxisInterval,i={data:[],hasYValue:!1},r=!1;return a.forEach((function(e){for(var a,o=e.data,s=e.yValueFunc,l=0;l<o.length;l++){var d=o[l],c=d.index;if(c-n<t&&t<c+n){a=d;break}}var h={name:e.label};if(void 0===a)h.value=null,h.text="--- ";else if(null===a.value)h.yValue=a,h.value=null,h.text="--- ",r=!0;else if(void 0===a.value||null===a.date||0===a.date||"0"===a.date.toString())h.value=null,h.text="无数据";else{var p=a.value;h.yValue=a,h.value=p,h.text=p.toString()+" "+e.unit,r=!0}h.formattedText="function"==typeof s?s(h,e):h.name+": "+h.text,i.data.push(h)})),i.hasYValue=r,i},t.prototype.shadowCopyArray=function(t){for(var e=[],a=0,n=t.length;a<n;a++)e.push(t[a]);return e},t.prototype.buildStateData=function(t){return this.shadowCopyArray(t)},t.prototype.updatePositionByPlayIndex=function(t){this.options.playIndex=t;var e=this.options.rectColorFunc,a=this.state,n=a.xScale,i=a.timeFormater,r=this.state.rectColor;if(null!==n){var o=this.getXvalueFromPlayIndex(t),s=n(o.index),l=this.getYaxisValue(o.index),d="";if(null!=o&&null!==o.date&&o.date>0&&(d=i(o.date),"function"==typeof e)){var c=e(o);null!==c&&(r=c)}this.setState({x1:s,x2:s,yValue:l.data,currentXText:d,rectColor:r}),this.drawIndicator()}},t.prototype.destory=function(){this.state&&(this.state.$dom.$origin.empty(),this.state.$dom=void 0,this.state=void 0),this.options&&(this.options=void 0)},t.timeFormater=function(t){"number"==typeof t&&(t=new Date(t));var e=t.getHours(),a=t.getMinutes(),n=t.getSeconds();return(e>=10?e.toString(10):"0"+e.toString(10))+":"+(a>=10?a.toString(10):"0"+a.toString(10))+":"+(n>=10?n.toString(10):"0"+n.toString(10))},t}(),c=function(){function t(t,e){this.getPathPartition=function(t){var e=[],a=[],n=t.color,i=t.data.length>0&&t.data[0].color&&t.data[0].color.length>0?t.data[0].color:n;return t.data.forEach((function(n,r){if(n.color&&n.color.length>0&&n.color!=i){if(e.push({data:[].concat(a),color:i}),a=[n],"BEFORE"===t.autoConnectPartition&&e.length>0){if((s=e[e.length-1].data).length>0){var o=s[s.length-1];a.splice(0,0,o)}}else if("AFTER"===t.autoConnectPartition&&e.length>0){var s;(s=e[e.length-1].data).length>0&&s.push(n)}i=n.color}else a.push(n),r==t.data.length-1&&e.push({data:[].concat(a),color:i})})),e},this.setOption(e,t)}return t.prototype.setOption=function(t,e){var a=$.extend({series:[],padding:{top:0,bottom:0,left:0,right:0}},t);this.options=a,this.state={selector:e,data:this.buildStateData(a.series),width:0,height:0,paths:null},this.initHtml()},t.prototype.getOption=function(){return this.options},t.prototype.getState=function(){return this.state},t.prototype.initHtml=function(){var t=this;this.state.$dom={$origin:$(this.state.selector)},this.state.$dom.$origin.empty(),this.state.width=this.state.$dom.$origin.width(),this.state.height=this.state.$dom.$origin.height();for(var e=this.state,a=e.height,n=e.width,i=this.options,r=i.series,o=i.padding,s=r.map((function(t){var e=d3.extent(t.data.filter((function(t){return null!==t.value})),(function(t){return t.value}));return{serieXExtent:[0,t.data.length-1],serieYExtent:[w.isEmpty(t.yMinValue)?e[0]:t.yMinValue,w.isEmpty(t.yMaxValue)?e[1]:t.yMaxValue]}})),d=d3.min(s,(function(t){return t.serieXExtent[0]})),c=d3.max(s,(function(t){return t.serieXExtent[1]})),h=s.map((function(t){return t.serieYExtent[0]?t.serieYExtent[0]:0})),p=s.map((function(t){return t.serieYExtent[1]?t.serieYExtent[1]:0})),u=0;u<h.length;u+=1)h[u]===p[u]&&(0===h[u]||(h[u]-=1),p[u]+=1);var g=d3.scaleLinear().domain([d,c]).range([0+o.left,n-o.right]),m=h.map((function(t,e){return d3.scaleLinear().domain([h[e],p[e]]).range([a-o.bottom,0+o.top])})),y=[];r.forEach((function(e,a){t.getPathPartition(e).forEach((function(t){var n=d3.line().x((function(t){return g(t.index)})).y((function(t){return m[a](t.value)}))(t.data);y.push(l({path:n},e,{color:t.color}))}))})),this.setState({width:n,height:a,paths:y}),this.render()},t.prototype.render=function(){var t=this.state.paths;this.state.$dom.$svg=d3.select(this.state.selector).append("svg").attr("width",this.state.width).attr("height",this.state.height).attr("class","simple-line-svg"),this.drawPaths(t)},t.prototype.drawPaths=function(t){for(var e=this.state.$dom.$svg.append("g"),a=0;a<t.length;a++){var n=t[a];e.append("path").datum(n.data).attr("fill","none").attr("stroke",n.color).attr("stroke-width",n.width).attr("d",n.path)}},t.prototype.setState=function(t){for(var e=Object.keys(t),a=0;a<e.length;a++){var n=e[a];this.state[n]=t[n]}},t.prototype.shadowCopyArray=function(t){for(var e=[],a=0,n=t.length;a<n;a++)e.push(t[a]);return e},t.prototype.buildStateData=function(t){return this.shadowCopyArray(t)},t}(),h=function(t){this._dependencies=t||{}};h.prototype.set=function(t,e){this._dependencies[t]=e},h.prototype.get=function(t){return this._dependencies[t]};var p=function(){this._treeData=null,this._activeTreeNode=null,this._eventHandlerList={};var t=new Date,e=t.getFullYear(),a=t.getMonth()+1;this._nowMonth=e+"-"+(a<10?"0"+a:a)+"-01",this._afterMonth=e+"-"+(a+1<10?"0"+(a+1):a+1)+"-01",this._trackColor,this._trackWidth=6,this._validDate=null,this._validSensorFlag,this._validMile,this._validClickedIndex,this._initVid=null,this._vid=null,this._pid=null,this._sensorType=null,this._objType=null,this._group=null,this._startTime=null,this._endTime=null,this._positions=null,this._positionsTmp=null,this._playIndex=0,this._speed=1e4,this._sensorFlag=null,this._isPlaying=!1,this._isDraging=!1,this._allOrRunData="all",this._showAlarmPoint=!1,this._showStopPoint=!1,this._isChartOpen=!1,this._paraScale=null,this._sensorList=null,this._activeSensorKeys=null,this._mileSpeed=null,this._stopData=null,this._stopTypeDict=null,this._stopDataTmp=null,this._oilConsumptionData=null,this._oilConsumptionSensorNo=null,this._oilData,this._oilSensorNo=null,this._temperaturey,this._temperatureySensorNo=null,this._humidity,this._humiditySensorNo=null,this._workHour,this._workHourSensorNo=null,this._reverse=null,this._ioData=null,this._ioDataSensorNo=null,this._weight=null,this._weightSensorNo=null,this._tire=null,this._tireNumList=null,this._tireNum=null,this._tableTabIndex=1,this._obdData=null,this._odbDataTmp=null,this._runFragmentData=null,this._stopFragmentData=null,this._alarmData=null,this._areaTreeCheckVid=!0,this._areaTreeAllCheck=!0,this._rangeAreaPos=[],this._areaIndex=!0,this._fenceIdList=new mapVehicle,this._administrativeRegionsList=new mapVehicle,this._travelLineList=new mapVehicle};p.prototype.setActiveSensorKeys=function(t){this._activeSensorKeys=t,this.runEventHandler("activeSensorKeysChange")},p.prototype.getActiveSensorKeys=function(){return this._activeSensorKeys},p.prototype.setSensorList=function(t){this._sensorList=t,this.runEventHandler("sensorListChange")},p.prototype.getSensorList=function(){return this._sensorList},p.prototype.getParaScale=function(){return this._paraScale},p.prototype.setIsChartOpen=function(t){this._isChartOpen=t,this.runEventHandler("isChartOpenChange")},p.prototype.getIsChartOpen=function(){return this._isChartOpen},p.prototype.setAlarmData=function(t){this._alarmData=t,this.runEventHandler("alarmDataChange")},p.prototype.getAlarmData=function(){return this._alarmData},p.prototype.setStopFragmentData=function(t){this._stopFragmentData=t,this.runEventHandler("stopFragmentDataChange")},p.prototype.getStopFragmentData=function(){return this._stopFragmentData},p.prototype.setRunFragmentData=function(t){this._runFragmentData=t,this.runEventHandler("runFragmentDataChange")},p.prototype.getRunFragmentData=function(){return this._runFragmentData},p.prototype.setObdData=function(t){this._obdData=t,this.runEventHandler("obdDataChange")},p.prototype.getObdData=function(){return this._obdData},p.prototype.setOdbDataTmp=function(t){this._odbDataTmp=t,this.runEventHandler("odbDataTmpChange")},p.prototype.getOdbDataTmp=function(){return this._odbDataTmp},p.prototype.setMileSpeed=function(t){this.supplyMissingPoint(t,(function(t,e){return{speed:null,mileage:null,time:e,supply:!0}})),this._mileSpeed=t,this.runEventHandler("mileSpeedChange")},p.prototype.getMileSpeed=function(){return this._mileSpeed},p.prototype.setStopData=function(t){this.supplyMissingPoint(t,(function(t,e){return{status:null,time:e,supply:!0}})),this._stopData=t,this.runEventHandler("stopDataChange")},p.prototype.getStopData=function(){return this._stopData},p.prototype.setStopDataTmp=function(t){this._stopDataTmp=t},p.prototype.getStopDataTmp=function(){return this._stopDataTmp},p.prototype.setStopTypeDict=function(t){this._stopTypeDict=t},p.prototype.getStopTypeDict=function(){return this._stopTypeDict},p.prototype.setOilData=function(t){this.supplyMissingPoint(t,(function(t,e){return{oilTank:t.oilTank.map((function(){return null})),fuelAmount:t.fuelAmount.map((function(){return null})),fuelSpill:t.fuelSpill.map((function(){return null})),time:e,supply:!0}})),this._oilData=t,this.runEventHandler("oilDataChange")},p.prototype.getOilData=function(){return this._oilData},p.prototype.setOilSensorNo=function(t){this._oilSensorNo=t,this.runEventHandler("oilSensorNoChange")},p.prototype.getOilSensorNo=function(){return this._oilSensorNo},p.prototype.setOilConsumptionData=function(t){this.supplyMissingPoint(t,(function(t,e){return{oilWear:null,time:e,supply:!0}})),this._oilConsumptionData=t,this.runEventHandler("oilConsumptionDataChange")},p.prototype.getOilConsumptionData=function(){return this._oilConsumptionData},p.prototype.setOilConsumptionSensorNo=function(t){this._oilConsumptionSensorNo=t,this.runEventHandler("oilConsumptionSensorNoChange")},p.prototype.getOilConsumptionSensorNo=function(){return this._oilConsumptionSensorNo},p.prototype.setTemperaturey=function(t){this.supplyMissingPoint(t.sensorDataList,(function(t,e){return{temperature:null,time:e,supply:!0}})),this._temperaturey=t,this.runEventHandler("temperatureyChange")},p.prototype.getTemperaturey=function(){return this._temperaturey},p.prototype.setTemperatureySensorNo=function(t){this._temperatureySensorNo=t,this.runEventHandler("temperatureySensorNoChange")},p.prototype.getTemperatureySensorNo=function(){return this._temperatureySensorNo},p.prototype.setHumidity=function(t){this.supplyMissingPoint(t.sensorDataList,(function(t,e){return{humidity:null,time:e,supply:!0}})),this._humidity=t,this.runEventHandler("humidityChange")},p.prototype.getHumidity=function(){return this._humidity},p.prototype.setHumiditySensorNo=function(t){this._humiditySensorNo=t,this.runEventHandler("humiditySensorNoChange")},p.prototype.getHumiditySensorNo=function(){return this._humiditySensorNo},p.prototype.setWorkHour=function(t){this.supplyMissingPoint(t.workHourInfo,(function(t,e){return{checkData:null,type:null,workingPosition:null,time:e,supply:!0}})),this._workHour=t,this.runEventHandler("workHourChange")},p.prototype.getWorkHour=function(){return this._workHour},p.prototype.setWorkHourSensorNo=function(t){this._workHourSensorNo=t,this.runEventHandler("workHourSensorNoChange")},p.prototype.getWorkHourSensorNo=function(){return this._workHourSensorNo},p.prototype.setReverse=function(t){this.supplyMissingPoint(t,(function(t,e){return{orientation:null,rotationSpeed:null,rotationStatus:null,workTime:null,pulseCount:null,rotationTime:null,time:e,supply:!0}})),this._reverse=t,this.runEventHandler("reverseChange")},p.prototype.getReverse=function(){return this._reverse},p.prototype.setIoData=function(t){this.supplyMissingPoint(t.data,(function(t,e){return{statuses:[null,null,null,null],time:e,supply:!0}})),this._ioData=t},p.prototype.getIoData=function(){return this._ioData},p.prototype.setIoDataSensorNo=function(t){this._ioDataSensorNo=t,this.runEventHandler("ioDataSensorNoChange")},p.prototype.getIoDataSensorNo=function(){return this._ioDataSensorNo},p.prototype.setWeight=function(t){this.supplyMissingPoint(t.sensorDataList,(function(t,e){return{weight:null,time:e,supply:!0}})),this._weight=t,this.runEventHandler("weightChange")},p.prototype.getWeight=function(){return this._weight},p.prototype.setWeightSensorNo=function(t){this._weightSensorNo=t,this.runEventHandler("weightSensorNoChange")},p.prototype.getWeightSensorNo=function(){return this._weightSensorNo},p.prototype.setTire=function(t){this.supplyMissingPoint(t.sensorDataList,(function(t,e){return{pressure:null,time:e,supply:!0}})),this._tire=t,this.runEventHandler("tireChange")},p.prototype.getTire=function(){return this._tire},p.prototype.setTireNumList=function(t){this._tireNumList=t},p.prototype.getTireNumList=function(){return this._tireNumList},p.prototype.setTireNum=function(t){this._tireNum=t,this.runEventHandler("tireNumChange")},p.prototype.getTireNum=function(){return this._tireNum},p.prototype.setTableTabIndex=function(t){var e=this._tableTabIndex!==t;this._tableTabIndex=t,e&&this.runEventHandler("tableTabIndexChange")},p.prototype.getTableTabIndex=function(){return this._tableTabIndex},p.prototype.setIsPlaying=function(t,e){var a=this._isPlaying!==t,n=!0===this._isPlaying&&!1===t?"play2Stop":"stop2Play";this._isPlaying=t,a&&this.runEventHandler("isPlayingChange",n,e)},p.prototype.getIsPlaying=function(){return this._isPlaying},p.prototype.setIsDraging=function(t){this._isDraging=t},p.prototype.getIsDraging=function(){return this._isDraging},p.prototype.setAllOrRunData=function(t){var e=this._allOrRunData!==t;this._allOrRunData=t,e&&this.runEventHandler("allOrRunDataChange")},p.prototype.getAllOrRunData=function(){return this._allOrRunData},p.prototype.setShowAlarmPoint=function(t){this._showAlarmPoint=t,this.runEventHandler("showAlarmPointChange")},p.prototype.getShowAlarmPoint=function(){return this._showAlarmPoint},p.prototype.setShowStopPoint=function(t){this._showStopPoint=t,this.runEventHandler("showStopPointChange")},p.prototype.getShowStopPoint=function(){return this._showStopPoint},p.prototype.setSpeed=function(t){this._speed=t,this.runEventHandler("speedChange")},p.prototype.getSpeed=function(){return this._speed},p.prototype.setSensorFlag=function(t){this._sensorFlag=t},p.prototype.getSensorFlag=function(){return this._sensorFlag},p.prototype.setPlayIndex=function(t,e){"chart"===e&&(t=this.getParaScale()(t,"toOrigin")),this._playIndex=t,this.runEventHandler("playIndexChange")},p.prototype.getPlayIndex=function(t){return"chart"===t?this.getParaScale()(this._playIndex,"toChart"):this._playIndex},p.prototype.setPositions=function(t){this._positions=t,this._paraScale=null===t?null:this.buildParaScale(t),this.runEventHandler("positionsChange")},p.prototype.getPositions=function(){return this._positions},p.prototype.setPositionsTmp=function(t){this._positionsTmp=t},p.prototype.getPositionsTmp=function(){return this._positionsTmp},p.prototype.setTrackColor=function(t){this._trackColor=t,this.runEventHandler("trackColorChange")},p.prototype.getTrackColor=function(){return this._trackColor},p.prototype.setTrackWidth=function(t){this._trackWidth=t,this.runEventHandler("trackWidthChange")},p.prototype.getTrackWidth=function(){return this._trackWidth},p.prototype.setValidDate=function(t){this._validDate=t},p.prototype.getValidDate=function(){return this._validDate},p.prototype.setValidSensorFlag=function(t){this._validSensorFlag=t},p.prototype.getValidSensorFlag=function(){return this._validSensorFlag},p.prototype.setValidMile=function(t){this._validMile=t},p.prototype.getValidMile=function(){return this._validMile},p.prototype.setValidClickedIndex=function(t){this._validClickedIndex=t},p.prototype.getValidClickedIndex=function(){return this._validClickedIndex},p.prototype.setTreeData=function(t){this._treeData=t},p.prototype.getTreeData=function(){return this._treeData},p.prototype.setActiveTreeNode=function(t){this._activeTreeNode=t,this._sensorType=t.deviceType,this._objType=t.type,this._vid=t.id,this._pid=t.pId,this.runEventHandler("activeTreeNodeChange")},p.prototype.getActiveTreeNode=function(){return this._activeTreeNode},p.prototype.getSensorType=function(){return this._sensorType},p.prototype.setSensorType=function(t){this._sensorType=t},p.prototype.getObjType=function(){return this._objType},p.prototype.setGroup=function(t){this._group=t},p.prototype.getGroup=function(){return this._group},p.prototype.setNowMonth=function(t){this._nowMonth=t},p.prototype.getNowMonth=function(){return this._nowMonth},p.prototype.setAfterMonth=function(t){this._afterMonth=t},p.prototype.getAfterMonth=function(){return this._afterMonth},p.prototype.setVid=function(t){this._vid=t},p.prototype.getVid=function(){return this._vid},p.prototype.setPid=function(t){this._pid=t},p.prototype.getPid=function(){return this._pid},p.prototype.setInitVid=function(t){this._initVid=t},p.prototype.getInitVid=function(){return this._initVid},p.prototype.setStartEndTime=function(t,e){null!=t&&(this._startTime=t),null!=e&&(this._endTime=e),this.runEventHandler("startEndTimeChange")},p.prototype.getStartTime=function(){return this._startTime},p.prototype.getEndTime=function(){return this._endTime},p.prototype.setAreaTreeCheckVid=function(t){this._areaTreeCheckVid=t},p.prototype.getAreaTreeCheckVid=function(){return this._areaTreeCheckVid},p.prototype.setAreaTreeAllCheck=function(t){this._areaTreeAllCheck=t},p.prototype.getAreaTreeAllCheck=function(){return this._areaTreeAllCheck},p.prototype.setRangeAreaPos=function(t){this._rangeAreaPos=t},p.prototype.getRangeAreaPos=function(){return this._rangeAreaPos},p.prototype.setAreaIndex=function(t){this._areaIndex=t},p.prototype.getAreaIndex=function(){return this._areaIndex},p.prototype.setFenceIdList=function(t){this._fenceIdList=t},p.prototype.getFenceIdList=function(){return this._fenceIdList},p.prototype.setAdministrativeRegionsList=function(t){this._administrativeRegionsList=t},p.prototype.getAdministrativeRegionsList=function(){return this._administrativeRegionsList},p.prototype.setTravelLineList=function(t){this._travelLineList=t},p.prototype.getTravelLineList=function(){return this._travelLineList},p.prototype.on=function(t,e){void 0===this._eventHandlerList[t]?this._eventHandlerList[t]=[e]:this._eventHandlerList[t].push(e)},p.prototype.off=function(t,e){var a=this._eventHandlerList[t];if(void 0===a||void 0===a.length||0===a.length)return!1;for(var n=0;n<a.length;n++)a[n]===e&&a.splice(n,1)},p.prototype.runEventHandler=function(t){var e=this._eventHandlerList[t];if(void 0===e||void 0===e.length||0===e.length)return!1;for(var a=0;a<e.length;a++){var n=e[a];if("function"==typeof n){var i=n.apply(null,Array.prototype.slice.call(arguments,1));if(!1===i)break}}},p.prototype.supplyMissingPoint=function(t,e){if(t)for(var a=t.length,n=0;n<a;){var i=t[n-1],r=t[n];if(i){var o=r.time-i.time;if(o<=300||o>259200)n+=1;else{var s=Math.floor(o/30);o/30===s&&s>0&&(s-=1);for(var l=0;l<s;l+=1)t.splice(n+l,0,e(i,i.time+30*(l+1)));a=t.length,n+=s+1}}else n+=1}},p.prototype.supplyLocation=function(t){if(t){for(var e=t.length,a={},n={},i=0,r=0,o=0;o<e;){var s=t[o-1],l=t[o];if(s){var d=l.vtime-s.vtime;if(d<=300||d>259200)a[i]=r,n[r]=i,r+=1,i+=1,o+=1;else{var c=Math.floor(d/30);d/30===c&&c>0&&(c-=1);for(var h=0;h<c;h+=1)t.splice(o+h,0,{vtime:s.vtime+30*(h+1)}),n[r+=1]=i;a[i]=r,n[r]=i,r+=1,i+=1,e=t.length,o+=c+1}}else a[i]=r,n[r]=i,r+=1,i+=1,o+=1}return[a,n]}},p.prototype.buildParaScale=function(t){for(var e=[],a=[],n=0;n<t.length;n++)e.push(t[n]),a.push(t[n]);var i=this.supplyLocation(a);return function(t,e){return"toChart"===e?i[0][t]:i[1][t]}};var u=function(t,e,a){this.options=e,this.dependency=a,this.$origin=$(t);var n=new Date;this.nowMonth=n.getFullYear()+"-"+(parseInt(n.getMonth()+1)<10?"0"+parseInt(n.getMonth()+1):parseInt(n.getMonth()+1))+"-01",this.afterMonth=n.getFullYear()+"-"+(parseInt(n.getMonth()+2)<10?"0"+parseInt(n.getMonth()+2):parseInt(n.getMonth()+2))+"-01",this.nowYear=n.getFullYear(),this.calendar=this.$origin.calendarTrack()};u.prototype.getValidDate=function(){var t=this.dependency.get("data"),e=t.getActiveTreeNode();if(e){var a=e.id,n=t.getNowMonth(),i=t.getAfterMonth(),r=n.split("-")[0]+n.split("-")[1],o=[],s=[],l=[],d=[],c=null;$.ajax({type:"POST",url:"/clbs/lkyw/trackBack/getActiveDate",data:{vehicleId:a,nowMonth:n,nextMonth:i,type:t.getSensorType(),bigDataFlag:1},dataType:"json",async:!0,beforeSend:function(){layer.load(2)},success:function(e){if(layer.closeAll("loading"),o=[],s=[],l=[],d=[],e.success){var a=$.parseJSON(e.msg),n=a.date;c=a.dailySensorFlag;var i=a.dailyMile;t.setValidDate(n),t.setValidSensorFlag(c),t.setValidMile(i);for(var h=0;h<n.length;h++){var p=r+(parseInt(n[h]+1)<10?"0"+parseInt(n[h]+1):parseInt(n[h]+1)),u=parseFloat(i[h]);switch(a.type){case"5":l.push([p,p,""]);break;case"9":case"10":cdWorldType=a.type,s.push([p,p,u]);break;default:o.push([p,p,u])}}}"thing"==this.dependency.get("flags").objType&&(d=o.concat(l));var g=$("#treeDemo").height(),m=$(".track-playback-content .calendar4 tbody tr").length;this.$origin.html(""),this.$origin.calendarTrack({highlightRange:o,stopHighlightRange:s,peopleHighlightRange:l,thingHighlightRange:d});var y=$(".track-playback-content .calendar4 tbody tr").length;y>m?$("#treeDemo").css("height",g-34+"px"):y<m&&$("#treeDemo").css("height",g+54+"px"),$(".track-playback-content .calendar4 tbody td").each((function(){$(this).hasClass("widget-disabled")&&($(this).removeClass("widget-highlight").removeClass("widget-stopHighlight"),$(this).children("span").children("span.mileageList").text("-"))})),this.dependency.get("flags").isFlag=!1}.bind(this)})}};var g=function(t,e){this.options=$.extend({},{min:0,max:0,value:0,onDrag:null,onDragEnd:null},e),this.$origin=$(t),this.$back=this.$origin.find(".progress-back"),this.$indicator=this.$origin.find(".progress-indicator"),this.width=this.$back.width(),this.indicatorHalfWidth=this.$indicator.width()/2,this.isDragging=!1,this.downX=0,this.downLeft=0-this.indicatorHalfWidth,this.moveHandler=null,this.delta=0,this.value=this.options.value,this.$indicator.on("mousedown",g.prototype.mousedownHandler.bind(this)),this.$back.on("click",g.prototype.clickHandler.bind(this)),$("body").on("mouseup",g.prototype.mouseupHandler.bind(this))};g.prototype.setOptions=function(t){var e=this.options.value===t.value&&this.options.max===t.max&&this.options.min===t.min;this.options=$.extend({},this.options,t),this.value=this.options.value;var a=parseFloat(this.value*this.width/(this.options.max-this.options.min))-this.indicatorHalfWidth;e||this.$indicator.css("left",a+"px")},g.prototype.clickHandler=function(t){if(t.preventDefault(),!(this.options&&this.options.max<=this.options.min)){var e=$(t.currentTarget).offset(),a=t.clientX-e.left;if(!(a<0||a>this.width)){var n=a-this.indicatorHalfWidth;this.$indicator.css("left",n+"px"),this.value=parseInt(a/this.width*(this.options.max-this.options.min)),this.options&&this.options.onDragEnd&&this.options.onDragEnd(this.value)}}},g.prototype.mousedownHandler=function(t){if(t.preventDefault(),!(this.options&&this.options.max<=this.options.min)){this.isDragging=!0,this.downX=t.clientX;var e=parseFloat(this.$indicator.css("left"));this.downLeft=isNaN(e)?0:e,this.moveHandler=g.prototype.mousemoveHandler.bind(this),$("body").on("mousemove",this.moveHandler)}},g.prototype.mousemoveHandler=function(t){if(t.preventDefault(),!(this.options&&this.options.max<=this.options.min)&&this.isDragging){var e=t.clientX-this.downX,a=this.downLeft+e;a<0-this.indicatorHalfWidth&&(a=0-this.indicatorHalfWidth),a>this.width-this.indicatorHalfWidth&&(a=this.width-this.indicatorHalfWidth),this.$indicator.css("left",a+"px");var n=a+this.indicatorHalfWidth;this.value=parseInt(n/this.width*(this.options.max-this.options.min)),this.options&&this.options.onDrag&&this.options.onDrag(this.value)}},g.prototype.mouseupHandler=function(t){if(!(this.options&&this.options.max<=this.options.min)&&this.isDragging){$("body").off("mousemove",this.moveHandler);var e=t.clientX-this.downX,a=this.downLeft+e;a<0-this.indicatorHalfWidth&&(a=0-this.indicatorHalfWidth),a>this.width-this.indicatorHalfWidth&&(a=this.width-this.indicatorHalfWidth),this.isDragging=!1;var n=a+this.indicatorHalfWidth;this.value=parseInt(n/this.width*(this.options.max-this.options.min)),this.options&&this.options.onDragEnd&&this.options.onDragEnd(this.value)}};var m=function(t,e){this.options=e,this.$origin=$(t),this.isDragging=!1,this.downY=0,this.downX=0,this.downTop=0,this.moveHandler=null,this.$indicator=null,this.delta=0,this.$origin.on("mousedown",m.prototype.mousedownHandler.bind(this)),$("body").on("mouseup",m.prototype.mouseupHandler.bind(this))};m.prototype.mousedownHandler=function(t){t.preventDefault(),this.isDragging=!0,this.downX=t.clientX,this.downY=t.clientY,this.$indicator=$('<div class="indicator"></div>'),this.$origin.append(this.$indicator);var e=parseFloat(this.$indicator.css("top"));this.downTop=isNaN(e)?0:e,this.moveHandler=m.prototype.mousemoveHandler.bind(this),this.$indicator.css("position","absolute"),$("body").on("mousemove",this.moveHandler)},m.prototype.mousemoveHandler=function(t){if(t.preventDefault(),this.isDragging){var e=t.clientY-this.downY,a=this.delta+e;if(this.options&&void 0!==this.options.min&&a<this.options.min)return;if(this.options&&void 0!==this.options.max&&a>this.options.max)return;this.$indicator.css("top",this.downTop+e+"px")}},m.prototype.mouseupHandler=function(t){if(this.isDragging){var e=t.clientY-this.downY;this.delta+=e,this.options&&void 0!==this.options.min&&this.delta<this.options.min&&(this.delta=this.options.min),this.options&&void 0!==this.options.max&&this.delta>this.options.max&&(this.delta=this.options.max),this.isDragging=!1,this.$origin.empty(),$("body").off("mousemove",this.moveHandler),this.options&&this.options.onDragEnd&&this.options.onDragEnd(this.delta)}},m.prototype.setDelta=function(t){this.options&&void 0!==this.options.min&&t>=this.options.min&&this.options&&void 0!==this.options.max&&t<=this.options.max&&(this.delta=t,this.options&&this.options.onDragEnd&&this.options.onDragEnd(this.delta))};var y=function(t,e,a){this.dependency=a,this.selector=t,this.zTreeIdJson={},this.crrentSubV=[],this.vehicleSize=0,this.inputChange=null,this.first=!0,this.onlineType="all";var n,i=this;($("input").inputClear().on("onClearEvent",(function(t,e){"citySel"==e.id&&($("#trackTreeLoad span").text("加载中，请稍后"),$("#trackTreeLoad i").css("visibility","visible"),$("#trackTreeLoad").show(),i.init())})),$("#citySel").on("input propertychange",(function(t){null!==i.inputChange&&(clearTimeout(i.inputChange),i.inputChange=null),i.inputChange=setTimeout((function(){var t=$("#citySel").val();if(""==t)return $("#trackTreeLoad span").text("正在查询，请稍后"),$("#trackTreeLoad i").css("visibility","visible"),$("#trackTreeLoad").show(),void i.init();i.search(t),$("#trackTreeLoad i").css("visibility","visible"),$("#trackTreeLoad span").html("正在查询，请稍后"),$("#trackTreeLoad").show()}),800)})),"Microsoft Internet Explorer"==navigator.appName&&"MSIE9.0"==navigator.appVersion.split(";")[1].replace(/[ ]/g,""))&&$("#citySel").bind("focus",(function(){n=setInterval((function(){var t=$("#citySel").val();""!=t?(i.search(t),$("#trackTreeLoad i").css("visibility","visible"),$("#trackTreeLoad span").html("正在查询，请稍后"),$("#trackTreeLoad").show()):i.init()}),800)})).bind("blur",(function(){clearInterval(n)}))};y.prototype.all=function(){this.onlineType="all",trackPlayback.monitorTree.init()},y.prototype.online=function(){this.onlineType="online",trackPlayback.monitorTree.init()},y.prototype.offline=function(){this.onlineType="offline",trackPlayback.monitorTree.init()},y.prototype.init=function(){this.setting={async:{url:y.prototype.getTreeUrl.bind(this),type:"post",enable:!0,autoParam:["id"],dataType:"json",sync:!1,otherParam:{type:"single"},dataFilter:y.prototype.ajaxDataFilter.bind(this)},check:{enable:!0,chkStyle:"radio",chkboxType:{Y:"s",N:"s"},radioType:"all"},view:{dblClickExpand:!1,nameIsHTML:!0,countClass:"offline"===this.onlineType?"hidden":"group-number-statistics"},data:{simpleData:{enable:!0}},callback:{beforeCheck:y.prototype.zTreeBeforeCheck.bind(this),onCheck:y.prototype.onCheck.bind(this),beforeClick:y.prototype.zTreeBeforeClick.bind(this),onAsyncSuccess:y.prototype.zTreeOnAsyncSuccess.bind(this),onAsyncError:y.prototype.zTreeOnAsyncError.bind(this),onClick:y.prototype.zTreeOnClick.bind(this),onExpand:y.prototype.zTreeOnExpand.bind(this),beforeAsync:y.prototype.zTreeBeforeAsync.bind(this),onNodeCreated:y.prototype.zTreeOnNodeCreated.bind(this)}},this.treeObj=$.fn.zTree.init($(this.selector),this.setting,null)},y.prototype.search=function(t,e){""==t&&(clearTimeout(this.inputChange),this.inputChange=null),this.setting={async:{url:"/clbs/m/functionconfig/fence/bindfence/monitorTreeFuzzy",type:"post",enable:!0,autoParam:["id"],dataType:"json",otherParam:{type:"single",queryParam:t,queryType:null===e?"name":e},dataFilter:y.prototype.ajaxQueryDataFilterSearch.bind(this)},check:{enable:!0,chkStyle:"radio"},view:{dblClickExpand:!1,nameIsHTML:!0,countClass:"group-number-statistics"},data:{simpleData:{enable:!0}},callback:{beforeCheck:y.prototype.zTreeBeforeCheck.bind(this),onCheck:y.prototype.onCheck.bind(this),beforeClick:y.prototype.zTreeBeforeClick.bind(this),onAsyncSuccess:y.prototype.zTreeOnAsyncSuccessSearch.bind(this),onAsyncError:y.prototype.zTreeOnAsyncError.bind(this),onClick:y.prototype.zTreeOnClick.bind(this),onExpand:y.prototype.zTreeOnExpand.bind(this),beforeAsync:y.prototype.zTreeBeforeAsync.bind(this),onNodeCreated:y.prototype.zTreeOnNodeCreated.bind(this)}},this.treeObj=$.fn.zTree.init($(this.selector),this.setting,null)},y.prototype.zTreeOnAsyncError=function(t,e,a,n,i){"error"==i&&($("#trackTreeLoad i").css("visibility","hidden"),$("#trackTreeLoad span").text("加载失败"))},y.prototype.zTreeOnExpand=function(t,e,a){if("assignment"==a.type&&void 0===a.children){json_ajax("post","/clbs/m/functionconfig/fence/bindfence/putMonitorByAssign","json",!1,{assignmentId:a.id,isChecked:a.checked,monitorType:"monitor"},function(t){var n=JSON.parse(Object(s.a)(t.msg));null!=n&&n.length>0&&(this.treeObj.addNodes(a,n),this.checkCurrentNodes(e))}.bind(this))}},y.prototype.checkCurrentNodes=function(t){var e=this.crrentSubV;if(null!=e&&null!=e&&0!==e.length)for(var a=0;a<e.length;a++){var n=zTreeIdJson[e[a]];if(null!=n&&n.length>0)for(var i=0;i<n.length;i++){var r=n[i],o=this.treeObj.getNodeByTId(r);null!=o&&this.treeObj.checkNode(o,!0,!0)}}},y.prototype.zTreeBeforeAsync=function(){return this.dependency.get("flags").bflag},y.prototype.zTreeOnNodeCreated=function(t,e,a){var n=a.id.toString(),i=[];null==this.zTreeIdJson[n]||null==this.zTreeIdJson[n]?(i=[a.tId],this.zTreeIdJson[n]=i):this.zTreeIdJson[n].push(a.tId)},y.prototype.zTreeOnAsyncSuccess=function(t,e,a,n){$("#trackTreeLoad").hide();var i=this.treeObj,r=this.dependency.get("data").getInitVid();if(null!=r&&(i.expandAll(!0),null!=r&&""!=r)){var o=i.getNodesByParam("id",r,null);if(null!=o&&null!=o&&o.length>0){for(var s=0,l=o.length;s<l;s++)i.checkNode(o[s],!0,!0),0==this.crrentSubV.length&&this.crrentSubV.push(o[s].id);this.dependency.get("data").setInitVid(null),this.dependency.get("data").setActiveTreeNode(o[0])}}if("online"===this.onlineType&&this.treeObj.expandAll(!0),i.updateNodeCount(a),this.first){this.first=!1;var d=0,c=i.getNodesByFilter(assignmentNotExpandFilter);for(s=0;s<c.length&&(i.expandNode(c[s],!0,!0,!1,!0),!((d+=c[s].children.length)>=200));s++);}},y.prototype.zTreeOnAsyncSuccessSearch=function(t,e,a,n){var i=this.treeObj;0==i.getNodes().length?($("#trackTreeLoad i").css("visibility","hidden"),$("#trackTreeLoad span").text("未找到查询对象")):$("#trackTreeLoad").hide();var r=this.dependency.get("data").getInitVid();if(null!=r&&(i.expandAll(!0),null!=r&&""!=r)){var o=i.getNodesByParam("id",r,null);if(null!=o&&null!=o&&o.length>0){for(var s=0,l=o.length;s<l;s++)i.checkNode(o[s],!0,!0),0==this.crrentSubV.length&&this.crrentSubV.push(o[s].id);this.dependency.get("data").setInitVid(null),this.dependency.get("data").setActiveTreeNode(o[0]);var d=this.dependency.get("fenceTree");d.vehicleTreeClickGetFenceInfo.bind(d)(!0,r)}}if(i.updateNodeCount(a),this.first){this.first=!1;var c=0,h=i.getNodesByFilter(assignmentNotExpandFilter);for(s=0;s<h.length&&(i.expandNode(h[s],!0,!0,!1,!0),!((c+=h[s].children.length)>=200));s++);}null==this.inputChange&&0==this.vehicleSize||(""!==$("#citySel").val()&&i.expandAll(!0),clearTimeout(this.inputChange),this.inputChange=null)},y.prototype.zTreeBeforeCheck=function(t,e){this.dependency.get("data");if(e.checked)return!1;var a=!0;if(!e.checked){if("group"==e.type||"assignment"==e.type){var n=(s=$.fn.zTree.getZTreeObj(t)).getCheckedNodes(!0),i=0;json_ajax("post","/clbs/m/personalized/ico/getVehicleCount","json",!1,{parentId:e.id,type:e.type},(function(t){t.success?i+=t.obj:layer.msg(t.msg)}));for(var r=[],o=0;o<n.length;o++){if(l=n[o].id,"people"==n[o].type||"vehicle"==n[o].type||"thing"==n[o].type)null==s.getNodeByParam("tId",n[o].tId,e)&&-1==$.inArray(l,r)&&r.push(l)}i+=r.length}else if("people"==e.type||"vehicle"==e.type||"thing"==e.type){var s,l;for(n=(s=$.fn.zTree.getZTreeObj(t)).getCheckedNodes(!0),i=0,r=[],o=0;o<n.length;o++)s.checkNode(n[o],!1,!0),l=n[o].id,"people"!=n[o].type&&"vehicle"!=n[o].type&&"thing"!=n[o].type||-1==$.inArray(l,r)&&r.push(l);i=r.length+1}i>100&&(layer.msg("最多勾选100个监控对象"),a=!1)}return a},y.prototype.getTreeUrl=function(t,e){var a;return null==e?a="all"===this.onlineType?"/clbs/m/functionconfig/fence/bindfence/getTreeByMonitorCount":"online"===this.onlineType?"/clbs/m/basicinfo/monitoring/vehicle/treeStateInfo?webType=2&type=1":"/clbs/m/functionconfig/fence/bindfence/getTreeByMonitorCount":"assignment"==e.type&&(a="/clbs/m/functionconfig/fence/bindfence/putMonitorByAssign?assignmentId="+e.id+"&isChecked="+e.checked+"&monitorType=monitor"),a},y.prototype.ajaxQueryDataFilterSearch=function(t,e,a){a=JSON.parse(Object(s.a)(a));var n=filterQueryResult(a,this.crrentSubV),i=$("#treeEmpty");return 0==n.length?i.show():i.hide(),n},y.prototype.ajaxDataFilter=function(t,e,a){"all"!==this.onlineType&&"offline"!==this.onlineType||(a=JSON.parse(Object(s.a)(a.msg)));var n=trackPlayback.getOnlineArray(),i=[];if(a)for(var r=0;r<a.length;r++){var o=a[r];if("group"==o.type||"assignment"==o.type?(o.open=!0,o.nocheck=!0):o.isParent=!1,"vehicle"===o.type&&(this.vehicleSize+=1),"offline"===this.onlineType){if("assignment"!==o.type&&"group"!==o.type&&n.indexOf(o.id)>-1)continue}else if("online"===this.onlineType&&"assignment"!==o.type&&"group"!==o.type&&n.indexOf(o.id)<0)continue;i.push(o)}return this.dependency.get("data").setTreeData(i),i},y.prototype.zTreeBeforeClick=function(t,e,a){return"group"!==e.type&&"assignment"!==e.type},y.prototype.onCheck=function(t,e,a){var n=this.dependency.get("data"),i=new Date,r=i.getFullYear()+"-"+(parseInt(i.getMonth()+1)<10?"0"+parseInt(i.getMonth()+1):parseInt(i.getMonth()+1))+"-01";i.setMonth(i.getMonth()+1);var o=i.getFullYear()+"-"+(parseInt(i.getMonth()+1)<10?"0"+parseInt(i.getMonth()+1):parseInt(i.getMonth()+1))+"-01";if(this.dependency.get("calendar").nowMonth=r,this.dependency.get("calendar").afterMonth=o,a.checked){n.setNowMonth(r),n.setAfterMonth(o),n.setActiveTreeNode(a),this.treeObj.selectNode(a,!1,!0);var s=this.dependency.get("fenceTree");s.vehicleTreeClickGetFenceInfo.bind(s)(a.checked,a.id)}},y.prototype.getCharSelect=function(t){var e=t.getCheckedNodes(!0),a=t.getNodes();e.length>0?$("#areaGroupSelect").val(a[0].name):$("#areaGroupSelect").val("")},y.prototype.getCheckedNodes=function(){for(var t=$.fn.zTree.getZTreeObj("treeDemoMenu").getCheckedNodes(!0),e="",a="",n=0,i=t.length;n<i;n++)"vehicle"!=t[n].type&&"people"!=t[n].type&&"thing"!=t[n].type||(e+=t[n].name+",",a+=t[n].id+",");allVid=a,vnameList=e},y.prototype.zTreeOnClick=function(t,e,a){var n=this.dependency.get("data"),i=new Date,r=i.getFullYear()+"-"+(parseInt(i.getMonth()+1)<10?"0"+parseInt(i.getMonth()+1):parseInt(i.getMonth()+1))+"-01";i.setMonth(i.getMonth()+1);var o=i.getFullYear()+"-"+(parseInt(i.getMonth()+1)<10?"0"+parseInt(i.getMonth()+1):parseInt(i.getMonth()+1))+"-01";if(this.dependency.get("calendar").nowMonth=r,this.dependency.get("calendar").afterMonth=o,(n.getActiveTreeNode()?n.getActiveTreeNode().id:null)!==a.id){a.name;n.setNowMonth(r),n.setAfterMonth(o),n.setActiveTreeNode(a);a.deviceType;for(var s=this.treeObj,l=s.getCheckedNodes(!0),d=0,c=l.length;d<c;d++)s.checkNode(l[d],!1,!0);s.selectNode(a,!1,!0),s.checkNode(a,!0,!0),this.dependency.get("map").map.clearMap();var h=this.dependency.get("fenceTree");h.vehicleTreeClickGetFenceInfo.bind(h)(a.checked,a.id)}};var f=function(t,e,a){this.dependency=a,this.monitorSize=0,this.monitorMaxCheckSize=100,this.zTreeIdJson={},this.menuCrrentSubV=[],this.areaVehicleNameList="",this.searchTreeTime=null,this.searchFlag=!0,this.inputFlag=!1,this.selector=$(t),this.eventBind()};f.prototype.eventBind=function(){var t=this;$("input").inputClear().on("onClearEvent",(function(e,a){"groupSelect"==a.id&&(t.dependency.get("flags").changeFlag=!1,t.dependency.get("data").setAreaTreeAllCheck(!1),this.inputFlag=!0,t.treeInit())})),$("#areaGroupSelect").on("input propertychange",(function(e){t.searchTreeTime&&clearTimeout(t.searchTreeTime),t.searchTreeTime=setTimeout((function(){if(t.searchFlag){var e=$("#areaGroupSelect").val();t.searchAreaTreeVehicle(e)}t.searchFlag=!0}),500)})),$("#queryType").on("change",(function(){""!=$("#areaGroupSelect").val()&&($("#areaGroupSelect").val(""),t.dependency.get("flags").changeFlag=!0,t.dependency.get("data").setAreaTreeAllCheck(!1),t.treeInit())}))},f.prototype.treeInit=function(){this.setting={async:{url:f.prototype.getTreeUrl.bind(this),type:"post",enable:!0,autoParam:["id"],dataType:"json",otherParam:{type:"single"},dataFilter:f.prototype.ajaxDataFilter.bind(this)},check:{enable:!0,chkStyle:"checkbox",radioType:"all",chkboxType:{Y:"s",N:"s"}},view:{dblClickExpand:!1,nameIsHTML:!0,countClass:"group-number-statistics"},data:{simpleData:{enable:!0}},callback:{beforeCheck:f.prototype.zTreeBeforeCheck.bind(this),beforeClick:f.prototype.zTreeBeforeClick.bind(this),onCheck:f.prototype.onCheckVehicle.bind(this),onAsyncSuccess:f.prototype.zTreeOnAsyncSuccess.bind(this),onExpand:f.prototype.zTreeOnExpand.bind(this),onNodeCreated:f.prototype.zTreeOnNodeCreated.bind(this)}},this.treeObj=$.fn.zTree.init(this.selector,this.setting,null)},f.prototype.getChildNode=function(t,e){var a=$.fn.zTree.getZTreeObj(e);json_ajax("post","/clbs/m/functionconfig/fence/bindfence/putMonitorByAssign","json",!1,{assignmentId:t.id,isChecked:t.checked,monitorType:"monitor"},function(n){var i=JSON.parse(Object(s.a)(n.msg));null!=i&&i.length>0&&(a.addNodes(t,i),this.checkCurrentNodes(e))}.bind(this))},f.prototype.zTreeOnExpand=function(t,e,a){var n=$.fn.zTree.getZTreeObj(e),i=this;if(null!==a.pId)if(void 0===a.children&&"assignment"==a.type)this.getChildNode(a,e);else if("group"==a.type){json_ajax("post","/clbs/m/functionconfig/fence/bindfence/putMonitorByGroup","json",!1,{groupId:a.id,isChecked:a.checked,monitorType:"vehicle"},function(t){var e=t.obj;null!=e&&null!=e&&$.each(e,(function(t){var a=t,r=(e[t],i.zTreeIdJson[a][0]),o=n.getNodeByTId(r);void 0===o.children&&n.addNodes(o,[])}))}.bind(this))}},f.prototype.setMenuCrrentSubV=function(t){this.menuCrrentSubV=[],this.menuCrrentSubV.push(t)},f.prototype.checkCurrentNodes=function(t){var e=$.fn.zTree.getZTreeObj(t),a=this.menuCrrentSubV;if(null!=a&&null!=a&&0!==a.length)for(var n=0;n<a.length;n++){var i=zTreeIdJson[a[n]];if(null!=i&&i.length>0)for(var r=0;r<i.length;r++){var o=i[r],s=e.getNodeByTId(o);null!=s&&e.checkNode(s,!0,!0)}}},f.prototype.zTreeBeforeAsync=function(){return this.dependency.get("flags").bflag},f.prototype.zTreeOnNodeCreated=function(t,e,a){var n=a.id.toString(),i=[];null==this.zTreeIdJson[n]||null==this.zTreeIdJson[n]?(i=[a.tId],this.zTreeIdJson[n]=i):this.zTreeIdJson[n].push(a.tId)},f.prototype.zTreeOnAsyncSuccess=function(t,e,a,n){var i=$.fn.zTree.getZTreeObj(e);this.dependency.get("flags").bflag1=!1;var r=this.dependency.get("data").getAreaTreeAllCheck();this.monitorSize<5e3&&r&&i.expandAll(!0),this.monitorSize<=this.monitorMaxCheckSize&&r&&(i.checkAllNodes(!0),this.dependency.get("flags").changeFlag||this.getCharSelect(i)),this.dependency.get("data").setAreaTreeAllCheck(!1)},f.prototype.zTreeBeforeCheck=function(t,e){var a=!0;if(!e.checked){if("group"==e.type||"assignment"==e.type){var n=(s=$.fn.zTree.getZTreeObj(t)).getCheckedNodes(!0),i=0;json_ajax("post","/clbs/m/personalized/ico/getCheckedVehicle","json",!1,{parentId:e.id,type:e.type},(function(t){t.success?i+=t.obj:layer.msg(t.msg)}));for(var r=[],o=0;o<n.length;o++){if(l=n[o].id,"people"==n[o].type||"vehicle"==n[o].type||"thing"==n[o].type)null==s.getNodeByParam("tId",n[o].tId,e)&&-1==$.inArray(l,r)&&r.push(l)}i+=r.length}else if("people"==e.type||"vehicle"==e.type||"thing"==e.type){var s,l;for(n=(s=$.fn.zTree.getZTreeObj(t)).getCheckedNodes(!0),i=0,r=[],o=0;o<n.length;o++)l=n[o].id,"people"!=n[o].type&&"vehicle"!=n[o].type&&"thing"!=n[o].type||-1==$.inArray(l,r)&&r.push(l);i=r.length+1}i>this.monitorMaxCheckSize&&(layer.msg("最多勾选"+this.monitorMaxCheckSize+"个监控对象"),a=!1)}return a},f.prototype.getTreeUrl=function(t,e){return null==e?"/clbs/m/functionconfig/fence/bindfence/getTreeByMonitorCount":"assignment"==e.type?"/clbs/m/functionconfig/fence/bindfence/putMonitorByAssign?assignmentId="+e.id+"&isChecked="+e.checked+"&monitorType=monitor":void 0},f.prototype.ajaxDataFilter=function(t,e,a){a=JSON.parse(Object(s.a)(a.msg));if(this.monitorSize=0,a)for(var n=0;n<a.length;n++)"assignmentSkin"!=a[n].iconSkin&&(a[n].open=!0),a[n].nocheck=!1,"assignment"==a[n].type&&a[n].canCheck&&(this.monitorSize+=a[n].canCheck);return a},f.prototype.zTreeBeforeClick=function(t,e,a){return $.fn.zTree.getZTreeObj(t).checkNode(e,!e.checked,!0,!0),!1},f.prototype.onCheckVehicle=function(t,e,a){var n=$.fn.zTree.getZTreeObj(e);a.checked&&(this.searchFlag=!1,n.expandNode(a,!0,!0,!0,!0)),this.dependency.get("data").setAreaTreeAllCheck(!1),this.menuCrrentSubV=[],this.menuCrrentSubV.push(a.id),this.getCharSelect(n),this.getCheckedNodes()},f.prototype.getCharSelect=function(t){var e=t.getCheckedNodes(!0),a=t.getNodes();e.length>0?$("#areaGroupSelect").val(a[0].name):$("#areaGroupSelect").val("")},f.prototype.getCheckedNodes=function(){for(var t=$.fn.zTree.getZTreeObj("areaTreeDemo").getCheckedNodes(!0),e="",a="",n=0,i=t.length;n<i;n++)"vehicle"!=t[n].type&&"people"!=t[n].type&&"thing"!=t[n].type||(e+=t[n].name+",",a+=t[n].id+",");this.dependency.get("data").setAreaTreeCheckVid(a),this.areaVehicleNameList=e},f.prototype.ajaxQueryDataFilter=function(t,e,a){return a=JSON.parse(Object(s.a)(a)),"vehicle"==$("#queryType").val()?filterQueryResult(a,this.menuCrrentSubV):a},f.prototype.searchZTreeOnAsyncSuccess=function(t,e,a,n){var i=$.fn.zTree.getZTreeObj(e);this.dependency.get("flags").bflag1=!1,i.expandAll(!0)},f.prototype.searchAreaTreeVehicle=function(t){if(this.dependency.get("data").setAreaTreeAllCheck(!1),this.menuCrrentSubV=[],null==t||null==t||""==t)this.inputFlag&&(this.inputFlag=!1,this.treeInit());else{this.inputFlag=!0;var e={async:{url:"/clbs/a/search/reportFuzzySearch",type:"post",enable:!0,autoParam:["id"],dataType:"json",otherParam:{type:$("#queryType").val(),queryParam:t,queryType:"multiple"},dataFilter:f.prototype.ajaxQueryDataFilter.bind(this)},check:{enable:!0,chkStyle:"checkbox",radioType:"all",chkboxType:{Y:"s",N:"s"}},view:{dblClickExpand:!1,nameIsHTML:!0,countClass:"group-number-statistics"},data:{simpleData:{enable:!0}},callback:{beforeClick:f.prototype.zTreeBeforeClick.bind(this),onCheck:f.prototype.onCheckVehicle.bind(this),onExpand:f.prototype.zTreeOnExpand.bind(this),onAsyncSuccess:f.prototype.searchZTreeOnAsyncSuccess.bind(this),onNodeCreated:f.prototype.zTreeOnNodeCreated.bind(this)}};$.fn.zTree.init(this.selector,e,null)}};var v=function(t,e,a){this.dependency=a,this.isMapThreeDFlag=!0,this.isTrafficDisplay=!0,this.gdSatelliteLayer=new AMap.TileLayer.Satellite,this.standardLayer=new AMap.TileLayer,this.map=new AMap.Map(t,{resizeEnable:!0,scrollWheel:!0,zoom:18,layers:[this.standardLayer,this.gdSatelliteLayer]}),this.gdSatelliteLayer.hide(),this.map.on("moveend",v.prototype.onMapAreaChange.bind(this)),this.map.on("complete",v.prototype.onMapAreaChange.bind(this)),this.map.on("mousemove",v.prototype.handleMapMouseMove.bind(this)),this.map.on("click",(function(){$(".menuContent").slideUp()})),this.paths=null,this.line=null,this.passedLine=null,this.runLine=null,this.lineArr=null,this.marker=null,this.markerIcon=null,this.listenToMoveend=null,this.listenToMoving=null,this.listenToClick=null,this.stopMarkers=null,this.middleStopMarkers=null,this.alarmMarkers=null,this.runMileMarker=null,this.infoWindow=null,this.alarmInfoWindow=null,this.stopInfoWindow=null,this.buildings=new AMap.Buildings,this.bounds=null,this.closestMarker=null,this.closestLabel=null,this.closestIndex=null,this.buildings.setMap(this.map),this.map.getCity((function(t){var e=t.province+'<span class="caret"></span>';$("#placeChoose").html(e)})),AMap.plugin(["AMap.ToolBar","AMap.Scale"],function(){this.map.addControl(new AMap.ToolBar({direction:!1})),this.map.addControl(new AMap.Scale)}.bind(this)),this.satellLayer=new AMap.TileLayer({tileUrl:"https://mt{1,2,3,0}.google.cn/maps/vt?lyrs=s@194&hl=zh-CN&gl=cn&x=[x]&y=[y]&z=[z]",zIndex:100}),this.satellLayer.setMap(this.map),this.satellLayer.hide(),this.roadNet=new AMap.TileLayer.RoadNet,this.roadNet.setMap(this.map),this.roadNet.hide(),this.realTimeTraffic=new AMap.TileLayer.Traffic,this.realTimeTraffic.setMap(this.map),this.realTimeTraffic.hide(),this.markerStart=null,this.markerEnd=null,this.mouseTool=new AMap.MouseTool(this.map),this.mouseTool.on("draw",v.prototype.createRangeSuccess.bind(this)),this.mouseTool1=new AMap.MouseTool(this.map),this.mouseTool1.on("draw",v.prototype.createRangeSuccess.bind(this)),this.RegionalQuerymarker1=null,this.RegionalQuerymarker2=null,this.areaTitle1=null,this.areaTitle2=null,$(".amap-logo").attr("href","javascript:void(0)").attr("target",""),$("#setMap").on("click",v.prototype.satelliteMapSwitching.bind(this)),$("#googleMapTrackPlayback").on("click",v.prototype.showGoogleMapLayers.bind(this)),$("#mapDropSettingPlayback").on("click",v.prototype.showMapView.bind(this)),$("#realTimeRCTrackPlayback").on("click",v.prototype.realTimeRC.bind(this))};v.prototype.onMapAreaChange=function(){var t=this.map.getBounds(),e=t.getSouthWest(),a=t.getNorthEast(),n=e.lat,i=e.lng,r=a.lat,o=a.lng;this.bounds=[[i,n],[o,r]]},v.prototype.showZtreeCheckedToMap=function(t,e){if(1==t.checked){for(var a=0,n=(o=e.getChangeCheckedNodes()).length;a<n;a++)o[a].checkedOld=!0;for(var i=0;i<o.length;i++){var r=o[i].id;this.showFenceInfo(r,o[i])}}else{var o;for(a=0,n=(o=e.getChangeCheckedNodes()).length;a<n;a++){o[a].checkedOld=!1,e.cancelSelectedNode(o[a]);r=o[a].id;this.hideFenceInfo(r)}}},v.prototype.drawAdministrationToMap=function(t,e,a){var n=[],i=this.dependency.get("data").getAdministrativeRegionsList();if(i.containsKey(e)){var r=i.get(e);this.map.remove(r),i.remove(e)}var o=0;for(t.length;o<1;o++){var s=new AMap.Polygon({map:this.map,strokeWeight:1,strokeColor:"#CC66CC",fillColor:"#CCF3FF",fillOpacity:.5,path:t});n.push(s)}i.put(e,n),this.map.setFitView(s),this.dependency.get("data").setAdministrativeRegionsList(i)},v.prototype.drawMarkToMap=function(t,e){var a=t.id,n=this.dependency.get("data").getFenceIdList();if(n.containsKey(a)){var i=n.get(a);e.remove(i),n.remove(a)}var r=[];r.push(t.longitude),r.push(t.latitude);var o=new AMap.Marker({position:r,offset:new AMap.Pixel(-9,-23)});1==t.markIcon&&o.setIcon("/clbs/resources/img/circleIcon.png"),o.setMap(e),e.setFitView(o),n.put(a,o),this.dependency.get("data").setFenceIdList(n)},v.prototype.drawRectangleToMap=function(t,e){var a=t.id,n=this.dependency.get("data").getFenceIdList();if(n.containsKey(a)){var i=n.get(a);i.show(),this.map.setFitView(i)}else{var r=new Array;null!=t&&(r.push([t.leftLongitude,t.leftLatitude]),r.push([t.rightLongitude,t.leftLatitude]),r.push([t.rightLongitude,t.rightLatitude]),r.push([t.leftLongitude,t.rightLatitude]));var o=new AMap.Polygon({path:r,strokeColor:"#FF33FF",strokeOpacity:.2,strokeWeight:3,fillColor:"#1791fc",fillOpacity:.35});o.setMap(e),e.setFitView(o),n.put(a,o),this.dependency.get("data").setFenceIdList(n)}},v.prototype.drawPolygonToMap=function(t,e){var a=t[0].polygonId,n=this.dependency.get("data").getFenceIdList();n.containsKey(a)&&(n.get(a).hide(),n.remove(a));var i=new Array;if(null!=t&&t.length>0)for(var r=0;r<t.length;r++)i.push([t[r].longitude,t[r].latitude]);var o=new AMap.Polygon({path:i,strokeColor:"#FF33FF",strokeOpacity:.2,strokeWeight:3,fillColor:"#1791fc",fillOpacity:.35});o.setMap(e),e.setFitView(o),n.put(a,o),this.dependency.get("data").setFenceIdList(n)},v.prototype.drawCircleToMap=function(t,e){var a=t.id,n=this.dependency.get("data").getFenceIdList();n.containsKey(a)&&(n.get(a).hide(),n.remove(a));var i=new AMap.Circle({center:new AMap.LngLat(t.longitude,t.latitude),radius:t.radius,strokeColor:"#F33",strokeOpacity:1,strokeWeight:3,fillColor:"#ee2200",fillOpacity:.35});i.setMap(e),e.setFitView(i),n.put(a,i),this.dependency.get("data").setFenceIdList(n)},v.prototype.drawTravelLineToMap=function(t,e,a,n){var i=a.id,r=[],o=(a.startlongtitude,a.startLatitude,a.endlongtitude,a.endLatitude,[]);if(null!=n)for(var s=0,l=n.length;s<l;s++)o.push([n[s].longtitude,n[s].latitude]);var d=0;for(l=t.length;d<l;d++)r.push([t[d].longitude,t[d].latitude]);var c=this.dependency.get("data").getTravelLineList();if(c.containsKey(i)){var h=c.get(i);this.map.remove([h]),c.remove(i)}var p=new AMap.Polyline({path:r,strokeColor:"#3366FF",strokeOpacity:1,strokeWeight:5,strokeStyle:"solid",strokeDasharray:[10,5],zIndex:51});p.setMap(this.map),this.map.setFitView(p),c.put(i,p),this.dependency.get("data").setTravelLineList(c)},v.prototype.drawLineToMap=function(t,e,a,n){var i=t[0].lineId,r=this.dependency.get("data").getFenceIdList();if(r.containsKey(i)){var o=r.get(i);if(Array.isArray(o))for(var s=0;s<o.length;s++)o[s].hide();else o.hide();r.remove(i)}var l=new Array;if(null!=t&&t.length>0)for(var s in t)"0"==t[s].type&&(l[s]=[t[s].longitude,t[s].latitude]);var d=new AMap.Polyline({path:l,strokeColor:"#3366FF",strokeOpacity:1,strokeWeight:5,strokeStyle:"solid",strokeDasharray:[10,5],zIndex:51});[].push(d),r.put(i,d),d.setMap(n),n.setFitView(d),this.dependency.get("data").setFenceIdList(r)},v.prototype.hideFenceInfo=function(t){var e=this.dependency.get("data").getFenceIdList();if(e.containsKey(t)){var a=e.get(t);if(Array.isArray(a))for(var n=0;n<a.length;n++)a[n].hide();else a.hide()}this.hideRegionsOrTravel(t)},v.prototype.hideRegionsOrTravel=function(t){var e=this.dependency.get("data").getAdministrativeRegionsList();if(e.containsKey(t)){var a=e.get(t);this.map.remove(a),e.remove(t),this.dependency.get("data").setAdministrativeRegionsList(e)}var n=this.dependency.get("data").getTravelLineList();if(n.containsKey(t)){a=n.get(t);this.map.remove(a),n.remove(t)}this.dependency.get("data").setTravelLineList(n)},v.prototype.showFenceInfo=function(t,e){var a=this.dependency.get("data").getFenceIdList();if(a.containsKey(t)){var n=a.get(t);if(null!=n)if(Array.isArray(n))for(var i=0;i<n.length;i++)n[i].show(),this.map.setFitView(n[i]);else n.show(),this.map.setFitView(n)}else{this.dependency.get("fenceTree").getFenceDetailInfo([e],this.map)}},v.prototype.delFenceListAndMapClear=function(){var t=$.fn.zTree.getZTreeObj("vFenceTreeTrackPlayback"),e=this.dependency.get("data").getFenceIdList();if(null!=t){for(var a=t.getCheckedNodes(!0),n=0,i=a.length;n<i;n++)t.checkNode(a[n],!1,!1);var r=t.getChangeCheckedNodes();for(n=0;n<r.length;n++)r[n].checkedOld=!1;if(e.elements.length>0){var o=e.elements.length;for(n=0;n<o;n++){var s=e.elements[n].key,l=e.get(s);"AMap.Marker"!=l.CLASS_NAME&&"AMap.Polyline"!=l.CLASS_NAME&&"AMap.Polygon"!=l.CLASS_NAME&&"AMap.Circle"!=l.CLASS_NAME||l.hide()}e.clear()}var d=this.dependency.get("data").getAdministrativeRegionsList();if(d.elements.length>0){var c=d.elements.length;for(n=0;n<c;n++){var h=d.elements[n].key,p=d.get(h);this.map.remove(p)}d.clear(),this.dependency.get("data").setAdministrativeRegionsList(d)}var u=this.dependency.get("data").getTravelLineList();if(u.elements.length>0){var g=u.elements.length;for(n=0;n<g;n++){var m=u.elements[n].key,y=u.get(m);this.map.remove([y])}u.clear()}this.dependency.get("data").setFenceIdList(e),this.dependency.get("data").getTravelLineList(u)}},v.prototype.createRangeSuccess=function(t){var e=this.dependency.get("data").getRangeAreaPos(),a=this.dependency.get("data").getAreaIndex();e[a]=t.obj.getBounds(),this.dependency.get("data").setRangeAreaPos(e);var n=$(".areaInput").eq(a);n.val("区域"+parseInt(a+1)),n.after('<i class="delArea"></i>'),$(".delArea").on("click",this.removeArea.bind(this));var i=t.obj.getBounds().getNorthEast().getLng(),r=t.obj.getBounds().getNorthEast().getLat();"0"==a?(this.areaTitle1=new AMap.Marker({map:this.map,position:[i,r],offset:new AMap.Pixel(-47,1),content:'<div class="areaTitle">区域1</div>',zIndex:99998,autoRotation:!0}),this.mouseTool.close(!1),this.mouseTool1.close(!1),$("#area-error").remove()):(this.areaTitle2=new AMap.Marker({map:this.map,position:[i,r],offset:new AMap.Pixel(-47,1),content:'<div class="areaTitle">区域2</div>',zIndex:99998,autoRotation:!0}),this.mouseTool.close(!1),this.mouseTool1.close(!1),$("#areaTwo-error").remove())},v.prototype.areaTableInit=function(t){var e="",a=!1,n=this.dependency.get("data").getRangeAreaPos();if(t.success){if(null!=t.obj){a=!0;var i=t.obj.areaOne,r=t.obj.areaTwo,o=[],s=[],l="turnoverId";if(i){for(var d=0,c=0;c<i.length;c++){var h=i[c].monitorId;-1==o.indexOf(h)&&(d++,o.push(h)),l=l+"_"+c;var p=i[c].monitorName;e+='<tr data-id="'+h+'" class="fenceTurnoverTime areaTrOne" data-index="0" data-time="'+(u=i[c].startTime+"--"+i[c].endTime)+'"><td><div class="imgBox"><img class="dropIcon" src="/clbs/resources/img/dropDown.svg">'+p+"</div></td><td>"+u+'</td><td>区域1</td></tr><tr><td class="areaSearchTable" colspan="3"><table class="table table-striped table-bordered" cellspacing="0" width="100%"><thead><tr><th>序号</th><th>进区域时间</th><th>出区域时间</th></tr></thead><tbody id="'+l+'"></tbody></table></td></tr>'}this.RegionalQuerymarker1&&this.map.remove(this.RegionalQuerymarker1),n[0]&&(this.RegionalQuerymarker1=new AMap.Marker({map:this.map,position:n[0].getCenter(),offset:new AMap.Pixel(-26,-13),content:'<div class="marker-route marker-marker-bus-from">'+d+"</div>",zIndex:99999,autoRotation:!0}),this.RegionalQuerymarker1.on("click",(function(){$("#areaSearchCar .areaSearchTable").hide(),$("#areaSearchCar .areaTrOne").show(),$("#areaSearchCar .areaTrTwo").hide(),$("#areaSearchCar .modal-body").scrollTop(0),$("#areaSearchCar").modal("show")})))}if(r){for(d=0,c=0;c<r.length;c++){h=r[c].monitorId;-1==s.indexOf(h)&&(d++,s.push(h)),l=l+"_"+c;var u;p=r[c].monitorName;e+='<tr data-id="'+h+'" class="fenceTurnoverTime areaTrTwo" data-index="1" data-time="'+(u=r[c].startTime+"--"+r[c].endTime)+'"><td><div class="imgBox"><img class="dropIcon" src="/clbs/resources/img/dropDown.svg">'+p+"</div></td><td>"+u+'</td><td>区域2</td></tr><tr><td class="areaSearchTable" colspan="3"><table class="table table-striped table-bordered" cellspacing="0" width="100%"><thead><tr><th>序号</th><th>进区域时间</th><th>出区域时间</th></tr></thead><tbody id="'+l+'"></tbody></table></td></tr>'}this.RegionalQuerymarker2&&this.map.remove(this.RegionalQuerymarker2),n[1]&&(this.RegionalQuerymarker2=new AMap.Marker({map:this.map,position:n[1].getCenter(),offset:new AMap.Pixel(-26,-13),content:'<div class="marker-route marker-marker-bus-from">'+d+"</div>",zIndex:99999,autoRotation:!0}),this.RegionalQuerymarker2.on("click",(function(){$("#areaSearchCar .areaSearchTable").hide(),$("#areaSearchCar .areaTrOne").hide(),$("#areaSearchCar .areaTrTwo").show(),$("#areaSearchCar .modal-body").scrollTop(0),$("#areaSearchCar").modal("show")})))}}$("#dataTable tbody.monitoringObj").html(e);var g=this;$(".fenceTurnoverTime").unbind("click").bind("click",(function(){g.dependency.get("fixedTimeArea").fenceTurnoverTime(this,g)})),a?$("#areaSearchCar").modal("show"):layer.msg(trackAreaMonitorNull)}else t.msg&&layer.msg(t.msg);layer.closeAll("loading")},v.prototype.delArea=function(t){var e=this.dependency.get("data").getRangeAreaPos();e[1]=null,this.dependency.get("data").setRangeAreaPos(e),this.areaTitle2&&(this.map.remove(this.areaTitle2),this.RegionalQuerymarker2&&(this.map.remove(this.RegionalQuerymarker2),this.RegionalQuerymarker2=null),this.mouseTool1.close(!0),this.areaTitle2=null),$(t.target).closest(".form-group").remove()},v.prototype.removeArea=function(t){t.stopPropagation();var e=$(t.target).siblings(".areaInput");e.val("");var a=e.index(".areaInput"),n=this.dependency.get("data").getRangeAreaPos();n[a]=null,this.dependency.get("data").setRangeAreaPos(n),"0"==a&&this.areaTitle1?(this.map.remove(this.areaTitle1),this.areaTitle1=null,this.RegionalQuerymarker1&&(this.map.remove(this.RegionalQuerymarker1),this.RegionalQuerymarker1=null),this.mouseTool.close(!0)):"1"==a&&this.areaTitle2&&(this.map.remove(this.areaTitle2),this.areaTitle2=null,this.RegionalQuerymarker2&&(this.map.remove(this.RegionalQuerymarker2),this.RegionalQuerymarker2=null),this.mouseTool1.close(!0)),$(t.target).remove()},v.prototype.toolClickList=function(t){this.mouseTool.close(!1),this.mouseTool1.close(!1);var e=$(t.target).index(".areaInput"),a=this.dependency.get("data").getRangeAreaPos();if(this.dependency.get("data").setAreaIndex(e),a[e]){var n=a[e].getCenter();this.map.setZoomAndCenter(18,n)}else"0"==e?this.mouseTool.rectangle():this.mouseTool1.rectangle()},v.prototype.areaDestory=function(){this.RegionalQuerymarker1&&(this.map.remove(this.RegionalQuerymarker1),this.RegionalQuerymarker1=null),this.areaTitle1&&(this.map.remove(this.areaTitle1),this.areaTitle1=null),this.RegionalQuerymarker2&&(this.map.remove(this.RegionalQuerymarker2),this.RegionalQuerymarker2=null),this.areaTitle2&&(this.map.remove(this.areaTitle2),this.areaTitle2=null),this.mouseTool.close(!0),this.mouseTool1.close(!0),this.dependency.get("data").setRangeAreaPos([])},v.prototype.realTimeRC=function(){this.isTrafficDisplay?(this.realTimeTraffic.show(),$("#realTimeRCTrackPlayback").addClass("map-active"),$("#realTimeRCLabTrackPlayback").addClass("preBlue"),this.isTrafficDisplay=!1,this.googleMapLayer&&this.googleMapLayer.setMap(null),$("#googleMapTrackPlayback").attr("checked",!1),$("#googleMapLabTrackPlayback").removeClass("preBlue")):(this.realTimeTraffic.hide(),$("#realTimeRCTrackPlayback").removeClass("map-active"),$("#realTimeRCLabTrackPlayback").removeClass("preBlue"),this.isTrafficDisplay=!0)},v.prototype.satelliteMapSwitching=function(){this.isMapThreeDFlag?($("#setMap").addClass("map-active"),$("#defaultMapLab").addClass("preBlue"),this.roadNet.show(),this.standardLayer.hide(),this.gdSatelliteLayer.show(),this.buildings.setMap(null),this.isMapThreeDFlag=!1,this.googleMapLayer&&this.googleMapLayer.setMap(null),$("#googleMapTrackPlayback").attr("checked",!1),$("#googleMapLabTrackPlayback").removeClass("preBlue")):(this.standardLayer.show(),this.gdSatelliteLayer.hide(),$("#setMap").removeClass("map-active"),$("#defaultMapLab").removeClass("preBlue"),this.buildings.setMap(this.map),this.satellLayer.hide(),this.roadNet.hide(),this.isMapThreeDFlag=!0)},v.prototype.showGoogleMapLayers=function(){$("#googleMapTrackPlayback").attr("checked")?(this.googleMapLayer.setMap(null),$("#googleMapTrackPlayback").attr("checked",!1),$("#googleMapLabTrackPlayback").removeClass("preBlue")):(this.googleMapLayer=new AMap.TileLayer({tileUrl:"http://mt{1,2,3,0}.google.cn/vt/lyrs=m@142&hl=zh-CN&gl=cn&x=[x]&y=[y]&z=[z]&s=Galil",zIndex:100}),this.googleMapLayer.setMap(this.map),$("#googleMapTrackPlayback").attr("checked",!0),$("#googleMapLabTrackPlayback").addClass("preBlue"),$("#realTimeRCTrackPlayback").attr("checked",!1),$("#realTimeRCLabTrackPlayback").removeClass("preBlue"),this.realTimeTraffic.hide(),this.isTrafficDisplay=!0,this.isMapThreeDFlag=!0,$("#setMap").attr("checked",!1),$("#defaultMapLab").removeClass("preBlue"),this.satellLayer.hide(),this.roadNet.hide(),this.buildings.setMap(this.map))},v.prototype.showMapView=function(){$("#mapDropSettingMenuPlayback").is(":hidden")?$("#mapDropSettingMenuPlayback").slideDown():$("#mapDropSettingMenuPlayback").slideUp()},v.prototype.initColorSetting=function(t){var e=this.dependency.get("data");$.ajax({type:"POST",url:"/clbs/core/uum/custom/findCustomColumnInfoByMark",data:{marks:"TRACKPLAY_SPEED"},dataType:"json",async:!0,success:function(a){if(a.success){var n=a.obj.TRACKPLAY_SPEED.map((function(t){return parseInt(t.initValue)})),i=n.slice(0,2),r=n[2];r&&e.setTrackWidth(r),e.setTrackColor(i),"function"==typeof t&&t()}}})},v.prototype.getParaColor=function(t,e,a){var n=e||[],i="#ffd045",r="#00cc00",o="#960ba3";a<=4&&(i="#fff90c",r="#008700",o="#860A92");var s=function(t){return void 0===t?"":(t=parseInt(t))>=n[1]?"high":t>=n[0]&&t<n[1]?"normal":"low"},l=t.concat([{x:Math.random()}]),d=l.length,c={};if(d>0)for(var h=s(l[0].speed),p=0,u=0;u<d;u+=1){var g=s(l[u].speed);if(g!==h){var m=c[h],y={startIndex:p,endIndex:u};m?(m.occurrence+=1,m.segment.push(y)):c[h]={type:h,occurrence:1,segment:[y]},h=g,p=u-1}}return c.high&&(c.high.color=o),c.normal&&(c.normal.color=r),c.low&&(c.low.color=i),c},v.prototype.getNearDistance=function(){var t=this.map.getZoom();return 2*(t<5?400*(30-t):t<8?300*(30-t):t<11?150*(30-t):t<14?30*(30-t):t<15?20*(30-t):t<17?6*(30-t):2*(30-t))},v.prototype.handleMapMouseMove=function(t){var e=t.lnglat,a=null,n=null;if(this.lineArr){for(var i=0,r=this.lineArr.length;i<r;i++){var o=this.lineArr[i];if(!this.isOutOfBounds(o)){var s=e.distance(o);(null===a||a>s)&&(a=s,n=i)}}var l=this.getNearDistance();if(null!==a&&a<l){if(this.closestIndex!=n){this.closestMarker&&(this.map.remove(this.closestMarker),this.map.remove(this.closestLabel)),this.closestMarker=new AMap.Marker({map:this.map,position:this.lineArr[n],offset:new AMap.Pixel(-10,-10),icon:new AMap.Icon({size:new AMap.Size(20,20),image:"/clbs/resources/img/circle.svg",imageOffset:new AMap.Pixel(0,0)}),extData:n,zIndex:70}),this.closestMarker.on("click",function(t){var e=t.target.getExtData(),a=this.dependency.get("data");this.marker&&this.marker.stopMove(),a.setIsPlaying(!1),a.setPlayIndex(e)}.bind(this));var d=this.dependency.get("data").getPositions();this.closestLabel=new AMap.Text({map:this.map,position:this.lineArr[n],offset:new AMap.Pixel(-20,-25),text:T.monthTimeRender(1e3*d[n].vtime),anchor:"top-right",zIndex:99998}),this.closestIndex=n}}else this.closestMarker&&(this.map.remove(this.closestMarker),this.map.remove(this.closestLabel),this.closestMarker=null,this.closestIndex=null)}},v.prototype.handleLineMouseClick=function(t){},v.prototype.clearMap=function(){if(null!=this.marker&&this.map.remove(this.marker),null!=this.markerEnd&&this.map.remove(this.markerEnd),null!=this.markerStart&&this.map.remove(this.markerStart),this.passedLine&&this.map.remove(this.passedLine),null!=this.infoWindow&&this.infoWindow.close(),this.line&&this.line.length>0)for(var t=0;t<this.line.length;t++)this.map.remove(this.line[t]);this.lineArr=null,this.marker=null,this.listenToMoveend=null,this.listenToMoving=null,this.listenToClick=null,this.stopMarkers=null,this.middleStopMarkers=null,this.alarmMarkers=null,this.infoWindow=null},v.prototype.drawLine=function(t){var e=this.dependency.get("data").getPositions(),a=this.dependency.get("data").getTrackColor(),n=this.dependency.get("data").getTrackWidth();if(null!==e){this.lineArr=this.formateLngLatFromPosition(e);for(var i=this.getParaColor(e,a,n),r=Object.keys(i),o=[],s=0;s<r.length;s++)for(var l=i[r[s]],d=0;d<l.segment.length;d++){var c=new AMap.Polyline({map:this.map,path:this.lineArr.slice(l.segment[d].startIndex,l.segment[d].endIndex),strokeColor:l.color,strokeOpacity:.9,strokeWeight:n,strokeStyle:"solid",zIndex:50,showDir:!0});o.push(c)}this.line=o,this.passedLine=new AMap.Polyline({map:this.map,strokeColor:"#000",strokeOpacity:.5,strokeWeight:n,strokeStyle:"solid",zIndex:60}),this.markerStart=new AMap.Marker({map:this.map,position:this.lineArr[0],offset:new AMap.Pixel(-12,-40),icon:new AMap.Icon({size:new AMap.Size(40,40),image:"/clbs/resources/img/start.svg",imageOffset:new AMap.Pixel(0,0)}),zIndex:70}),this.markerEnd=new AMap.Marker({map:this.map,position:this.lineArr[this.lineArr.length-1],offset:new AMap.Pixel(-12,-40),icon:new AMap.Icon({size:new AMap.Size(40,40),image:"/clbs/resources/img/end.svg",imageOffset:new AMap.Pixel(0,0)}),zIndex:70});this.map.setFitView()}},v.prototype.redrawLine=function(){var t=this.dependency.get("data"),e=t.getPositions(),a=t.getTrackColor(),n=t.getPlayIndex(),i=t.getTrackWidth();if(null!==e){if(this.line&&this.line.length>0)for(var r=0;r<this.line.length;r++)this.map.remove(this.line[r]);this.map.remove(this.passedLine);var o=this.getParaColor(e,a,i),s=Object.keys(o),l=[];for(r=0;r<s.length;r++)for(var d=o[s[r]],c=0;c<d.segment.length;c++)l.push(new AMap.Polyline({map:this.map,path:this.lineArr.slice(d.segment[c].startIndex,d.segment[c].endIndex),strokeColor:d.color,strokeOpacity:.9,strokeWeight:i,strokeStyle:"solid",zIndex:50,showDir:!0}));this.line=l,this.passedLine=new AMap.Polyline({map:this.map,strokeColor:"#000",strokeOpacity:.5,strokeWeight:i,strokeStyle:"solid",zIndex:60}),this.passedLine.setPath(this.lineArr.slice(0,n+1)),this.runLine&&this.runLine.setOptions({strokeWeight:i})}},v.prototype.drawMarker=function(){var t=this.dependency.get("data"),e=t.getPositions(),a=t.getObjType(),n=t.getPlayIndex(),i=parseInt(e[n].angle)+270,r=this.lineArr[n];e[n];if(void 0===this.marker||null===this.marker){var o="/clbs/resources/img/vehicle.png";o="people"==a?"/clbs/resources/img/123.png":"thing"==a?"/clbs/resources/img/thing.png":"/clbs/resources/img/vehicle.png";var s=e[0].ico;null!=s&&""!=s&&(o="/clbs/resources/img/vico/"+s),this.markerIcon=o,this.marker=new AMap.Marker({map:this.map,position:r,icon:this.markerIcon,offset:new AMap.Pixel(-20,-15),zIndex:99997,autoRotation:!0,angle:i}),this.listenToClick=AMap.event.addListener(this.marker,"click",(function(){this.toggleInfoWindow()}),this)}else if(this.isOutOfBounds(r)&&this.map.setCenter(r),t.getIsPlaying()){var l=this.marker.getPosition();this.shouldJump(l.lng,l.lat,r[0],r[1])?(this.marker.stopMove(),this.marker.setPosition(r),requestAnimationFrame(function(){this.continue()}.bind(this))):this.marker.moveTo(r,t.getSpeed())}else this.marker.setPosition(r),this.passedLine.setPath(this.lineArr.slice(0,n+1))},v.prototype.isOutOfBounds=function(t){var e=this.bounds;return t[0]<=e[0][0]||t[1]<=e[0][1]||t[0]>=e[1][0]||t[1]>=e[1][1]},v.prototype.shouldJump=function(t,e,a,n){var i=this.dependency.get("data").getSpeed();if(0==a&&0==n||"114.059264"==a&&"22.612487"==n)return!0;var r=2e-5;return 1e4===i?r=4e-5:2e4===i&&(r=8e-5),Math.sqrt(Math.pow(t-a,2)+Math.pow(e-n,2))<=r},v.prototype.prev=function(){var t=this.dependency.get("data");this.marker&&this.marker.stopMove(),t.setIsPlaying(!1);t.getPositions();var e=t.getPlayIndex();e>0?t.setPlayIndex(e-1):layer.msg("已经是第一个点了")},v.prototype.play=function(){var t=this.dependency.get("data");!this.listenToMoveend&&this.marker&&(this.listenToMoveend=AMap.event.addListener(this.marker,"moveend",(function(){t.getIsPlaying()&&this.continue()}),this),this.listenToMoving=AMap.event.addListener(this.marker,"moving",(function(){var e=t.getPlayIndex();this.passedLine.setPath(this.lineArr.slice(0,e+1))}),this)),t.setIsPlaying(!0),this.continue()},v.prototype.continue=function(){var t=this.dependency.get("data"),e=t.getPositions(),a=t.getPlayIndex();a+1<e.length?t.setPlayIndex(a+1):(t.setIsPlaying(!1),this.dependency.get("table").autoGetStatusPosition())},v.prototype.pause=function(t){var e=this.dependency.get("data");this.marker&&this.marker.stopMove(),e.setIsPlaying(!1,t),this.dependency.get("table").autoGetStatusPosition()},v.prototype.reset=function(){var t=this.dependency.get("data");this.marker&&this.marker.stopMove(),t.setIsPlaying(!1),t.setPlayIndex(0)},v.prototype.next=function(){var t=this.dependency.get("data");this.marker&&this.marker.stopMove(),t.setIsPlaying(!1);var e=t.getPositions(),a=t.getPlayIndex();a+1<e.length?t.setPlayIndex(a+1):layer.msg("已经是最后一个点了")},v.prototype.filterStopData=function(t){var e=[];if(null===t)return null;for(var a=0;a<t.length;a++){var n=void 0;(t[a-1]&&"1"===t[a-1].drivingState&&"2"===t[a].drivingState||0===a&&"2"===t[a].drivingState)&&(n=t[a]),void 0!==n&&e.push({item:n,index:a})}return e},v.prototype.toggleStopPoint=function(){var t=this.dependency.get("data"),e=t.getPositions(),a=t.getShowStopPoint();if(null!==e)if(a){layer.msg("显示停止点");for(var n=this.filterStopData(e),i=[],r=r="/clbs/resources/img/stop.svg",o=0;o<n.length;o++){var s=n[o],l=new AMap.Marker({map:this.map,position:new AMap.LngLat(s.item.longitude,s.item.latitude),icon:r,offset:new AMap.Pixel(-16,-13),zIndex:99999,extData:{stopIndex:o,originIndex:s.index}});l.on("click",this.onStopMarkerClick.bind(this)),i.push(l)}this.stopMarkers=i,this.map.setFitView(this.stopMarkers)}else{if(layer.msg("移除停止点"),null!==this.stopMarkers)for(o=0;o<this.stopMarkers.length;o++)this.map.remove(this.stopMarkers[o]);if(null!==this.middleStopMarkers)for(o=0;o<this.middleStopMarkers.length;o++)this.map.remove(this.middleStopMarkers[o])}},v.prototype.toggleAlarmPoint=function(){var t=this.dependency.get("data"),e=t.getShowAlarmPoint(),a=t.getVid(),n=t.getStartTime(),i=t.getEndTime();if(e)layer.msg("显示报警点"),json_ajax("POST","/clbs/lkyw/trackBack/getAlarmData","json",!0,{vehicleId:a,startTime:parseInt(new Date(n.replace(/\-/g,"/")).getTime()/1e3),endTime:parseInt(new Date(i.replace(/\-/g,"/")).getTime()/1e3)},function(e){if(e.success){t.setAlarmData(e.obj);for(var a=e.obj||[],n=[],i=i="/clbs/resources/img/al.svg",r=0;r<a.length;r++){var o=a[r].alarmStartLocation.split(","),s=new AMap.Marker({map:this.map,position:new AMap.LngLat(o[0],o[1]),icon:i,offset:new AMap.Pixel(-16,-13),zIndex:99999,extData:r});s.on("click",this.onAlarmMarkerClick.bind(this)),n.push(s)}this.alarmMarkers=n,this.map.setFitView(this.alarmMarkers)}else layer.msg(e.msg)}.bind(this));else if(layer.msg("移除报警点"),null!==this.alarmMarkers)for(var r=0;r<this.alarmMarkers.length;r++)this.map.remove(this.alarmMarkers[r])},v.prototype.danceStopMarker=function(t){for(var e,a=this.dependency.get("data").getPositions(),n=this.filterStopData(a),i=0;i<n.length;i++){if(n[i].index===t){if(!this.stopMarkers)return;if(!(e=this.stopMarkers[i]))return}}void 0===e&&(e=new AMap.Marker({map:this.map,position:new AMap.LngLat(a[t].longtitude,a[t].latitude),icon:"/clbs/resources/img/stop.svg",offset:new AMap.Pixel(-16,-13),zIndex:99999}),null===this.middleStopMarkers?this.middleStopMarkers=[e]:this.middleStopMarkers.push(e)),e&&(e.setAnimation("AMAP_ANIMATION_BOUNCE"),setTimeout((function(){e.setAnimation("AMAP_ANIMATION_NONE")}),5300))},v.prototype.danceAlarmMarker=function(t){if(this.alarmMarkers){var e=this.alarmMarkers[t];e&&(e.setAnimation("AMAP_ANIMATION_BOUNCE"),setTimeout((function(){e.setAnimation("AMAP_ANIMATION_NONE")}),5300))}},v.prototype.highlightRunSegment=function(t,e,a){var n=this.dependency.get("data"),i=n.getAllOrRunData(),r=n.getPositions(),o=n.getPositionsTmp(),s=n.getTrackWidth(),l="run"===i?o:r;l=l.slice(t,e+1);var d=this.formateLngLatFromPosition(l),c=[d[d.length-1][0],d[d.length-1][1]];this.removeHighlightRunSegment(),this.runLine=new AMap.Polyline({map:this.map,path:d,isOutline:!1,strokeColor:"#0072d4",strokeOpacity:1,strokeWeight:s,strokeStyle:"solid",outlineColor:"#0000ff",borderWeight:2,zIndex:60}),this.runMileMarker=new AMap.Text({map:this.map,position:c,offset:new AMap.Pixel(-20,-25),text:"行驶里程："+w.toFixed(a,1,!0)+"km",anchor:"top-right",zIndex:99998})},v.prototype.removeHighlightRunSegment=function(){this.runLine&&(this.map.remove(this.runLine),this.runLine=null),this.runMileMarker&&(this.map.remove(this.runMileMarker),this.runMileMarker=null)},v.prototype.focusRunSegment=function(){this.map.setFitView(this.runLine)},v.prototype.onAlarmMarkerClick=function(t){var e=t.target.getExtData(),a=this.dependency.get("data"),n=a.getAlarmData(),i=a.getPositions();if(this.alarmMarkers&&0!==this.alarmMarkers.length&&void 0!==e&&null!==n&&n[e]&&this.alarmMarkers[e]){var r=n[e],o="",s="",l="";i&&i[0]&&(o=i[0].plateColor,s=i[0].simCard,l=i[0].deviceNumber);var d=[];d.push("监控对象:"+r.monitorName),d.push("车牌颜色:"+o),d.push("所属分组:"+r.assignmentName),d.push("高程:"+(null===r.height?"":r.height)),d.push("终端手机号:"+s),d.push("终端号:"+l),d.push("记录仪速度:"+(null===r.recorderSpeed?"":r.recorderSpeed)),d.push("报警信息:"+r.description),d.push("处理状态:"+r.alarmStatus),d.push("处理人:"+(null===r.personName?"无":r.personName)),d.push("报警开始时间:"+(null===r.startTime?"":r.startTime)),d.push("报警开始坐标:"+(void 0===r.alarmStartLocation?"位置描述获取失败":r.alarmStartLocation)),d.push("报警结束时间:"+(null===r.endTime?"":r.endTime)),d.push("报警结束坐标:"+(void 0===r.alarmEndLocation?"位置描述获取失败":r.alarmEndLocation));var c=d.join("<br/>");this.alarmInfoWindow?(this.alarmInfoWindow.setContent(c),this.alarmInfoWindow.open(this.map,this.alarmMarkers[e].getPosition())):(this.alarmInfoWindow=new AMap.InfoWindow({content:c,offset:new AMap.Pixel(-20,-13),closeWhenClickMap:!0}),this.alarmInfoWindow.open(this.map,this.alarmMarkers[e].getPosition()))}},v.prototype.onStopMarkerClick=function(t){var e=this.dependency.get("data"),a=this.dependency.get("table"),n=e.getStopTypeDict(),i=e.getPositions(),r=t.target.getExtData(),o=r.stopIndex,s=r.originIndex;if(s=e.getParaScale()(s,"toChart"),this.stopMarkers&&0!==this.stopMarkers.length&&void 0!==o&&this.stopMarkers[o]&&n){var l,d=n[2].segment;if(d)for(var c=0;c<d.length;c++)if(d[c].startIndex<=s&&s<=d[c].endIndex){l=d[c];break}if(l){var h=[];h.push("停止点:"+(o+1)),h.push("停止时长:"+T.timeRender(l.timeLength)),h.push("开始时间:"+T.fullTimeRender(1e3*l.startTime)),h.push("结束时间:"+T.fullTimeRender(1e3*l.endTime)),h.push('停止位置:<span class="stopMarkerInfoWindowLocation">...</span>');var p=h.join("<br/>");this.stopInfoWindow?(this.stopInfoWindow.setContent(p),this.stopInfoWindow.open(this.map,this.stopMarkers[o].getPosition())):(this.stopInfoWindow=new AMap.InfoWindow({content:p,offset:new AMap.Pixel(-20,-13),closeWhenClickMap:!0}),this.stopInfoWindow.open(this.map,this.stopMarkers[o].getPosition())),a.getAddress(null,i[s].latitude,i[s].longtitude,(function(t){$(".stopMarkerInfoWindowLocation").html($.isPlainObject(t)?"未定位":t)}))}}},v.prototype.closeInfoWindow=function(){this.infoWindow&&this.infoWindow.getIsOpen()&&this.infoWindow.close()},v.prototype.toggleInfoWindow=function(){var t=this.dependency.get("data"),e=t.getIsPlaying(),a=t.getIsDraging(),n=t.getPositions(),i=t.getSensorFlag(),r=t.getPlayIndex(),o=t.getGroup();if(n&&null!=r){var s=n[r];if(s)if(e||a)this.infoWindow&&this.infoWindow.close();else{if(!this.marker)return;var l="-";null==(l=i?s.mileageSpeed:s.speed)&&(l="");var d=[];d.push("定位时间："+T.fullTimeRender(1e3*s.vtime)),d.push("监控对象："+s.plateNumber),d.push("车牌颜色："+s.plateColor),d.push("终端号："+s.deviceNumber),d.push("终端手机号："+s.simCard),d.push("所属分组："+o),d.push("经度："+s.longitude),d.push("纬度："+s.latitude),d.push("高程："+s.height),d.push("速度(km/h)："+l),d.push('<a type="button" id="addFence" onclick="trackPlayback.map.showAddFencePage()" style="cursor:pointer;display:inline-block;margin: 8px 0px 0px 0px;">轨迹生成路线</a>');var c=d.join("<br/>");this.infoWindow?(this.infoWindow.setContent(c),this.infoWindow.open(this.map,this.marker.getPosition())):(this.infoWindow=new AMap.InfoWindow({content:c,offset:new AMap.Pixel(-20,-13),closeWhenClickMap:!0}),this.infoWindow.open(this.map,this.marker.getPosition()))}}},v.prototype.formateLngLatFromPosition=function(t){for(var e=[],a=0;a<t.length;a++){var n=t[a],i=[n.longitude?n.longitude:"0.0",n.latitude?n.latitude:"0.0"];if(!i[0]||!i[1]||"0.0"==i[0]&&"0.0"==i[1]||"114.059264"==i[0]&&"22.612487"==i[1])for(var r=a-1;r>=0;r--)if("114.059264"!==t[r].longitude&&"22.612487"!==t[r].latitude&&"0.0"!=t[r].longitude&&"0.0"!=t[r].latitude){i[0]=t[r].longitude,i[1]=t[r].latitude;break}e.push(i)}return e},v.prototype.showAddFencePage=function(){setTimeout((function(){$("#addFencePage").modal("show")}),200)},v.prototype.addLineFence=function(){var t=$("#trackLineName1").val();json_ajax("POST","/clbs/m/functionconfig/fence/managefence/addLine","json",!1,{name:t},this.lineCallback.bind(this))},v.prototype.lineCallback=function(t){1==t.success?this.trackLineAdded():null==t.msg?layer.msg(trackFenceExists):t.msg.toString().indexOf("系统错误")>-1&&layer.msg(t.msg,{move:!1})},v.prototype.getHistory1=function(){for(var t,e,a,n=this.dependency.get("data").getPositions(),i="",r="",o="",s=0,l=0;l<n.length;l++)e=(t=n[l]).latitude,a=t.longitude,i+=s+++",",r+=Math.formatFloat(a,6)+",",o+=Math.formatFloat(e,6)+",";i.length>0&&(i=i.substr(0,i.length-1)),r.length>0&&(r=r.substr(0,r.length-1)),o.length>0&&(o=o.substr(0,o.length-1)),$("#historyPointSeqs").val(i),$("#historyLongitudes").val(r),$("#historyLatitudes").val(o)},v.prototype.trackLineAdded=function(){if(this.validate_line()){layer.load(2),$("#addFenceBtn").attr("disabled",!0),$("#hideDialog").attr("disabled",!0),this.getHistory1();var t=$("#historyPointSeqs").val(),e=$("#historyLongitudes").val(),a=$("#historyLatitudes").val();if(""==t||""==e||""==a)return void layer.msg(trackHistoryDataNull);$("#addLineFormSubmit").ajaxSubmit((function(t){(t=JSON.parse(t)).success?($(".cancle").click(),$("#addFenceBtn").attr("disabled",!1),$("#hideDialog").attr("disabled",!1),$("#hideDialog").click(),layer.closeAll(),layer.msg("保存成功")):null==t.msg?layer.msg("保存失败"):t.msg.toString().indexOf("系统错误")>-1&&layer.msg(t.msg,{move:!1})}))}},v.prototype.validate_line=function(){return $("#addLineFormSubmit").validate({rules:{name:{required:!0,maxlength:20},width:{required:!0,maxlength:10},description:{maxlength:100}},messages:{name:{required:"不能为空",maxlength:"长度不超过20位"},width:{required:"不能为空",maxlength:"长度不超过10位"},description:{maxlength:"长度不超过100位"}}}).form()};var b=function(t,e){this.dependency=e,this.map=e.get("map").map,this.areaListStr="",this.groupName="",this.init()};b.prototype.init=function(){this.dependency.get("data");this.initLayDate(),$("#trackPlayQuery").on("click",this.trackDataQuery.bind(this)),$(".areaTool").on("click",this.showAreaTool.bind(this)),$("#areaGroupSelect,#areaGroupSelectSpan").on("click",showMenuContent),$("#specialTimePlayBack").on("click",this.fixedTimeAreaShow.bind(this)),$("#trackAddWayToPoint").on("click",this.addTimeBox.bind(this)),$("#addMapArea").on("click",this.addArea.bind(this)),$(".areaInput").on("click",this.dependency.get("map").toolClickList.bind(this.dependency.get("map"))),$("#areaTimeSearch").on("click",this.searchTimeArea.bind(this)),$("#searchCarExport").on("click",this.fixAreaExport.bind(this)),$("#fixAreaClose").on("click",this.fixAreaClose.bind(this))},b.prototype.initLayDate=function(){var t=this.getToDay(),e=t.split("--");$("#areaSearchTimeInterval").val(t),laydate.render({elem:"#searchTimeIntervalStart",type:"datetime",value:e[0],btns:["now","confirm"],done:function(t,e,a){var n=t+"--"+$("#searchTimeIntervalEnd").val();$("#areaSearchTimeInterval").val(n)}}),laydate.render({elem:"#searchTimeIntervalEnd",type:"datetime",value:e[1],btns:["now","confirm"],done:function(t,e,a){var n=$("#searchTimeIntervalStart").val()+"--"+t;$("#areaSearchTimeInterval").val(n)}})},b.prototype.showAreaTool=function(){$("#realTimeCanArea").hasClass("realTimeCanAreaShow")?$("#realTimeCanArea").removeClass("realTimeCanAreaShow"):$("#realTimeCanArea").addClass("realTimeCanAreaShow")},b.prototype.fixedTimeAreaShow=function(){$(".areaInput:eq(0)").click();var t=this.dependency.get("data").getVid();if(t){var e=$.fn.zTree.getZTreeObj("areaTreeDemo"),a=e.getNodesByParam("id",t,null);a[0]&&(e.checkNode(a[0],!0,!0),this.dependency.get("areaMonitorTree").setMenuCrrentSubV(t),this.dependency.get("areaMonitorTree").getCharSelect(e),this.dependency.get("areaMonitorTree").getCheckedNodes())}$("#fixedTimeArea").show(),$("#realTimeCanArea").removeClass("realTimeCanAreaShow")},b.prototype.trackDataQuery=function(){if(this.dependency.get("data").getVid()){var t=this.dependency.get("data").getSensorType(),e=$("#timeInterval").val().split("--"),a=e[0],n=new Date(a).getTime(),i=e[1],r=new Date(i).getTime();if(r<n)return layer.msg(trackDateError,{move:!1}),!1;if(r-n>604799e3&&"5"!=t)return layer.msg(trackVehicleDateError,{move:!1}),!1;if(r-n>259199e3&&"5"==t)return layer.msg(trackPeopleDateError,{move:!1}),!1;this.dependency.get("data").setStartEndTime(e[0],e[1]),$("#realTimeCanArea").removeClass("realTimeCanAreaShow")}else layer.msg("请选择监控对象")},b.prototype.addTimeBox=function(t){var e=$(t.target);if(0==$("#removeWayToPoint").length){e.closest(".form-group").after('<div class="form-group addItem"><div class="col-md-10" style="padding-right:0;">      <input style="cursor: pointer; background-color: #fafafa;float:left;width:45.5%;"             class="form-control layer-date laydate-icon"             id="searchTimeIntervalStart1" readonly>      <span style="float: left;width:5%;text-align: center;margin-top:8px;">~</span>           <input style="cursor: pointer; background-color: #fafafa;float:left;width:45.5%;"              class="form-control layer-date laydate-icon"              id="searchTimeIntervalEnd1" readonly><input type="hidden" id="searchTimeInterval1" name="timeInterval"></div>      <button id="removeWayToPoint" type="button"       class="btn btn-danger padBottom">        <span class="glyphicon glyphicon-trash"         aria-hidden="true"></span>      </button>    </div>');var a=this.getYesterDay(),n=a.split("--"),i=$("#searchTimeInterval1");i.val(a),laydate.render({elem:"#searchTimeIntervalStart1",type:"datetime",isInitValue:!0,value:n[0],btns:["now","confirm"],done:function(t,e,a){var n=t+"--"+$("#searchTimeIntervalEnd1").val();i.val(n)}}),laydate.render({elem:"#searchTimeIntervalEnd1",type:"datetime",isInitValue:!0,value:n[1],btns:["now","confirm"],done:function(t,e,a){var n=$("#searchTimeIntervalStart1").val()+"--"+t;i.val(n)}}),$("#removeWayToPoint").on("click",this.removeBox.bind(this))}},b.prototype.removeBox=function(t){$(t.target).closest(".form-group").remove()},b.prototype.getYesterDay=function(){var t=new Date,e=new Date(t.getTime()-864e5),a=e.getFullYear(),n=e.getMonth()+1,i=e.getDate();n>=1&&n<=9&&(n="0"+n),i>=0&&i<=9&&(i="0"+i);var r=a+"-"+n+"-"+i;return r+" 00:00:00--"+r+" 23:59:59"},b.prototype.getToDay=function(){var t=new Date,e=t.getFullYear(),a=t.getMonth()+1,n=t.getDate();a>=1&&a<=9&&(a="0"+a),n>=0&&n<=9&&(n="0"+n);var i=e+"-"+a+"-"+n;return i+" 00:00:00--"+i+" 23:59:59"},b.prototype.addArea=function(t){var e=$(t.target);0==$("#removeMapArea").length&&(e.closest(".form-group").after('<div class="form-group addItem">       <div class="col-md-10">        <input type="text" name="areaTwo" class="form-control areaInput" placeholder="点击后在地图上选择区域" readonly>       </div>       <button id="removeMapArea" type="button"        class="btn btn-danger padBottom">         <span class="glyphicon glyphicon-trash"          aria-hidden="true"></span>       </button>      </div>'),$("#removeMapArea").on("click",this.dependency.get("map").delArea.bind(this.dependency.get("map"))),$(".areaInput").on("click",this.dependency.get("map").toolClickList.bind(this.dependency.get("map"))),$(".areaInput:eq(1)").click())},b.prototype.validatesArea=function(){return $("#timeAreaForm").validate({ignore:"",onfocusout:!1,rules:{groupSelect:{zTreeChecked:"areaTreeDemo"},area:{required:!0},areaTwo:{required:!0},timeInterval:{isRange24:!0,isDateTimeCompare:!0}},messages:{groupSelect:{zTreeChecked:"请至少选择一个监控对象"},area:{required:"请在地图上选择区域"},areaTwo:{required:"请在地图上选择区域"}}}).form()},b.prototype.getAreaTime=function(t){if(0==$(t).length)return null;var e=$(t).val().split("--"),a=e[0],n=e[1];return[a=(a=new Date(Date.parse(a.replace(/-/g,"/")))).getTime()/1e3,n=(n=new Date(Date.parse(n.replace(/-/g,"/")))).getTime()/1e3]},b.prototype.getAreaLonglat=function(t,e){return t?{areaId:e,leftTopLongitude:t.getSouthWest().getLng(),leftTopLatitude:t.getSouthWest().getLat(),rightFloorLongitude:t.getNorthEast().getLng(),rightFloorLatitude:t.getNorthEast().getLat()}:null},b.prototype.searchTimeArea=function(){var t=this.dependency.get("map");if(this.dependency.get("areaMonitorTree").getCheckedNodes(),this.validatesArea()){var e=$("#searchTimeInterval1");if(e&&e.val()==$("#areaSearchTimeInterval").val())return void layer.msg("请勿选择两个相同时间");layer.load(2);var a=this.getAreaTime("#areaSearchTimeInterval"),n=this.getAreaTime("#searchTimeInterval1"),i=this.dependency.get("data").getRangeAreaPos(),r=i[0],o=i[1],s=[],l=this.getAreaLonglat(r,"areaOne");if(s.push(l),o){l=this.getAreaLonglat(o,"areaTwo");s.push(l)}var d={monitorIds:this.dependency.get("data").getAreaTreeCheckVid(),areaListStr:JSON.stringify(s),startTimeOne:a[0],endTimeOne:a[1],startTimeTwo:n?n[0]:void 0,endTimeTwo:n?n[1]:void 0};this.areaListStr=s,this.groupName=$("#areaGroupSelect").val();json_ajax("POST","/clbs/lkyw/trackBack/findHistoryByTimeAndAddress","json",!1,d,this.dependency.get("map").areaTableInit.bind(t))}},b.prototype.turnTimeFormat=function(t){var e=new Date(1e3*t);return e.getFullYear()+"-"+((e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-")+((e.getDate()<10?"0"+e.getDate():e.getDate())+" ")+((e.getHours()<10?"0"+e.getHours():e.getHours())+":")+((e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":")+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds())},b.prototype.fenceTurnoverTime=function(t,e){var a=$(t).attr("data-id"),n=$(t).attr("data-index"),i=e.dependency.get("data").getRangeAreaPos()[n],r=$(t).attr("data-time").split("--"),o=r[0],s=r[1];r=[o=(o=new Date(Date.parse(o.replace(/-/g,"/")))).getTime()/1e3,s=(s=new Date(Date.parse(s.replace(/-/g,"/")))).getTime()/1e3];var l=i.getSouthWest().getLng(),d=i.getSouthWest().getLat(),c=i.getNorthEast().getLng(),h=i.getNorthEast().getLat(),p=$(t).next("tr").children("td").children("table").children("tbody").attr("id");if(""==$("#"+p).html()){var u={leftTopLongitude:l,leftTopLatitude:d,rightFloorLongitude:c,rightFloorLatitude:h,vehicleId:a,startTime:r[0],endTime:r[1]};ajax_submit("POST","/clbs/lkyw/trackBack/getQueryDetails","json",!0,u,!0,(function(t){if(t.success){for(var a="",n=t.obj,i=0;i<n.length;i++){if(""!=n[i][0])a+="<tr><td>"+(i+1)+"</td><td>"+("已在区域内"==n[i][0]?"已在区域内":e.dependency.get("fixedTimeArea").turnTimeFormat(n[i][0]))+"</td>";else a+="<tr><td>"+(i+1)+"</td><td>未进区域</td>";if(""!=n[i][1])a+="<td>"+e.dependency.get("fixedTimeArea").turnTimeFormat(n[i][1])+"</td></tr>";else a+="<td>未出区域</td></tr>"}$("#"+p).html(a),$("#"+p).parents("td.areaSearchTable").slideDown(200)}}))}else{var g=$("#"+p).parents("td.areaSearchTable");g.is(":hidden")?g.slideDown(200):g.slideUp(200)}},b.prototype.fixAreaExport=function(){var t=$("#areaSearchCar .areaTrOne:visible").length,e=$("#areaSearchCar .areaTrTwo:visible").length;if(0!==t||0!==e){for(var a=[],n=0;n<this.areaListStr.length;n++){var i=this.areaListStr[n],r=i.areaId;"areaOne"==r&&t>0&&a.push(i),"areaTwo"==r&&e>0&&a.push(i)}var o={groupName:this.groupName,areaListStr:JSON.stringify(a).replace(/\"/g,"'")};exportExcelUseForm("/clbs/lkyw/trackBack/timeZoneExport",o)}else layer.msg("无数据导出")},b.prototype.fixAreaClose=function(){$("#fixedTimeArea").hide(),$(".areaInput").val(""),$(".addItem").remove(),$(".delArea").remove(),$("#fixedTimeArea label.error").remove(),$("#areaGroupSelect").val(""),$("#queryType").val("vehicle"),this.dependency.get("areaMonitorTree").treeInit();var t=this.dependency.get("map");t.areaDestory.bind(t)(),this.initLayDate()};var k=function(t,e){this.dependency=e,$("#vFenceSearchTrackPlayback").bind("input oninput",k.prototype.vsearchFenceCarSearch.bind(this)),$("#fenceToolBtnTrackPlayback").on("click",k.prototype.fenceToolClickSHFn.bind(this))};k.prototype.getCurrentVehicleAllFence=function(t){var e,a={async:{url:"/clbs/m/functionconfig/fence/bindfence/fenceTreeByVid",type:"post",enable:!0,autoParam:["id"],dataType:"json",otherParam:{vid:t},dataFilter:k.prototype.FenceAjaxDataFilter.bind(this)},view:{dblClickExpand:!1,nameIsHTML:!0,fontCss:setFontCss_ztree},check:{enable:!0,chkStyle:"checkbox",chkboxType:{Y:"s",N:"s"},radioType:"all"},data:{simpleData:{enable:!0},key:{title:"name"}},callback:{onClick:k.prototype.vFenceTreeClick.bind(this),onCheck:k.prototype.vFenceTreeCheck.bind(this)}};($.fn.zTree.init($("#vFenceTreeTrackPlayback"),a,null),"Microsoft Internet Explorer"==navigator.appName&&"MSIE9.0"==navigator.appVersion.split(";")[1].replace(/[ ]/g,""))&&$("#vFenceSearchTrackPlayback").bind("focus",(function(){e=setInterval((function(){search_ztree("vFenceTreeTrackPlayback","vFenceSearchTrackPlayback","fence")}),500)})).bind("blur",(function(){clearInterval(e)}))},k.prototype.vFenceTreeClick=function(t,e,a){return $.fn.zTree.getZTreeObj("vFenceTreeTrackPlayback").checkNode(a,!a.checked,null,!0),!1},k.prototype.vFenceTreeCheck=function(t,e,a){var n=$.fn.zTree.getZTreeObj("vFenceTreeTrackPlayback");this.dependency.get("map").showZtreeCheckedToMap(a,n)},k.prototype.vsearchFenceCarSearch=function(){search_ztree("vFenceTreeTrackPlayback","vFenceSearchTrackPlayback","fence")},k.prototype.FenceAjaxDataFilter=function(t,e,a){if(a)for(var n=0;n<a.length;n++){var i=a[n];i.open=!1,i.name=html2Escape(i.name),1==i.markIcon&&(i.iconSkin="zw_m_marker_circle_skin")}return a},k.prototype.vehicleTreeClickGetFenceInfo=function(t,e){1==t?(""==$("#vFenceSearchTrackPlayback").val()&&null==$("#vFenceSearchTrackPlayback").val()||$("#vFenceSearchTrackPlayback").val(""),this.dependency.get("map").delFenceListAndMapClear(),this.getCurrentVehicleAllFence(e),$("#vFenceTreeTrackPlayback").removeClass("hidden"),$("#vSearchContentTrackPlayback").removeClass("hidden"),$("#vFenceMsgTrackPlayback").addClass("hidden")):($("#vFenceTreeTrackPlayback").html("").addClass("hidden"),$("#vSearchContentTrackPlayback").addClass("hidden"))},k.prototype.fenceToolClickSHFn=function(){$("#fenceTool>.dropdown-menu").is(":hidden")?$("#fenceTool>.dropdown-menu").show():$("#fenceTool>.dropdown-menu").hide()},k.prototype.getFenceDetailInfo=function(t,e){layer.load(2);var a=this.dependency.get("map");$.ajax({type:"POST",url:"/clbs/m/functionconfig/fence/bindfence/getFenceDetails",data:{fenceNodes:JSON.stringify(t)},dataType:"json",success:function(t){if(layer.closeAll("loading"),t.success){var n=t.obj;if(null!=n&&n.length>0)for(var i=0;i<n.length;i++){var r,o,s=n[i].fenceType;"zw_m_travel_line"==s?(r=n[i].allPoints,o=n[i].passPointData):r=n[i].fenceData;var l=null==n[i].lineSpot?[]:n[i].lineSpot,d=null==n[i].lineSegment?[]:n[i].lineSegment;if("zw_m_marker"==s)a.drawMarkToMap(r,e);else if("zw_m_line"==s)a.drawLineToMap(r,l,d,e);else if("zw_m_rectangle"==s)a.drawRectangleToMap(r,e);else if("zw_m_polygon"==s)a.drawPolygonToMap(r,e);else if("zw_m_circle"==s)a.drawCircleToMap(r,e);else if("zw_m_administration"==s){var c=n[0].aId;a.drawAdministrationToMap(r,c,e)}else"zw_m_travel_line"==s&&a.drawTravelLineToMap(r,e,n[i].travelLine,o)}}}})};var T={numberSortFunction:function(t,e){var a=parseFloat(t),n=parseFloat(e);return isNaN(a)&&(a=0),isNaN(n)&&(n=0),a-n},fullTimeRender:function(t){"number"==typeof t&&(t=new Date(t));var e=t.getFullYear(),a=t.getMonth()+1,n=t.getDate(),i=t.getHours(),r=t.getMinutes(),o=t.getSeconds(),s=a>=10?a.toString(10):"0"+a.toString(10),l=n>=10?n.toString(10):"0"+n.toString(10),d=i>=10?i.toString(10):"0"+i.toString(10),c=r>=10?r.toString(10):"0"+r.toString(10),h=o>=10?o.toString(10):"0"+o.toString(10);return[e.toString(),s,l].join("-")+" "+[d,c,h].join(":")},monthTimeRender:function(t){"number"==typeof t&&(t=new Date(t));t.getFullYear();var e=t.getMonth()+1,a=t.getDate(),n=t.getHours(),i=t.getMinutes(),r=t.getSeconds(),o=e>=10?e.toString(10):"0"+e.toString(10),s=a>=10?a.toString(10):"0"+a.toString(10),l=n>=10?n.toString(10):"0"+n.toString(10),d=i>=10?i.toString(10):"0"+i.toString(10),c=r>=10?r.toString(10):"0"+r.toString(10);return[o,s].join("-")+" "+[l,d,c].join(":")},timeRender:function(t){if(null==t||isNaN(t))return"--";var e=Math.floor(t/86400);t-=86400*e;var a=Math.floor(t/3600);t-=3600*a;var n=Math.floor(t/60);t-=60*n;var i="",r=!1,o=!1;return e>0&&(i+=e.toString()+"天",r=!0),(!0===r||a>0)&&(i+=a.toString()+"时",o=!0),(!0===o||n>0)&&(i+=n.toString()+"分"),i+=t.toString()+"秒"},statusRender:function(t){return"2"===t?'<span class="color-red">停止</span>':"1"===t?'<span class="color-blue">行驶</span>':""},accRender:function(t){return"1"===t?'<span class="color-blue">开</span>':"0"===t?'<span class="color-red">关</span>':""},angleRender:function(t){return t>=0&&t<=22.5||t>337.5&&t<=360?"北":t>22.5&&t<=67.5?"东北":t>67.5&&t<=112.5?"东":t>112.5&&t<=157.5?"东南":t>157.5&&t<=202.5?"南":t>202.5&&t<=247.5?"西南":t>247.5&&t<=292.5?"西":t>292.5&&t<=337.5?"西北":""},locationTypeRender:function(t){return 0==t?"卫星+基站定位":1==t?"基站定位":2==t?"卫星定位":3==t?"WIFI+基站定位":4==t?"卫星+WIFI+基站定位":"-"},locationStatusRender:function(t){return 0==t?"未定位":1==t?"定位":"-"},statusTableSpeedRender:function(t,e,a,n){return n.sensorFlag?n.mileageSpeed?n.mileageSpeed:"-":t},fillStatusRender:function(t){return 1==t?"补传":"非补传"},statusTableRecorderSpeedRender:function(t,e,a,n){return n.recorderSpeed?n.recorderSpeed:"-"},statusTableMileageRender:function(t,e,a,n){return n.sensorFlag?n.mileageTotal?n.mileageTotal:"-":t},statusTableHandlePositionRender:function(t,e,a,n){return null===t?'<a href="#" onclick="trackPlayback.table.handleStatusPositionClick(\''+n.id+"')\">点击获取位置信息</a>":t},alarmFenceTypeRender:function(t){return t="zw_m_rectangle"==t?"矩形":"zw_m_circle"==t?"圆形":"zw_m_line"==t?"线":"zw_m_polygon"==t?"多边形":""},alarmTableStartLocationRender:function(t,e,a,n){return null==t||""===t?'<a href="#" onclick="trackPlayback.table.handleStartLocationClick(\''+n.id+"')\">点击获取位置信息</a>":t},alarmTableEndLocationRender:function(t,e,a,n){return null==t||""===t?'<a href="#" onclick="trackPlayback.table.handleEndLocationClick(\''+n.id+"')\">点击获取位置信息</a>":t},stopTableHandleStartPositionRender:function(t,e,a,n){return null===t?'<a href="#" onclick="trackPlayback.table.handleStopTableStartLocationClick(\''+n.id+"')\">点击获取位置信息</a>":t},stopTableHandleEndPositionRender:function(t,e,a,n){return null===t?'<a href="#" onclick="trackPlayback.table.handleStopTableEndLocationClick(\''+n.id+"')\">点击获取位置信息</a>":t},runTableHandleStartPositionRender:function(t,e,a,n){return null===t?'<a href="#" onclick="trackPlayback.table.handleRunTableStartLocationClick(\''+n.id+"')\">点击获取位置信息</a>":t},runTableHandleEndPositionRender:function(t,e,a,n){return null===t?'<a href="#" onclick="trackPlayback.table.handleRunTableEndLocationClick(\''+n.id+"')\">点击获取位置信息</a>":t}};T.defaultStatusColumns=[{title:"序号",name:"sequenceNumber",width:60,isSequence:!0},{title:"监控对象",name:"monitorName",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"定位时间",name:"vtime",width:160,maxWidth:200,minWidth:100,resizable:!0,render:T.fullTimeRender},{title:"间隔时间",name:"intervalTime",width:100,maxWidth:200,minWidth:80,resizable:!0,render:T.timeRender},{title:"所属分组",name:"assignmentName",width:200,maxWidth:600,minWidth:100,resizable:!0},{title:"终端号",name:"deviceNumber",width:100,maxWidth:200,minWidth:100,resizable:!0},{title:"终端手机号",name:"simCard",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"状态 <i class='fa fa-question-circle'></i>",name:"status",width:80,maxWidth:200,minWidth:60,resizable:!0,render:T.statusRender},{title:"ACC状态",name:"acc",width:100,maxWidth:200,minWidth:100,resizable:!0,render:T.accRender},{title:"速度 (km/h)",name:"speed",width:120,maxWidth:200,minWidth:100,resizable:!0,render:T.statusTableSpeedRender},{title:"行车记录仪速度",name:"recorderSpeed",width:120,maxWidth:200,minWidth:100,resizable:!0,render:T.statusTableRecorderSpeedRender},{title:"方向",name:"angle",width:80,maxWidth:100,minWidth:60,resizable:!0,render:T.angleRender},{title:"总里程 (km)",name:"gpsMile",width:120,maxWidth:200,minWidth:60,resizable:!0,render:T.statusTableMileageRender},{title:"定位方式",name:"locationType",width:100,maxWidth:300,minWidth:80,resizable:!0,render:T.locationTypeRender},{title:"卫星颗数",name:"satelliteNumber",width:100,maxWidth:200,minWidth:100,resizable:!0},{title:"定位状态",name:"locationStatus",width:100,maxWidth:300,minWidth:80,resizable:!0,render:T.locationStatusRender},{title:"是否补传",name:"reissue",width:100,maxWidth:300,minWidth:80,resizable:!0,render:T.fillStatusRender},{title:"经度",name:"longtitude",width:120,maxWidth:200,minWidth:60,resizable:!0},{title:"纬度",name:"latitude",width:120,maxWidth:200,minWidth:60,resizable:!0},{title:"位置",name:"location",width:200,maxWidth:800,minWidth:100,resizable:!0,render:T.statusTableHandlePositionRender},{title:"",name:"empty",width:40}],T.defaultRunColumns=[{title:"序号",name:"sequenceNumber",width:60,isSequence:!0},{title:"监控对象",name:"monitorName",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"所属分组",name:"assignmentName",width:200,maxWidth:600,minWidth:100,resizable:!0},{title:"行驶时长",name:"runTime",width:100,maxWidth:200,minWidth:80,resizable:!0,render:T.timeRender},{title:"行驶里程(km)",name:"runMile",width:120,maxWidth:200,minWidth:60,resizable:!0},{title:"用油量（L）",name:"useOil",width:120,maxWidth:200,minWidth:60,resizable:!0,render:function(t){return w.isEmpty(t)?"":w.toFixed(t,1,!0)}},{title:"耗油量（L）",name:"consumeOil",width:120,maxWidth:200,minWidth:60,resizable:!0,render:function(t){return w.isEmpty(t)?"":w.toFixed(t,1,!0)}},{title:"行驶开始时间",name:"runStartTime",width:200,maxWidth:300,minWidth:100,resizable:!0,render:T.fullTimeRender},{title:"行驶开始位置",name:"runStartLocation",width:250,maxWidth:800,minWidth:100,resizable:!0,render:T.runTableHandleStartPositionRender},{title:"行驶结束时间",name:"runEndTime",width:200,maxWidth:300,minWidth:100,resizable:!0,render:T.fullTimeRender},{title:"行驶结束位置",name:"runEndLocation",width:250,maxWidth:800,minWidth:100,resizable:!0,render:T.runTableHandleEndPositionRender},{title:"终端号",name:"deviceNumber",width:100,maxWidth:200,minWidth:100,resizable:!0},{title:"终端手机号",name:"simcardNumber",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"",name:"empty",width:40}],T.defaultStopColumns=[{title:"序号",name:"sequenceNumber",width:60,isSequence:!0},{title:"监控对象",name:"monitorName",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"所属分组",name:"assignmentName",width:200,maxWidth:600,minWidth:100,resizable:!0},{title:"停止时长",name:"stopTime",width:100,maxWidth:200,minWidth:80,resizable:!0,render:T.timeRender},{title:"停止开始时间",name:"stopStartTime",width:200,maxWidth:300,minWidth:100,resizable:!0,render:T.fullTimeRender},{title:"停止开始位置",name:"stopStartLocation",width:250,maxWidth:800,minWidth:100,resizable:!0,render:T.stopTableHandleStartPositionRender},{title:"停止结束时间",name:"stopEndTime",width:200,maxWidth:300,minWidth:100,resizable:!0,render:T.fullTimeRender},{title:"停止结束位置",name:"stopEndLocation",width:250,maxWidth:800,minWidth:100,resizable:!0,render:T.stopTableHandleEndPositionRender},{title:"终端号",name:"deviceNumber",width:100,maxWidth:200,minWidth:100,resizable:!0},{title:"终端手机号",name:"simcardNumber",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"",name:"empty",width:40}],T.defaultAlarmColumns=[{title:"序号",name:"sequenceNumber",width:60,isSequence:!0},{title:"监控对象",name:"monitorName",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"所属分组",name:"assignmentName",width:160,maxWidth:200,minWidth:100,resizable:!0},{title:"报警类型",name:"alarmType",width:140,maxWidth:200,minWidth:100,resizable:!0},{title:"处理状态",name:"status",width:100,maxWidth:200,minWidth:80,resizable:!0},{title:"处理人",name:"personName",width:100,maxWidth:200,minWidth:100,resizable:!0},{title:"报警开始时间",name:"startTime",width:180,maxWidth:300,minWidth:80,resizable:!0},{title:"报警开始位置",name:"startLocation",width:200,maxWidth:700,minWidth:100,resizable:!0,render:T.alarmTableStartLocationRender},{title:"报警开始速度",name:"speed",width:200,maxWidth:700,minWidth:100,resizable:!0},{title:"行车记录仪速度",name:"recorderSpeed",width:200,maxWidth:700,minWidth:100,resizable:!0},{title:"报警结束时间",name:"endTime",width:180,maxWidth:300,minWidth:80,resizable:!0},{title:"报警结束位置",name:"endLocation",width:200,maxWidth:700,minWidth:100,resizable:!0,render:T.alarmTableEndLocationRender},{title:"围栏类型",name:"fenceType",width:100,maxWidth:200,minWidth:80,resizable:!0},{title:"围栏名称",name:"fenceName",width:100,maxWidth:200,minWidth:80,resizable:!0},{title:"",name:"empty",width:40}],T.defaultOBDColumns=[{title:"序号",name:"sequenceNumber",width:60,isSequence:!0},{title:"监控对象",name:"monitorName",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"定位时间",name:"serviceGpsTime",width:160,maxWidth:200,minWidth:100,resizable:!0,render:T.fullTimeRender},{title:"服务器时间",name:"serviceSystemTime",width:160,maxWidth:200,minWidth:100,resizable:!0,render:T.fullTimeRender},{title:"所属企业",name:"groupName",width:200,maxWidth:600,minWidth:100,resizable:!0},{title:"仪表总里程",name:"obdTotalMileage",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"累计里程",name:"obdAccumulatedMileage",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"累计总油耗",name:"obdTotalOilConsumption",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"瞬时油耗",name:"obdInstantOilConsumption",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"仪表车速",name:"obdInstrumentSpeed",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"转速",name:"obdRotationRate",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"机油压力",name:"obdOilPressure",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"电池电压",name:"obdBatteryVoltage",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"水温",name:"obdWaterTemperature",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"车辆油箱油量",name:"obdOilQuantity",width:130,maxWidth:200,minWidth:100,resizable:!0},{title:"油箱液位高度",name:"obdOilTankLevelHeight",width:130,maxWidth:200,minWidth:100,resizable:!0},{title:"仪表记录的短途行驶里程",name:"obdShortDistanceMileage",width:220,maxWidth:300,minWidth:100,resizable:!0},{title:"发/电动机运行时间",name:"obdEngineRunningTime",width:220,maxWidth:300,minWidth:100,resizable:!0},{title:"扭矩",name:"obdTorque",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"尿素液位",name:"obdUreaLevel",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"刹车状态(脚刹)",name:"obdFootBrakeStatusStr",width:130,maxWidth:200,minWidth:100,resizable:!0},{title:"远光灯状态",name:"obdHighBeamStatusStr",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"近光灯状态",name:"obdDippedHeadlightStatusStr",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"小灯状态",name:"obdSmallLampStatusStr",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"示宽灯状态",name:"obdIndicatorLampStatusStr",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"雾灯状态",name:"obdFogLampStatusStr",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"左转向灯状态",name:"obdLeftTurnLampStatusStr",width:130,maxWidth:200,minWidth:100,resizable:!0},{title:"右转向灯状态",name:"obdRightTurnLampStatusStr",width:130,maxWidth:200,minWidth:100,resizable:!0},{title:"应急灯状态",name:"obdEmergencyLampStatusStr",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"左前门状态",name:"obdLeftFrontDoorStatusStr",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"右前门状态",name:"obdRightFrontDoorStatusStr",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"左后门状态",name:"obdLeftRearDoorStatusStr",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"右后门状态",name:"obdRightRearDoorStatusStr",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"尾箱门状态",name:"obdTailBoxDoorStatusStr",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"全车锁",name:"obdFullVehicleLockStr",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"左前门锁",name:"obdLeftFrontDoorLockStr",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"右前门锁",name:"obdRightFrontDoorLockStr",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"左后门锁",name:"obdLeftRearDoorLockStr",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"右后门锁",name:"obdRightRearDoorLockStr",width:120,maxWidth:200,minWidth:100,resizable:!0,sortDirections:["ascend","descend"],sorter:!0},{title:"左前窗状态",name:"obdLeftFrontWindowStatusStr",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"右前窗状态",name:"obdRightFrontWindowStatusStr",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"左后窗状态",name:"obdLeftRearWindowStatusStr",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"右后窗状态",name:"obdRightRearWindowStatusStr",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"故障信号(ECM)",name:"obdFaultSignalECMStr",width:140,maxWidth:200,minWidth:100,resizable:!0},{title:"故障信号(ABS)",name:"obdFaultSignalABSStr",width:140,maxWidth:200,minWidth:100,resizable:!0},{title:"故障信号(SRS)",name:"obdFaultSignalSRSStr",width:140,maxWidth:200,minWidth:100,resizable:!0},{title:"报警信号(机油)",name:"obdAlarmSignalEngineOilStr",width:140,maxWidth:200,minWidth:100,resizable:!0},{title:"报警信号(胎压)",name:"obdAlarmSignalTirePressureStr",width:140,maxWidth:200,minWidth:100,resizable:!0},{title:"报警信号(保养)",name:"obdAlarmSignalMaintainStr",width:140,maxWidth:200,minWidth:100,resizable:!0},{title:"安全气囊状态",name:"obdSafetyAirBagStatusStr",width:140,maxWidth:200,minWidth:100,resizable:!0},{title:"刹车状态(手刹)",name:"obdHandBrakeStatusStr",width:140,maxWidth:200,minWidth:100,resizable:!0},{title:"离合状态",name:"obdClutchStatusStr",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"安全带(驾驶员)",name:"obdSafetyBeltStatusDriverStr",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"安全带(副驾)",name:"obdSafetyBeltStatusDeputyDrivingStr",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"ACC信号",name:"obdACCSignalStr",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"钥匙状态",name:"obdKeyStatusStr",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"雨刮状态",name:"obdWiperStatusStr",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"空调开关",name:"obdAirConditionerStatusStr",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"档位",name:"obdGearPositionStr",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"油门踏板",name:"obdAcceleratorPedalStr",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"方向盘转角状态",name:"obdSteeringWheelAngleStatusStr",width:140,maxWidth:200,minWidth:100,resizable:!0},{title:"能源类型",name:"obdEnergyTypeStr",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"OBD状态(MIL故障灯)",name:"obdMILFaultLampStr",width:260,maxWidth:300,minWidth:100,resizable:!0},{title:"续航里程",name:"obdEnduranceMileage",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"油量百分比",name:"obdPercentageOfOil",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"瞬时百公里油耗",name:"obdInstant100KmOilConsumption",width:140,maxWidth:200,minWidth:100,resizable:!0},{title:"平均百公里油耗",name:"obdAverage100KmOilConsumption",width:140,maxWidth:200,minWidth:100,resizable:!0},{title:"发动机进气温度",name:"obdEngineIntakeTemperature",width:140,maxWidth:200,minWidth:100,resizable:!0},{title:"车内空调温度",name:"obdAirConditioningTemperature",width:140,maxWidth:200,minWidth:100,resizable:!0},{title:"电机温度",name:"obdMotorTemperature",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"控制器温度",name:"obdControllerTemperature",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"三元催化器温度",name:"obdTernaryCatalystTemperature",width:140,maxWidth:200,minWidth:100,resizable:!0},{title:"机油温度",name:"obdEngineOilTemperature",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"燃油温度",name:"obdFuelTemperature",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"增压空气温度",name:"obdSuperchargedAirTemperature",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"转速计算车速",name:"obdSpeedByRotationalSpeedCalculation",width:140,maxWidth:200,minWidth:100,resizable:!0},{title:"空气流量",name:"obdAirFlowRate",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"进气压力",name:"obdIntakePressure",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"喷油量",name:"obdFuelInjectionQuantity",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"油门踏板相对位置",name:"obdRelativePositionOfThrottlePedal",width:160,maxWidth:200,minWidth:100,resizable:!0},{title:"方向盘转角角度",name:"obdSteeringWheelAngle",width:160,maxWidth:200,minWidth:100,resizable:!0},{title:"电池剩余电量",name:"obdBatteryRemainingElectricity",width:140,maxWidth:200,minWidth:100,resizable:!0},{title:"车辆行程耗油量",name:"obdVehicleTravelFuelConsumption",width:140,maxWidth:200,minWidth:100,resizable:!0},{title:"行程内离合次数",name:"obdNumberOfClutchesDuringTravel",width:140,maxWidth:200,minWidth:100,resizable:!0},{title:"行程内脚刹次数",name:"obdNumberOfFootBrakesDuringTravel",width:140,maxWidth:200,minWidth:100,resizable:!0},{title:"行程内手刹次数",name:"obdNumberOfHandBrakesDuringTravel",width:140,maxWidth:200,minWidth:100,resizable:!0},{title:"发动机负荷",name:"obdEngineLoad",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"扭矩百分比",name:"obdTorquePercentage",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"大气压力",name:"obdAtmosphericPressure",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"前氧传感器示值",name:"obdFrontOxygenSensorValue",width:160,maxWidth:200,minWidth:100,resizable:!0},{title:"后氧传感器示值",name:"obdRearOxygenSensorValue",width:160,maxWidth:200,minWidth:100,resizable:!0},{title:"SCR",name:"obdSCR",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"氧化氮超限报警状态",name:"obdNitricOxideOverrunAlarmStatus",width:180,maxWidth:200,minWidth:100,resizable:!0},{title:"NOx浓度值范围",name:"obdNOxConcentrationRange",width:160,maxWidth:200,minWidth:100,resizable:!0},{title:"报警信息",name:"obdAlarmInfo",width:120,maxWidth:200,minWidth:100,resizable:!0},{title:"",name:"empty",width:40}];var x=function(t){return t.replace(/(?:\.0*|(\.\d+?)0+)$/,"$1")},S=function(t,e){this.dependency=e,this.tableStatus=null,this.tableObd=null,this.tableRun=null,this.tableStop=null,this.tableAlarm=null,this.defaultStatusColumns=T.defaultStatusColumns,this.defaultAlarmColumns=T.defaultAlarmColumns,this.defaultRunColumns=T.defaultRunColumns,this.defaultStopColumns=T.defaultStopColumns,this.defaultOBDColumns=T.defaultOBDColumns,this.statusColumns=[],this.alarmColumns=[],this.obdColumns=[],this.stopColumns=[],this.columnKeys=["TRACKPLAY_DATA","TRACKPLAY_ALARM","TRACKPLAY_OBD_LIST","TRACKPLAY_RUN","TRACKPLAY_STOP"],this.tableStatusClickIndex=void 0,this.tableRunClickId=void 0,this.tableRunClickTimestamp=void 0,this.tableObdClickIndex=void 0,this.initSetting(!1)};S.prototype.initSetting=function(t,e){$.ajax({type:"POST",url:"/clbs/core/uum/custom/findCustomColumnInfoByMark",dataType:"json",async:!0,data:{marks:this.columnKeys.join(",")+",TRACKPLAY_SPEED"},success:function(a){var n=[$.extend({},T.defaultStatusColumns[0])],i=[$.extend({},T.defaultAlarmColumns[0])],r=[$.extend({},T.defaultOBDColumns[0])],o=[$.extend({},T.defaultRunColumns[0])],s=[$.extend({},T.defaultStopColumns[0])];if(a.success&&a.obj){var l=this.dependency.get("data"),d=a.obj.TRACKPLAY_SPEED.map((function(t){return parseInt(t.initValue)})),c=d.slice(0,2),h=d[2];h&&l.setTrackWidth(h),l.setTrackColor(c);for(var p=[n,i,r,o,s],u=[T.defaultStatusColumns,T.defaultAlarmColumns,T.defaultOBDColumns,T.defaultRunColumns,T.defaultStopColumns],g=0;g<this.columnKeys.length;g++){var m=this.columnKeys[g],y=a.obj[m];if(null!=y)for(var f=0;f<y.length;f++){var v=y[f],b=u[g].find((function(t){return t.name===v.columnName}));if(void 0!==b){var k=$.extend({},b);1===v.isFix&&(k.isFrozen=!0),p[g].push(k)}}}n.push(T.defaultStatusColumns[T.defaultStatusColumns.length-1]),i.push(T.defaultAlarmColumns[T.defaultAlarmColumns.length-1]),r.push(T.defaultOBDColumns[T.defaultOBDColumns.length-1]),o.push(T.defaultRunColumns[T.defaultRunColumns.length-1]),s.push(T.defaultStopColumns[T.defaultStopColumns.length-1])}this.statusColumns=n,this.alarmColumns=i,this.obdColumns=r,this.runColumns=o,this.stopColumns=s,this.initOrUpdateSetting(t),"function"==typeof e&&e()}.bind(this)})},S.prototype.initOrUpdateSetting=function(t){var e=0,a=!1;this.statusColumns.forEach((function(t){e+=t.width,t.isFrozen&&!a&&(a=!0),t.isFrozen&&(t.resizable=!1)})),a&&(this.statusColumns[0].isFrozen=!0);var n={tableId:"tableStatus",data:t?this.tableStatus.getOption().data:[],columns:this.statusColumns,freezeHead:!0,freezeColumn:a,getUniqueId:"id",width:e,cancelActiveRow:!1,clickMeansActive:!0,dblClickMeansLock:!1,activeScrollDuration:0,striped:!1,virtualRender:!0,handleTdClick:this.handleStatusTableClick.bind(this),handleThHover:this.handleStatusMouseOver.bind(this)},i=0,r=!1;this.alarmColumns.forEach((function(t){i+=t.width,t.isFrozen&&!r&&(r=!0),t.isFrozen&&(t.resizable=!1)})),r&&(this.alarmColumns[0].isFrozen=!0);var o={tableId:"tableAlarm",data:t?this.tableAlarm.getOption().data:[],columns:this.alarmColumns,freezeHead:!0,freezeColumn:r,getUniqueId:"id",width:i,clickMeansActive:!0,scrollWhenAppend:!0,virtualRender:!0,handleTdClick:this.handleAlarmTableDblClick.bind(this)},s=0,l=!1;this.obdColumns.forEach((function(t){s+=t.width,t.isFrozen&&!l&&(l=!0),t.isFrozen&&(t.resizable=!1)})),l&&(this.obdColumns[0].isFrozen=!0);var d={tableId:"tableOBD",data:t?this.tableObd.getOption().data:[],columns:this.obdColumns,freezeHead:!0,freezeColumn:l,getUniqueId:"id",width:s,cancelActiveRow:!1,clickMeansActive:!0,dblClickMeansLock:!1,activeScrollDuration:0,striped:!1,virtualRender:!0,handleTdClick:this.handleObdTableClick.bind(this)},c=0,h=!1;this.runColumns.forEach((function(t){c+=t.width,t.isFrozen&&!h&&(h=!0),t.isFrozen&&(t.resizable=!1)})),h&&(this.runColumns[0].isFrozen=!0);var p={tableId:"tableRun",data:t?this.tableRun.getOption().data:[],columns:this.runColumns,freezeHead:!0,freezeColumn:h,getUniqueId:"id",width:c,cancelActiveRow:!1,clickMeansActive:!0,dblClickMeansLock:!1,activeScrollDuration:0,striped:!1,virtualRender:!0,handleTdClick:this.handleRunTableClick.bind(this),handleTdDblClick:this.handleRunTableDblClick.bind(this)},u=0,g=!1;this.stopColumns.forEach((function(t){u+=t.width,t.isFrozen&&!g&&(g=!0),t.isFrozen&&(t.resizable=!1)})),g&&(this.stopColumns[0].isFrozen=!0);var m={tableId:"tableStop",data:t?this.tableStop.getOption().data:[],columns:this.stopColumns,freezeHead:!0,freezeColumn:g,getUniqueId:"id",width:u,cancelActiveRow:!1,clickMeansActive:!0,dblClickMeansLock:!1,activeScrollDuration:0,striped:!1,virtualRender:!0,handleTdClick:this.handleStopTableClick.bind(this)};this.tableStatus=$("#allDataWraper-div").itable(n),this.tableObd=$("#obdDataWraper-div").itable(d),this.tableAlarm=$("#alarmDataWraper-div").itable(o),this.tableRun=$("#runDataWraper-div").itable(p),this.tableStop=$("#stopDataWraper-div").itable(m),t&&(this.tableStatus.render(),this.tableAlarm.render(),this.tableObd.render(),this.tableRun.render(),this.tableStop.render()),this.setActiveRow()},S.prototype.handleStatusTableClick=function(t,e,a){var n=this.tableStatus.findRow(this.tableStatus.getState().data,this.tableStatus.getOption(),t);if(null!==n){var i=n[1],r=n[0];this.tableStatusClickIndex=i;var o=this.dependency.get("data");o.getIsPlaying()&&this.dependency.get("map").pause(),o.setPlayIndex(i),o.getShowStopPoint()&&r&&"2"===r.status&&this.dependency.get("map").danceStopMarker(i)}},S.prototype.handleObdTableClick=function(t,e,a){var n=this.tableObd.findRow(this.tableObd.getState().data,this.tableObd.getOption(),t);if(null!==n){var i=n[1];this.tableObdClickIndex=i;var r=this.dependency.get("data");r.getIsPlaying()&&this.dependency.get("map").pause(),r.setPlayIndex(i)}},S.prototype.handleRunTableClick=function(t,e,a){var n=this.dependency.get("map"),i=this.tableRunClickTimestamp;if(this.tableRunClickTimestamp=new Date,!(i&&this.tableRunClickTimestamp.getTime()-i.getTime()<600))if(t!==this.tableRunClickId){var r=this.tableRun.findRow(this.tableRun.getState().data,this.tableRun.getOption(),t);if(null!==r){var o=r[0];this.tableRunClickId=t,o&&n.highlightRunSegment(o.originStartIndex,o.originEndIndex,o.runMile)}}else{this.tableRunClickId=void 0,n.removeHighlightRunSegment();var s=this.tableRun,l=this.tableRunClickId;requestAnimationFrame((function(){s.setActiveRow(l)}))}},S.prototype.handleRunTableDblClick=function(t,e,a){var n=this.dependency.get("map");this.dependency.get("data").getIsPlaying()&&n.pause("runTableDblClick"),setTimeout((function(){n.focusRunSegment()}),800)},S.prototype.removeHighlightRunSegment=function(){var t=this.dependency.get("map");this.dependency.get("data");if(trackPlayback.data.getIsPlaying()&&this.tableRunClickId)return this.tableRunClickId=void 0,this.tableRun.setActiveRow(void 0),void t.removeHighlightRunSegment()},S.prototype.handleStopTableClick=function(t,e,a){var n=this.tableStop.findRow(this.tableStop.getState().data,this.tableStop.getOption(),t);if(null!==n){var i=n[0];this.dependency.get("data").getShowStopPoint()&&i&&this.dependency.get("map").danceStopMarker(i.originStartIndex)}},S.prototype.handleAlarmTableDblClick=function(t,e,a){var n=this.tableAlarm.findRow(this.tableAlarm.getState().data,this.tableAlarm.getOption(),t);if(null!==n){var i=n[1];this.dependency.get("map").danceAlarmMarker(i)}},S.prototype.setActiveRow=function(){var t=this.dependency.get("data"),e=t.getPositions(),a=t.getPlayIndex();if(e&&null!==a&&e[a]){var n=e[a],i=this.getRowId(n),r=t.getTableTabIndex();1===r?a!==this.tableStatusClickIndex&&this.tableStatus.getState().lastClickRowId!==i&&this.tableStatus.setActiveRow(i):2===r&&a!==this.tableObdClickIndex&&this.tableObd.getState().lastClickRowId!==i&&this.tableObd.setActiveRow(i)}},S.prototype.setActiveTab=function(){var t=this.dependency.get("data").getTableTabIndex();1!==t||$("#allDataWraper").hasClass("active")?2!==t||$("#obdDataWraper").hasClass("active")?3!==t||$("#runDataWraper").hasClass("active")?4!==t||$("#stopDataWraper").hasClass("active")?5!==t||$("#alarmDataWraper").hasClass("active")||$("#myTab a:eq(4)").tab("show"):$("#myTab a:eq(3)").tab("show"):$("#myTab a:eq(2)").tab("show"):$("#myTab a:eq(1)").tab("show"):$("#myTab a:eq(0)").tab("show"),this.setActiveRow()},S.prototype.replaceAlarmTable=function(){var t=this.dependency.get("data").getAlarmData(),e=[];if(null!==t){console.log(t);for(var a=0;a<t.length;a++){var n=t[a];e.push({sequenceNumber:0,id:n.id,monitorName:n.monitorName,assignmentName:n.assignmentName,alarmType:n.description,status:n.alarmStatus,personName:n.personName,startTime:n.startTime,startLocation:n.startLocation,speed:n.speed?x(n.speed.toString()):"-",recorderSpeed:n.recorderSpeed?x(n.recorderSpeed.toString()):"-",alarmStartLocation:n.alarmStartLocation,endTime:n.endTime,endLocation:n.endLocation,alarmEndLocation:n.alarmEndLocation,fenceType:n.fenceType,fenceName:n.fenceName})}}this.tableAlarm.replaceOptionData(e)},S.prototype.replaceRunTable=function(){var t=this.dependency.get("data").getRunFragmentData();null!==t?this.tableRun.replaceOptionData(t):this.tableRun.replaceOptionData([])},S.prototype.replaceStopTable=function(){var t=this.dependency.get("data").getStopFragmentData();null!==t?this.tableStop.replaceOptionData(t):this.tableStop.replaceOptionData([])},S.prototype.replaceObdTable=function(){var t=this.dependency.get("data"),e=t.getObdData(),a=t.getPositions(),n=t.getPositionsTmp(),i=t.getAllOrRunData(),r=[],o="run"===i?n:a;if(null!==e){for(var s=0;s<e.length;s++){for(var l=e[s],d={sequenceNumber:0,id:this.getRowId(l),monitorName:l.plateNumber,serviceGpsTime:1e3*l.vtime,serviceSystemTime:1e3*parseInt(l.uploadtime),groupName:l.groupName,drivingState:o[s].drivingState},c=0;c<this.obdColumns.length;c++){var h=this.obdColumns[c].name;void 0===d[h]&&(d[h]=l[h])}r.push(d)}"run"===i&&(r=trackPlayback.filterRunData(r)),this.tableObd.replaceOptionData(r),this.setActiveRow()}else this.tableObd.replaceOptionData([])},S.prototype.replaceTable=function(){var t=this.dependency.get("data"),e=t.getGroup(),a=t.getSensorFlag(),n=t.getPositions(),i=[];if(null===n)this.dependency.get("dragBar").setDelta(0),$("#scalingBtn").removeClass("fa-chevron-down").addClass("fa-chevron-up"),this.tableStatus.replaceOptionData([]);else{for(var r=0;r<n.length;r++){var o=n[r],s=n[r-1];i.push({sequenceNumber:0,id:this.getRowId(o),monitorName:o.plateNumber,vtime:1e3*o.vtime,intervalTime:void 0===s?null:o.vtime-s.vtime,assignmentName:e,deviceNumber:o.deviceNumber,simCard:o.simCard,status:o.drivingState,acc:o.acc,speed:o.speed,recorderSpeed:o.recorderSpeed,angle:o.angle,gpsMile:o.gpsMile,locationType:o.locationType,satelliteNumber:o.satelliteNumber,locationStatus:o.locationStatus,longtitude:o.longitude,latitude:o.latitude,mileageSpeed:o.mileageSpeed,mileageTotal:o.mileageTotal,sensorFlag:a,location:null,reissue:o.reissue})}this.tableStatus.replaceOptionData(i),this.setActiveRow(),this.dependency.get("dragBar").setDelta(-250),$("#scalingBtn").removeClass("fa-chevron-up").addClass("fa-chevron-down")}t.setTableTabIndex(1),t.setObdData(null),t.setAlarmData(null),t.setStopFragmentData(null),t.setRunFragmentData(null)},S.prototype.getRowId=function(t){return t.plateNumber+" "+t.vtime},S.prototype.getRestTableData=function(){var t=this.dependency.get("data"),e=t.getTableTabIndex(),a=t.getVid(),n=t.getStartTime(),i=t.getEndTime(),r=t.getSensorFlag(),o=t.getValidSensorFlag();r=null;if(o&&(r=o[t.getValidClickedIndex()]),2===e)null===t.getObdData()&&json_ajax("POST","/clbs/lkyw/trackBack/getMonitorObdDate","json",!0,{monitorId:a,startTime:n,endTime:i,sensorFlag:r},(function(e){if(e.success){var a=JSON.parse(Object(s.a)(e.msg));"yes"===a.isObdSet?t.setObdData(a.result):t.setObdData(null)}else layer.msg(e.msg)}));else if(3===e){if(null===t.getRunFragmentData()){var l=t.getPositions(),d=t.getPositionsTmp(),c=t.getStopTypeDict(),h=t.getAllOrRunData(),p=t.getGroup(),u="run"===h?d:l,g=[];if(c[1])for(var m=c[1].segment,y=0;y<m.length;y++){k=u[(b=m[y]).originStartIndex],T=u[b.originEndIndex];var f="-";!r||w.isEmpty(T.mileageTotal)||w.isEmpty(k.mileageTotal)?w.isEmpty(T.gpsMile)||w.isEmpty(k.gpsMile)||(f=T.gpsMile-k.gpsMile):f=T.mileageTotal-k.mileageTotal,"-"!==f&&(f=w.toFixed(f,1,!0)),g.push({sequenceNumber:0,originStartIndex:b.originStartIndex,originEndIndex:b.originEndIndex,id:this.getRowId(k),monitorName:b.monitorName,assignmentName:p,runTime:b.timeLength,runMile:f,useOil:b.useOil,consumeOil:b.consumeOil,runStartTime:b.originStartTime,runStartLocation:null,startLongtitude:b.startLongtitude,startLatitude:b.startLatitude,runEndTime:b.originEndTime,runEndLocation:null,endLongtitude:b.endLongtitude,endLatitude:b.endLatitude,deviceNumber:b.deviceNumber,simcardNumber:b.simcardNumber})}t.setRunFragmentData(g)}}else if(4===e){if(null===t.getStopFragmentData()){l=t.getPositions(),d=t.getPositionsTmp(),c=t.getStopTypeDict(),h=t.getAllOrRunData(),p=t.getGroup(),u="run"===h?d:l;var v=[];if(c[2]){var b,k,T;m=c[2].segment;console.log("segments",m);for(y=0;y<m.length;y++)k=u[(b=m[y]).originStartIndex],T=u[b.originEndIndex],v.push({sequenceNumber:0,originStartIndex:b.originStartIndex,originEndIndex:b.originEndIndex,id:this.getRowId(k),monitorName:b.monitorName,assignmentName:p,stopTime:b.timeLength,stopStartTime:b.originStartTime,stopStartLocation:null,startLongtitude:b.startLongtitude,startLatitude:b.startLatitude,stopEndTime:b.originEndTime,stopEndLocation:null,endLongtitude:b.endLongtitude,endLatitude:b.endLatitude,deviceNumber:b.deviceNumber,simcardNumber:b.simcardNumber})}t.setStopFragmentData(v)}}else if(5===e){null===t.getAlarmData()&&json_ajax("POST","/clbs/lkyw/trackBack/getAlarmData","json",!0,{vehicleId:a,startTime:parseInt(new Date(n.replace(/\-/g,"/")).getTime()/1e3),endTime:parseInt(new Date(i.replace(/\-/g,"/")).getTime()/1e3)},(function(e){e.success?t.setAlarmData(e.obj):layer.msg(e.msg)}))}},S.prototype.autoGetStatusPosition=function(){var t=this.dependency.get("data"),e=t.getIsPlaying(),a=t.getIsDraging();if(!e&&!a){var n=this.tableStatus,i=this.getAddress;setTimeout((function(){var e=t.getPlayIndex(),a=n.getState().data[e];null!=a&&null===a.location&&i(a.id,a.latitude,a.longtitude,(function(t){n.updateOptionData({id:a.id,location:$.isPlainObject(t)?"未定位":t})}))}),500)}},S.prototype.handleStatusPositionClick=function(t){var e=this.tableStatus,a=e.findRow(e.getState().data,e.getOption(),t);if(null!==a){var n=a[0];this.getAddress(n.id,n.latitude,n.longtitude,(function(a){e.updateOptionData({id:t,location:$.isPlainObject(a)?"未定位":a})}))}},S.prototype.getAddress=function(t,e,a,n){var i={addressReverse:[e,a,"","","vehicle"]};$.ajax({type:"POST",url:"/clbs/v/monitoring/address",dataType:"json",async:!0,data:i,traditional:!0,timeout:8e3,success:function(t){n(t)}})},S.prototype.handleStartLocationClick=function(t){var e=this.tableAlarm,a=e.findRow(e.getState().data,e.getOption(),t);if(null!==a){var n=a[0],i=n.alarmStartLocation.split(",");this.getAddress(n.id,i[1],i[0],(function(a){e.updateOptionData({id:t,startLocation:$.isPlainObject(a)?"未定位":a})}))}},S.prototype.handleEndLocationClick=function(t){var e=this.tableAlarm,a=e.findRow(e.getState().data,e.getOption(),t);if(null!==a){var n=a[0],i=n.alarmEndLocation.split(",");this.getAddress(n.id,i[1],i[0],(function(a){e.updateOptionData({id:t,endLocation:$.isPlainObject(a)?"未定位":a})}))}},S.prototype.handleStopTableStartLocationClick=function(t){var e=this.tableStop,a=e.findRow(e.getState().data,e.getOption(),t);if(null!==a){var n=a[0];this.getAddress(n.id,n.startLatitude,n.startLongtitude,(function(a){e.updateOptionData({id:t,stopStartLocation:$.isPlainObject(a)?"未定位":a})}))}},S.prototype.handleStopTableEndLocationClick=function(t){var e=this.tableStop,a=e.findRow(e.getState().data,e.getOption(),t);if(null!==a){var n=a[0];this.getAddress(n.id,n.endLatitude,n.endLongtitude,(function(a){e.updateOptionData({id:t,stopEndLocation:$.isPlainObject(a)?"未定位":a})}))}},S.prototype.handleRunTableStartLocationClick=function(t){var e=this.tableRun,a=e.findRow(e.getState().data,e.getOption(),t);if(null!==a){var n=a[0];this.getAddress(n.id,n.startLatitude,n.startLongtitude,(function(a){e.updateOptionData({id:t,runStartLocation:$.isPlainObject(a)?"未定位":a})}))}},S.prototype.handleRunTableEndLocationClick=function(t){var e=this.tableRun,a=e.findRow(e.getState().data,e.getOption(),t);if(null!==a){var n=a[0];this.getAddress(n.id,n.endLatitude,n.endLongtitude,(function(a){e.updateOptionData({id:t,runEndLocation:$.isPlainObject(a)?"未定位":a})}))}},S.prototype.handleStatusMouseOver=function(t,e){"status"===e.data("name")&&e.justToolsTip({animation:"moveInTop",width:"auto",contents:"连续5个点及以上，且速度都小于等于5km/h，为停止； 连续3个点及以上，且速度都大于5km/h，为行驶",gravity:"top",events:"mouseover"})},S.prototype.isTableEmpty=function(){var t=this.dependency.get("data").getTableTabIndex();return 0===(1===t?this.tableStatus:2===t?this.tableObd:3===t?this.tableRun:4===t?this.tableStop:this.tableAlarm).getState().data.length};var w={getLocale:function(t){return{runAndStop:"行驶/停止",driveTime:"时长",stopTimeLength:"停止时长",mileage:"里程",speed:"速度",oilDataText:"油量",leftOil:"剩油",addOil:"加油",reduceOil:"漏油",oilConsumption:"油耗",tempText:"温度(℃)",humidityText:"湿度(%)",voltage:"电压",secondFlow:"瞬时流量",reverseText:"正反转",noData:"无数据",upRotate:"正转",downRotate:"反转",stopRorate:"停转",io:"开关",hour:"h"}[t]},getHourFromSecond:function(t){var e=t/3600;return e=w.toFixed(e,1,!0)},getHTMLFromSecond:function(t){if(t>=600)return'<span class="color-blue">'+w.getHourFromSecond(t).toString()+"</span> h";var e=Math.floor(t/60),a=t-60*e;return'<span class="color-blue">'+e.toString()+'</span> m <span class="color-blue">'+a.toString()+"</span> s"},getTextFromSecond:function(t){if(t>=600)return w.getHourFromSecond(t).toString()+" h";var e=Math.floor(t/60),a=t-60*e;return e.toString()+" m "+a.toString()+" s"},toFixed:function(t,e,a){var n=t;if("number"!=typeof n)try{n=parseFloat(n)}catch(t){return 0}if(null==n||isNaN(n))return 0;var i=n.toFixed(e);return a&&(i=parseFloat(i)),i},isEmpty:function(t){return!(t instanceof Date)&&(null==t||"object"==typeof t&&(void 0!==t.size?0===t.size:0===Object.keys(t).length||0===t.length))},tryParseFloat:function(t,e){void 0===e&&(e=0);var a=parseFloat(t);return isNaN(a)?e:a}},P=function(t,e){this.dependency=e};P.prototype.sensorMeta={mileSpeed:{icon:"icon-mile",text:"里程速度",ids:["0x53"]},stopData:{icon:"icon-runAndStop",text:"行驶/停止",ids:["0x00"]},oilData:{icon:"icon-oil",text:"油量数据",ids:["0x41","0x42","0x43","0x44"]},oilConsumptionData:{icon:"icon-oilConsume",text:"油耗数据",ids:["0x45","0x46"]},temperaturey:{icon:"icon-temperature",text:"温度数据",ids:["0x21","0x22","0x23","0x24","0x25"]},humidity:{icon:"icon-humiture",text:"湿度数据",ids:["0x26","0x27","0x28","0x29","0x2A"]},workHour:{icon:"icon-workhour",text:"工时数据",ids:["0x80","0x81"]},reverse:{icon:"icon-reverse",text:"正反转",ids:["0x51"]},weight:{icon:"icon-weight",text:"载重数据",ids:["0x70","0x71"]},tire:{icon:"icon-tire",text:"胎压数据",ids:["0xE3"]},ioData:{icon:"icon-io",text:"开关数据",ids:["0x90","0x91","0x92"]}},P.prototype.chartTmpl={mileSpeed:'<div class="chart-item" id="mileSpeedItem">\n                                <div class="chart-title">里程速度</div>\n                                <div class="chart-line">\n                                    <div id="mileSpeedChart" class="chart-wraper"></div>\n                                </div>\n                                <table class="chart-text">\n                                    <tr>\n                                        <td>里程 <span  class="color-blue" id="mileText">--</span> km</td>\n                                        <td>最高速度 <span  class="color-blue" id="maxSpeedText">--</span> km/h</td>\n                                    </tr>\n                                </table>\n                            </div>',stopData:'<div class="chart-item" id="stopDataItem">\n                                <div class="chart-title">行驶/停止</div>\n                                <div class="chart-line">\n                                    <div id="stopDataChart" class="chart-wraper"></div>\n                                </div>\n                                <table class="chart-text">\n                                    <tr>\n                                        <td>行驶次数 <span  class="color-blue" id="runTimesText">--</span> 次</td>\n                                        <td>行驶里程 <span  class="color-blue" id="runMilesText">--</span> km</td>\n                                        <td>行驶时长 <span  id="runTimeText">--</span></td>\n                                    </tr>\n                                    <tr>\n                                        <td>停止次数 <span  class="color-blue" id="stopTimesText">--</span> 次</td>\n                                        <td>怠速里程 <span  class="color-blue" id="stopMilesText">--</span> km</td>\n                                        <td>停止时长 <span id="stopTimeText">--</span></td>\n                                    </tr>\n                                </table>\n                            </div>',oilData:'<div class="chart-item" id="oilDataItem">\n                                <div class="chart-title">油量数据 <select class="chart-select" id="oilDataSelect"></select></div>\n                                <div class="chart-line">\n                                    <div id="oilDataChart" class="chart-wraper"></div>\n                                </div>\n                                <table class="chart-text">\n                                    <tr>\n                                        <td>加油 <span  class="color-blue" id="addOilText">--</span> L</td>\n                                        <td>漏油 <span  class="color-blue" id="spillOilText">--</span> L</td>\n                                        <td>用油 <span  class="color-blue" id="useOilText">--</span> L</td>\n                                    </tr>\n                                </table>\n                            </div>',oilConsumptionData:'<div class="chart-item" id="oilConsumptionDataItem">\n                                <div class="chart-title">油耗数据 <select class="chart-select" id="oilConsumptionDataSelect"></select></div>\n                                <div class="chart-line">\n                                    <div id="oilConsumptionDataChart" class="chart-wraper"></div>\n                                </div>\n                                <table class="chart-text">\n                                    <tr>\n                                        <td>油耗 <span  class="color-blue" id="oilConsumptionText">--</span> L</td>\n                                        <td>百公里油耗 <span  class="color-blue" id="oilConsumption100Text">--</span> L/100km</td>\n                                    </tr>\n                                </table>\n                            </div>',temperaturey:'<div class="chart-item" id="temperatureyItem">\n                                <div class="chart-title">温度数据 <select class="chart-select" id="temperatureySelect"></select></div>\n                                <div class="chart-line">\n                                    <div id="temperatureyChart" class="chart-wraper"></div>\n                                </div>\n                                <table class="chart-text">\n                                    <tr>\n                                        <td>最高温度 <span  class="color-blue" id="highestTempText">--</span> ℃</td>\n                                        <td>最低温度 <span  class="color-blue" id="lowestTempText">--</span> ℃</td>\n                                    </tr>\n                                </table>\n                            </div>',humidity:'<div class="chart-item" id="humidityItem">\n                                <div class="chart-title">湿度数据 <select class="chart-select" id="humiditySelect"></select></div>\n                                <div class="chart-line">\n                                    <div id="humidityChart" class="chart-wraper"></div>\n                                </div>\n                                <table class="chart-text">\n                                    <tr>\n                                        <td>最高湿度 <span  class="color-blue" id="highestHumiText">--</span>%</td>\n                                        <td>最低湿度 <span  class="color-blue" id="lowestHumiText">--</span>%</td>\n                                    </tr>\n                                </table>\n                            </div>',workHour:'<div class="chart-item" id="workHourItem">\n                                <div class="chart-title">工时数据 <select class="chart-select" id="workHourSelect"></select></div>\n                                <div class="chart-line">\n                                    <div id="workHourChart" class="chart-wraper"></div>\n                                </div>\n                                <table class="chart-text">\n                                    <tr>\n                                        <td>有效工时 <span  id="validWorkHourText">--</span></td>\n                                        <td>待机工时 <span  id="waitWorkHourText">--</span></td>\n                                        <td>停机工时 <span  id="stopWorkHourText">--</span></td>\n                                    </tr>\n                                </table>\n                            </div>',reverse:'<div class="chart-item" id="reverseItem">\n                                <div class="chart-title">正反转数据</div>\n                                <div class="chart-line">\n                                    <div id="reverseChart" class="chart-wraper"></div>\n                                </div>\n                                <table class="chart-text">\n                                    <tr>\n                                        <td>正转时长 <span  id="totalUpTimeText">--</span></td>\n                                        <td>反转时长 <span  id="totalDownTimeText">--</span></td>\n                                    </tr>\n                                </table>\n                            </div>',ioData:'<div class="chart-item" id="ioDataItem">\n                                <div class="chart-title">I/O数据 <select class="chart-select" id="ioDataSelect"></select></div>\n                                <div class="chart-line">\n                                    <div id="ioDataChart" class="chart-wraper"></div>\n                                </div>\n                                <table class="chart-text">\n                                    <tr>\n                                        <td><span class="io-rect" id="ioUpRect"></span><span id="ioUpText"></span> <span  id="ioTotalUpText">--</span></td>\n                                        <td><span class="io-rect" id="ioDownRect"></span><span id="ioDownText"></span> <span  id="ioTotalDownText">--</span></td>\n                                    </tr>\n                                </table>\n                            </div>',weight:'<div class="chart-item" id="weightItem">\n                                <div class="chart-title">载重数据 <select class="chart-select" id="weightSelect"></select></div>\n                                <div class="chart-line">\n                                    <div id="weightChart" class="chart-wraper"></div>\n                                </div>\n                                <table class="chart-text">\n                                    <tr>\n                                        <td>空载 <span  id="emptyText">--</span></td>\n                                        <td>轻载 <span  id="lightText">--</span></td>\n                                        <td>重载 <span  id="heavyText">--</span></td>\n                                    </tr>\n                                    <tr>\n                                        <td>满载 <span  id="fullText">--</span></td>\n                                        <td>超载 <span  id="overText">--</span></td>\n                                    </tr>\n                                </table>\n                            </div>',tire:'<div class="chart-item" id="tireItem">\n                                <div class="chart-title">胎压数据 <select class="chart-select" id="tireSelect"></select></div>\n                                <div class="chart-line">\n                                    <div id="tireChart" class="chart-wraper"></div>\n                                </div>\n                                <table class="chart-text">\n                                    <tr>\n                                        <td>最高胎压 <span  class="color-blue" id="highestTireText">--</span> bar</td>\n                                        <td>最低胎压 <span  class="color-blue" id="lowestTireText">--</span> bar</td>\n                                    </tr>\n                                </table>\n                            </div>'},P.prototype.reRender=function(){var t=this.dependency.get("data").getActiveSensorKeys();if(null!==t)for(var e=0;e<t.length;e++)t[e].chart&&t[e].chart.initHtml()},P.prototype.onSensorItemClick=function(t){var e=this.dependency.get("data"),a=e.getActiveSensorKeys(),n=e.getSensorList();null!==a&&e.setActiveSensorKeys([a[1],{key:n[t].key,chart:null}])},P.prototype.setChartOpen=function(){var t=this.dependency.get("data").getIsChartOpen(),e=$("#topPart"),a=$("#toggleChartText");t?(e.addClass("chart-open"),a.html("隐<br/>藏")):(e.removeClass("chart-open"),a.html("曲<br/>线<br/>报<br/>表"))},P.prototype.onSensorPageClick=function(){var t=$(this),e=$("#sensorContainer"),a=e.scrollLeft(),n=60*(e.find(".sensor-item").length-9);a=t.hasClass("prev")?Math.max(0,a-60):Math.min(n,a+60),e.animate({scrollLeft:a+"px"},200),a>=n?$("#nextPageIcon").hide():$("#nextPageIcon").show(),a>0?$("#prevPageIcon").show():$("#prevPageIcon").hide()},P.prototype.onDrag=function(t){t&&void 0!==t.playIndex&&(this.dependency.get("data").setIsDraging(!0),this.dependency.get("data").getIsPlaying()&&this.dependency.get("map").pause(),this.dependency.get("data").setPlayIndex(t.playIndex,"chart"))},P.prototype.onDragEnd=function(t){t&&void 0!==t.playIndex&&(this.dependency.get("data").setIsDraging(!1),this.dependency.get("data").getIsPlaying()&&this.dependency.get("map").pause(),this.dependency.get("data").setPlayIndex(t.playIndex,"chart"))},P.prototype.updatePlayIndex=function(){var t=this.dependency.get("data").getPlayIndex("chart"),e=this.dependency.get("data").getActiveSensorKeys();if(null!==e)for(var a=0;a<e.length;a++)e[a].chart&&e[a].chart.updatePositionByPlayIndex(t)},P.prototype.getSensorList=function(){var t=this.dependency.get("data"),e=t.getVid();json_ajax("GET","/clbs/lkyw/trackBack/getPollingList","json",!0,{monitorId:e},function(e){if(e.success){var a=[];e.obj.sensorPollingList&&(a=e.obj.sensorPollingList);for(var n=["0x53","0x00"].concat(a),i=[],r=Object.keys(this.sensorMeta),o=0;o<r.length;o++){for(var s=r[o],l=this.sensorMeta[s],d=l.ids,c={key:s,text:l.text,icon:l.icon,ids:[]},h=0;h<d.length;h++){var p=d[h];n.indexOf(p)>-1&&c.ids.push(p)}c.ids.length>0&&i.push(c)}t.setSensorList(i),t.setActiveSensorKeys(null)}}.bind(this))},P.prototype.initSensorHtml=function(){var t=this.dependency.get("data").getSensorList(),e=$("#sensorWraper");if(e.empty(),null!==t){for(var a='<div class="sensor-item un-active">\n                                        <div class="sensor-icon {{icon}}"></div>\n                                        <div class="sensor-text">{{text}}</div>\n                                    </div>',n=0;n<t.length;n++){var i=t[n];e.append($(a.replace("{{icon}}",i.icon).replace("{{text}}",i.text)))}$("#prevPageIcon").hide(),t.length>9?$("#nextPageIcon").show():$("#nextPageIcon").hide()}},P.prototype.renderChartLine=function(){var t=this.dependency.get("data").getActiveSensorKeys();if($(".sensor-item").addClass("un-active"),null!==t)for(var e=0;e<t.length;e++){var a=t[e].key,n=this.sensorMeta[a];a&&$("."+n.icon).closest(".sensor-item").removeClass("un-active")}var i=$(".chart-item");if(null!==t){var r=function(t){switch(t){case"mileSpeed":this.getMileSpeed();break;case"stopData":this.getStopData();break;case"oilConsumptionData":this.initOilConsumptionHTML();break;case"oilData":this.initOilHTML();break;case"temperaturey":this.initTemperatureyHTML();break;case"humidity":this.initHumidityHTML();break;case"workHour":this.initWorkHourHTML();break;case"reverse":this.getReverse();break;case"ioData":this.getIoData();break;case"weight":this.initWeightHTML();break;case"tire":this.initTireHTML()}};if(0===i.length)for(e=0;e<t.length;e++){a=t[e].key;r.call(this,a)}else{var o=$(".chart-item:eq(0)"),s=this;o.slideUp((function(){$(this).remove();var e=t[1].key;r.call(s,e)}))}}else $(".chart-item").remove()},P.prototype.getMileSpeed=function(){$("#chartContainer").append($(this.chartTmpl.mileSpeed));var t=this.dependency.get("data"),e=t.getVid(),a=t.getStartTime(),n=t.getEndTime(),i=t.getValidSensorFlag(),r=t.getValidClickedIndex(),o=i&&null!=r?i[i]:void 0;json_ajax("GET","/clbs/lkyw/trackBack/getMileAndSpeed","json",!0,{monitorId:e,startTime:a,endTime:n,sensorFlag:o},(function(e){e.success?t.setMileSpeed(e.obj.mileAndSpeed?e.obj.mileAndSpeed:[]):layer.msg(e.exceptionDetailMsg||e.msg)}))},P.prototype.mileSpeedChange=function(){var t=this.dependency.get("data"),e=t.getActiveSensorKeys(),a=t.getMileSpeed(),n=t.getPlayIndex("chart"),i=a.length,r=0,o=0;i>0&&(o=parseFloat(a[0].speed));for(var s=[],l=[],c=0;c<i;c+=1){var h=a[c],p=h.mileage;p=null===p?null:parseFloat(p);var u=h.speed;u=null===u?null:parseFloat(u);var g=new Date(1e3*h.time);if(null!==p&&p<=0){for(var m=null,y=0,f=Math.max(c,i-c-1);y<f;y+=1){var v=a[c-y],b=a[c+y];if(v&&v.mileage>0?m=v:b&&b.mileage>0&&(m=b),null!==m)break}null!==m&&(a[c]=m,p=m.mileage,p=parseFloat(p))}s.push({index:c,date:g,value:p,supply:h.supply,color:null===p?"transparent":"#86cdf3"}),l.push({index:c,date:g,value:u,supply:h.supply,color:null===u?"transparent":"#a3d843"}),u>=o&&(o=u)}i>0&&(r=a[i-1].mileage-a[0].mileage,r=w.toFixed(r,1,!0));var k=w.getLocale("mileage"),T=[{data:s,width:1,label:k,unit:"km",yValueFunc:function(t,e){var a=t.yValue;if(!a)return"---";var n=a.index,i=a.value;if(a.supply)return"无数据";if(null===i)return"无传感器数据";var r=e.data[n].value-e.data[0].value;return r=w.toFixed(r,2,!0),k+": "+r+" km"}},{data:l,width:1,label:w.getLocale("speed"),unit:"km/h",yMinValue:0,yMaxValue:240}];$("#mileText").html(r<0?"-":r),$("#maxSpeedText").html(o);var x=new d("#mileSpeedChart",{series:T,playIndex:n,snap:!0,onDrag:this.onDrag.bind(this),onDragEnd:this.onDragEnd.bind(this)});if(e)for(c=0;c<e.length;c++){"mileSpeed"===e[c].key&&(e[c].chart=x)}},P.prototype.getStopData=function(){$("#chartContainer").append($(this.chartTmpl.stopData));var t=this.dependency.get("data"),e=t.getVid(),a=t.getStartTime(),n=t.getEndTime(),i=t.getValidSensorFlag(),r=t.getValidClickedIndex(),o=i&&null!=r?i[i]:void 0;json_ajax("GET","/clbs/lkyw/trackBack/getTravelAndStop","json",!0,{monitorId:e,startTime:a,endTime:n,sensorFlag:o},(function(e){e.success?t.setStopData(e.obj.travelAndStop?e.obj.travelAndStop:[]):layer.msg(e.exceptionDetailMsg||e.msg)}))},P.prototype.stopDataChange=function(){var t,e=this.dependency.get("data"),a=e.getActiveSensorKeys(),n=e.getStopData(),i=e.getAllOrRunData(),r=e.getPositions(),o=e.getPositionsTmp(),s=e.getPlayIndex("chart"),l=e.getParaScale(),h=n.concat([{x:Math.random()}]),p="run"===i?o:r,u=h.length,g=[],m=0,y=0,f=[],v=0,b=0,k=0,T=[],x=0;if(u>0){for(var S={},P=h[0].status,C=0,D=0,I=0;I<u;I+=1){var M=h[I],A=M.status,L=M.time;if(I<u-1){var W={};W.date=new Date(1e3*L),W.value=1,W.supply=M.supply,W.index=I,W.color=null===(t=A)?"lightgray":"1"===t?"#a3d843":"#ff9999",W.type=A,g.push(W)}if(null!==A){var F=h[I].time-h[D].time;if(A!==P||F>300){var O=S[P],R=D,N=h[R].time-h[C].time,E=h[R].mileage-h[C].mileage;F<=300&&(N=h[R=I].time-h[C].time,E=h[R].mileage-h[C].mileage);var z=l(C,"toOrigin"),_=l(R,"toOrigin"),H={startIndex:C,endIndex:R,timeLength:N,mileageLength:E,startTime:h[C].time,endTime:h[R].time,originStartIndex:z,originEndIndex:_,monitorName:p[z].plateNumber,originStartTime:1e3*p[z].vtime,startLongtitude:p[z].longitude,startLatitude:p[z].latitude,originEndTime:1e3*p[_].vtime,endLongtitude:p[_].longitude,endLatitude:p[_].latitude,deviceNumber:p[z].deviceNumber,simcardNumber:p[z].simCard,useOil:this.getUseOil(z,_,p),consumeOil:this.getConsumeOil(z,_,p)};O?(O.occurrence+=1,O.totalTimeLength+=N,O.totalMileageLength+=E,O.segment.push(H)):S[P]={type:P,occurrence:1,totalTimeLength:N,totalMileageLength:E,segment:[H]},P=A,C=I}D=I}}S[2]&&(m=S[2].totalTimeLength,v=S[2].totalMileageLength,y=S[2].occurrence,f=S[2].segment),S[1]&&(b=S[1].totalTimeLength,x=S[1].totalMileageLength,k=S[1].occurrence,T=S[1].segment)}if("run"!==i&&e.setStopTypeDict(S),new c("#progressBack",{series:[{width:8,autoConnectPartition:"AFTER",data:g}]}),this.dependency.get("progressBar").setOptions({min:0,max:null===n?0:n.length-1}),null!==a){var V=[{data:g,width:3,label:w.getLocale("runAndStop"),unit:"h",stopTimeArr:f,runTimeArr:T,autoConnectPartition:"AFTER",yValueFunc:function(t,e){var a=t.yValue;if(!a)return"---";var n=a.index,i=a.type;if(a.supply)return"无数据";if(null===i)return"无传感器数据";var r=e.stopTimeArr,o=e.runTimeArr;if("1"==i)for(var s=0;s<o.length;s+=1){if((d=o[s]).startIndex<=n&&n<=d.endIndex)return"行驶: "+w.getTextFromSecond(d.timeLength)+"\n里程: "+w.toFixed(d.mileageLength,1,!0)+" km"}for(var l=0;l<r.length;l+=1){var d;if((d=r[l]).startIndex<=n&&n<=d.endIndex)return"停止: "+w.getTextFromSecond(d.timeLength)+"\n怠速: "+w.toFixed(d.mileageLength,1,!0)+" km"}return"---"},yMinValue:0,yMaxValue:1.8}];$("#runTimesText").html(k),$("#runMilesText").html(w.toFixed(x,1,!0)),$("#runTimeText").html(w.getHTMLFromSecond(b)),$("#stopTimesText").html(y),$("#stopMilesText").html(w.toFixed(v,1,!0)),$("#stopTimeText").html(w.getHTMLFromSecond(m));var j=new d("#stopDataChart",{series:V,playIndex:s,snap:!0,onDrag:this.onDrag.bind(this),onDragEnd:this.onDragEnd.bind(this)});for(I=0;I<a.length;I++){"stopData"===a[I].key&&(a[I].chart=j)}}},P.prototype.getUseOil=function(t,e,a){var n=0;w.isEmpty(a[t].oilTankOne)||(n+=w.tryParseFloat(a[t].oilTankOne)),w.isEmpty(a[t].oilTankTwo)||(n+=w.tryParseFloat(a[t].oilTankTwo)),w.isEmpty(a[e].oilTankOne)||(n-=w.tryParseFloat(a[e].oilTankOne)),w.isEmpty(a[e].oilTankTwo)||(n-=w.tryParseFloat(a[e].oilTankTwo));for(var i=t;i<=e;i++)w.isEmpty(a[i].fuelAmountOne)||(n+=w.tryParseFloat(a[i].fuelAmountOne)),w.isEmpty(a[i].fuelAmountTwo)||(n+=w.tryParseFloat(a[i].fuelAmountTwo)),w.isEmpty(a[i].fuelSpillOne)||(n-=w.tryParseFloat(a[i].fuelSpillOne)),w.isEmpty(a[i].fuelSpillTwo)||(n-=w.tryParseFloat(a[i].fuelSpillTwo));return n},P.prototype.getConsumeOil=function(t,e,a){var n=0;return w.isEmpty(a[t].totalOilwearOne)||(n-=w.tryParseFloat(a[t].totalOilwearOne)),w.isEmpty(a[t].totalOilwearTwo)||(n-=w.tryParseFloat(a[t].totalOilwearTwo)),w.isEmpty(a[e].totalOilwearOne)||(n+=w.tryParseFloat(a[e].totalOilwearOne)),w.isEmpty(a[e].totalOilwearTwo)||(n+=w.tryParseFloat(a[e].totalOilwearTwo)),n},P.prototype.initOilHTML=function(){$("#chartContainer").append($(this.chartTmpl.oilData));for(var t=this.dependency.get("data"),e=t.getSensorList(),a=$("#oilDataSelect"),n=0;n<e.length;n++){var i=e[n];if("oilData"===i.key)for(var r=0;r<i.ids.length;r++){var o=i.ids[r]-64;a.append($('<option value="'+(r+1)+'">'+o+"#</option>"))}}a.on("change",(function(){t.setOilSensorNo($(this).val())})),t.setOilSensorNo(1)},P.prototype.getOilData=function(){var t=this.dependency.get("data"),e=t.getVid(),a=t.getStartTime(),n=t.getEndTime(),i=t.getValidSensorFlag(),r=t.getValidClickedIndex(),o=i&&null!=r?i[i]:void 0;json_ajax("GET","/clbs/lkyw/trackBack/getOilMass","json",!0,{monitorId:e,startTime:a,endTime:n,sensorFlag:o},(function(e){e.success?t.setOilData(e.obj.oilMass?e.obj.oilMass:[]):layer.msg(e.exceptionDetailMsg||e.msg)}))},P.prototype.oilDataChange=function(){for(var t=this.dependency.get("data"),e=t.getActiveSensorKeys(),a=t.getOilData(),n=t.getOilSensorNo()-1,i=t.getPlayIndex("chart"),r=a.length,o=0,s=0,l=0,c=[],h=[],p=0;p<r;p+=1){var u=a[p],g=u.oilTank[n];if(null===(g=null==g?null:parseFloat(g))||g<=.5){var m=null;if(0===p||p===r-1)for(var y=0,f=Math.max(p,r-p-1);y<f;y+=1){var v=a[p-y],b=a[p+y];if(v&&v.oilTank[n]>.5?m=v:b&&b.oilTank[n]>.5&&(m=b),null!=m)break}else a[p-1]&&a[p-1].oilTank[n]>.5&&(m=a[p-1]);null!=m&&(a[p]=m,g=m.oilTank[n],g=w.isEmpty(g)?0:parseFloat(g))}var k=null==g?"transparent":"#e88031",T=u.fuelAmount[n],x=u.fuelSpill[n];null!=T&&(o+=T=parseFloat(T)),null!=x&&(s+=x=parseFloat(x));var S={index:p,date:new Date(1e3*u.time),value:g,supply:u.supply,color:k,fuelAmount:T,fuelSpill:x};c.push(S),T>0&&h.push({x:p,color:"green"}),x>0&&h.push({x:p,color:"red"})}var P=[{data:c,width:1,label:w.getLocale("oilDataText"),dott:h,yValueFunc:function(t,e){if(!t.yValue)return"---";if(t.yValue.supply)return"无数据";if(null===t.yValue.value)return"无传感器数据";var a=t.yValue.fuelAmount,n=t.yValue.fuelSpill;return a>0?t.text+"\n"+w.getLocale("addOil")+a+e.unit:n>0?t.text+"\n"+w.getLocale("reduceOil")+n+e.unit:w.getLocale("leftOil")+" "+t.text},unit:"L",yMinValue:0}];if(a.length>0){var C=a[0].oilTank[n],D=a[a.length-1].oilTank[n],I=C-D;null!=C&&null!=D||(I=0),l=I+o-s}$("#addOilText").html(w.toFixed(o,1,!0)),$("#spillOilText").html(w.toFixed(s,1,!0)),$("#useOilText").html(w.toFixed(l,1,!0));var M=new d("#oilDataChart",{series:P,playIndex:i,snap:!0,onDrag:this.onDrag.bind(this),onDragEnd:this.onDragEnd.bind(this)});for(p=0;p<e.length;p++){"oilData"===e[p].key&&(e[p].chart=M)}},P.prototype.initOilConsumptionHTML=function(){$("#chartContainer").append($(this.chartTmpl.oilConsumptionData));for(var t=this.dependency.get("data"),e=t.getSensorList(),a=$("#oilConsumptionDataSelect"),n=0;n<e.length;n++){var i=e[n];if("oilConsumptionData"===i.key)for(var r=0;r<i.ids.length;r++){var o=i.ids[r]-68;a.append($('<option value="'+o+'">'+o+"#</option>"))}}a.on("change",(function(){t.setOilConsumptionSensorNo($(this).val())})),t.setOilConsumptionSensorNo(1)},P.prototype.getOilConsumptionData=function(){var t=this.dependency.get("data"),e=t.getVid(),a=t.getStartTime(),n=t.getEndTime(),i=t.getValidSensorFlag(),r=t.getValidClickedIndex(),o=i&&null!=r?i[i]:void 0,s=t.getOilConsumptionSensorNo();json_ajax("POST","/clbs/lkyw/trackBack/getOilConsumptionChartData","json",!0,{vehicleId:e,startTime:a,endTime:n,sensorFlag:o,sensorNo:s},(function(e){e.success?t.setOilConsumptionData(e.obj.sensorDataList?e.obj.sensorDataList:[]):layer.msg(e.exceptionDetailMsg||e.msg)}))},P.prototype.oilConsumptionDataChange=function(){for(var t=this.dependency.get("data"),e=t.getActiveSensorKeys(),a=t.getOilConsumptionData(),n=t.getPlayIndex("chart"),i=a.length,r=0,o=0,s=[],l=0;l<i;l+=1){var c="#e88031",h=a[l],p=h.oilWear;if(null===p)c="transparent";else if((p=parseFloat(p))<=0){var u=null;if(0===l||l===i-1)for(var g=1,m=Math.max(l,i-l-1);g<m;g+=1){var y=a[l-g],f=a[l+g];if(y&&y.oilWear>0?u=y:f&&f.oilWear>0&&(u=f),null!==u)break}else a[l-1]&&a[l-1].oilWear>0&&(u=a[l-1]);null!==u&&(a[l]=u,p=u.oilWear,p=w.isEmpty(p)?0:parseFloat(p))}s.push({index:l,date:new Date(1e3*h.time),value:p,supply:h.supply,color:c})}if(i>0){var v=null,b=null;for(l=0;l<i&&(null!==v||w.isEmpty(a[l].oilWear)||(v=l),null!==b||w.isEmpty(a[i-l-1].oilWear)||(b=i-l-1),null===v||null===b);l+=1);if(null!==v&&null!==b){var k=w.tryParseFloat(a[v].oilWear,0),T=w.tryParseFloat(a[b].oilWear,0),x=w.tryParseFloat(a[v].mileage,0),S=w.tryParseFloat(a[b].mileage,0);r=T-k,S-x==0?o="--":(o=(T-k)/(S-x)*100,o=w.toFixed(o,1,!0))}}var P=[{data:s,width:1,label:w.getLocale("oilConsumption"),unit:"L",yValueFunc:function(t){var e=t.yValue;return e?e.supply?"无数据":null===e.value?"无传感器数据":e.value+" L":"---"}}];$("#oilConsumptionText").html(w.toFixed(r,1,!0)),$("#oilConsumption100Text").html(w.toFixed(o,1,!0));var C=new d("#oilConsumptionDataChart",{series:P,playIndex:n,snap:!0,rectHeight:22,onDrag:this.onDrag.bind(this),onDragEnd:this.onDragEnd.bind(this)});for(l=0;l<e.length;l++){"oilConsumptionData"===e[l].key&&(e[l].chart=C)}},P.prototype.initTemperatureyHTML=function(){$("#chartContainer").append($(this.chartTmpl.temperaturey));for(var t=this.dependency.get("data"),e=t.getSensorList(),a=$("#temperatureySelect"),n=0;n<e.length;n++){var i=e[n];if("temperaturey"===i.key)for(var r=0;r<i.ids.length;r++){var o=i.ids[r]-32;a.append($('<option value="'+o+'">'+o+"#</option>"))}}a.on("change",(function(){t.setTemperatureySensorNo($(this).val())})),t.setTemperatureySensorNo(1)},P.prototype.getTemperaturey=function(){var t=this.dependency.get("data"),e=t.getVid(),a=t.getStartTime(),n=t.getEndTime(),i=t.getValidSensorFlag(),r=t.getValidClickedIndex(),o=i&&null!=r?i[i]:void 0,s=t.getTemperatureySensorNo();json_ajax("POST","/clbs/lkyw/trackBack/getTemperatureChartData","json",!0,{vehicleId:e,startTime:a,endTime:n,sensorFlag:o,sensorNo:s},(function(e){e.success?t.setTemperaturey(e.obj?e.obj:{}):layer.msg(e.exceptionDetailMsg||e.msg)}))},P.prototype.temperatureyChange=function(){var t,e=this.dependency.get("data"),a=e.getActiveSensorKeys(),n=e.getTemperaturey(),i=e.getPlayIndex("chart"),r=n.sensorDataList,o=r.length,s=null,l=null;if(r){var c=[];n.highTemperatureThreshold&&c.push({value:parseFloat(n.highTemperatureThreshold),color:"red"}),n.lowTemperatureThreshold&&c.push({value:parseFloat(n.lowTemperatureThreshold),color:"red"});for(var h=[],p=0;p<o;p+=1){var u=r[p],g=u.temperature,m={index:p,date:new Date(1e3*u.time),value:g,supply:u.supply,color:null!==g?"#962219":"transparent"};h.push(m),null!==g&&(null===s?(s=g,l=g):(g>=s&&(s=g),g<=l&&(l=g)))}t=[{data:h,width:1,label:w.getLocale("tempText"),unit:"℃",yValueFunc:function(t){return t.yValue?t.yValue.supply?"无数据":null===t.yValue.value?"无传感器数据":t.text:"---"},line:c,yMinValue:Math.min(-55,n.minTemperature),yMaxValue:Math.max(125,n.maxTemperature)}],s=null===s?"--":w.toFixed(s,1,!0),l=null===l?"--":w.toFixed(l,1,!0)}else t=null,s="--",l="--";$("#highestTempText").html(null==n.maxTemperature?"--":n.maxTemperature),$("#lowestTempText").html(null==n.minTemperature?"--":n.minTemperature);var y=new d("#temperatureyChart",{series:t,playIndex:i,snap:!0,rectHeight:22,onDrag:this.onDrag.bind(this),onDragEnd:this.onDragEnd.bind(this)});for(p=0;p<a.length;p++){"temperaturey"===a[p].key&&(a[p].chart=y)}},P.prototype.initHumidityHTML=function(){$("#chartContainer").append($(this.chartTmpl.humidity));for(var t=this.dependency.get("data"),e=t.getSensorList(),a=$("#humiditySelect"),n=0;n<e.length;n++){var i=e[n];if("humidity"===i.key)for(var r=0;r<i.ids.length;r++){var o=i.ids[r]-37;a.append($('<option value="'+o+'">'+o+"#</option>"))}}a.on("change",(function(){t.setHumiditySensorNo($(this).val())})),t.setHumiditySensorNo(1)},P.prototype.getHumidity=function(){var t=this.dependency.get("data"),e=t.getVid(),a=t.getStartTime(),n=t.getEndTime(),i=t.getValidSensorFlag(),r=t.getValidClickedIndex(),o=i&&null!=r?i[i]:void 0,s=t.getHumiditySensorNo();json_ajax("POST","/clbs/lkyw/trackBack/getHumidityChartData","json",!0,{vehicleId:e,startTime:a,endTime:n,sensorFlag:o,sensorNo:s},(function(e){e.success?t.setHumidity(e.obj?e.obj:{}):layer.msg(e.exceptionDetailMsg||e.msg)}))},P.prototype.humidityChange=function(){var t,e=this.dependency.get("data"),a=e.getActiveSensorKeys(),n=e.getHumidity(),i=e.getPlayIndex("chart"),r=n.sensorDataList,o=r.length,s=null,l=null;if(r){var c=[];null!==n.highHumidityThreshold&&c.push({value:n.highHumidityThreshold,color:"red"}),null!==n.lowHumidityThreshold&&c.push({value:n.lowHumidityThreshold,color:"red"});for(var h=[],p=0;p<o;p+=1){var u=r[p],g=u.humidity,m={index:p,date:new Date(1e3*u.time),value:g,supply:u.supply,color:null!==g?"#962219":"transparent"};h.push(m),null!==g&&(null===s?(s=g,l=g):g>=s?s=g:l=g)}t=[{data:h,color:"skyblue",width:1,label:w.getLocale("humidityText"),unit:"%",yValueFunc:function(t){return t.yValue?t.yValue.supply?"无数据":null===t.yValue.value?"无传感器数据":t.text:"---"},line:c,yMinValue:Math.min(0,n.minHumidity),yMaxValue:Math.min(100,n.maxHumidity)}],s=null===s?"--":w.toFixed(s,1,!0),l=null===l?"--":w.toFixed(l,1,!0)}else t=null,s="--",l="--";$("#highestHumiText").html(null==n.maxHumidity?"--":n.maxHumidity),$("#lowestHumiText").html(null==n.minHumidity?"--":n.minHumidity);var y=new d("#humidityChart",{series:t,playIndex:i,snap:!0,rectHeight:22,onDrag:this.onDrag.bind(this),onDragEnd:this.onDragEnd.bind(this)});for(p=0;p<a.length;p++){"humidity"===a[p].key&&(a[p].chart=y)}},P.prototype.initWorkHourHTML=function(){$("#chartContainer").append($(this.chartTmpl.workHour));for(var t=this.dependency.get("data"),e=t.getSensorList(),a=$("#workHourSelect"),n=0;n<e.length;n++){var i=e[n];if("workHour"===i.key)for(var r=0;r<i.ids.length;r++){var o=i.ids[r]-127;a.append($('<option value="'+o+'">'+o+"#</option>"))}}a.on("change",(function(){t.setWorkHourSensorNo($(this).val())})),t.setWorkHourSensorNo(1)},P.prototype.getWorkHour=function(){var t=this.dependency.get("data"),e=t.getVid(),a=t.getStartTime(),n=t.getEndTime(),i=t.getValidSensorFlag(),r=t.getValidClickedIndex(),o=i&&null!=r?i[i]:void 0,s=t.getWorkHourSensorNo();json_ajax("POST","/clbs/lkyw/trackBack/getWorkHourChartData","json",!0,{vehicleId:e,startTime:a,endTime:n,sensorFlag:o,sensorNo:s},(function(e){e.success?t.setWorkHour(e.obj?e.obj:{}):layer.msg(e.exceptionDetailMsg||e.msg)}))},P.prototype.workHourChange=function(){var t=this.dependency.get("data"),e=t.getActiveSensorKeys(),a=t.getMileSpeed(),n=t.getWorkHour(),i=t.getPlayIndex("chart"),r=n.workHourInfo,o=r.length,s=n.workInspectionMethod,l=null,c="--",h="--",p="--";if(r){c=n.workDuration,h=n.standByDuration,p=n.haltDuration;for(var u={0:"#5a5a5a",1:"#606dcf",2:"#deb741",null:"transparent"},g=function(t){return 1===t.type?u[t.workingPosition]:"transparent"},m=function(t){var e=t.checkData;return 2==t.type||null==e?null:parseFloat(e)},y=0,f=[],v=0;v<o;v+=1){var b=r[v],k=m(b);f.push({index:v,date:new Date(1e3*b.time),value:k,supply:b.supply,color:g(b),validate:b.type}),k>y&&(y=k)}if(1===s)l=[{data:f,width:1,label:w.getLocale("voltage"),unit:"V",autoConnectPartition:"AFTER",yValueFunc:function(t){return t.yValue?t.yValue.supply?"无数据":null===t.yValue.value?"无传感器数据":t.text:"---"},yMinValue:0,yMaxValue:y+10}],null!=(T=n.thresholdValue)&&(l[0].line=[{value:parseFloat(T),color:"darkgray"}],l[0].yMaxValue=Math.max(l[0].yMaxValue,parseFloat(T)+10));else if(2===s){var T;l=[{data:f,width:1,label:w.getLocale("secondFlow"),unit:"L/h",autoConnectPartition:"AFTER",yValueFunc:function(t){return t.yValue?t.yValue.supply?"无数据":null===t.yValue.value?"无传感器数据":t.text:"---"},yMinValue:0,yMaxValue:y+10}],null!=(T=n.thresholdValue)&&(l[0].line=[{value:parseFloat(T),color:"darkgray"}],l[0].yMaxValue=Math.max(l[0].yMaxValue,parseFloat(T)+10))}else l=[{data:f,width:1,label:w.getLocale("secondFlow"),unit:"L/h",autoConnectPartition:"AFTER",yMinValue:0,yMaxValue:y+10,yValueFunc:function(t){return t.yValue?t.yValue.supply?"无数据":null===t.yValue.value?"无传感器数据":t.text:"---"}},{data:a.map((function(t,e){var a=t.speed;return{index:e,date:new Date(1e3*t.time),value:null===a?null:parseFloat(a),color:null===a?"transparent":"#a3d843"}})),width:1,label:w.getLocale("speed"),unit:"km/h",yMinValue:0,yMaxValue:240}];c=w.getHTMLFromSecond(c),h=w.getHTMLFromSecond(h),p=w.getHTMLFromSecond(p)}$("#validWorkHourText").html(c),2!==s&&3!==s||$("#waitWorkHourText").html(h),$("#stopWorkHourText").html(p);var x=new d("#workHourChart",{series:l,playIndex:i,snap:!0,onDrag:this.onDrag.bind(this),onDragEnd:this.onDragEnd.bind(this)});for(v=0;v<e.length;v++){"workHour"===e[v].key&&(e[v].chart=x)}},P.prototype.getReverse=function(){$("#chartContainer").append($(this.chartTmpl.reverse));var t=this.dependency.get("data"),e=t.getVid(),a=t.getStartTime(),n=t.getEndTime(),i=t.getValidSensorFlag(),r=t.getValidClickedIndex(),o=i&&null!=r?i[i]:void 0;json_ajax("POST","/clbs/lkyw/trackBack/getPositiveInversionDate","json",!0,{monitorId:e,startTime:a,endTime:n,sensorFlag:o},(function(e){e.success?t.setReverse(e.obj?e.obj:[]):layer.msg(e.exceptionDetailMsg||e.msg)}))},P.prototype.reverseChange=function(){for(var t=this.dependency.get("data"),e=t.getActiveSensorKeys(),a=t.getReverse(),n=t.getPlayIndex("chart"),i=a.length,r={1:"#2a5eee",2:"#f9cc42",3:"#e14877",null:"transparent"},o=0,s=0,l=0,c=0,h=null,p=null,u=null,g=[],m=0,y=[],f=0,v=[],b=0;b<i;b+=1){var k=a[b],T={},x=k.orientation,S=k.time,P=k.rotationStatus;"1"===P&&(x=3),null===x||3===x||b===i-1?1===h?(o+=l=a[1===x?b:b-1].time-p,g.push({startIndex:m,endIndex:1===x?b:b-1,timeLength:l})):2===h&&(s+=c=a[2===x?b:b-1].time-u,y.push({startIndex:f,endIndex:2===x?b:b-1,timeLength:c})):1===x?2!==h&&null!==h&&3!==h||(p=S,m=b,2===h&&(s+=c=a[b-1].time-u,y.push({startIndex:f,endIndex:b-1,timeLength:c}))):2===x&&(1!==h&&null!==h&&3!==h||(u=S,f=b,1===h&&(o+=l=a[b-1].time-p,g.push({startIndex:m,endIndex:b-1,timeLength:l})))),h=x,T.date=0===S?null:new Date(1e3*S),T.value=1,T.supply=k.supply,T.rotationStatus=P,T.index=b,T.color=r[x],T.type=x,v.push(T)}var C=[{data:v,width:3,label:w.getLocale("reverseText"),unit:"h",upTimeArr:g,downTimeArr:y,autoConnectPartition:"AFTER",yValueFunc:function(t,e){var a=t.yValue;if(!a)return"---";if(a.supply)return"无数据";if(null===a.rotationStatus)return"无传感器数据";var n=a.index,i=a.type;if(null===a.date)return w.getLocale("noData");var r=e.upTimeArr,o=e.downTimeArr;if(1===i)for(var s=0;s<r.length;s+=1){if((l=r[s]).startIndex<=n&&n<=l.endIndex)return w.getLocale("upRotate")+"\n"+w.getTextFromSecond(l.timeLength)}else if(2===i)for(s=0;s<o.length;s+=1){var l;if((l=o[s]).startIndex<=n&&n<=l.endIndex)return w.getLocale("downRotate")+"\n"+w.getTextFromSecond(l.timeLength)}else{if(3===i)return w.getLocale("stopRorate");if(null===i)return"无传感器数据"}return"---"},yMinValue:0,yMaxValue:1.8}];$("#totalUpTimeText").html(w.getHTMLFromSecond(o)),$("#totalDownTimeText").html(w.getHTMLFromSecond(s));var D=new d("#reverseChart",{series:C,playIndex:n,snap:!0,onDrag:this.onDrag.bind(this),onDragEnd:this.onDragEnd.bind(this)});for(b=0;b<e.length;b++){"reverse"===e[b].key&&(e[b].chart=D)}},P.prototype.getIoData=function(){$("#chartContainer").append($(this.chartTmpl.ioData));var t=this.dependency.get("data"),e=t.getVid(),a=t.getStartTime(),n=t.getEndTime(),i=t.getValidSensorFlag(),r=t.getValidClickedIndex(),o=i&&null!=r?i[i]:void 0;t.getSensorList();json_ajax("GET","/clbs/lkyw/trackBack/getSwitchData","json",!0,{monitorId:e,startTime:a,endTime:n,sensorFlag:o},(function(e){if(e.success){for(var a=$("#ioDataSelect"),n=0;n<e.obj.names.length;n++)a.append($('<option value="'+n+'">'+e.obj.names[n]+"</option>"));a.on("change",(function(){t.setIoDataSensorNo($(this).val())})),t.setIoData(e.obj?e.obj:{}),t.setIoDataSensorNo(0)}else layer.msg(e.exceptionDetailMsg||e.msg)}))},P.prototype.ioDataChange=function(){var t,e=this.dependency.get("data"),a=e.getActiveSensorKeys(),n=e.getIoData(),i=e.getIoDataSensorNo(),r=(i=e.getIoDataSensorNo(),e.getPlayIndex("chart")),o=n.alarmStatuses[i],s=n.IOStatus[i][1],l=n.IOStatus[i][0],c=0,h=0,p=function(t){if(null===t)return"transparent";if(o.length>0&&null!==t){if(0===t&&"2"===o)return"#f40505";if(1===t&&"1"===o)return"#f40505"}return 0===t?"#000000":"#709fa8"},u=0,g=0,m=null,y=null,f=null,v=[],b=0,k=[],T=0,x=[];if(!w.isEmpty(n)&&n.data){for(var S=n.data,P=n.data.length,C=0;C<P;C+=1){var D=S[C],I={},M=D.statuses[i];2===M&&(M=null);var A=D.time;null===M||C===P-1?1===m?(c+=u=S[1===M?C:C-1].time-y,v.push({startIndex:b,endIndex:1===M?C:C-1,timeLength:u})):0===m&&(h+=g=S[0===M?C:C-1].time-f,k.push({startIndex:T,endIndex:0===M?C:C-1,timeLength:g})):1===M?0!==m&&null!==m||(y=A,b=C,0===m&&(h+=g=S[C-1].time-f,k.push({startIndex:T,endIndex:C-1,timeLength:g}))):0===M&&(1!==m&&null!==m||(f=A,T=C,1===m&&(c+=u=S[C-1].time-y,v.push({startIndex:b,endIndex:C-1,timeLength:u})))),m=M,I.date=0===A?null:new Date(1e3*A),I.value=1,I.supply=D.supply,I.index=C,I.color=p(M),I.type=M,x.push(I)}c=w.getHTMLFromSecond(c,1,!0),h=w.getHTMLFromSecond(h,1,!0)}else t=null,c="--",h="--";t=[{data:x,width:3,label:w.getLocale("io"),unit:"h",upTimeArr:v,downTimeArr:k,autoConnectPartition:"AFTER",yValueFunc:function(t,e){var a=t.yValue;if(!a)return"---";var n=a.index,i=a.type,r=a.date;if(a.supply)return"无数据";if(null===i)return"无传感器数据";var o=e.upTimeArr,d=e.downTimeArr;if(null===r)return w.getLocale("noData");if(1==i)for(var c=0;c<o.length;c+=1){if((p=o[c]).startIndex<=n&&n<=p.endIndex)return s+"\n"+w.getTextFromSecond(p.timeLength)}for(var h=0;h<d.length;h+=1){var p;if((p=d[h]).startIndex<=n&&n<=p.endIndex)return l+"\n"+w.getTextFromSecond(p.timeLength)}return"---"}}],$("#ioUpText").html(s),$("#ioDownText").html(l),$("#ioTotalUpText").html(c),$("#ioTotalDownText").html(h),$("#ioUpRect").css("backgroundColor","#709fa8"),$("#ioDownRect").css("backgroundColor","#000000");var L=new d("#ioDataChart",{series:t,playIndex:r,snap:!0,rectColorFunc:function(t){var e=t.color;return"transparent"===e?null:e},onDrag:this.onDrag.bind(this),onDragEnd:this.onDragEnd.bind(this)});for(C=0;C<a.length;C++){"ioData"===a[C].key&&(a[C].chart=L)}},P.prototype.initWeightHTML=function(){$("#chartContainer").append($(this.chartTmpl.weight));for(var t=this.dependency.get("data"),e=t.getSensorList(),a=$("#weightSelect"),n=[],i=0;i<e.length;i++){var r=e[i];if("weight"===r.key)for(var o=0;o<r.ids.length;o++){var s=r.ids[o]-111;n.push(s),a.append($('<option value="'+s+'">'+s+"#</option>"))}}a.on("change",(function(){t.setWeightSensorNo($(this).val())})),n.length>0&&t.setWeightSensorNo(n[0])},P.prototype.getWeight=function(){var t=this.dependency.get("data"),e=t.getVid(),a=t.getStartTime(),n=t.getEndTime(),i=t.getValidSensorFlag(),r=t.getValidClickedIndex(),o=i&&null!=r?i[i]:void 0,s=t.getWeightSensorNo();json_ajax("POST","/clbs/lkyw/trackBack/getLoadWeight","json",!0,{vehicleId:e,startTime:a,endTime:n,sensorFlag:o,sensorNo:s},(function(e){e.success?t.setWeight(e.obj?e.obj:{}):layer.msg(e.exceptionDetailMsg||e.msg)}))},P.prototype.weightChange=function(){var t=this.dependency.get("data"),e=t.getActiveSensorKeys(),a=t.getWeight(),n=t.getPlayIndex("chart"),i=a.sensorDataList.concat([{x:Math.random()}]),r=i.length,o=[],s=0,l=0,c=0,h=0,p=0,u=a.maxLoadWeight;a.overLoadValue>u&&(u=a.overLoadValue);var g,m=u>1e3?"T":"kg";if(r>0){for(var y={},f=i[0].status,v=0,b=0,k=0;k<r;k+=1){var T=(O=i[k]).status,x=O.time;if(k<r-1){var S={};S.date=new Date(1e3*x),S.value="T"===m?w.toFixed(O.weight/1e3,1,!0):O.weight,S.supply=O.supply,S.index=k,S.color=null===(g=T)?"lightgray":"1"===g?"#cdcdcd":"6"===g?"#bddbff":"2"===g?"#8b84eb":"7"===g?"#95b6f2":"3"===g?"#f8a023":"#ffffff",S.type=T,o.push(S)}if(null!==T){var P=i[k].time-i[b].time;if(T!==f||P>300){var C=y[f],D=b,I=i[D].time-i[v].time;P<=300&&(I=i[D=k].time-i[v].time);var M={startIndex:v,endIndex:D,timeLength:I,startTime:i[v].time,endTime:i[D].time};C?(C.occurrence+=1,C.totalTimeLength+=I,C.segment.push(M)):y[f]={type:f,occurrence:1,totalTimeLength:I,segment:[M]},f=T,v=k}b=k}}y[1]&&(s=y[1].totalTimeLength),y[2]&&(l=y[2].totalTimeLength),y[3]&&(c=y[3].totalTimeLength),y[6]&&(h=y[6].totalTimeLength),y[7]&&(p=y[7].totalTimeLength)}var A=[],L=[];if(null!==a.noLoadValue&&void 0!==a.noLoadValue){var W="T"===m?w.toFixed(a.noLoadValue/1e3,1,!0):a.noLoadValue;A.push({value:parseFloat(W),color:"red"}),L.push(W)}if(null!==a.lightLoadValue&&void 0!==a.lightLoadValue){W="T"===m?w.toFixed(a.lightLoadValue/1e3,1,!0):a.lightLoadValue;A.push({value:parseFloat(W),color:"red"}),L.push(W)}if(null!==a.fullLoadValue&&void 0!==a.fullLoadValue){W="T"===m?w.toFixed(a.fullLoadValue/1e3,1,!0):a.fullLoadValue;A.push({value:parseFloat(W),color:"red"}),L.push(W)}if(null!==a.overLoadValue&&void 0!==a.overLoadValue){W="T"===m?w.toFixed(a.overLoadValue/1e3,1,!0):a.overLoadValue;A.push({value:parseFloat(W),color:"red"}),L.push(W)}var F="T"===m?w.toFixed(a.maxLoadWeight/1e3,1,!0):a.maxLoadWeight;for(k=0;k<L.length;k+=1){var O;(O=L[k])>F&&(F=O)}var R=new d("#weightChart",{series:[{data:o,width:1,label:"重量("+m+")",unit:m,autoConnectPartition:"BEFORE",yValueFunc:function(t){return t.yValue?t.yValue.supply?"无数据":null===t.yValue.value?"无传感器数据":t.text:"---"},line:A,yMinValue:0,yMaxValue:F}],playIndex:n,snap:!0,rectHeight:22,onDrag:this.onDrag.bind(this),onDragEnd:this.onDragEnd.bind(this)});$("#emptyText").html(null==s?"--":w.getHTMLFromSecond(s)),$("#lightText").html(null==h?"--":w.getHTMLFromSecond(h)),$("#heavyText").html(null==p?"--":w.getHTMLFromSecond(p)),$("#fullText").html(null==l?"--":w.getHTMLFromSecond(l)),$("#overText").html(null==c?"--":w.getHTMLFromSecond(c));for(k=0;k<e.length;k++){"weight"===e[k].key&&(e[k].chart=R)}},P.prototype.initTireHTML=function(){$("#chartContainer").append($(this.chartTmpl.tire));for(var t=this.dependency.get("data"),e=t.getTireNumList(),a=$("#tireSelect"),n=0;n<e.length;n++){var i=e[n];a.append($('<option value="'+i+'">'+i+"#</option>"))}a.on("change",(function(){t.setTireNum($(this).val())})),t.setTireNum(1)},P.prototype.getTire=function(){var t=this.dependency.get("data"),e=t.getVid(),a=t.getStartTime(),n=t.getEndTime(),i=t.getValidSensorFlag(),r=t.getValidClickedIndex(),o=i&&null!=r?i[i]:void 0,s=t.getTireNum();json_ajax("POST","/clbs/lkyw/trackBack/getTirePressureData","json",!0,{vehicleId:e,startTime:a,endTime:n,sensorFlag:o,tireNum:s},(function(e){e.success?t.setTire(e.obj?e.obj:{}):layer.msg(e.exceptionDetailMsg||e.msg)}))},P.prototype.tireChange=function(){var t,e=this.dependency.get("data"),a=e.getActiveSensorKeys(),n=e.getTire(),i=e.getPlayIndex("chart"),r=n.sensorDataList,o=r.length,s=null,l=null;if(r){var c=[];n.heighPressure&&c.push({value:parseFloat(n.heighPressure),color:"red"}),n.lowPressure&&c.push({value:parseFloat(n.lowPressure),color:"red"});for(var h=[],p=0;p<o;p+=1){var u=r[p],g=u.pressure,m={index:p,date:new Date(1e3*u.time),value:g,supply:u.supply,color:null!==g?"#5fcc97":"transparent"};h.push(m)}var y=n.maxTirePressure;n.heighPressure>y&&(y=n.heighPressure),null==y&&(y=100),t=[{data:h,width:1,label:"胎压(bar)",unit:"bar",yValueFunc:function(t){return t.yValue?t.yValue.supply?"无数据":null===t.yValue.value?"无传感器数据":t.text:"---"},line:c,yMinValue:0,yMaxValue:y}],s=null===n.maxTirePressure?"--":w.toFixed(n.maxTirePressure,1,!0),l=null===n.minTirePressure?"--":w.toFixed(n.minTirePressure,1,!0)}else t=null,s="--",l="--";$("#highestTireText").html(s),$("#lowestTireText").html(l);var f=new d("#tireChart",{series:t,playIndex:i,snap:!0,rectHeight:22,onDrag:this.onDrag.bind(this),onDragEnd:this.onDragEnd.bind(this)});for(p=0;p<a.length;p++){"tire"===a[p].key&&(a[p].chart=f)}},Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(t){if(null==this)throw new TypeError('"this" is null or not defined');var e=Object(this),a=e.length>>>0;if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var n=arguments[1],i=0;i<a;){var r=e[i];if(t.call(n,r,i,e))return r;i++}}}),Math.formatFloat=function(t,e){var a=Math.pow(10,e);return parseInt(t*a,10)/a},$((function(){window.trackPlayback={dragBar:void 0,progressBar:void 0,calendar:void 0,monitorTree:void 0,areaMonitorTree:void 0,fixedTimeArea:void 0,fenceTree:void 0,map:void 0,data:void 0,flags:{isFlag:!1,bFlag:!0,bFlag1:!0,firstFlag:!0,worldType:"",objType:"",changeFlag:!1},init:function(t,e){trackPlayback.getOnlineArray=t;var a=new h({flags:trackPlayback.flags});trackPlayback.data=new p,a.set("data",trackPlayback.data),trackPlayback.dragBar=new m("#tableMapDrag",{min:-500,max:0,onDragEnd:trackPlayback.onDragBarDragEnd}),a.set("dragBar",trackPlayback.dragBar),trackPlayback.progressBar=new g("#progressLine",{onDrag:trackPlayback.onProgressBarDrag,onDragEnd:trackPlayback.onProgressBarDragEnd}),a.set("progressBar",trackPlayback.progressBar),trackPlayback.calendar=new u(".calendar4",null,a),a.set("calendar",trackPlayback.calendar),trackPlayback.monitorTree=new y("#treeDemoTrackPlayback",null,a),a.set("monitorTree",trackPlayback.monitorTree),trackPlayback.areaMonitorTree=new f("#areaTreeDemo",null,a),a.set("areaMonitorTree",trackPlayback.areaMonitorTree),trackPlayback.map=new v("mapContainer",null,a),a.set("map",trackPlayback.map),trackPlayback.fixedTimeArea=new b(null,a),a.set("fixedTimeArea",trackPlayback.fixedTimeArea),trackPlayback.fenceTree=new k(null,a),a.set("fenceTree",trackPlayback.fenceTree),trackPlayback.table=new S(null,a),a.set("table",trackPlayback.table),trackPlayback.chart=new P(null,a),a.set("chart",trackPlayback.chart),trackPlayback.bindDataEvent(),trackPlayback.initLayout(),trackPlayback.videoPlayEvent(),trackPlayback.exportEvent(),trackPlayback.choseTreeNode(e)},choseTreeNode:function(t){var e,a,n,i,r;t&&t.vehicleId&&(e=t.vehicleId,a=t.pid,n=t.startTime,i=t.endTime,r=t.type),trackPlayback.fixedTimeArea.fixAreaClose(!0),null!=e&&e.length>0?(trackPlayback.data.setInitVid(e),trackPlayback.data.setPid(a),trackPlayback.data.setSensorType(r),trackPlayback.monitorTree.search(e,"monitorId"),trackPlayback.fenceTree.vehicleTreeClickGetFenceInfo(!0,e),n&&setTimeout((function(){trackPlayback.data.getVid()||trackPlayback.data.setVid(t.vehicleId),trackPlayback.data.setStartEndTime(n,i)}),2e3)):trackPlayback.monitorTree.init()},exportEvent:function(){$("#tableDataExport").on("click",trackPlayback.tableDataExport)},tableDataExport:function(){var t=trackPlayback.data.getVid(),e=trackPlayback.table.isTableEmpty(),a=trackPlayback.data.getTableTabIndex()-1;t?e?layer.msg("列表无任何数据，无法导出"):1==a?trackPlayback.exportFunc():(trackPlayback.showExportModal(),$('input[name="exportAddress"]').on("change",trackPlayback.isShowAddress),$("#exportBtn").on("click",trackPlayback.exportFunc)):layer.msg("请选择监控对象")},showExportModal:function(){var t=$('input[name="videoSet"]:checked').val(),e=trackPlayback.data.getTableTabIndex()-1,a="";0==e?a="all"==t?"导出全部数据":"导出行驶数据":4==e?a="导出报警数据":3==e?a="导出停止段数据":2==e&&(a="导出行驶段数据"),$("#exportTitle").text(a),$("#noExportPosition").prop("checked",!0),$("#yesExportPosition").prop("checked",!1),$("#modalTips").hide(),$("#exportModal").modal("show")},isShowAddress:function(){var t=$(this).val(),e=$("#modalTips");"0"==t?e.slideUp():e.slideDown()},exportFunc:function(){var t=trackPlayback.data.getVid(),e=trackPlayback.data.getTableTabIndex()-1,a="",n="";switch(e){case 1:a="TRACKPLAY_OBD_LIST";break;case 2:a="TRACKPLAY_RUN";break;case 3:a="TRACKPLAY_STOP";break;case 4:a="TRACKPLAY_ALARM";break;default:a="TRACKPLAY_DATA"}if(1==e)n="/clbs/lkyw/trackBack/exportTrackPlay?tab="+e+"&mark="+a+"&vehicleId="+t;else{var i=$('input[name="videoSet"]:checked').val(),r=e;3===e?r=3:4===e?r=2:2===e&&(r=4),n="/clbs/lkyw/trackBack/exportTrackPlay?isExportLocation="+$('input[name="exportAddress"]:checked').val()+"&flag="+("all"===i?0:1)+"&tab="+(e=r)+"&mark="+a+"&vehicleId="+t}$("#exportModal").modal("hide"),console.log(n),window.location.href=n},videoPlayEvent:function(){$("#paly-more").on("click",trackPlayback.playMore),$(".speed-control").on("click",trackPlayback.playSpeed)},playMore:function(){$(".checkbox-control").toggleClass("active")},playSpeed:function(){var t=$(this).find("#speed-num"),e=parseFloat(t.text());e=4==e?.5:2*e,t.text(e);var a=50;switch(e){case.5:a=500;break;case 1:a=5e3;break;case 2:a=1e4;break;case 4:a=2e4}trackPlayback.data.setSpeed(a)},bindDataEvent:function(){trackPlayback.data.on("activeTreeNodeChange",trackPlayback.activeTreeNodeChange),trackPlayback.data.on("startEndTimeChange",trackPlayback.startEndTimeChange),trackPlayback.data.on("positionsChange",trackPlayback.positionsChange),trackPlayback.data.on("positionsChange",trackPlayback.table.replaceTable.bind(trackPlayback.table)),trackPlayback.data.on("allOrRunDataChange",trackPlayback.allOrRunDataChange),trackPlayback.data.on("showStopPointChange",trackPlayback.map.toggleStopPoint.bind(trackPlayback.map)),trackPlayback.data.on("showAlarmPointChange",trackPlayback.map.toggleAlarmPoint.bind(trackPlayback.map)),trackPlayback.data.on("playIndexChange",trackPlayback.playIndexChange),trackPlayback.data.on("isPlayingChange",trackPlayback.isPlayingChange),trackPlayback.data.on("isPlayingChange",trackPlayback.table.removeHighlightRunSegment.bind(trackPlayback.table)),trackPlayback.data.on("isChartOpenChange",trackPlayback.chart.setChartOpen.bind(trackPlayback.chart)),trackPlayback.data.on("sensorListChange",trackPlayback.chart.initSensorHtml.bind(trackPlayback.chart)),trackPlayback.data.on("activeSensorKeysChange",trackPlayback.chart.renderChartLine.bind(trackPlayback.chart)),trackPlayback.data.on("stopDataChange",trackPlayback.chart.stopDataChange.bind(trackPlayback.chart)),trackPlayback.data.on("mileSpeedChange",trackPlayback.chart.mileSpeedChange.bind(trackPlayback.chart)),trackPlayback.data.on("oilConsumptionSensorNoChange",trackPlayback.chart.getOilConsumptionData.bind(trackPlayback.chart)),trackPlayback.data.on("oilConsumptionDataChange",trackPlayback.chart.oilConsumptionDataChange.bind(trackPlayback.chart)),trackPlayback.data.on("oilSensorNoChange",trackPlayback.chart.getOilData.bind(trackPlayback.chart)),trackPlayback.data.on("oilDataChange",trackPlayback.chart.oilDataChange.bind(trackPlayback.chart)),trackPlayback.data.on("temperatureySensorNoChange",trackPlayback.chart.getTemperaturey.bind(trackPlayback.chart)),trackPlayback.data.on("temperatureyChange",trackPlayback.chart.temperatureyChange.bind(trackPlayback.chart)),trackPlayback.data.on("humiditySensorNoChange",trackPlayback.chart.getHumidity.bind(trackPlayback.chart)),trackPlayback.data.on("humidityChange",trackPlayback.chart.humidityChange.bind(trackPlayback.chart)),trackPlayback.data.on("workHourSensorNoChange",trackPlayback.chart.getWorkHour.bind(trackPlayback.chart)),trackPlayback.data.on("workHourChange",trackPlayback.chart.workHourChange.bind(trackPlayback.chart)),trackPlayback.data.on("reverseChange",trackPlayback.chart.reverseChange.bind(trackPlayback.chart)),trackPlayback.data.on("weightSensorNoChange",trackPlayback.chart.getWeight.bind(trackPlayback.chart)),trackPlayback.data.on("weightChange",trackPlayback.chart.weightChange.bind(trackPlayback.chart)),trackPlayback.data.on("tireNumChange",trackPlayback.chart.getTire.bind(trackPlayback.chart)),trackPlayback.data.on("tireChange",trackPlayback.chart.tireChange.bind(trackPlayback.chart)),trackPlayback.data.on("ioDataSensorNoChange",trackPlayback.chart.ioDataChange.bind(trackPlayback.chart)),trackPlayback.data.on("tableTabIndexChange",trackPlayback.table.setActiveTab.bind(trackPlayback.table)),trackPlayback.data.on("tableTabIndexChange",trackPlayback.table.getRestTableData.bind(trackPlayback.table)),trackPlayback.data.on("stopFragmentDataChange",trackPlayback.table.replaceStopTable.bind(trackPlayback.table)),trackPlayback.data.on("runFragmentDataChange",trackPlayback.table.replaceRunTable.bind(trackPlayback.table)),trackPlayback.data.on("alarmDataChange",trackPlayback.table.replaceAlarmTable.bind(trackPlayback.table)),trackPlayback.data.on("obdDataChange",trackPlayback.table.replaceObdTable.bind(trackPlayback.table))},activeTreeNodeChange:function(){var t=trackPlayback.data.getActiveTreeNode();trackPlayback.data.getIsPlaying()&&trackPlayback.map.pause(),"assignment"!=t.type&&"group"!=t.type?($("#citySel").val(t.name),trackPlayback.calendar.getValidDate(t.id,trackPlayback.data.getNowMonth(),trackPlayback.data.getAfterMonth()),trackPlayback.chart.getSensorList(),$(".checkbox-control").removeClass("active"),trackPlayback.data.setPositions(null)):$("#citySel").val("")},startEndTimeChange:function(){var t=trackPlayback.data.getVid(),e=trackPlayback.data.getStartTime(),a=trackPlayback.data.getEndTime(),n=trackPlayback.data.getSensorType(),i=trackPlayback.data.getValidSensorFlag(),r=trackPlayback.data.getValidClickedIndex(),o=i&&null!=r?i[i]:void 0;$("#timeInterval").val(e+"--"+a);var l=$("#dataStatus0").is(":checked"),d=l?0:1;l!==$("#dataStatus1").is(":checked")&&$("#realTimeCanArea").hasClass("realTimeCanAreaShow")||(d=void 0),$.ajax({type:"POST",url:"/clbs/lkyw/trackBack/getMonitorHistoryData",data:{vehicleId:t,startTime:e,endTime:a,type:n,sensorFlag:o,reissue:d},dataType:"json",async:!0,beforeSend:function(t){layer.load(2)},complete:function(t,e){layer.closeAll("loading")},success:function(t){if(t.success){var e=Object(s.a)(t.obj.allData),a=$.parseJSON(e),n=t.obj.groups,i=(t.obj.type,t.obj.nowFlogKey);if((a=a&&a.length>0?a:null)&&a[0]){var r=a[0].totalTireNum;if(null!=r){for(var o=[],l=0;l<r;l++)o.push(l+1);trackPlayback.data.setTireNumList(o)}}else layer.msg("未查询到数据");trackPlayback.data.setGroup(n),trackPlayback.data.setSensorFlag(i),trackPlayback.data.setAllOrRunData(null),trackPlayback.data.setPositions(a)}else trackPlayback.data.setPositions(null),layer.msg(t.msg||t.exceptionDetailMsg)}})},positionsChange:function(){var t=trackPlayback.data.getPositions(),e=trackPlayback.data.getAllOrRunData(),a=trackPlayback.data.getIsPlaying(),n=trackPlayback.data.getIsChartOpen();a&&trackPlayback.map.pause(),null!==t&&"run"!==e||trackPlayback.data.setIsChartOpen(!1),trackPlayback.map.clearMap(),trackPlayback.map.drawLine(n),null===t?($(".play-control-container").removeClass("active"),$(".toggle-chart-part").hide()):($(".play-control-container").addClass("active"),"run"!==e&&$(".toggle-chart-part").show()),trackPlayback.data.setPlayIndex(0),$("#checkboxShowStop").prop("checked",!1),$("#checkboxShowAlarm").prop("checked",!1),trackPlayback.data.setActiveSensorKeys(null),null!==t&&"run"!==e&&trackPlayback.data.setActiveSensorKeys([{key:"mileSpeed",chart:null},{key:"stopData",chart:null}])},playIndexChange:function(){var t=trackPlayback.data.getPositions();trackPlayback.data.getStopData();if(null!==t){var e=trackPlayback.data.getPlayIndex("chart");null!=e&&(trackPlayback.progressBar.setOptions({value:e}),trackPlayback.table.setActiveRow(),trackPlayback.table.autoGetStatusPosition(),trackPlayback.chart.updatePlayIndex(),trackPlayback.map.closeInfoWindow(),trackPlayback.map.drawMarker())}},playOrPause:function(){$("#playOrPause").hasClass("pause")?trackPlayback.map.pause():trackPlayback.map.play()},isPlayingChange:function(t,e){var a=trackPlayback.data.getIsPlaying(),n=$("#playOrPause");a?n.removeClass("play").addClass("pause"):n.removeClass("pause").addClass("play"),"runTableDblClick"!==e&&setTimeout((function(){trackPlayback.map.toggleInfoWindow()}),800)},initLayout:function(){var t=$("#trackToggleLeftPart"),e=$("#leftPart"),a=$("#rightPart"),n=t.find("i");t.on("click",(function(){n.hasClass("fa-chevron-left")?(e.addClass("collapse"),a.addClass("extend"),n.removeClass("fa-chevron-left").addClass("fa-chevron-right")):(e.removeClass("collapse"),a.removeClass("extend"),n.removeClass("fa-chevron-right").addClass("fa-chevron-left"))})),$("#myTab li.table-tab").on("click",(function(){trackPlayback.data.getPositions()&&trackPlayback.data.setTableTabIndex($(this).index()+1)})),$("#scalingBtn").on("click",(function(){var t=$(this);t.hasClass("fa-chevron-down")?(trackPlayback.dragBar.setDelta(0),t.removeClass("fa-chevron-down").addClass("fa-chevron-up")):(trackPlayback.dragBar.setDelta(-250),t.removeClass("fa-chevron-up").addClass("fa-chevron-down"))})),$(".toggle-chart-part").on("click",(function(){null!==trackPlayback.data.getPositions()?trackPlayback.data.setIsChartOpen(!trackPlayback.data.getIsChartOpen()):layer.msg("请先查询历史数据")})),$(".page-icon").on("click",trackPlayback.chart.onSensorPageClick),$("#sensorWraper").on("click",".sensor-item",(function(){var t=$(this);if(t.hasClass("un-active")){var e=t.index();trackPlayback.chart.onSensorItemClick(e)}})),$('input[name="videoSet"]').on("change",(function(){var t=$(this).val();trackPlayback.data.setAllOrRunData(t)})),$("#checkboxShowStop").on("change",(function(){trackPlayback.data.setShowStopPoint($(this).prop("checked"))})),$("#checkboxShowAlarm").on("change",(function(){trackPlayback.data.setShowAlarmPoint($(this).prop("checked"))})),$("#addFenceBtn").on("click",trackPlayback.map.addLineFence.bind(trackPlayback.map)),$("#timeInterval").dateRangePicker({element:"#trackPlayQuery",dateLimit:7}),$("#customColumnA").on("click",(function(){trackPlayback.data.getIsPlaying()&&trackPlayback.map.pause()})),$("#chooseAll_trackPlayback").on("click",trackPlayback.monitorTree.all.bind(trackPlayback.monitorTree)),$("#online_trackPlayback").on("click",trackPlayback.monitorTree.online.bind(trackPlayback.monitorTree)),$("#chooseMissLine_trackPlayback").on("click",trackPlayback.monitorTree.offline.bind(trackPlayback.monitorTree))},onDragBarDragEnd:function(t){var e=$("#topPart"),a=$("#bottomPart");parseFloat(e.css("bottom"));e.css("bottom",50-t+"px"),a.css("height",50-t+"px"),0===t&&$("#scalingBtn").removeClass("fa-chevron-down").addClass("fa-chevron-up"),trackPlayback.chart.reRender()},onProgressBarDrag:function(t){trackPlayback.data.setIsDraging(!0),trackPlayback.data.getIsPlaying()&&trackPlayback.map.pause(),trackPlayback.data.setPlayIndex(t,"chart")},onProgressBarDragEnd:function(t){trackPlayback.data.setIsDraging(!1),trackPlayback.data.getIsPlaying()&&trackPlayback.map.pause(),trackPlayback.data.setPlayIndex(t,"chart")},getAddressUrl:function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),a=window.location.search.substr(1).match(e);return null!=a?unescape(a[2]):null},filterRunData:function(t){var e=[];if(null===t)return null;for(var a=0;a<t.length;a++)"1"===t[a].drivingState||t[a-1]&&"1"===t[a-1].drivingState&&"2"===t[a].drivingState||t[a+1]&&"1"===t[a+1].drivingState&&"2"===t[a].drivingState?e.push(t[a]):0!==a&&a!==t.length-1||"2"!==t[a].drivingState||e.push(t[a]);return e},filterStopData:function(t){var e=[];if(null===t)return null;for(var a=0;a<t.length;a++)"1"===t[a].status||t[a-1]&&"1"===t[a-1].status&&"2"===t[a].status||t[a+1]&&"1"===t[a+1].status&&"2"===t[a].status?e.push(t[a]):0!==a&&a!==t.length-1||"2"!==t[a].status||e.push(t[a]);return e},allOrRunDataChange:function(){var t=trackPlayback.data.getShowStopPoint(),e=trackPlayback.data.getShowAlarmPoint();t&&trackPlayback.data.setShowStopPoint(!1),e&&trackPlayback.data.setShowAlarmPoint(!1);var a=trackPlayback.data.getAllOrRunData(),n=trackPlayback.data.getPositions(),i=trackPlayback.data.getPositionsTmp(),r=trackPlayback.data.getStopData(),o=(trackPlayback.data.getStopDataTmp(),$("#allRadio")),s=$("#runRadio"),l=$("#allRunDataA");if(null===a)o.prop("checked",!0),s.prop("checked",!1),l.html("全部数据");else if("run"===a){o.prop("checked",!1),s.prop("checked",!0),l.html("行驶数据"),$(".toggle-chart-part").hide(),trackPlayback.data.setTableTabIndex(1);var d=trackPlayback.filterRunData(n);trackPlayback.data.setPositionsTmp(n),trackPlayback.data.setPositions(d);var c=trackPlayback.filterStopData(r);trackPlayback.data.setStopDataTmp(r),trackPlayback.data.setStopData(c)}else"all"===a&&(o.prop("checked",!0),s.prop("checked",!1),l.html("全部数据"),$(".toggle-chart-part").show(),trackPlayback.data.setTableTabIndex(1),trackPlayback.data.setPositions(i))},handleNodeClcik:function(t){setTimeout((function(){var e=$.fn.zTree.getZTreeObj("treeDemoTrackPlayback").getCheckedNodes(!0);if(e.length>0){var a=t.get("fenceTree");a.vehicleTreeClickGetFenceInfo.bind(a)(e[0].checked,e[0].id)}}),1500)}}}));a(251),a(180);var C=function(t,e,a,n){return new(a||(a=Promise))((function(i,r){function o(t){try{l(n.next(t))}catch(t){r(t)}}function s(t){try{l(n.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof a?e:new a((function(t){t(e)}))).then(o,s)}l((n=n.apply(t,e||[])).next())}))},D=function(t,e){var a,n,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(a)throw new TypeError("Generator is already executing.");for(;o;)try{if(a=1,n&&(i=2&r[0]?n.return:r[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,r[1])).done)return i;switch(n=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,n=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){o=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){o.label=r[1];break}if(6===r[0]&&o.label<i[1]){o.label=i[1],i=r;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(r);break}i[2]&&o.ops.pop(),o.trys.pop();continue}r=e.call(t,o)}catch(t){r=[6,t],n=0}finally{a=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},I=function(){function t(t,e){this.dependency=e,this.setOption(t)}return t.prototype.setOption=function(t){return C(this,void 0,void 0,(function(){return D(this,(function(e){switch(e.label){case 0:return this.option=t,this.state={$origin:null,$dom:{$all:null,$online:null,$offline:null},data:{dragBar:null}},this.state.$origin=$(t.selector),[4,this.initHtml()];case 1:return e.sent(),this.bindEvent(),this.initDragBar(),[2]}}))}))},t.prototype.update=function(t){t&&window.trackPlayback.choseTreeNode(t)},t.prototype.initHtml=function(){return C(this,void 0,void 0,(function(){var t;return D(this,(function(e){return t=$(o.a),this.state.$origin.empty(),this.state.$origin.append(t),this.state.$dom.$all=t.find("#chooseAll_trackPlayback"),this.state.$dom.$online=t.find("#online_trackPlayback"),this.state.$dom.$offline=t.find("#chooseMissLine_trackPlayback"),this.updateOnlineNumber(),[2]}))}))},t.prototype.bindEvent=function(){var t=this.dependency.get("data");t.on("onTreeOnlineSizeChange",this.updateOnlineNumber.bind(this));t.get("access_token"),t.get("ftpName"),t.get("videoUrl"),t.get("videoPort");window.trackPlayback.init(this.getOnlineArray.bind(this),this.option)},t.prototype.destory=function(){this.state.$origin.empty()},t.prototype.updateOnlineNumber=function(){var t=this.dependency.get("data"),e=t.get("treeAllSize"),a=t.get("treeOnlineSize"),n=t.get("treeOfflineSize");this.state.$dom.$all.find(".value-span").html("("+e.toString()+")"),this.state.$dom.$online.find(".value-span").html("("+a.toString()+")"),this.state.$dom.$offline.find(".value-span").html("("+n.toString()+")")},t.prototype.getOnlineArray=function(){var t=this.dependency.get("data"),e=t.get("runVidArray"),a=t.get("stopVidArray");return e||(e=[]),a||(a=[]),e.concat(a)},t.prototype.initDragBar=function(){var t=$("#rightPart").height()-50;this.state.data.dragBar=new DragBar("#tableMapDragBar",{min:-t,max:0,onDragEnd:this.onDragBarDragEnd.bind(this)})},t.prototype.onDragBarDragEnd=function(t){var e=$("#topPart"),a=$("#bottomPart");e.css("bottom",59-t+"px"),a.css("height",58-t+"px")},t}();e.default=I}}]);