(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{175:function(t,e,a){"use strict";a.d(e,"a",(function(){return s}));var i=a(177);function s(t){var e=t;return i.inflate(e,{to:"string"})}},219:function(t,e){t.exports='<div class="container-fluid historyCaptrue-container">\r\n  <div class="row historyCaptrue-header">\r\n    <div class="col-md-12" style="padding:10px 15px 10px 15px;">\r\n      <span class="title">查询历史抓拍</span>\r\n      <span id="close" class="glyphicon glyphicon-remove detail-close drawerCloseBtn"\r\n        style="float: right; margin:5px 10px 0 0;cursor: pointer;"></span>\r\n    </div>\r\n  </div>\r\n\r\n  <div class="row">\r\n    <div class="col-md-12" style="margin-top: 30px;">\r\n      <form id="captrueList" class="form-horizontal" action="#" method="post" role="form">\r\n        <div class="form-group">\r\n          <label class="col-md-1 col-sm-3 control-label">组织：</label>\r\n          <div class="has-feedback fastClear col-md-3 col-sm-8">\r\n            <select name="queryType" id="queryType" class="Inlinesearch form-control treeSelect">\r\n              <option value="vehicle">监控对象</option>\r\n              <option value="group">企业</option>\r\n              <option value="assignment">分组</option>\r\n            </select>\r\n            <input style="cursor: pointer; background-color: #fafafa;" type="text" name="groupSelect" placeholder="请选择"\r\n              class="form-control moreQueryGroup" autocomplete="off" id="groupSelect" />\r\n            <span class="fa fa-chevron-down form-control-feedback" style="top: 0; right: 15px;cursor:pointer;"\r\n              aria-hidden="true" id="groupSelectSpan"></span>\r\n            <div id="menuContent" class="menuContent">\r\n              <ul id="treeDemo" class="ztree"></ul>\r\n            </div>\r\n          </div>\r\n          <label class="col-md-1 col-sm-3 control-label searchListSelect">时间：</label>\r\n          <div class="col-md-3 col-sm-8 searchListSelect">\r\n            <input style="cursor: pointer; background-color: #fafafa;" class="form-control layer-date laydate-icon"\r\n              id="HistoryTimeInterval" name="HistoryTimeInterval" readonly />\r\n          </div>\r\n        </div>\r\n        <div class="form-group">\r\n          <div class="col-md-12 control-label" id="dateSearchData" style="padding-right: 33px;">\r\n            <button id="todayClick" type="button" class="btn btn-primary buttonWidth" name="0">今天\r\n            </button>\r\n            <button id="yesterdayClick" type="button" class="btn btn-primary buttonWidth" name="-1">前一天\r\n            </button>\r\n            <button id="nearlyThreeDays" type="button" class="btn btn-primary buttonWidth" name="-3">前三天\r\n            </button>\r\n            <button id="nearlyThreeDays1" type="button" class="btn btn-primary buttonWidth" name="-7">前七天\r\n            </button>\r\n            <button id="inquireClick" type="button" class="btn btn-primary search-btn buttonWidth" name="1"><i\r\n                class="glyphicon glyphicon-search"></i> 查询\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </form>\r\n    </div>\r\n  </div>\r\n\r\n  <div class="historyCaptured-content">\r\n    <div class="row">\r\n      <div id="capturedLeft" class="col-md-9" style="padding-right: 0; padding-left: 0;">\r\n        <div id="historyMapContainer"></div>\r\n      </div>\r\n      <div id="capturedRight" class="col-md-3" style="padding-left: 8px;">\r\n        <div class="panel-title" style="height: 43px;">\r\n          <ul id="tab" class="nav nav-tabs" role="tablist" style="position: relative; top:0;left: \r\n          0;">\r\n            <li class="active" style="position: absolute; left: 17px;"><a id="multimediaAll" href="#tabAll" role="tab"\r\n                data-toggle="tab" data-value="0">全部(0)</a></li>\r\n            <li style="position: absolute; left: 132px;"><a id="multimediaImg" href="#tabImg" role="tab"\r\n                data-toggle="tab" data-value="1">图片(0)</a></li>\r\n            <li style="position: absolute; left: 248px;"><a id="multimediaVideo" href="#tabVideo" role="tab"\r\n                data-toggle="tab" data-value="2">视频(0)</a></li>\r\n          </ul>\r\n        </div>\r\n        <div id="myTabContent" class="tab-content">\r\n          <div class="tab-pane fade in active hidesrcoll" id="tabAll">\r\n            <ul id="allContent" class="hidesrcolly">\r\n            </ul>\r\n          </div>\r\n          <div class="tab-pane fade hidesrcoll" id="tabImg">\r\n            <ul id="imgContent" class="hidesrcolly">\r\n            </ul>\r\n          </div>\r\n          <div class="tab-pane fade hidesrcoll" id="tabVideo">\r\n            <ul id="videoContent" class="hidesrcolly">\r\n            </ul>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n</div>'},220:function(t,e,a){},257:function(t,e,a){"use strict";a.r(e);var i=a(219),s=a.n(i),n=a(175),o=a(7),r=(a(220),a.p,a.p,function(t,e,a,i){return new(a||(a=Promise))((function(s,n){function o(t){try{l(i.next(t))}catch(t){n(t)}}function r(t){try{l(i.throw(t))}catch(t){n(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof a?e:new a((function(t){t(e)}))).then(o,r)}l((i=i.apply(t,e||[])).next())}))}),l=function(t,e){var a,i,s,n,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return n={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function r(n){return function(r){return function(n){if(a)throw new TypeError("Generator is already executing.");for(;o;)try{if(a=1,i&&(s=2&n[0]?i.return:n[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,n[1])).done)return s;switch(i=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!(s=o.trys,(s=s.length>0&&s[s.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){o.label=n[1];break}if(6===n[0]&&o.label<s[1]){o.label=s[1],s=n;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(n);break}s[2]&&o.ops.pop(),o.trys.pop();continue}n=e.call(t,o)}catch(t){n=[6,t],i=0}finally{a=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,r])}}},d=function(){function t(t,e){this.dependency=e,this.setOption(t)}return t.prototype.setOption=function(t){this.option=t,this.state={$origin:null,$dom:{$layDate:null,$zTreeInit:null,$zTreeInput:null,$menuContent:null,$queryType:null,$timeInterval:null,$mapContainer:null,$todayClick:null,$yesterdayClick:null,$nearlyThreeDays:null,$nearlyThreeDays1:null,$inquireClick:null,$allContent:null,$imgContent:null,$videoContent:null,$cutRight:null},data:{listData:null,listImgResponse:null,listVideoResponse:null,startTime:null,endTime:null,vehicleIds:null,allPageNum:"1",allpageSize:"10",allType:"0",allHtml:"",loadAllFlag:!0,imgPageNum:"1",imgpageSize:"10",imgHtml:"",imgType:"1",loadImgFlag:!0,videoPageNum:"1",videopageSize:"10",videoHtml:"",loadVideoFlag:!0,videoType:"2",size:0,searchFlag:!0,crrentSubV:[],allVid:null,vnameList:null,checkFlag:!1,zTreeIdJson:{},bflag:!0,inputChange:void 0,ifAllCheck:!0,inputFlag:!1,map:null,mediaMapDataDetail:null,infoWindowIndex:0,infoWindowIndex1:null,massMarksFlag:!0,massMarks:null,infowindow:null,slidingFlag:!1,currentTarget:null,index:null,indexFlag:null,address:null}},this.state.$origin=$(t.selector),this.initHtml(),this.bindEvent()},t.prototype.initHtml=function(){var t=$(s.a);this.state.$origin.empty(),this.state.$origin.append(t),this.state.$dom.$zTreeInit=t.find("#treeDemo"),this.state.$dom.$zTreeInput=t.find("#groupSelect"),this.state.$dom.$menuContent=t.find(".menuContent"),this.state.$dom.$queryType=t.find("#queryType"),this.state.$dom.$timeInterval=t.find("#HistoryTimeInterval"),this.state.$dom.$mapContainer=t.find("#historyMapContainer"),this.state.$dom.$todayClick=t.find("#todayClick"),this.state.$dom.$yesterdayClick=t.find("#yesterdayClick"),this.state.$dom.$nearlyThreeDays=t.find("#nearlyThreeDays"),this.state.$dom.$nearlyThreeDays1=t.find("#nearlyThreeDays1"),this.state.$dom.$inquireClick=t.find("#inquireClick"),this.state.$dom.$allContent=t.find("#allContent"),this.state.$dom.$imgContent=t.find("#imgContent"),this.state.$dom.$videoContent=t.find("#videoContent"),this.state.$dom.$cutRight=t.find("#cutRight"),this.zTreeInit(),this.timeInit(),this.initMap()},t.prototype.initMap=function(){if(this.state.data.map=new AMap.Map("historyMapContainer",{resizeEnable:!0,zoom:18}),navigator.userAgent.indexOf("Firefox")>=0)setTimeout((function(){var t=$(document.body).height();document.body.clientWidth<1750?($("#capturedLeft").removeClass("col-md-9").addClass("col-md-8"),$("#capturedRight").removeClass("col-md-3").addClass("col-md-4")):($("#capturedLeft").removeClass("col-md-8").addClass("col-md-9"),$("#capturedRight").removeClass("col-md-4").addClass("col-md-3")),$("#historyMapContainer").css("height",t-245+"px"),$(".hidesrcoll").css("height",t-288+"px"),$(window).resize((function(){var t=$(document.body).height();document.body.clientWidth<1750?($("#capturedLeft").removeClass("col-md-9").addClass("col-md-8"),$("#capturedRight").removeClass("col-md-3").addClass("col-md-4")):($("#capturedLeft").removeClass("col-md-8").addClass("col-md-9"),$("#capturedRight").removeClass("col-md-4").addClass("col-md-3")),$("#historyMapContainer").css("height",t-245+"px"),$(".hidesrcoll").css("height",t-288+"px")}))}),200);else{var t=$(document.body).height();document.body.clientWidth<1750?($("#capturedLeft").removeClass("col-md-9").addClass("col-md-8"),$("#capturedRight").removeClass("col-md-3").addClass("col-md-4")):($("#capturedLeft").removeClass("col-md-8").addClass("col-md-9"),$("#capturedRight").removeClass("col-md-4").addClass("col-md-3")),$("#historyMapContainer").css("height",t-245+"px"),$(".hidesrcoll").css("height",t-288+"px"),$(window).resize((function(){var t=$(document.body).height();document.body.clientWidth<1750?($("#capturedLeft").removeClass("col-md-9").addClass("col-md-8"),$("#capturedRight").removeClass("col-md-3").addClass("col-md-4")):($("#capturedLeft").removeClass("col-md-8").addClass("col-md-9"),$("#capturedRight").removeClass("col-md-4").addClass("col-md-3")),$("#historyMapContainer").css("height",t-245+"px"),$(".hidesrcoll").css("height",t-288+"px")}))}},t.prototype.bindEvent=function(){var t=this,e=this;this.state.$dom.$todayClick.on("click",(function(t){e.state.data.currentTarget=t.currentTarget,e.defaultParam(),e.inquireClick(0,!1)})),this.state.$dom.$yesterdayClick.on("click",(function(t){e.state.data.currentTarget=t.currentTarget,e.defaultParam(),e.inquireClick(-1,!1)})),this.state.$dom.$nearlyThreeDays.on("click",(function(t){e.state.data.currentTarget=t.currentTarget,e.defaultParam(),e.inquireClick(-3,!1)})),this.state.$dom.$nearlyThreeDays1.on("click",(function(t){e.state.data.currentTarget=t.currentTarget,e.defaultParam(),e.inquireClick(-7,!1)})),this.state.$dom.$inquireClick.on("click",(function(t){e.state.data.currentTarget=t.currentTarget,e.defaultParam(),e.inquireClick(1,!1)})),this.state.$dom.$allContent.on("scroll",this.allLoadMore.bind(this)),this.state.$dom.$imgContent.on("scroll",this.imgLoadMore.bind(this)),this.state.$dom.$videoContent.on("scroll",this.videoLoadMore.bind(this)),this.state.$dom.$zTreeInput.on("input propertychange",this.fuzzysearch.bind(this)),this.state.$dom.$queryType.on("change",this.valChange.bind(this)),$("body").on("click",".cutRight",(function(){var e=t.state.data.mediaMapDataDetail.obj.mediaMapDataDetail;t.state.data.infoWindowIndex++;var a=t.state.data.infoWindowIndex;a>=e.length&&(t.state.data.infoWindowIndex=0,a=t.state.data.infoWindowIndex),0==e[a].type?$("#mediaImg").attr("src",e[a].mediaUrlNew):$("#mediaVideo").attr("src",t.handleUrlDispose(e[a].mediaUrlNew)),$(".monitorName").html("监控对象："+t.monitorNameDispose(e[a].monitorName)),$(".createDataTime").html("时间："+t.timeDispose(e[a].createDataTime)),$(".spend").html("速度："+t.speedDispose(e[a].speed)),$(".address").html("位置："+t.fieldLimits(e[a].address)),$(".info_index").html(a+1),t.state.data.infoWindowIndex1=a})),$("body").on("click",".cutLeft",(function(){t.state.data.infoWindowIndex1--;var e=t.state.data.mediaMapDataDetail.obj.mediaMapDataDetail,a=t.state.data.infoWindowIndex1;a<0&&(t.state.data.infoWindowIndex1=e.length-1,a=t.state.data.infoWindowIndex1),0==e[a].type?$("#mediaImg").attr("src",e[a].mediaUrlNew):$("#mediaVideo").attr("src",t.handleUrlDispose(e[a].mediaUrlNew)),$(".monitorName").html("监控对象："+t.monitorNameDispose(e[a].monitorName)),$(".createDataTime").html("时间："+t.timeDispose(e[a].createDataTime)),$(".spend").html("速度："+t.speedDispose(e[a].speed)),$(".address").html("位置："+t.fieldLimits(e[a].address)),$(".info_index").html(a+1)})),$("body").on("click",".liAll",this.mapFind.bind(this)),$("body").on("mouseover",".info",this.handleFullDisplay.bind(this)),$("body").on("mouseout",".info",this.handleExceedHide.bind(this)),$("input").inputClear().on("onClearEvent",(function(e,a){if("groupSelect"==a.id){var i=$("#groupSelect").val();t.searchVehicleTree(i)}})),$("#historyMapContainer").on("mouseover",".cutRight",(function(){$(this).attr("src","/clbs/resources/img/hoverRight.png")})),$("#historyMapContainer").on("mouseout",".cutRight",(function(){$(this).attr("src","/clbs/resources/img/languageRight.png")})),$("#historyMapContainer").on("mouseover",".cutLeft",(function(){$(this).attr("src","/clbs/resources/img/hoverLeft.png")})),$("#historyMapContainer").on("mouseout",".cutLeft",(function(){$(this).attr("src","/clbs/resources/img/languageLeft.png")})),$("#close").on("click",this.handleclose.bind(this)),$("#groupSelectSpan").on("click",this.handspanHide),$("#groupSelect,#groupSelectSpan").on("click",showMenuContent)},t.prototype.destory=function(){this.state.$origin.empty()},t.prototype.zTreeInit=function(){var t={async:{url:this.getTreeUrl,type:"post",enable:!0,autoParam:["id"],dataType:"json",otherParam:{type:"multiple"},dataFilter:this.ajaxDataFilter.bind(this)},check:{enable:!0,chkStyle:"checkbox",chkboxType:{Y:"s",N:"s"},radioType:"all"},view:{dblClickExpand:!1,nameIsHTML:!0,countClass:"group-number-statistics"},data:{simpleData:{enable:!0}},callback:{beforeClick:this.beforeClickVehicle.bind(this),onCheck:this.onCheckVehicle.bind(this),beforeCheck:this.zTreeBeforeCheck.bind(this),onExpand:this.zTreeOnExpand.bind(this),onAsyncSuccess:this.zTreeOnAsyncSuccess.bind(this),onNodeCreated:this.zTreeOnNodeCreated.bind(this)}};$.fn.zTree.init(this.state.$dom.$zTreeInit,t,null)},t.prototype.getTreeUrl=function(t,e){return null==e?"/clbs/m/personalized/ico/vehicleTree":"assignment"==e.type?"/clbs/m/functionconfig/fence/bindfence/putMonitorByAssign?assignmentId="+e.id+"&isChecked="+e.checked+"&monitorType=allMonitor":void 0},t.prototype.ajaxDataFilter=function(t,e,a){$.fn.zTree.getZTreeObj(t);if(a.msg){var i,s=JSON.parse(Object(n.a)(a.msg));null!=s.tree&&null!=s.tree?(i=s.tree,this.state.data.size=s.size):i=s;for(var o=0;o<i.length;o++)i[o].open=!0}return i},t.prototype.beforeClickVehicle=function(t,e){return $.fn.zTree.getZTreeObj(t).checkNode(e,!e.checked,!0,!0),!1},t.prototype.onCheckVehicle=function(t,e,a){var i=$.fn.zTree.getZTreeObj(e);a.checked&&(this.state.data.searchFlag=!1,i.expandNode(a,!0,!0,!0,!0));var s=[];s.push(a.id),this.state.data.crrentSubV=s,this.getCharSelect(i),this.getCheckedNodes()},t.prototype.getCharSelect=function(t){var e=t.getCheckedNodes(!0),a=t.getNodes();e.length>0?this.state.$dom.$zTreeInput.val(a[0].name):this.state.$dom.$zTreeInput.val("")},t.prototype.getCheckedNodes=function(){for(var t=$.fn.zTree.getZTreeObj("treeDemo").getCheckedNodes(!0),e="",a="",i=0,s=t.length;i<s;i++)"vehicle"!=t[i].type&&"people"!=t[i].type&&"thing"!=t[i].type||(e+=t[i].name+",",a+=t[i].id+",");this.state.data.allVid=a,this.state.data.vnameList=e},t.prototype.zTreeBeforeCheck=function(t,e){var a=!0;if(!e.checked){if("group"==e.type||"assignment"==e.type){var i=(r=$.fn.zTree.getZTreeObj("treeDemo")).getCheckedNodes(!0),s=0;json_ajax("post","/clbs/m/personalized/ico/getVehicleCount","json",!1,{parentId:e.id,type:e.type},(function(t){t.success?s+=t.obj:layer.msg(t.msg)}));for(var n=[],o=0;o<i.length;o++){if(l=i[o].id,"people"==i[o].type||"vehicle"==i[o].type)null==r.getNodeByParam("tId",i[o].tId,e)&&-1==$.inArray(l,n)&&n.push(l)}s+=n.length}else if("people"==e.type||"vehicle"==e.type){var r,l;for(i=(r=$.fn.zTree.getZTreeObj("treeDemo")).getCheckedNodes(!0),s=0,n=[],o=0;o<i.length;o++)l=i[o].id,"people"!=i[o].type&&"vehicle"!=i[o].type||-1==$.inArray(l,n)&&n.push(l);s=n.length+1}if(localStorage.getItem("treeMaxSelect")){var d=Number(localStorage.getItem("treeMaxSelect"));s>d&&(layer.msg("最多勾选"+d+"个监控对象"),a=!1)}}return a&&("group"!=e.type||e.checked||(this.state.data.checkFlag=!0)),a},t.prototype.zTreeOnExpand=function(t,e,a){var i=this;if("group"!=a.type||this.state.data.checkFlag){this.state.data.checkFlag=!1;var s=$.fn.zTree.getZTreeObj("treeDemo");if("group"==a.type){json_ajax("post","/clbs/m/functionconfig/fence/bindfence/putMonitorByGroup","json",!1,{groupId:a.id,isChecked:a.checked,monitorType:"vehicle"},(function(t){var e,a=t.obj;null!=a&&null!=a&&$.each(a,(function(t){var n=t;a[t];if(null!=i.state.data.zTreeIdJson[n]){var o=i.state.data.zTreeIdJson[n][0];void 0===(e=s.getNodeByTId(o)).children&&s.addNodes(e,[])}}))}))}}},t.prototype.zTreeOnAsyncSuccess=function(t,e,a,i){var s=$.fn.zTree.getZTreeObj("treeDemo");this.state.data.size<=5e3&&this.state.data.ifAllCheck&&s.checkAllNodes(!0),this.getCharSelect(s),this.state.data.bflag=!1},t.prototype.zTreeOnNodeCreated=function(t,e,a){var i=a.id.toString(),s=[];null==this.state.data.zTreeIdJson[i]||null==this.state.data.zTreeIdJson[i]?(s=[a.tId],this.state.data.zTreeIdJson[i]=s):this.state.data.zTreeIdJson[i].push(a.tId)},t.prototype.fuzzysearch=function(){var t=this.state.data.inputChange,e=this.state.data.searchFlag,a=this;void 0!==t&&clearTimeout(t),window.ActiveXObject||"ActiveXObject"in window||(e=!0),t=setTimeout((function(){if(e){var t=$("#groupSelect").val();a.searchVehicleTree(t)}e=!0}),500)},t.prototype.searchVehicleTree=function(t){var e=this.state.data;if(e.ifAllCheck=!1,e.crrentSubV=[],null==t||null==t||""==t)e.bflag=!0,e.inputFlag&&(e.inputFlag=!1,this.zTreeInit());else{e.bflag=!0,e.inputFlag=!0;var a={async:{url:"/clbs/a/search/reportFuzzySearch",type:"post",enable:!0,autoParam:["id"],dataType:"json",otherParam:{type:$("#queryType").val(),queryParam:t,queryType:"multiple"},dataFilter:this.ajaxQueryDataFilter.bind(this)},check:{enable:!0,chkStyle:"checkbox",radioType:"all",chkboxType:{Y:"s",N:"s"}},view:{dblClickExpand:!1,nameIsHTML:!0,countClass:"group-number-statistics"},data:{simpleData:{enable:!0}},callback:{beforeClick:this.beforeClickVehicle.bind(this),onCheck:this.onCheckVehicle.bind(this),onExpand:this.zTreeOnExpand.bind(this),onNodeCreated:this.zTreeOnNodeCreated.bind(this)}};$.fn.zTree.init(this.state.$dom.$zTreeInit,a,null)}},t.prototype.ajaxQueryDataFilter=function(t,e,a){var i;a=JSON.parse(Object(n.a)(a)),i="vehicle"==this.state.$dom.$queryType.val()?filterQueryResult(a,this.state.data.crrentSubV):a;for(var s=0;s<i.length;s++)i[s].open=!0;return i},t.prototype.valChange=function(){var t=$("#groupSelect").val();this.searchVehicleTree(t)},t.prototype.timeInit=function(){this.state.$dom.$timeInterval.dateRangePicker({dateLimit:31,isOffLineReportFlag:!0,greater:!0})},t.prototype.getsTheCurrentTime=function(){var t=new Date;this.state.data.startTime=t.getFullYear()+"-"+(parseInt(t.getMonth()+1)<10?"0"+parseInt(t.getMonth()+1):parseInt(t.getMonth()+1))+"-"+(t.getDate()<10?"0"+t.getDate():t.getDate())+" 00:00:00",this.state.data.endTime=t.getFullYear()+"-"+(parseInt(t.getMonth()+1)<10?"0"+parseInt(t.getMonth()+1):parseInt(t.getMonth()+1))+"-"+(t.getDate()<10?"0"+t.getDate():t.getDate())+" 23:59:59";var e=$("#atime").val();null!=e&&""!=e&&(this.state.data.startTime=e)},t.prototype.startDay=function(t){var e=$("#HistoryTimeInterval").val().split("--"),a=e[0],i=e[1];if(""==a||""==i){var s=new Date,n=s.getTime()+864e5*t;s.setTime(n);var o=s.getFullYear(),r=s.getMonth(),l=s.getDate();r=this.doHandleMonth(r+1),l=this.doHandleMonth(l);var d=-(t+1);this.state.data.startTime=o+"-"+r+"-"+l+" 00:00:00";var c=s.getTime()+864e5*parseInt(String(d));s.setTime(c);var h=s.getFullYear(),p=s.getMonth(),m=s.getDate();p=this.doHandleMonth(p+1),m=this.doHandleMonth(m),this.state.data.endTime=h+"-"+p+"-"+m+" 23:59:59"}else{var u=a.slice(0,10).replace("-","/").replace("-","/"),g=Date.parse(u)+864e5*t,f=new Date;f.setTime(g);var y=f.getFullYear(),v=f.getMonth(),b=f.getDate();if(v=this.doHandleMonth(v+1),b=this.doHandleMonth(b),this.state.data.startTime=y+"-"+v+"-"+b+" 00:00:00",1==t)this.state.data.endTime=y+"-"+v+"-"+b+" 23:59:59";else{var T=Date.parse(u)+864e5*parseInt(String(-1)),C=new Date;C.setTime(T);var D=C.getFullYear(),x=C.getMonth(),k=C.getDate();x=this.doHandleMonth(x+1),k=this.doHandleMonth(k),this.state.data.endTime=D+"-"+x+"-"+k+" 23:59:59"}}},t.prototype.doHandleMonth=function(t){var e=t;return 1==t.toString().length&&(e="0"+t),e},t.prototype.inquireClick=function(t,e){if(this.validates()){if(0==t?this.getsTheCurrentTime():-1==t?this.startDay(-1):-3==t?this.startDay(-3):-7==t&&this.startDay(-7),1!=t)$("#HistoryTimeInterval").val(this.state.data.startTime+"--"+this.state.data.endTime);else{var a=$("#HistoryTimeInterval").val().split("--");this.state.data.startTime=a[0],this.state.data.endTime=a[1]}e||this.getCheckedNodes(),this.state.data.slidingFlag=!0,this.getListallData(),this.getListimgData(),this.getListvideoData(),this.getMapDate()}},t.prototype.getMapDate=function(){return r(this,void 0,void 0,(function(){var t,e,a,i,s,n,r,d,c,h,p,m;return l(this,(function(l){switch(l.label){case 0:return(t=new FormData).set("vehicleIds",this.state.data.allVid),t.set("startTime",this.state.data.startTime),t.set("endTime",this.state.data.endTime),[4,o.a.post("/clbs/lkyw/historicalSnapshot/mediaMapData",t)];case 1:if(e=l.sent(),a=e.data,i=a.obj.data,s=[],1==a.success&&""!=a.obj){for(n=[{url:"/clbs/resources/lkyw/src/assets/img/img.png",anchor:new AMap.Pixel(30,30),size:new AMap.Size(35,55)},{url:"/clbs/resources/lkyw/src/assets/img/video.png",anchor:new AMap.Pixel(30,30),size:new AMap.Size(35,55)}],r=0;r<i.length;r++)d=i[r],c=Number(d.longitude),h=Number(d.latitude),p={lnglat:[c,h],vehicleId:d.vehicleId,type:d.type,style:0==d.type?0:1},s.push(p);this.state.data.massMarksFlag?((m=new AMap.MassMarks(s,{zIndex:100,alwaysRender:!0,style:n})).setMap(this.state.data.map),this.state.data.massMarksFlag=!1,this.state.data.massMarks=m,m.on("click",this.massMarksClick.bind(this))):(this.state.data.massMarks.clear(),this.state.data.massMarks.setData(s))}return[2]}}))}))},t.prototype.massMarksClick=function(t){var e=t.data.lnglat.lng,a=t.data.lnglat.lat,i=t.data.type,s=t.data.vehicleId;this.mediaMapDataDetail(e,a,i,s,"")},t.prototype.mediaMapDataDetail=function(t,e,a,i,s){return r(this,void 0,void 0,(function(){var n,r,d,c;return l(this,(function(l){switch(l.label){case 0:return(n=new FormData).set("vehicleIds",i),n.set("startTime",this.state.data.startTime),n.set("endTime",this.state.data.endTime),n.set("latitude",e),n.set("longitude",t),n.set("type",a),n.set("snapshotTime",s),[4,o.a.post("/clbs/lkyw/historicalSnapshot/mediaMapDataDetail",n)];case 1:return r=l.sent(),d=r.data,this.state.data.mediaMapDataDetail=d,1==d.success&&""!=d.obj&&(c=new AMap.InfoWindow({isCustom:!0,content:this.createInfoWindow(d.obj),offset:new AMap.Pixel(0,-30)}),this.state.data.infowindow=c,this.state.data.infoWindowIndex=0,c.open(this.state.data.map,[t,e]),$("body").on("click","#chut",(function(){c.close()}))),[2]}}))}))},t.prototype.createInfoWindow=function(t){var e=t.mediaMapDataDetail[0].monitorName,a=t.mediaMapDataDetail[0].mediaUrlNew,i=t.mediaMapDataDetail[0].createDataTime,s=t.mediaMapDataDetail[0].address,n=t.mediaMapDataDetail[0].speed,o=t.mediaMapDataDetail[0].type,r=t.mediaMapDataDetail.length;return this.state.data.address=s,"<div class='info'><div class='info_title'><div id='chut' class='close' style='margin-right: 11px;margin-top:3px'>x</div></div><div class='row' style='margin: 0'><div class='col-md-5 info_left'><div style='margin-left:15px;margin-top:14px'><span class='monitorName'>监控对象："+this.monitorNameDispose(e)+"</span><br><span class='createDataTime'>时间："+this.timeDispose(i)+"</span><br><span class='spend'>速度："+this.speedDispose(n)+"</span><br><span class='address'>位置："+this.fieldLimits(s)+"</span></div></div><div class='col-md-7 info_right'><div class='multimedia'>"+this.infoWindowUrl(a,o)+"</div><img class='cutLeft' src='/clbs/resources/img/languageLeft.png'><img class='cutRight' src='/clbs/resources/img/languageRight.png'><div class='count'><span class='info_index'>1</span> / <span>"+r+"</span></div></div></div></div>"},t.prototype.infoWindowUrl=function(t,e){return 0==e?'<img id="mediaImg" src="'+t+'" style="height:115px; width: 190px"/>':2==e?null==t?"<img src='/clbs/resources/lkyw/src/assets/img/noVideo.png' style='height:115px;width:190px' />":'<video id="mediaVideo" src="'+t+'" controls="controls" controlsList="nodownload" style="width: 190px;height: 115px;"></video>':void 0},t.prototype.defaultParam=function(){this.state.$dom.$allContent[0].scrollTop=0,this.state.$dom.$imgContent[0].scrollTop=0,this.state.$dom.$videoContent[0].scrollTop=0,this.state.data.allPageNum="1",this.state.data.imgPageNum="1",this.state.data.videoPageNum="1",this.state.data.allHtml="",this.state.data.imgHtml="",this.state.data.videoHtml="",$("#allContent").html(""),$("#imgContent").html(""),$("#videoContent").html(""),this.state.data.loadAllFlag=!0,this.state.data.loadImgFlag=!0,this.state.data.loadVideoFlag=!0,null!=this.state.data.infowindow&&this.state.data.infowindow.close(),this.state.data.index=null;var t=this.state.data.map.getAllOverlays("marker");this.state.data.map.remove(t),$("#multimediaAll").html("全部(0)"),$("#multimediaImg").html("图片(0)"),$("#multimediaVideo").html("视频(0)")},t.prototype.getListallData=function(){return r(this,void 0,void 0,(function(){var t,e,a,i,s,n,r,d,c,h,p,m,u,g,f;return l(this,(function(l){switch(l.label){case 0:return(t=new FormData).set("vehicleIds",this.state.data.allVid),t.set("startTime",this.state.data.startTime),t.set("endTime",this.state.data.endTime),t.set("pageNum",this.state.data.allPageNum),t.set("pageSize",this.state.data.allpageSize),t.set("type",this.state.data.allType),this.state.data.slidingFlag&&$(this.state.data.currentTarget).attr("disabled","disabled"),[4,o.a.post("/clbs/lkyw/historicalSnapshot/mediaList",t)];case 1:if(e=l.sent(),this.state.data.listData={data:e},a=this.state.data.listData.data.data,i=this.state.data.listData.data.data.obj,s=i.records,n=this.state.data.allHtml,$("#multimediaAll").text("全部("+i.totalRecords+")"),1==a.success&&""!=i.records){for(r=0;r<s.length;r++)d=s[r].longitude,c=s[r].latitude,h=s[r].type,p=s[r].vehicleId,m=s[r].createDataTime,u=i.start+r+1,n+="<li style='border-bottom: 1px solid #e4e4e4; list-style: none;cursor:pointer;' data-value='"+d+","+c+", "+h+", "+p+" , "+m+"'; class='liAll'><div class='row' style='margin: 0'><div class='col-md-12 sort'>"+u+"</div></div><div class='row' style='margin: 0; height: 118px;position: relative;'><div id='typeImgOrVideo' class='col-md-6'>"+this.mediaUrlNew(s[r].mediaUrlNew,s[r].type)+"</div><div class='col-md-6' style='padding: 0; position: absolute; top: -5px; left: 174px;'><span  class='monitorName' style='font-size:13px;'>监控对象："+this.monitorNameDispose(s[r].monitorName)+"</span></br><span  class='monitorTime' style='font-size:13px;'>时间："+this.timeDispose(s[r].createDataTime)+"</span></br><span  class='monitorSpeed' style='font-size:13px;'>速度："+this.speedDispose(s[r].speed)+"</span></br><span  class='monitorAddress' style='font-size:13px;'>位置："+this.fieldLimits(s[r].address)+"</span></div></div></li>";$("#allContent").html(n),u=this.state.data.index,g=this.state.data.indexFlag,null!=u&&"allContent"==g&&(f=$("#allContent").children(),$(f[u]).find("span").css("color","red"),$(f[u]).find(".sort").css("color","red")),this.state.data.allHtml=n}return $(this.state.data.currentTarget).removeAttr("disabled"),[2]}}))}))},t.prototype.allLoadMore=function(){var t=this.state.data.loadAllFlag;if(this.state.data.slidingFlag=!1,t){var e=this.state.$dom.$allContent[0].scrollHeight;if(this.state.$dom.$allContent[0].scrollTop+this.state.$dom.$allContent.height()>=e){var a=Number(this.state.data.allPageNum)+1;this.state.data.allPageNum=String(a),this.getListallData()}}},t.prototype.getListimgData=function(){return r(this,void 0,void 0,(function(){var t,e,a,i,s,n,r,d,c,h,p,m,u,g,f;return l(this,(function(l){switch(l.label){case 0:return(t=new FormData).set("vehicleIds",this.state.data.allVid),t.set("startTime",this.state.data.startTime),t.set("endTime",this.state.data.endTime),t.set("pageNum",this.state.data.imgPageNum),t.set("pageSize",this.state.data.imgpageSize),t.set("type",this.state.data.imgType),[4,o.a.post("/clbs/lkyw/historicalSnapshot/mediaList",t)];case 1:if(e=l.sent(),this.state.data.listImgResponse={data:e},a=this.state.data.listImgResponse.data.data,i=this.state.data.listImgResponse.data.data.obj,s=i.records,n=this.state.data.imgHtml,$("#multimediaImg").text("图片("+i.totalRecords+")"),1==a.success&&""!=i.records){for(r=0;r<s.length;r++)d=s[r].longitude,c=s[r].latitude,h=s[r].type,p=s[r].vehicleId,m=s[r].createDataTime,u=i.start+r+1,n+="<li style='border-bottom: 1px solid #e4e4e4; list-style: none;cursor:pointer' data-value='"+d+","+c+", "+h+", "+p+" , "+m+"'; class='liAll'><div class='row' style='margin: 0'><div class='col-md-12 sort'>"+u+"</div></div><div class='row' style='margin: 0; height: 118px; position: relative;'><div id='typeImgOrVideo' class='col-md-6'>"+this.mediaUrlNew(s[r].mediaUrlNew,s[r].type)+"</div><div class='col-md-6' style='padding: 0; position: absolute; top: -5px; left: 174px;'><span  class='monitorName' style='font-size:13px;'>监控对象："+this.monitorNameDispose(s[r].monitorName)+"</span></br><span  class='monitorTime' style='font-size:13px;'>时间："+this.timeDispose(s[r].createDataTime)+"</span></br><span  class='monitorSpeed' style='font-size:13px;'>速度："+this.speedDispose(s[r].speed)+"</span></br><span  class='monitorAddress' style='font-size:13px;'>位置："+this.fieldLimits(s[r].address)+"</span></div></div></li>";$("#imgContent").html(n),u=this.state.data.index,g=this.state.data.indexFlag,null!=u&&"imgContent"==g&&(f=$("#imgContent").children(),$(f[u]).find("span").css("color","red"),$(f[u]).find(".sort").css("color","red")),this.state.data.imgHtml=n}return[2]}}))}))},t.prototype.imgLoadMore=function(){if(this.state.data.loadImgFlag){var t=this.state.$dom.$imgContent[0].scrollHeight;if(this.state.$dom.$imgContent[0].scrollTop+this.state.$dom.$imgContent.height()>=t){var e=Number(this.state.data.imgPageNum)+1;this.state.data.imgPageNum=String(e),this.getListimgData()}}},t.prototype.getListvideoData=function(){return r(this,void 0,void 0,(function(){var t,e,a,i,s,n,r,d,c,h,p,m,u,g,f;return l(this,(function(l){switch(l.label){case 0:return(t=new FormData).set("vehicleIds",this.state.data.allVid),t.set("startTime",this.state.data.startTime),t.set("endTime",this.state.data.endTime),t.set("pageNum",this.state.data.videoPageNum),t.set("pageSize",this.state.data.videopageSize),t.set("type",this.state.data.videoType),[4,o.a.post("/clbs/lkyw/historicalSnapshot/mediaList",t)];case 1:if(e=l.sent(),this.state.data.listVideoResponse={data:e},a=this.state.data.listVideoResponse.data.data,i=this.state.data.listVideoResponse.data.data.obj,s=i.records,n=this.state.data.videoHtml,$("#multimediaVideo").text("视频("+i.totalRecords+")"),1==a.success&&""!=i.records){for(r=0;r<s.length;r++)d=s[r].longitude,c=s[r].latitude,h=s[r].type,p=s[r].vehicleId,m=s[r].createDataTime,u=i.start+r+1,n+="<li style='border-bottom: 1px solid #e4e4e4; list-style: none;cursor:pointer' data-value='"+d+","+c+", "+h+", "+p+", "+m+"'; class='liAll'><div class='row' style='margin: 0'><div class='col-md-12 sort'>"+u+"</div></div><div class='row' style='margin: 0; height: 118px; position: relative;'><div id='typeImgOrVideo' class='col-md-6'>"+this.mediaUrlNew(s[r].mediaUrlNew,s[r].type)+"</div><div class='col-md-6' style='padding: 0; position: absolute; top: -5px; left: 174px;'><span class='monitorName' style='font-size:13px;'>监控对象："+this.monitorNameDispose(s[r].monitorName)+"</span></br><span  class='monitorTime' style='font-size:13px;'>时间："+this.timeDispose(s[r].createDataTime)+"</span></br><span  class='monitorSpeed' style='font-size:13px;'>速度："+this.speedDispose(s[r].speed)+"</span></br><span  class='monitorAddress' style='font-size:13px;'>位置："+this.fieldLimits(s[r].address)+"</span></div></div></li>";$("#videoContent").html(n),u=this.state.data.index,g=this.state.data.indexFlag,null!=u&&"videoContent"==g&&(f=$("#videoContent").children(),$(f[u]).find("span").css("color","red"),$(f[u]).find(".sort").css("color","red")),this.state.data.videoHtml=n}else this.state.data.loadVideoFlag=!1;return[2]}}))}))},t.prototype.videoLoadMore=function(){if(this.state.data.loadVideoFlag){var t=this.state.$dom.$videoContent[0].scrollHeight;if(this.state.$dom.$videoContent[0].scrollTop+this.state.$dom.$videoContent.height()>=t){var e=Number(this.state.data.videoPageNum)+1;this.state.data.videoPageNum=String(e),this.getListvideoData()}}},t.prototype.mapFind=function(t){this.state.data.index=$(t.currentTarget).index(),this.state.data.indexFlag=$(t.currentTarget).parent().attr("id");var e=$(t.currentTarget).attr("data-value").split(","),a=e[0],i=e[1],s=e[2],n=e[3].replace(/\s*/g,""),o=e[4];"null"==a&&(a="0"),"null"==i&&(i="0"),this.state.data.map.setZoomAndCenter(18,[Number(a),Number(i)]),this.mediaMapDataDetail(a,i,s,n,o),this.state.data.infoWindowIndex=0,$(t.currentTarget).parent().parent().siblings().children().children().find(".sort").css("color","#5D5F63"),$(t.currentTarget).parent().parent().siblings().children().children().find("span").css("color","#5D5F63"),$(t.currentTarget).siblings("li").find(".sort").css("color","#5D5F63"),$(t.currentTarget).siblings("li").find("span").css("color","#5D5F63"),$(t.currentTarget).find(".sort").css("color","red"),$(t.currentTarget).find("span").css("color","red")},t.prototype.mediaUrlNew=function(t,e){return 0==e?'<img id="imgDom" src="'+t+'" style="height:103px; width: 160px"/>':2==e?null==t?"<img src='/clbs/resources/lkyw/src/assets/img/noVideo.png'/>":'<video id="videoDom" src="'+t+'" controls="controls" controlsList="nodownload" style="width: 160px;height: 103px;"></video>':void 0},t.prototype.monitorNameDispose=function(t){return null==t||""==t?"-":t},t.prototype.timeDispose=function(t){return null==t||""==t?"-年-月-日-时-分-秒":t},t.prototype.speedDispose=function(t){return null==t||""==t?"- km/h":t+"km/h"},t.prototype.fieldLimits=function(t){return String(t).length>30?t.substring(0,30)+"......":t},t.prototype.validates=function(){return $("#captrueList").validate({rules:{groupSelect:{zTreeChecked:"treeDemo"}},messages:{groupSelect:{zTreeChecked:"请至少选择一个监控对象"}}}).form()},t.prototype.handleclose=function(){this.dependency.get("layout").back()},t.prototype.handspanHide=function(){$(this).next().is(":hidden")&&($(this).siblings("input").trigger("focus"),$(this).siblings("input").trigger("cick"))},t.prototype.handleFullDisplay=function(){var t=this.state.data.address;$(".info_left .address").html("位置："+t)},t.prototype.handleExceedHide=function(){var t=this.state.data.address;return String(t).length>30?$(".info_left .address").html("位置："+t.substring(0,30)+"......"):$(".info_left .address").html("位置："+t)},t.prototype.handleUrlDispose=function(t){return null==t?"/clbs/resources/lkyw/src/assets/img/noVideo.png":t},t}();e.default=d}}]);