(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{175:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var a=r(177);function i(e){var t=e;return a.inflate(t,{to:"string"})}},178:function(e,t,r){},221:function(e,t){e.exports='<div id="video-main-content" class="video-main-content">\r\n  \x3c!-- 左侧 --\x3e\r\n  <div class="video-main-left pull-left">\r\n    \x3c!-- 车辆树 --\x3e\r\n    <div class="vehicle-content">\r\n      <div class="panel-heading">\r\n        <strong>视频回放</strong>\r\n\r\n      </div>\r\n      <div class="panel-body">\r\n        \x3c!-- 日历 --\x3e\r\n        <div class="calendar calendar3"></div>\r\n\r\n        <div class="form-group select-condition clearfix" style="margin-top: 10px;margin-bottom: 7px;">\r\n          <div class="col-md-5 no-padding">\r\n            <input type="hidden" id="findType" />\r\n            <select class="form-control" id="type"></select>\r\n          </div>\r\n          <div class="col-md-5 no-padding monitorBox">\r\n            <input id="groupSelectVideoPlayback" placeholder="监控对象" type="text" autocomplete="off"\r\n              class="form-control input-white-bg" />\r\n          </div>\r\n          <div class="col-md-2 no-padding">\r\n            <button type="button" id="inquiry" style="padding: 8px 14px 7px" class="btn btn-primary">\r\n              <img src="/clbs/resources/img/gjSearch.svg" style="width: 25px;height:20px;max-width:none" alt="">\r\n            </button>\r\n          </div>\r\n        </div>\r\n        <div id=\'emptyNotification\'\r\n          style="text-align: center;display: none;position: absolute;left: 0;right: 0;margin: 0 auto;">\r\n          <span>暂无数据</span>\r\n        </div>\r\n        <div id=\'lkywTreeLoading\'\r\n          style="text-align: center;display: none;position: absolute;left: 0;right: 0;margin: 0 auto;">\r\n          <i class="fa fa-spinner loading-state"></i>\r\n          <span>加载中，请稍后...</span>\r\n        </div>\r\n        <ul id="treeDemoVideoPlayback" class="ztree" style="overflow-y: auto"></ul>\r\n        <div class="form-horizontal" style="padding-top: 10px;">\r\n          <div class="form-group allGroup">\r\n            <div style="cursor:pointer" id="chooseAll_videoPlayback"\r\n              class="col-md-4 col-sm-5 col-xs-5 text-center btnPadding onlineStatus">\r\n              <span>全部</span>\r\n            </div>\r\n            <div style="cursor:pointer;color: #45a541;" id="online_videoPlayback"\r\n              class="col-md-4 col-sm-5 col-xs-5 text-center btnPaddingOnLine onlineStatus">\r\n              <span>在线</span>\r\n            </div>\r\n            <div style="cursor:pointer" id="chooseMissLine_videoPlayback"\r\n              class="col-md-4 col-sm-5 col-xs-5 text-center btnPadding onlineStatus">\r\n              <span>不在线</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  \x3c!-- 右侧 --\x3e\r\n  <div class="video-main-right pull-right">\r\n    \x3c!-- 视频及地图 --\x3e\r\n    <div class="video-right-top video-map-content" id="videoBackRightTop">\r\n      \x3c!-- 视频 --\x3e\r\n      <div class="col-md-9 col-padding-zero resource-video-module animate-display" id="resource-video-module">\r\n        \x3c!-- 资源列表默认视频 --\x3e\r\n        <div class="pull-left hidden-video" id="resourceVideoDefault">\r\n          <video width="100%" height="100%" id="videoSource" autoplay></video>\r\n          <span class="video-controls"></span>\r\n        </div>\r\n        \x3c!-- 播放列表默认视频 --\x3e\r\n        <div class="pull-left" id="playListVideoDefault">\r\n          <video width="100%" height="100%" autoplay></video>\r\n          <span class="video-controls"></span>\r\n        </div>\r\n      </div>\r\n      \x3c!-- 地图 --\x3e\r\n      <div class="col-md-3 col-padding-zero resource-map-module animate-display" id="resource-map-module">\r\n        <div id="mapAllShow">\r\n          <i class="fa fa-chevron-left"></i>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    \x3c!-- 列表 --\x3e\r\n    <div class="video-right-bottom" id="videoRightBottom">\r\n      <ul class="nav nav-tabs" role="tablist">\r\n        <li id="playListActive" class="active"><a href="#playList" data-toggle="tab">播放列表</a></li>\r\n        <li id="resourceListActive"><a href="#resourceList" data-toggle="tab">资源列表</a></li>\r\n        <li id="FTPListActive"><a href="#ftpList" data-toggle="tab">FTP资源</a></li>\r\n\r\n        \x3c!-- 播放列表  回放下拉模块 --\x3e\r\n        <li class="video-back-module">\r\n          <select id="videoPlayWay" disabled="disabled" class="form-control">\r\n            <option value="0">正常回放</option>\r\n            <option value="1">快进回放</option>\r\n            <option value="2">关键帧快退回放</option>\r\n            <option value="3">关键帧播放</option>\r\n            <option value="4">单帧上传</option>\r\n          </select>\r\n        </li>\r\n        \x3c!-- 播放列表 - 播放模块 --\x3e\r\n        <li class="video-play-module">\r\n          <i id="playListVideoPlay" class="video-play" title="播放"></i>\r\n          <i id="playListVideoFrame" class="video-frame" title="关键帧播放"></i>\r\n          <i id="playListVideoStop" class="video-stop" title="停止"></i>\r\n          <i id="playListVideoBack" data="0" class="video-back" title="快退"></i>\r\n          <i id="playListVideoGoing" data="0" class="video-going" title="快进"></i>\r\n          \x3c!-- 播放倍数 --\x3e\r\n          <i id="videoPlayZoom">\r\n            <div class="left-grip">倍数×&nbsp;<span id="playLeftGripVal">1</span></div>\r\n            <div class="nstSlider" id="playListSilder" data-range_min="1" data-range_max="16" data-cur_min="0">\r\n              <div class="leftGrip" id="rightGripValue"></div>\r\n            </div>\r\n          </i>\r\n        </li>\r\n        \x3c!-- 资源列表  回放下拉模块 --\x3e\r\n        <li class="video-play-select">\r\n          <select id="videoResourcePlayWay" disabled="disabled" class="form-control">\r\n            <option value="0">正常回放</option>\r\n            <option value="1">快进回放</option>\r\n            <option value="2">关键帧快退回放</option>\r\n            <option value="3">关键帧播放</option>\r\n            <option value="4">单帧上传</option>\r\n          </select>\r\n        </li>\r\n        \x3c!-- 资源列表 - 播放模块 --\x3e\r\n        <li class="video-resource-module">\r\n          <i id="resourceListVideoPlay" class="video-resource-play" title="播放"></i>\r\n          <i id="resourceListVideoFrame" class="video-resource-frame" title="关键帧播放"></i>\r\n          <i id="resourceListVideoStop" class="video-resource-stop" title="停止"></i>\r\n          <i id="resourceListVideoBack" data="1" class="video-resource-back" title="快退"></i>\r\n          <i id="resourceListVideoGoing" data="1" class="video-resource-going" title="快进"></i>\r\n          \x3c!-- 播放倍数 --\x3e\r\n          <i id="videoPlayZoom">\r\n            <div class="left-grip">倍数×&nbsp;<span id="resourceLeftGripVal">1</span></div>\r\n            <div class="nstSlider" id="resourceListSilder" data-range_min="1" data-range_max="16" data-cur_min="0">\r\n              <div class="leftGrip" id="leftGripValue"></div>\r\n            </div>\r\n          </i>\r\n        </li>\r\n        \x3c!-- 向下隐藏按钮 --\x3e\r\n        <li class="tab-hide-down">\r\n          <i id="videoBackScalingBtn" class="fa fa-chevron-up"></i>\r\n        </li>\r\n      </ul>\r\n      <div class="tab-content">\r\n        \x3c!-- 播放列表 --\x3e\r\n        <div role="tabpanel" class="tab-pane play-list active" id="playList">\r\n          \x3c!-- 通道选择模块 --\x3e\r\n          <div class="video-aisle" id="videoChannelSelection"></div>\r\n          \x3c!-- 列表 --\x3e\r\n          <div class="col-padding-zero">\r\n            <div class="col-padding-zero playlist-wave-chart">\r\n              \x3c!-- 插件开始 --\x3e\r\n              <div id="containersVideoPlayback" class="video-status">\r\n                <div class="left">\r\n                  <div id="thisDateOf" class="day"></div>\r\n                  <div class="title">小时</div>\r\n                  <div class="channel-title-container">\r\n                  </div>\r\n                </div>\r\n                <div class="right">\r\n                  <div class="thumb-container" style="text-align: center;">\r\n                    <img src="src/assets/img/videoTip/u519.png" alt="" width="16px" height="16px">\r\n                    <span style="color: #FCBC53;">\r\n                      温馨提示:滚动鼠标滚轮进行切换时间刻度(时、分、秒)</span>\r\n                    <div class="thumb">\r\n                      <span id="h" class="h">00:</span>\r\n                      <span id="m" class="m">00:</span>\r\n                      <span id="s" class="s">00</span>\r\n                      <div class="line" id=\'NewtimeLine\'>\r\n\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  <div class="ruler">\r\n                    <div class="section">\r\n                      <div class="section-half"></div>\r\n                    </div>\r\n                  </div>\r\n                  <div class="channel-container">\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        \x3c!-- 资源列表 --\x3e\r\n        <div role="tabpanel" class="tab-pane" id="resourceList">\r\n          \x3c!-- <table id="resourceListDataTable" class="table table-striped table-bordered table-hover"\r\n                        cellspacing="0" width="100%">\r\n                        <thead>\r\n                            <tr>\r\n                                <th width="50px">序号</th>\r\n                                <th>操作设置</th>\r\n                                <th>状态</th>\r\n                                <th>监控对象</th>\r\n                                <th>终端号</th>\r\n                                <th>终端手机号</th>\r\n                                <th>通道号</th>\r\n                                <th>开始时间</th>\r\n                                <th>结束时间</th>\r\n                                <th>报警类型</th>\r\n                                <th>文件大小(M)</th>\r\n                                <th>资源类型</th>\r\n                                <th>码流类型</th>\r\n                                <th>存储器类型</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody></tbody>\r\n                    </table> --\x3e\r\n        </div>\r\n        \x3c!-- FTP资源列表 --\x3e\r\n        <div role="tabpanel" class="tab-pane" id="ftpList">\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n\x3c!--高级查询弹窗--\x3e\r\n<div class="modal fade" id="advancedQuery" tabindex="-1" aria-hidden="false" data-backdrop="static" role="dialog">\r\n  <div class="modal-dialog" role="document">\r\n    <div class="modal-content">\r\n      <form id="advancedFrom" role="form" action="/clbs/realTimeVideo/resource/upLoad" method="post"\r\n        class="form-horizontal">\r\n        <div class="modal-header">\r\n          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\r\n          <h4 class="modal-title">高级查询</h4>\r\n          <input type="hidden" name="vehicleId" id="advanced_vehicleId" />\r\n        </div>\r\n        <div class="modal-body" style="overflow-y: visible;">\r\n          <div class="row">\r\n            <div class="form-group">\r\n              <label class="col-md-3 control-label col-padding-left">时间：</label>\r\n              <div class="col-md-8">\r\n                <div class="input-group layui-input-inline">\r\n                  <input type="text" class="form-control input-text-cursor input-white-bg" id="searchStartTime"\r\n                    readonly="readonly" lay-key="111">\r\n                  <span class="input-group-addon input-group-border">-</span>\r\n                  <input type="text" class="form-control input-text-cursor input-white-bg" id="searchEndTime"\r\n                    readonly="readonly" lay-key="222">\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div id="alarmBox" class="form-group has-feedback">\r\n              <label class="col-md-3 control-label col-padding-left">报警类型：</label>\r\n              <div class="col-md-8">\r\n                <input placeholder="请选择报警类型" class="form-control input-text-cursor input-white-bg" id="alarmSelect"\r\n                  autocomplete="off">\r\n                <span class="fa fa-chevron-down form-control-feedback" style="top: 0; right: 2px;cursor:pointer"\r\n                  aria-hidden="true" id="alarmSelectSpan"></span>\r\n                <div id="alarmContent" class="menuContent" style="width: 279.5px; display: none;">\r\n                  <ul id="alarmTree" class="ztree"></ul>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div class="form-group">\r\n              <label class="col-md-3 control-label col-padding-left">通道号：</label>\r\n              <div class="col-md-8">\r\n                <select class="form-control" id="channelNum">\r\n                  <option value="0" id="allNum">全部</option>\r\n                </select>\r\n              </div>\r\n            </div>\r\n            <div class="form-group">\r\n              <label class="col-md-3 control-label col-padding-left">资源类型：</label>\r\n              <div class="col-md-8">\r\n                <select class="form-control" id="videoType">\r\n                  <option value="0" selected="selected" id="allVideoType">音视频</option>\r\n                  <option value="1">音频</option>\r\n                  <option value="2">视频</option>\r\n                  <option class="approvalHide" value="3">视频或音视频</option>\r\n                </select>\r\n              </div>\r\n            </div>\r\n            <div class="form-group approvalHide">\r\n              <label class="col-md-3 control-label col-padding-left">码流类型：</label>\r\n              <div class="col-md-8">\r\n                <select class="form-control" id="codeSchema">\r\n                  <option value="0" selected="selected">所有码流</option>\r\n                  <option value="1">主码流</option>\r\n                  <option value="2">子码流</option>\r\n                </select>\r\n              </div>\r\n            </div>\r\n            <div class="form-group approvalHide">\r\n              <label class="col-md-3 control-label col-padding-left">存储器类型：</label>\r\n              <div class="col-md-8">\r\n                <select class="form-control" id="storageType">\r\n                  <option value="0" selected="selected">所有存储器</option>\r\n                  <option value="1">主存储器</option>\r\n                  <option value="2">灾备存储器</option>\r\n                </select>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class="modal-footer">\r\n          <button class="btn btn-primary" type="button" id="advancedSubmit">\r\n            <strong>查询</strong>\r\n          </button>\r\n          <button type="button" class="btn btn-default" data-dismiss="modal">\r\n            <strong>关闭</strong>\r\n          </button>\r\n        </div>\r\n      </form>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n\r\n<div class="modal fade" id="uploadVideoModal" tabindex="-1" aria-hidden="false" data-backdrop="static" role="dialog">\r\n  <div class="modal-dialog" role="document">\r\n    <div class="modal-content">\r\n      <form id="uploadFrom" role="form" action="/clbs/realTimeVideo/resource/upLoad" method="post"\r\n        class="form-horizontal">\r\n        <div class="modal-header">\r\n          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\r\n          <h4 class="modal-title">文件上传：<span id="upload_brand"></span></h4>\r\n          <input type="hidden" name="vehicleId" id="upload_vehicleId" />\r\n          <input type="hidden" name="channelNumber" id="upload_channelNumbe" />\r\n          <input type="hidden" name="startTime" id="upload_startTime" />\r\n          <input type="hidden" name="endTime" id="upload_endTime" />\r\n          <input type="hidden" name="alarmSign" id="upload_alarm" />\r\n          <input type="hidden" name="resourceType" id="upload_resourceType" />\r\n          <input type="hidden" name="streamType" id="upload_streamType" />\r\n          <input type="hidden" name="storageAddress" id="upload_storageAddress" />\r\n          <input type="hidden" id="uploadId" />\r\n          <input type="hidden" id="state" />\r\n          <input type="hidden" id="stop" />\r\n          <input type="hidden" id="cancel" />\r\n          <input type="hidden" id="filesize" name="filesize" />\r\n          <input type="hidden" name="FTPassword" id="FTPassword" />\r\n        </div>\r\n        <div class="modal-body">\r\n          <div class="row">\r\n            <div class="form-group">\r\n              <label class="col-md-4 control-label"><label class="text-danger">*</label>FTP服务器IP：</label>\r\n              <div class="col-md-6">\r\n                <input type="text" name="FTPServerIp" id="FTPServerIp" class="form-control" placeholder="请输入IP地址" />\r\n              </div>\r\n            </div>\r\n            <div class="form-group">\r\n              <label class="col-md-4 control-label"><label class="text-danger">*</label>端口：</label>\r\n              <div class="col-md-6">\r\n                <input type="text" name="FTPort" id="FTPort" class="form-control" placeholder="请输入端口" />\r\n              </div>\r\n            </div>\r\n            <div class="form-group">\r\n              <label class="col-md-4 control-label"><label class="text-danger">*</label>用户名：</label>\r\n              <div class="col-md-6">\r\n                <input type="text" name="FTPUserName" id="FTPUserName" class="form-control" placeholder="请输入用户名" />\r\n              </div>\r\n            </div>\r\n            <div class="form-group">\r\n              <label class="col-md-4  control-label"><label class="text-danger">*</label>密码：</label>\r\n              <div class="col-md-6">\r\n                <input type="password" id="FTPpwd" class="form-control" />\r\n              </div>\r\n            </div>\r\n            <div class="form-group">\r\n              <label class="col-md-4 control-label">文件上传路径：</label>\r\n              <div class="col-md-6">\r\n                <input type="text" name="fileUploadPath" id="fileUploadPath" readonly class="form-control"\r\n                  placeholder="请输入文件上传路径" />\r\n              </div>\r\n            </div>\r\n            <div class="form-group">\r\n              <label class="col-md-4 control-label"><label class="text-danger">*</label> 执行条件：</label>\r\n              <div class="col-md-6" id="execute">\r\n                <input type="hidden" name="executeOn" id="executeOn" />\r\n                <label class="checkbox-inline">\r\n                  <input type="checkbox" checked="checked" id="wifi"> WIFI\r\n                </label>\r\n                <label class="checkbox-inline">\r\n                  <input type="checkbox" checked="checked" id="lan"> LAN\r\n                </label>\r\n                <label class="checkbox-inline">\r\n                  <input type="checkbox" checked="checked" id="threeOrFourG"> 3G/4G\r\n                </label>\r\n                <div id="executeError" class="error hidden">不能为空</div>\r\n              </div>\r\n\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class="modal-footer">\r\n          <button class="btn btn-primary" type="button" id="sendSubmit">\r\n            <strong>下 发</strong>\r\n          </button>\r\n          <button type="button" class="btn btn-default" data-dismiss="modal">\r\n            <strong>关 闭</strong>\r\n          </button>\r\n        </div>\r\n      </form>\r\n    </div>\r\n  </div>\r\n</div>'},222:function(e,t,r){},258:function(t,r,a){"use strict";a.r(r);var i,s,o,l,n,c,d,u,p,h,v,m,f,y,g,b,L,k,T,S,V,C,x,w,P,D,N,F,A,G=a(221),I=a.n(G),j=(a(178),a(175)),B=a(22),M=[],_=[],O="",R="",E=[],H="",z={},U="",q=[],Z=null,K=[],W=[],Q=["one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen"],J=$("#header").height(),Y=[],X=[],ee=0,te=!0,re=1,ae=1,ie=1,se=1,oe=!1,le=[],ne=null,ce=0,de=!1,ue=[],pe=!1,he=!1,ve=null,me=null,fe=null,ye=null,ge=!1,be=!0,$e=null,Le=null,ke=0,Te=!0,Se=!1,Ve=!0,Ce=["1","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28"],xe=null,we=null,Pe=null,De=null,Ne=null,Fe=null,Ae=null,Ge=null,Ie="all",je={},Be="",Me=1;window.resourceList={webSocket:null,getOnlineArray:null,videoIsFlag:!1,init:function(e){$(".calendar3").calendar(),xe=new AMap.Map("resource-map-module",{resizeEnable:!0,zoom:18}),V=new resourceList.maps,k=new resourceList.maps,s=new resourceList.maps,o=new resourceList.maps,l=new resourceList.maps,n=new resourceList.maps,c=new resourceList.maps,S=new resourceList.maps,d=new resourceList.maps,D=new resourceList.maps,u=new resourceList.maps,F=new resourceList.maps,resourceList.setTreeHeight(),$(window).resize((function(){resourceList.setTreeHeight()})),resourceList.videoSocketSubscribe(),resourceList.videoDateSocketSubscribe(),resourceList.historyPlaySubscribe(),resourceList.historyControlSubscribe(),json_ajax("POST","/clbs/m/functionconfig/fence/bindfence/getStatistical","json",!0,{webType:2},(function(t){N=t.obj.allV,e.id?window.videoPlaybackChoseTreeNode(e):resourceList.resourceListTree()})),layer.msg("请选择监控对象",{time:-1})},changeYMcallback:function(){""!==O?(ge=!1,resourceList.videoIsFlag=!0,resourceList.inquiry(1)):resourceList.videoIsFlag=!1},setTreeHeight:function(){$(window).width()<1200?$("body").css("overflow","auto"):$("body").css("overflow","hidden"),we=$(window).height(),J=50,Pe=$(".panel-heading").height()+20,De=$(".select-condition").height()+10,5==(Ne=$(".calendar3 tbody tr").length)?Fe=295:4==Ne?Fe=350:6==Ne&&(Fe=340),Ae=we-J-Pe-Fe-De-85,$("#treeDemoVideoPlayback").css("height",Ae+"px"),we<=667&&$("#treeDemoVideoPlayback").css("height","150px")},maps:function(){this.elements=[],this.size=function(){return this.elements.length},this.isEmpty=function(){return this.elements.length<1},this.clear=function(){this.elements=[]},this.put=function(e,t,r){this.elements.push({key:e,value:t,newKey:r})},this.remove=function(e){var t=!1;try{for(var r=0,a=this.elements.length;r<a;r++)if(this.elements[r].key==e)return this.elements.splice(r,1),!0}catch(e){t=!1}return t},this.get=function(e){try{for(var t=0,r=this.elements.length;t<r;t++)if(this.elements[t].key==e)return this.elements[t].value}catch(e){return null}},this.element=function(e){return e<0||e>=this.elements.length?null:this.elements[e]},this.containsKey=function(e){var t=!1;try{for(var r=0,a=this.elements.length;r<a;r++)this.elements[r].key==e&&(t=!0)}catch(e){t=!1}return t},this.containsValue=function(e){var t=!1;try{for(var r=0,a=this.elements.length;r<a;r++)this.elements[r].value==e&&(t=!0)}catch(e){t=!1}return t},this.values=function(){for(var e=new Array,t=0,r=this.elements.length;t<r;t++)e.push(this.elements[t].value);return e},this.keys=function(){for(var e=new Array,t=0,r=this.elements.length;t<r;t++)e.push(this.elements[t].key);return e}},ymdFormator:function(e){var t=e,r=t.getFullYear().toString(),a=t.getMonth()+1;a=a<10?"0"+a.toString():a.toString();var i=t.getDate();return r+"-"+a+"-"+(i=i<10?"0"+i.toString():i.toString())},searchTimeLoad:function(){var e=new Date,t=resourceList.ymdFormator(e);$("#searchStartTime").val(t+" 00:00:00");var r=resourceList.ymdFormator(e);$("#searchEndTime").val(r+" 23:59:59"),laydate.render({elem:"#searchStartTime",theme:"#6dcff6",type:"datetime"}),laydate.render({elem:"#searchEndTime",theme:"#6dcff6",type:"datetime"})},resourceListTree:function(){var e={async:{url:resourceList.getIcoTreeUrl,type:"post",enable:!0,autoParam:["id"],dataType:"json",sync:!1,otherParam:{type:"resource"},dataFilter:resourceList.ajaxDataFilter},check:{enable:!0,chkStyle:"radio",chkboxType:{Y:"s",N:"s"},radioType:"all"},view:{dblClickExpand:!1,nameIsHTML:!0,fontCss:setFontCss_sphf_ztree,countClass:"group-number-statistics",addDiyDom:resourceList.addDiyDom},data:{simpleData:{enable:!0}},callback:{beforeClick:resourceList.beforeClickVehicle,beforeCheck:resourceList.zTreeBeforeCheck,onCheck:resourceList.onCheckVehicle,onExpand:resourceList.zTreeOnExpand,onAsyncSuccess:resourceList.zTreeOnAsyncSuccess,onNodeCreated:resourceList.zTreeOnNodeCreated}};$.fn.zTree.init($("#treeDemoVideoPlayback"),e,null)},getIcoTreeUrl:function(e,t){var r;return null==t?r="all"===Ie?N<=5e3?"/clbs/m/functionconfig/fence/bindfence/new/monitorTree?webType=2":"/clbs/m/functionconfig/fence/bindfence/bigDataMonitorTree":"online"===Ie?"/clbs/m/basicinfo/monitoring/vehicle/new/treeStateInfo?webType=2&type=1":N<=5e3?"/clbs/m/basicinfo/monitoring/vehicle/treeStateInfo?webType=2&type=7":"/clbs/m/functionconfig/fence/bindfence/bigDataMonitorTree":"assignment"==t.type&&(r="/clbs/m/functionconfig/fence/bindfence/new/putMonitorByAssign?assignmentId="+t.id+"&isChecked="+t.checked+"&monitorType=monitor&webType=2"),r},zTreeBeforeAsync:function(){return bflag},beforeClickVehicle:function(e,t){var r=$.fn.zTree.getZTreeObj("treeDemoVideoPlayback");return t.checked||r.checkNode(t,!t.checked,!0,!0),!1},zTreeOnAsyncSuccess:function(){var e=$.fn.zTree.getZTreeObj("treeDemoVideoPlayback");i<=5e3&&e.checkAllNodes(!0),$("#lkywTreeLoading").hide(),e.getNodes().length<1&&$("#emptyNotification").show()},zTreeOnNodeCreated:function(e,t,r){$.fn.zTree.getZTreeObj("treeDemoVideoPlayback");var a=r.id.toString(),i=[];null==z[a]||null==z[a]?(i=[r.tId],z[a]=i):z[a].push(r.tId)},ajaxDataFilter:function(e,t,r){var a,s;null!=(a=null==r.msg?"online"===Ie?r:JSON.parse(Object(j.a)(r)):JSON.parse(Object(j.a)(r.msg))).tree&&null!=a.tree?(s=a.tree,i=a.size):s=a;var o=resourceList.getOnlineArray();"offline"===Ie&&(s=s.filter((function(e){return"assignment"===e.type||"group"===e.type||!(o.indexOf(e.id)>-1)})));for(var l=0;l<s.length;l++)"group"!=s[l].type&&"assignment"!=s[l].type||(s[l].open=!0,s[l].nocheck=!0),"people"!=s[l].type&&"vehicle"!=s[l].type&&"thing"!=s[l].type||(s[l].isParent=!1);return s},zTreeBeforeCheck:function(e,t){var r=!0;if(!t.checked){if("group"==t.type||"assignment"==t.type){var a=(l=$.fn.zTree.getZTreeObj("treeDemoVideoPlayback")).getCheckedNodes(!0),i=0;json_ajax("post","/clbs/m/personalized/ico/getCheckedVehicle","json",!1,{parentId:t.id,type:t.type},(function(e){e.success?i+=e.obj:null!=e.msg&&""!=e.msg&&layer.msg(e.msg)}));for(var s=[],o=0;o<a.length;o++){if(n=a[o].id,"people"==a[o].type||"vehicle"==a[o].type)null==l.getNodeByParam("tId",a[o].tId,t)&&-1==$.inArray(n,s)&&s.push(n)}i+=s.length}else if("people"==t.type||"vehicle"==t.type||"thing"==t.type){var l,n;for(a=(l=$.fn.zTree.getZTreeObj("treeDemoVideoPlayback")).getCheckedNodes(!0),i=0,s=[],o=0;o<a.length;o++)n=a[o].id,"people"!=a[o].type&&"vehicle"!=a[o].type&&"thing"!=a[o].type||-1==$.inArray(n,s)&&s.push(n);i=s.length+1}i>5e3&&(layer.msg(maxSelectItem),r=!1)}return r&&("group"!=t.type||t.checked||(Ge=!0)),r},onCheckVehicle:function(e,t,r){layer.closeAll();var a=$.fn.zTree.getZTreeObj("treeDemoVideoPlayback");r.checked||a.checkNode(r,!r.checked,!0,!0),Be=r.deviceType,v=0,$("#channelNum").val("0"),"23"===Be?($("#type").val("0"),$("#allNum").hide(),$("#ftpServer").hide()):($("#allNum").show(),$("#ftpServer").show()),Z=r.id,resourceList.vehicleListId(r),$("#videoBackScalingBtn").removeClass("fa fa-chevron-down").addClass("fa fa-chevron-up"),$("#videoBackRightTop").css("height","calc(100% - 42px)")},zTreeOnExpand:function(e,t,r){if("group"!=r.type||Ge){Ge=!1;var a=$.fn.zTree.getZTreeObj("treeDemoVideoPlayback");if("group"==r.type){json_ajax("post","/clbs/m/functionconfig/fence/bindfence/putMonitorByGroup","json",!1,{groupId:r.id,isChecked:r.checked,monitorType:"vehicle"},(function(e){var t=e.obj;null!=t&&null!=t&&$.each(t,(function(e){var r=e,i=(t[e],z[r][0]),s=a.getNodeByTId(i);void 0===s.children&&a.addNodes(s,[])}))}))}}},addDiyDom:function(e,t){if(-1!==["vehicle","people","thing"].indexOf(t.type)&&t.status&&3!==t.status){var r='<img src="'+(1===t.acc?"/clbs/resources/img/videoPrompt/accgreen.svg":"/clbs/resources/img/videoPrompt/accgray.svg")+'"style="height:19px;width:43px;"/>';$("#"+t.tId+"_a").append(r)}},ajaxQueryDataFilter:function(e,t,r){r=JSON.parse(Object(j.a)(r));var a=[];null!=M&&null!=M&&M.length>0&&(a=(","==M.slice(M.length-1)?M.slice(0,-1):M).split(","));for(var i=0;i<r.length;i++)"group"!=r[i].type&&"assignment"!=r[i].type||(r[i].open=!0,r[i].nocheck=!0),"-1"!=Ce.indexOf(r[i].deviceType)&&(r[i].isParent=!1);return filterQueryResult(r,a)},searchVehicleTree:function(e,t){$("#lkywTreeLoading i").css("visibility","visible"),$("#lkywTreeLoading span").text("加载中，请稍后"),$("#lkywTreeLoading").show(),$("#emptyNotification").hide();var r={async:{url:"/clbs/a/search/new/monitorTreeFuzzy",type:"post",enable:!0,autoParam:["id"],dataType:"json",sync:!1,otherParam:{type:"single",queryParam:e,queryType:"name",webType:"2"},dataFilter:resourceList.ajaxQueryDataFilter},check:{enable:!0,chkStyle:"radio",chkboxType:{Y:"s",N:"s"},radioType:"all"},view:{dblClickExpand:!1,nameIsHTML:!0,fontCss:setFontCss_sphf_ztree,countClass:"group-number-statistics",addDiyDom:resourceList.addDiyDom},data:{simpleData:{enable:!0}},callback:{beforeClick:resourceList.beforeClickVehicle,onAsyncSuccess:function(){resourceList.fuzzyZTreeOnAsyncSuccess(),"function"==typeof t&&setTimeout(()=>{t()},1e3)},onCheck:resourceList.fuzzyOnCheckVehicle}};$.fn.zTree.init($("#treeDemoVideoPlayback"),r,null)},fuzzyOnCheckVehicle:function(e,t,r){var a=$.fn.zTree.getZTreeObj("treeDemoVideoPlayback");r.checked||a.checkNode(r,!r.checked,!0,!0),"23"===(Be=r.deviceType)?($("#type").val("0"),$("#ftpServer").hide()):$("#ftpServer").show();var i=a.getChangeCheckedNodes();if(r.checked){resourceList.vehicleListId(r);for(var s=a.getCheckedNodes(!0),o=0,l=0;l<s.length;l++)"people"!=s[l].type&&"vehicle"!=s[l].type&&"thing"!=s[l].type||(o+=1);if(o>5e3){layer.msg("最多勾选5000个监控对象！");for(l=0;l<i.length;l++)i[l].checked=!1,a.updateNode(i[l])}}for(l=0;l<i.length;l++)i[l].checkedOld=i[l].checked;Z=r.id,$("#groupSelectVideoPlayback").val(r.name.replace("ACC","")),$("#videoBackScalingBtn").removeClass("fa fa-chevron-down").addClass("fa fa-chevron-up"),$("#videoBackRightTop").css("height","calc(100% - 42px)")},fuzzyZTreeOnAsyncSuccess:function(e,t,r){0==$.fn.zTree.getZTreeObj("treeDemoVideoPlayback").getNodes().length?($("#lkywTreeLoading i").css("visibility","hidden"),$("#lkywTreeLoading span").text("未找到查询对象")):$("#lkywTreeLoading").hide();var a=$.fn.zTree.getZTreeObj("treeDemoVideoPlayback");a.expandAll(!0),a.getNodes().length},vehicleListId:function(e){"Microsoft Internet Explorer"==navigator.appName&&$(".input-placeholder").remove(),$("#groupSelectVideoPlayback").val(e.name.replace("ACC","")),R=e.name.replace("ACC",""),O=e.id,ge=!1,$("#resourceListActive").hasClass("active")&&(resourceList.resourceVideoStopFn(),$("#resourceListActive,#resourceList,#ftpList").removeClass("active"),$("#playListActive,#playList").addClass("active"),$(".video-back-module,.video-play-module").show(),$(".video-play-select,.video-resource-module").hide()),resourceList.inquiry(1),resourceList.getVideoChannel(O)},getVideoChannel:function(e){json_ajax("POST","/clbs/realTimeVideo/resource/getVideoChannel","json",!1,{vehicleId:e},resourceList.getVideoChannelCallack)},getVideoChannelCallack:function(e){if(e.success){var t=e.obj,r="";T=[];var a=[];je={},W=[];for(var i=0;i<t.length;i++)0===t[i].channelType||2===t[i].channelType?(T.push(t[i].logicChannel),a.push(t[i].logicChannel),je[t[i].logicChannel]=t[i].logicChannel):je[t[i].logicChannel]=t[i].logicChannel;X.forEach(e=>{T.some(t=>t===e)||(W.push(e),a.push(e),T.push(e))}),r='<option value="0">全部</option>',"23"===Be&&(r="");for(var s=0;s<a.length;s++){var o=a[s];v==T[s]?r+="<option selected value="+o+">"+o+"</option>":r+="<option value="+o+">"+o+"</option>"}$("#channelNum").html(r)}},easySort:function(e,t){return e-t},showMenu:function(e){if($("#menuContent").is(":hidden")){var t=$("#groupSelectVideoPlayback").width(),r=t+0+21;"Microsoft Internet Explorer"==navigator.appName?$("#menuContent").css("width",t+7+"px"):$("#menuContent").css("width",r+"px"),$(window).resize((function(){var e=$("#groupSelectVideoPlayback").width(),t=e+0+21;"Microsoft Internet Explorer"==navigator.appName?$("#menuContent").css("width",e+7+"px"):$("#menuContent").css("width",t+"px")})),$("#menuContent").slideDown("fast")}else $("#menuContent").is(":hidden");$("body").on("mousedown",resourceList.onBodyDown)},hideMenu:function(){$("#menuContent").fadeOut("fast"),$("body").off("mousedown",resourceList.onBodyDown)},onBodyDown:function(e){"menuBtn"==e.target.id||"menuContent"==e.target.id||$(e.target).parents("#menuContent").length>0||resourceList.hideMenu()},showMenuAlarm:function(e){if($("#alarmContent").is(":hidden")){var t=$("#alarmSelect").width(),r=t+$("#alarmSelectSpan").width()+21;"Microsoft Internet Explorer"==navigator.appName?$("#alarmContent").css("width",t+7+"px"):$("#alarmContent").css("width",r+"px"),$(window).resize((function(){var e=$("#groupSelectVideoPlayback").width(),t=e+0+21;"Microsoft Internet Explorer"==navigator.appName?$("#alarmContent").css("width",e+7+"px"):$("#alarmContent").css("width",t+"px")})),$("#alarmContent").slideDown("fast")}else $("#alarmContent").is(":hidden");$("body").on("mousedown",resourceList.onBodyDownAlarm)},hideMenuAlarm:function(){$("#alarmContent").fadeOut("fast"),$("body").off("mousedown",resourceList.onBodyDownAlarm)},onBodyDownAlarm:function(e){"menuBtn"==e.target.id||"alarmContent"==e.target.id||$(e.target).parents("#alarmContent").length>0||resourceList.hideMenuAlarm()},mapAllShowFn:function(){$(this).children().hasClass("fa fa-chevron-left")?($(this).children().removeClass("fa fa-chevron-left"),$(this).children().addClass("fa fa-chevron-right"),$("#resource-map-module").css("float","right"),$("#resource-map-module").removeClass("col-md-3"),$("#resource-map-module").addClass("col-md-12"),$("#resource-video-module").hide()):($(this).children().removeClass("fa fa-chevron-right"),$(this).children().addClass("fa fa-chevron-left"),$("#resource-map-module").removeClass("col-md-12"),$("#resource-map-module").addClass("col-md-3"),setTimeout((function(){$("#resource-video-module").show()}),300))},pageLoadsEmpty:function(e){$("#resource-video-module div:nth-child(2)").nextAll().remove(),$("#resource-video-module div:nth-child(2)").removeClass("hidden-video").css({width:"100%",height:"100%"}),$("#playListVideoPlay").hasClass("video-play")?$("#resourceListActive").hasClass("active")&&$("#resourceListVideoPlay").hasClass("video-resource-play-check")&&resourceList.resourceVideoStopFn():resourceList.stop(e),$("#playListVideoPlay").removeClass("video-play-check").addClass("video-play"),$("#playListVideoPlay").prop("title","播放"),$("#playListVideoBack").off("click"),$("#playListVideoStop").off("click"),$("#playListVideoFrame").off("click"),$("#playListVideoGoing").off("click"),$("#stationContainer").html(""),$("#timeBody").html(""),$("#videoChannelSelection").html(""),ie=1,se=1,$("#playLeftGripVal").text(1),$("#rightGripValue").css("left","0px"),$("#playListVideoBack,#playListVideoGoing").attr("data","0"),ne=null,$("#playListActive").hasClass("active")&&$("#playListVideoDefault").removeClass("hidden-video"),resourceList.jwVideoClear(),le=[],S.clear(),T=[],k.clear(),s.clear(),c.clear(),S.clear(),re=1,ae=1,$("#resourceLeftGripVal").text(1),$("#leftGripValue").css("left","0px"),$("#resourceListVideoPlay").removeClass("video-resource-play-check").addClass("video-resource-play"),document.getElementById("videoSource").removeAttribute("src"),ce=0},setAlarm:function(){var e={async:{url:"/clbs/realTimeVideo/resource/alarmTree",type:"post",enable:!0,autoParam:["id"],dataType:"json",sync:!1,dataFilter:resourceList.ajaxAlarmDataFilter},check:{enable:!0,chkStyle:"checkbox",chkboxType:{Y:"s",N:"s"},radioType:"all"},view:{dblClickExpand:!1,nameIsHTML:!0,fontCss:setFontCss_ztree,countClass:"group-number-statistics",showIcon:!1},data:{simpleData:{enable:!0}},callback:{beforeClick:resourceList.beforeClickAlarm,onAsyncSuccess:resourceList.AlarmTreeAsyncSuccess,onCheck:resourceList.fuzzyOnCheckAlarm}};$.fn.zTree.init($("#alarmTree"),e,null)},showQueryInfo:function(){if(""==O)return layer.msg("请选择监控对象",{time:-1}),!1;"23"===Be?($("#codeSchema").val("0"),$("#storageType").val("0"),$("#videoType").val("0"),$("#allVideoType").text("全部"),$(".approvalHide").hide()):($("#allVideoType").text("音视频"),$(".approvalHide").show()),resourceList.resetadvancedInfo(),$("#advancedQuery").modal("show")},resetadvancedInfo:function(){resourceList.searchTimeLoad(),resourceList.setAlarm(),H="",$("#alarmSelect").val(""),"23"!==Be&&$("#channelNum").val(0),$("#videoType").val(0),$("#codeSchema").val(0),$("#storageType").val(0)},inquiry:function(e){$("#scalingBtn").hasClass("fa-chevron-down")&&$("#scalingBtn").click(),Le&&clearTimeout(Le),$("#containersVideoPlayback").hide();var t=$(".channel-checkbox");$("#videoChannelSelection").html(""),$("#resourceListDataTable tbody").html(""),$("#resourceListDataTables tbody").html(""),$("#stationContainer").css({"padding-top":"30px"}),$("#timeLine").css({height:"0px"}),2!==e?(resourceList.pageLoadsEmpty(t),o.clear(),n.clear()):l.clear(),$("#resourceListDataTable tbody").html("");var r=$(".calendar.calendar3 table caption span").html().replace(/[^0-9]/gi,"-");r.split("-")[0],r.split("-")[1];xe.clearMap(),0,ee=0;var a=$("#type").val();h=a,layer.msg("正在努力加载数据,请耐心等待",{icon:16,time:18e3,shade:[.1,!0],skin:"layui-layer-border layui-layer-hui"}),resourceList.searchCalendar(e)},searchCalendar:function(e){q=[];var t={};if(""==O)return layer.msg("请选择监控对象",{time:-1}),!1;t.vehicleID=O,q.push(t);var r=$("#type").val(),a=r,i=$("#searchStartTime").val(),s=$("#searchEndTime").val();if(""!=i&&""!=s){var o=i,l=s,n=new RegExp("-","g");if(o=o.replace(n,"/"),l=l.replace(n,"/"),(o=new Date(parseInt(Date.parse(o),10)).getTime())>(l=new Date(parseInt(Date.parse(l),10)).getTime()))return layer.msg("开始时间应在结束时间之前"),!1;if(0!=r){if(l-o>26784e5)return layer.msg("查询FTP视频信息时间范围不能大于一个月"),!1}else Le=setTimeout((function(){layer.msg("终端无反馈,请重试")}),6e4)}if(""==i){if(0!=r)return layer.msg("查询FTP资源开始时间不能为空"),!1;i="0000-00-00 00:00:00"}if(""==s){if(0!=r)return layer.msg("查询FTP资源结束时间不能为空"),!1;s="0000-00-00 00:00:00"}var c=O,d=R,u=H;""==u&&(u=0);var h=$("#channelNum").val();v=h;var m=$("#videoType").val(),f=$("#codeSchema").val(),y=$("#storageType").val();p=c;var g=$(".calendar.calendar3 table caption span").html().replace(/[^0-9]/gi,"-"),b=g.split("-")[0].substring(2,4),L=g.split("-")[1];L.length<2&&(L="0"+L);var k=b+L;if(1==e){var T=parseInt(g.split("-")[0]),S=parseInt(g.split("-")[1])-1,V=new Date(T,S,1),C=new Date(T,S+1,0);i=resourceList.ymdFormator(V)+" 00:00:00",s=resourceList.ymdFormator(C)+" 23:59:59"}if(0==r){if(2!==e){const e={vehicleId:c,videoType:m,date:k};resourceList.webSocket.send("/app/video/history/month",resourceList.headers,e)}}else{json_ajax_p("POST","/clbs/realTimeVideo/resource/getResource","json",!0,{vehicleId:c,brand:d,alarmType:u,channlNumer:h,startTime:i,endTime:s,type:r,msgSN:void 0,videoType:m,streamType:f,storageType:y,ftpName:a,date:k},resourceList.inquiryBack)}resourceList.getIco()},changeTab:function(){$("#resourceListActive").hasClass("active")&&($("#resourceListActive,#resourceList,#ftpList,#FTPListActive").removeClass("active"),$("#playListActive,#playList").addClass("active"),$(".video-back-module,.video-play-module").show(),$(".video-play-select,.video-resource-module").hide()),$("#FTPListActive").hasClass("active")&&($("#resourceListActive,#resourceList,#ftpList,#FTPListActive").removeClass("active"),$("#playListActive,#playList").addClass("active"),$(".video-back-module,.video-play-module").show(),$(".video-play-select,.video-resource-module").hide())},inquiryBack:function(e){var t,r=$(".calendar.calendar3 table caption span").html().replace(/[^0-9]/gi,"-"),a=r.split("-")[0],i=r.split("-")[1];if(e.success){if(ge){if($("#advancedQuery").modal("hide"),resourceList.changeTab(),f=e.obj.brand,y=e.obj.deviceNumber,m=e.obj.mobile,ye=e.obj.type,"0"!=e.obj.type)if(layer.closeAll(),null!=(t=e.obj.ftpResource)){u=t.resourceList;l.clear();for(p=0;p<u.length;p++){h=u[p].alarmType,v=u[p].startTime,g=u[p].endTime,b=u[p].name,L=u[p].url,k=u[p].fileSize,T=u[p].channelNumber;var s=u[p].physicsChannel;x=v.substr(0,10),w=[T,v,g,h,k,L,b,s];resourceList.publicMapData(x,w,l)}var n=$("#searchStartTime").val(),c=$("#searchEndTime").val();resourceList.oneDayData(n,c)}else layer.msg("获取资源列表数据失败")}else if($("#advancedQuery").modal("hide"),resourceList.changeTab(),f=e.obj.brand,y=e.obj.deviceNumber,m=e.obj.mobile,ye=e.obj.type,"0"!=e.obj.type)if(layer.closeAll(),null!=(t=e.obj.ftpResource)){var d=t.calendarSet;resourceList.buildDate(d,[a,i,1]),o.clear();for(var u=t.resourceList,p=0;p<u.length;p++){var h=u[p].alarmType,v=u[p].startTime,g=u[p].endTime,b=u[p].name,L=u[p].url,k=u[p].fileSize,T=u[p].channelNumber,S=u[p].uploadTime,V=u[p].tempUrl,C=u[p].downUrl,x=v.substr(0,10),w=[T,v,g,h,k,L,b,T,S,C,V];resourceList.publicMapData(x,w,o)}}else layer.msg("获取资源列表数据失败")}else layer.closeAll(),null!=e.msg&&""!=e.msg&&layer.msg(e.msg)},inquiryNewBack:function(e){if(e.success)if(ge){if($("#advancedQuery").modal("hide"),f=e.obj.brand,y=e.obj.deviceNumber,m=e.obj.mobile,ye=e.obj.type,"0"!==e.obj.type)if(layer.closeAll(),null!=(t=e.obj.ftpResource)){for(r=t.resourceList,l.clear(),a=0;a<r.length;a++){i=r[a].alarmType,s=r[a].startTime,n=r[a].endTime,c=r[a].name,d=r[a].url,u=r[a].fileSize,p=r[a].channelNumber;h=r[a].uploadTime,g=r[a].tempUrl,v=r[a].downUrl;b=s.substr(0,10),L=[p,s,n,i,u,d,c,p,h,v,g],resourceList.publicMapData(b,L,l)}k=ge?l.get(b):o.get(b);resourceList.generateFtpNewList(k,b)}else layer.msg("获取资源列表数据失败")}else{$("#advancedQuery").modal("hide"),f=e.obj.brand,y=e.obj.deviceNumber,m=e.obj.mobile,ye=e.obj.type,layer.closeAll();var t=e.obj.ftpResource;if(null!=t){o.clear();for(var r=t.resourceList,a=0;a<r.length;a++){var i=r[a].alarmType,s=r[a].startTime,n=r[a].endTime,c=r[a].name,d=r[a].url,u=r[a].fileSize,p=r[a].channelNumber,h=r[a].uploadTime,v=r[a].downUrl,g=r[a].tempUrl,b=s.substr(0,10),L=[p,s,n,i,u,d,c,p,h,v,g];resourceList.publicMapData(b,L,o);var k=ge?l.get(b):o.get(b);resourceList.generateFtpNewList(k,b)}}else layer.msg("获取资源列表数据失败")}else layer.closeAll(),null!=e.msg&&""!==e.msg&&$(".video-loading-name-all").text(ata.msg);resourceList.setMainRightLayout()},oneDayData:function(e,t,r){Me=1,r&&(ge=!1),ye=$("#type").val(),P=e.split(" ")[0],resourceList.pageLoadsEmpty(),te=!0,ee=1;var a=e.substr(0,10);$(".heads-date-module").html(a),x=a,$("#resourceListDataTable tbody").html(""),layer.msg("正在努力加载数据,请耐心等待",{icon:16,time:8e3,shade:[.1,!0],skin:"layui-layer-border layui-layer-hui"}),"0"!=ye?resourceList.getHistoryCoord(a,e,t):(be=!0,resourceList.getResourceData(e,t),me=e,fe=t)},getResourceData:function(e,t){if(be=!0,ye=0,$("#resourceListDataTable tbody").html(""),$("#resourceListDataTables tbody").html(""),$e&&clearTimeout($e),""==O)return layer.msg("请选择监控对象",{time:-1}),!1;var r=$("#type").val(),a=/(\d+-\d+-\d+)\s(\d+:\d+:\d+)/;if(""!=e&&""!=t){var i=e.replace(a,"$1T$2"),s=t.replace(a,"$1T$2");if(i>s)return layer.msg("开始时间应在结束时间之前"),!1;if(0!=r){if(s-i>26784e5)return layer.msg("查询FTP视频信息时间范围不能大于一个月"),!1}else $e=setTimeout((function(){layer.msg("终端无反馈,请重试")}),6e4)}if(""==e){if(0!=r)return layer.msg("查询FTP资源开始时间不能为空"),!1;e="0000-00-00 00:00:00"}if(""==t){if(0!=r)return layer.msg("查询FTP资源结束时间不能为空"),!1;t="0000-00-00 00:00:00"}layer.msg("正在努力加载数据,请耐心等待",{icon:16,time:8e3,shade:[.1,!0],skin:"layui-layer-border layui-layer-hui"});var o=O,l=R,n=H;""==n&&(n=0);var c=$("#channelNum").val();v=c;var d=$("#videoType").val(),u=$("#codeSchema").val(),h=$("#storageType").val();p=o;var m=$(".calendar.calendar3 table caption span").html().replace(/[^0-9]/gi,"-"),f=m.split("-")[0].substring(2,4),y=m.split("-")[1];y.length<2&&(y="0"+y);var g={vehicleId:o,brand:l,alarmType:n,channlNumer:c,startTime:e,endTime:t,msgSN:void 0,videoType:d,streamType:u,storageType:h,date:f+y,deviceType:Be};resourceList.webSocket.send("/app/video/history/day",resourceList.headers,g),Se=!1,$("#advancedQuery").modal("hide"),resourceList.changeTab()},getResourceDataCallBack:function(){Se=!1,$("#advancedQuery").modal("hide"),resourceList.changeTab()},getHistoryCoord:function(e,t,r){xe.clearMap(),x=e;json_ajax_p("POST","/clbs/realTimeVideo/resource/getHistory","json",!0,{vehicleId:p,startTime:t,endTime:r},(function(t){if(t.success){if(layer.closeAll(),null!=t.msg&&null!=t.msg){var r=Object(j.a)(t.msg),a=$.parseJSON(r);resourceList.history(a)}if(resourceList.getVideoChannel(p),"0"!=v&&(T=[]).push(je[v]),"0"==h){1;var i=n.get(e);resourceList.generateDeviceList(i,e);var s=ge?l.get(e):o.get(e);resourceList.generateFtpNewList(s,e),$(".video-play-select").css("opacity",1)}else{i=ge?l.get(e):o.get(e);resourceList.generateFtpList(i,e),$(".video-play-select").css("opacity",0)}resourceList.getMonitorObjeChannelNumber(T)}else layer.closeAll(),layer.msg("数据查询失败！请重试！")}))},getLastOilDataCallBack:function(e){var t=$.parseJSON(e.body);if(!t.success)return void layer.msg(t.msg);let r=t.obj;if(null!=r&&""!==r&&(t=t.obj,!Se)){var a=$(".calendar.calendar3 table caption span").html().replace(/[^0-9]/gi,"-"),i=a.split("-")[0],s=a.split("-")[1];layer.closeAll(),$e&&clearTimeout($e);var o=t.data.msgBody.resourcesList,l=[];o.forEach(e=>{l.push(e.channelNum)}),X=[...new Set(l)],f=t.desc.monitorName,y=t.desc.deviceNumber,m=t.data.msgHead.mobile,ye=0;var c=[];n.clear();for(var d=0;d<o.length;d++){var u=o[d].startTime,p=o[d].endTime,h=u.substring(0,6),v=o[d].channelNum,g=o[d].fileSize,b=o[d].alarm,L=o[d].videoType,k=o[d].streamType,T=o[d].storageType;if(u=resourceList.dateFormat("20"+u),p=resourceList.dateFormat("20"+p),resourceList.filterAlarmType(b)){c.push(h);var S=u.substr(0,10),V=[v,u,p,b,g,L,k,T,o[d].startTime,o[d].endTime,v];resourceList.publicMapData(S,V,n)}}if("0"!=ye){var C=resourceList.unique(c);0==ee&&resourceList.buildDate(C,[i,s,1])}else if(be){var x=me.substr(0,10);resourceList.getHistoryCoord(x,me,fe)}}},generateFtpList:function(e,t){var r="";if(s.clear(),e)for(var a=0;a<e.length;a++){var i=parseInt(e[a][0]),o=parseInt(e[a][7]),l=e[a][1],n=e[a][2],c=resourceList.timestamp(l),d=resourceList.timestamp(n),u=e[a][3];u=resourceList.parsingAlarmType(u);var p=resourceList.alarmNameSplit(u);""!=u&&u.length>20&&(u=u.substring(0,20)+"..."),u=","==u.substring(u.length-1)?u.substring(0,u.length-1):u;var v=e[a][4],g=e[a][5],b=(e[a][6],e[a][8]?e[a][8]:"-"),L=e[a][10],k=e[a][9],S='<button href="'+k+'"  type="button" class="btn btn-primary fileUpload" onclick="resourceList.fileHrefDownload(\''+k+"')\">MP4文件下载</button> ",V='<button href="'+L+'"  type="button" class="btn btn-primary fileUpload" onclick="resourceList.fileHrefDownload(\''+L+"')\">源文件下载</button> ";L||(V='<button disabled  type="button" class="btn btn-primary fileUpload">源文件下载</button> ');var C=[c,d,g,i];resourceList.publicMapData(o,C,s,i);r+=' <tr data-num="'+i+'" ondblclick="resourceList.ondblclickVideo(this)" fileName="'+g+'"  ftpName="'+h+'" onclick="resourceList.onclickVideo(this)"><td>'+(a+1)+"</td><td>"+V+S+"</td><td>-</td><td>"+b+"</td><td>"+f+"</td><td>"+y+"</td><td>"+m+"</td><td>"+i+"</td><td>"+l+"</td><td>"+n+'</td><td class="demo demoUp" alt="'+p+'" >'+u+"</td><td>"+v+"</td><td>-</td><td>子码流</td><td>-</td></tr>"}$("#resourceList").html('<table width="100%" cellspacing="0"  class="table table-striped table-bordered table-hover" id="resourceListDataTable"><thead> <tr><th width="50px">序号</th><th>操作设置</th><th>状态</th><th>上传时间</th><th>监控对象</th><th>终端号</th><th>终端手机号</th><th>通道号</th><th>开始时间</th><th>结束时间</th><th>报警类型</th><th>文件大小(M)</th><th>资源类型</th><th>码流类型</th><th>存储器类型</th></tr></thead><tbody></tbody></table >'),$("#resourceListDataTable tbody").append(r),setTimeout((function(){$(".demoUp").mouseover((function(){var e=$(this);"undefined"!=e.attr("alt")&&e.justToolsTip({animation:"moveInTop",width:"auto",contents:e.attr("alt"),gravity:"top"})}))}),1e3),resourceList.videoStatusInit(T,s,t)},generateFtpNewList:function(e,t){var r="";if(e)for(var a=0;a<e.length;a++){var i=parseInt(e[a][0]),o=parseInt(e[a][7]),l=e[a][1],n=e[a][2],c=resourceList.timestamp(l),d=resourceList.timestamp(n),u=e[a][3];u=resourceList.parsingAlarmType(u);var p=resourceList.alarmNameSplit(u);""!==u&&u.length>20&&(u=u.substring(0,20)+"..."),u=","===u.substring(u.length-1)?u.substring(0,u.length-1):u;var h=e[a][4],v=e[a][5],g=(e[a][6],e[a][8]?e[a][8]:"-"),b=e[a][10],L=e[a][9],k=[c,d,v,i];resourceList.publicMapData(o,k,s,i);var T='<button href="'+b+'"  type="button" class="btn btn-primary fileUpload" onclick="resourceList.fileHrefDownload(\''+b+"')\">源文件下载</button> ";b||(T='<button disabled  type="button" class="btn btn-primary fileUpload">源文件下载</button> '),r+=' <tr data-num="'+i+'" data-fileName="'+v+'" data-ftpName="FTP服务器"><td>'+(a+1)+"</td><td>"+T+('<button href="'+L+'"  type="button" class="btn btn-primary fileUpload" onclick="resourceList.fileHrefDownload(\''+L+"')\">MP4文件下载</button> ")+"</td><td>-</td><td>"+g+"</td><td>"+f+"</td><td>"+y+"</td><td>"+m+"</td><td>"+i+"</td><td>"+l+"</td><td>"+n+'</td><td class="demo demoUp" data-alarm="'+p+'" >'+u+"</td><td>"+h+"</td><td>-</td><td>子码流</td><td>-</td></tr>"}$("#ftpList").html('<table width="100%" cellspacing="0"  class="table table-striped table-bordered table-hover" id="resourceListDataTables"><thead> <tr><th width="50px">序号</th><th>操作设置</th><th>状态</th><th>上传时间</th><th>监控对象</th><th>终端号</th><th>终端手机号</th><th>通道号</th><th>开始时间</th><th>结束时间</th><th>报警类型</th><th>文件大小(M)</th><th>资源类型</th><th>码流类型</th><th>存储器类型</th></tr></thead><tbody></tbody></table >'),$("#resourceListDataTables tbody").append(r),setTimeout((function(){$(".demoUp").mouseover((function(){var e=$(this);"undefined"!=e.attr("data-alarm")&&e.justToolsTip({animation:"moveInTop",width:"auto",contents:e.attr("data-alarm"),gravity:"top"})}))}),1e3);var S=$("#resourceListDataTables tbody tr");S.click((function(e){resourceList.onclickVideo($(this)[0])})),S.dblclick((function(e){resourceList.ondblclickFTPVideo($(this)[0])}))},generateDeviceList:function(e,t){c.clear();var r=[];if(e)for(var a=0;a<e.length;a++){var i=e[a][0],s=e[a][10],o=e[a][1],l=e[a][2],n=e[a][3],d=resourceList.parsingAlarmType(n),u=resourceList.alarmNameSplit(d);""!=d&&d.length>20&&(d=d.substring(0,20)+"..."),d=","==d.substring(d.length-1)?d.substring(0,d.length-1):d;var h=e[a][4],v=e[a][5],g=e[a][6],b=e[a][7],L=e[a][8],k=e[a][9],S=resourceList.videoType(v)||"-",V=resourceList.streamType(g)||"-",C=resourceList.storageType(b)||"-",x=[resourceList.timestamp(o)||"-",resourceList.timestamp(l)||"-",v,g,b,!1,i];resourceList.publicMapData(s,x,c,i),h=(h/1048576).toFixed(1);var w="state"+(a+1),P="upload"+(a+1),D=f+","+p+","+i+","+L+","+k+","+n+","+v+","+g+","+b+","+w+","+("stop"+(a+1))+","+("cancel"+(a+1))+","+e[a][4]+","+P;r.push({0:a+1,1:D,2:w,3:f,4:y,5:m,6:i,7:o,8:l,9:d,10:h,11:S,12:V,13:C,14:L,15:k,16:u})}$("#resourceList").html('<table width="100%" cellspacing="0"  class="table table-striped table-bordered table-hover" id="resourceListDataTable"></table>'),$("#resourceListDataTable").dataTable({data:r,paging:!1,searching:!1,info:!1,language:{zeroRecords:"暂无数据"},columns:[{title:"序号",orderable:!1},{title:"操作设置",class:"center",orderable:!1,render:function(e,t,r,a){var i="";return"23"===Be?i='<button disabled href="/clbs/realTimeVideo/resource/upload?resourceListStr='+e+'" id="'+P+'" type="button" class="btn btn-primary fileUpload" onclick="resourceList.fileUpload(\''+e+"')\">文件上传</button> ":i+='<button style="margin-right: 10px;" href="/clbs/realTimeVideo/resource/upload?resourceListStr='+e+'" id="'+P+'" type="button" class="btn btn-primary fileUpload" onclick="resourceList.fileUpload(\''+e+"')\">文件上传</button>",i+='<button style="margin-right: 10px;" type="button" class="btn btn-primary fileStop" id="433"  onclick="resourceList.status(this,0,1)" disabled >暂停</button>',i+='<button type="button" class="btn btn-primary fileCancel" id="123"   onclick="resourceList.status(this,1,3)" disabled >取消</button>'}},{title:"状态",orderable:!1,render:function(e,t,r,a){var i="";return i+=`<span id=${r[2]}></span>`}},{title:"监控对象",orderable:!1},{title:"终端号",class:"center",orderable:!1},{title:"终端手机号",class:"center",orderable:!1},{title:"通道号",class:"center"},{title:"开始时间",class:"center videoStartTime",render:function(e,t,r,a){var i="";return i+=`<span videoStartTime=${r[14]}>${r[7]}</span>`}},{title:"结束时间",class:"center videoEndTime",render:function(e,t,r,a){var i="";return i+=`<span videoEndTime=${r[15]}>${r[8]}</span>`}},{title:"报警类型",class:"center demoUp",orderable:!1,render:function(e,t,r,a){var i="";return i+=`<span class="demo demoUp" >${e}</span>`}},{title:"文件大小(M)",class:"center",orderable:!1},{title:"资源类型",class:"center",orderable:!1},{title:"码流类型",class:"center",orderable:!1},{title:"存储器类型",class:"center",orderable:!1},{title:"录像开始时间",class:"center",orderable:!1,visible:!1},{title:"录像结束时间时间",class:"center",orderable:!1,visible:!1}]}),setTimeout((function(){$(".demoUp").mouseover((function(){var e=$(this);"undefined"!=e.attr("alt")&&e.justToolsTip({animation:"moveInTop",width:"auto",contents:e.attr("alt"),gravity:"top"})}))}),1e3);var N=null;e?e.length>0&&(N=e[0][1]):t&&(N=t),$("#resourceListDataTable tbody").on("click","tr",(function(){resourceList.resourceSelected($(this)[0])})),$("#resourceListDataTable tbody").on("dblclick","tr",(function(){resourceList.ondblclickDevice($(this)[0])})),resourceList.videoStatusInit(T,c,N)},videoStatusInit:function(e,t,r){"0"==h?($("#resourceListVideoFrame").css("cursor","pointer"),$("#resourceListVideoFrame").on("click",resourceList.resourceVideoFrameFn),$("#resourceModule").addClass("slider-module"),$("#playModule").addClass("slider-module")):($("#resourceModule").removeClass("slider-module"),$("#playModule").removeClass("slider-module")),$("#containersVideoPlayback").show(),pe=!1,A&&A.stop(),A=null;var a=resourceList.returnVideoList(e,t);A=$("#containersVideoPlayback").videoStatus({channels:e,channelData:a,onDragStart:function(e,t){he=!0},defaultDate:0==Object.keys(a).length&&r?new Date(r):void 0,onDragEnd:function(e,r){pe=!0,he=!1,resourceList.getDragVideoTime(r,t)},onPlaying:function(e,r){he||resourceList.isNextClip(r,t),"not-allowed"==$("#playListVideoStop").css("cursor")&&$("#playListVideoStop").css("cursor","pointer").off("click").on("click",resourceList.videoStopFn)},onStatusClick:function(e,r){pe=!0,resourceList.getDragVideoTime(r,t)}}),$("#scalingBtn").removeClass("fa-chevron-up").addClass("fa-chevron-down")},getDragVideoTime:function(e,t){A.pause();for(var r=$(".channel-checkbox"),a=[],i=0;i<r.length;i++)a.push($(r[i]).data("channel"));var s="",o="";for(i=0;i<a.length;i++)s+=p+",",o+=a[i]+",";s=s.substring(0,s.length-1),o=o.substring(0,o.length-1);var l=$("#thisDateOf").text()+" "+e.currentHour+":"+e.currentMinute+":"+e.currentSecond;resourceList.sendStopInstruct(s,o,"drag",resourceList.dateToyyMMddHHmmss(new Date(l.replace(/-/g,"/"))))},returnDragVideoTimeList:function(e,t){for(var r=[],a=0;a<T.length;a++)if("true"==k.get("subChk_"+T[a])){var i=t.get(T[a]);if(void 0!==i)for(var s=0;s<i.length;s++)if(e>=i[s][0]&&e<=i[s][1]){r.push([e,i[s][1],i[s][i[s].length-1],T[a]]);break}}return r},isNextClip:function(e,t){var r=$("#thisDateOf").text()+" "+e.currentHour+":"+e.currentMinute+":"+e.currentSecond,a=new Date(r.replace(/-/g,"/")).getTime()/1e3+1;_=[];for(var i=[],s=0;s<T.length;s++)if("true"==k.get("subChk_"+T[s])){var o=t.get(T[s]);if(void 0!==o)for(var l=0;l<o.length;l++)if(a>=o[l][0]&&a<=o[l][1]){for(var n=!1,c=0;c<le.length;c++)if(le[c][3]==T[s]){if(a>le[c][1]){var d=[o[l][0],o[l][1],o[l][o[l].length-1],T[s]];_.push(d),i.push(d[2]),le[c]=d}n=!0}if(!n){d=[o[l][0],o[l][1],o[l][o[l].length-1],T[s]];_.push(d),i.push(d[2]),le.push(d)}break}}_.length==T&&A.pause(),_.length>0&&resourceList.sendStopInstruct(p,i.join(","),"resourceChange")},returnVideoList:function(e,t){for(var r={},a=0;a<e.length;a++){var i=t.get(e[a]),s=[];if(void 0!==i){for(var o=0;o<i.length;o++)s.push({ID:o+1,DisplayText:"",StationId:e[a],StartTime:resourceList.getTimeFormat(i[o][0]),EndTime:resourceList.getTimeFormat(i[o][1])});r[e[a]]=s}}return r},parsingAlarmType:function(e){if(0!=e){for(var t=[],r=0,a=e.toString(2),i=a.length-1;i>=0;i--)0!=a[i]&&t.push(r),r++;for(var s="",o=0;o<t.length;o++)s+=L.elements.filter(e=>e.key==t[o])[0].value+","}else s="";return s},fileUpload:function(e){$("#uploadVideoModal").modal("show");var t=e.split(",");$("#upload_brand").text(t[0]),$("#upload_vehicleId").val(t[1]),$("#upload_channelNumbe").val(t[2]),$("#upload_startTime").val(t[3]),$("#upload_endTime").val(t[4]),$("#upload_alarm").val(t[5]),$("#upload_resourceType").val(t[6]),$("#upload_streamType").val(t[7]),$("#upload_storageAddress").val(t[8]),$("#state").val(t[9]),$("#stop").val(t[10]),$("#cancel").val(t[11]),$("#filesize").val(t[12]),$("#uploadId").val(t[13]);var r={vehicleId:t[1],startTime:t[3],channelNumber:t[2],alarm:t[5]};json_ajax("POST","/clbs/realTimeVideo/resource/getFtpMsg","json",!1,r,(function(e){if(e.success){var t=e.obj.fileUrl,r=e.obj.ftpBean,a=r.host,i=r.port,s=r.username,o=r.password;$("#FTPServerIp").val(a),$("#FTPort").val(i),$("#FTPUserName").val(s),$("#FTPassword").val(o),$("#FTPpwd").val(o),$("#fileUploadPath").val(t)}})),event.stopPropagation()},submit:function(){if(resourceList.validates()){var e,t,r,a=!1;if($("#wifi").is(":checked")?(a=!0,e=1):e=0,$("#lan").is(":checked")?(a=!0,t=1):t=0,$("#threeOrFourG").is(":checked")?(a=!0,r=1):r=0,a){if(0==e&&0==t&&0==r)return $("#executeError").removeClass("hidden"),!1;var i=r.toString()+t.toString()+e.toString(),s=parseInt(i,2);$("#executeOn").val(s),$("#executeError").addClass("hidden");var o=$("#state").val(),l=$("#stop").val(),n=$("#uploadId").val(),c=$("#cancel").val(),d=[o,l,c,n],u=$("#FTPpwd").val();u=resourceList.encode(u),$("#FTPassword").val(u),$("#uploadVideoModal").modal("hide"),$("#uploadFrom").ajaxSubmit((function(e){var t=$.parseJSON(e);if(t.success){$("#"+o).text("上传中");var r=t.obj.msgId,a=t.obj.userName;resourceList.fileUploadWebSoket(r),V.put(r,d),$("#"+o).attr("msgId",r),$("#"+o).attr("userName",a),$("#"+l).removeAttr("disabled"),$("#"+c).removeAttr("disabled"),$("#"+n).attr("disabled","disabled")}else layer.msg("文件上传下发指令失败")}))}else layer.msg("请至少勾选一项")}},validates:function(){return $("#uploadFrom").validate({rules:{FTPServerIp:{required:!0,isContainsNumberAndPoint:"#FTPServerIp",maxlength:15,minlength:7},FTPort:{required:!0,number:!0,max:65535,min:1},FTPUserName:{required:!0,maxlength:20,minlength:1},FTPassword:{required:!0,maxlength:20,minlength:1}},messages:{FTPServerIp:{required:"不能为空",maxlength:"长度不超过15位",minlength:"长度不能小于7位",isContainsNumberAndPoint:"只能输入数字和."},FTPort:{required:"不能为空",number:"必须为数字",max:"输入范围1~65535",min:"长度不能小于1位"},FTPUserName:{required:"不能为空",maxlength:"长度不超过20位",minlength:"长度不能小于1位"},FTPassword:{required:"不能为空",maxlength:"长度不超过20位",minlength:"长度不能小于1位"}}}).form()},fileUploadWebSoket:function(e){var t={desc:{MsgId:4614,UserName:$("#userName").text(),cmsgSN:e},data:q};resourceList.webSocket.subscribe(resourceList.headers,"/user/topic/fileUploadStatus",resourceList.fileUploadWebSoketCallBack,"/app/vehicle/resourceList",t)},fileUploadWebSoketCallBack:function(e){var t=$.parseJSON(e.body),r=t.data.msgBody.result,a=t.data.msgBody.msgSNACK,i=V.get(a);if(null!=i){var s=i[0],o=i[1],l=i[2],n=i[3];1==r?$("#"+s).text("上传失败"):$("#"+s).text("上传成功"),$("#"+o).text("暂停"),$("#"+o).attr("disabled","disabled"),$("#"+l).attr("disabled","disabled"),$("#"+n).removeAttr("disabled")}else $(".td_state").text(""),$(".fileStop").text("暂停"),$(".fileStop").attr("disabled","disabled"),$(".fileCancel").attr("disabled","disabled"),$(".fileUpload").removeAttr("disabled")},status:function(e,t,r){var a=$(e).text(),i=$("#state"+r).attr("msgId");$("state#"+r).attr("userName");1==t?($("#state"+r).text(""),$("#stop"+r).text("暂停"),$("#stop"+r).attr("disabled","disabled"),$("#cancel"+r).attr("disabled","disabled"),$("#upload"+r).removeAttr("disabled"),resourceList.fileController(i,2)):0==t&&("暂停"==a?($("#state"+r).text("已暂停"),$("#stop"+r).text("继续"),resourceList.fileController(i,0)):($("#state"+r).text("上传中"),$("#stop"+r).text("暂停"),resourceList.fileController(i,1))),event.stopPropagation()},fileController:function(e,t){json_ajax("POST","/clbs/realTimeVideo/resource/control","json",!1,{msgSn:e,control:t,vehicleId:p},null)},videoType:function(e){switch(e){case 0:return"音视频";case 1:return"音频";case 2:return"视频";case 3:return"音频或视频"}},streamType:function(e){switch(e){case 0:return"所有码流";case 1:return"主码流";case 2:return"子码流"}},storageType:function(e){switch(e){case 0:return"所有存储器";case 1:return"主存储器";case 2:return"灾备存储器"}},buildDate:function(e,t){for(var r=[],a=0;a<e.length;a++)r.push(["20"+e[a],"20"+e[a]]);$(".calendar3").html(""),$(".calendar3").calendar({highlightRange:r,changeYMcallback:resourceList.changeYMcallback,initYMD:t}),resourceList.videoIsFlag=!1,$(".calendar3 tbody td").each((function(){$(this).hasClass("widget-disabled")&&($(this).removeClass("widget-videoHlight").removeClass("widget-stopHighlight"),$(this).children("span").children("span.mileageList").text("-"))})),layer.msg("获取资源成功，请选择日期")},dateFormat:function(e){var t=e.replace(/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/,"$1/$2/$3 $4:$5:$6");return new Date(t).Format("yyyy-MM-dd hh:mm:ss")},dateToyyMMddHHmmss:function(e){return e.getFullYear().toString().substring(2)+resourceList.fillZero(e.getMonth()+1)+resourceList.fillZero(e.getDate())+resourceList.fillZero(e.getHours())+resourceList.fillZero(e.getMinutes())+resourceList.fillZero(e.getSeconds())},fillZero:function(e){return e<10?"0"+e:e},yyMMddHHmmssToDate:function(e){let t=new Date,r=e.replace(/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/,"$1/$2/$3 $4:$5:$6");return new Date(t.getFullYear().toString().substring(0,2)+r)},unique:function(e){for(var t=[],r={},a=0;a<e.length;a++)r[e[a]]||(t.push(e[a]),r[e[a]]=1);return t},history:function(e){g=e.resultful,Y=[],u.clear();for(var t=0;t<g.length;t++){var r=g[t].latitude,a=g[t].longtitude,i=g[t].vtime,s=g[t].originalLongtitude,o=g[t].originalLatitude;u.put(i,[s,o]),0!=r&&0!=a&&Y.push([a,r])}Y.length>0&&resourceList.polyline(Y)},alarmNameSplit:function(e){var t="";if(""!=e){for(var r=e.split(","),a=0;a<r.length;a++)t+=r[a]+"<br/>";return t}},onclickVideo:function(e){$(e).hasClass("tableHighlight-blue")||($("#resourceListDataTable tbody").find("tr").removeClass("tableHighlight-blue"),$(e).addClass("tableHighlight-blue"),$("#resourceListVideoPlay").removeClass("video-resource-play-check").addClass("video-resource-play"),$("#videoSource")[0].pause(),re=1,ae=1,$("#resourceLeftGripVal").text(1),$("#leftGripValue").css("left","0px"),ce=0)},ondblclickVideo:function(e){$("#resourceListDataTable tbody").find("tr").removeClass("tableHighlight-blue"),$(e).addClass("tableHighlight-blue"),$("#resourceListVideoPlay").removeClass("video-resource-play-check").addClass("video-resource-play"),$("#videoSource")[0].pause();var t=$(e).attr("ftpName"),r=$(e).attr("fileName");resourceList.publicVideoPlay(r,t)},ondblclickFTPVideo:function(e){$("#resourceListDataTables tbody").find("tr").removeClass("tableHighlight-blue"),$(e).addClass("tableHighlight-blue"),$("#videoSource")[0].pause();var t=$(e).attr("data-ftpName"),r=$(e).attr("data-fileName");resourceList.publicVideoPlay(r,t,(function(){$("#resourceListVideoPlay").removeClass("video-resource-play").addClass("video-resource-play-check").prop("title","暂停"),$("#resourceListVideoStop").removeClass("video-resource-stop-check").addClass("video-resource-stop")}))},publicVideoPlay:function(e,t){json_ajax("POST","/clbs/realTimeVideo/resource/fileDownload","json",!0,{fileName:e,ftpName:t},(function(e){if(e.success){var t="/clbs/resourceVideo/"+e.obj.fileName;$("#videoSource").removeAttr("src"),$("#videoSource").attr("src",t),$("#videoSource")[0].addEventListener("ended",(function(){$("#videoSource").removeAttr("src"),$("#resourceListVideoPlay").removeClass("video-resource-play-check").addClass("video-resource-play").prop("title","播放")})),resourceList.getVideoPlaybackSpeedFn("videoSource","resourceLeftGripVal",!0),$("#resourceListVideoPlay").removeClass("video-resource-play").addClass("video-resource-play-check")}}))},fileDownload:function(e,t,r){json_ajax("POST","/clbs/realTimeVideo/resource/fileDownload","json",!1,{fileName:e,ftpName:t},(function(e){e.success&&(window.location.href="/clbs/realTimeVideo/resource/download?path="+r)})),"Microsoft Internet Explorer"==navigator.appName&&"MSIE9.0"==navigator.appVersion.split(";")[1].replace(/[ ]/g,"")?event.cancelBubble=!0:event.stopPropagation()},fileHrefDownload:function(e){window.location.href=e},timestamp:function(e){e=e.replace(/-/g,"/");var t=new Date(e).getTime();return t/=1e3},publicMapData:function(e,t,r,a){var i=r.get(e);null==i?a?r.put(e,[t],a):r.put(e,[t]):(r.containsKey(e)&&r.remove(e),i.push(t),a?r.put(e,i,a):r.put(e,i))},polyline:function(e){var t="/clbs/resources/img/vehicle.png";null!=U&&""!=U&&(t="/clbs/resources/img/vico/"+U),b=new AMap.Marker({map:xe,position:e[0],icon:t,offset:new AMap.Pixel(-26,-13),autoRotation:!0});new AMap.Polyline({map:xe,path:e,strokeColor:"#3366FF",strokeOpacity:1,strokeWeight:5,strokeStyle:"solid",strokeDasharray:[10,5],zIndex:51});xe.setFitView()},tabHideDownFn:function(){if($(this).hasClass("fa fa-chevron-down")){$("#videoBackRightTop").css("height","calc(100% - 42px)"),$(this).removeClass("fa fa-chevron-down").addClass("fa fa-chevron-up");for(var e=0,t=0;t<k.values().length;t++)"true"===k.values()[t]&&(e+=1);resourceList.thisListShowsVideoScreenSeparated(e)}else{var r=$("#videoRightBottom").height()+10+"px";$("#videoBackRightTop").css("height","calc(100% - "+r+")"),$(this).removeClass("fa fa-chevron-up").addClass("fa fa-chevron-down");for(e=0,t=0;t<k.values().length;t++)"true"===k.values()[t]&&(e+=1);resourceList.thisListShowsVideoScreenSeparated(e)}},thisListShowsVideoScreenSeparated:function(e){var t=$("#resource-video-module div").length;1==e||1==t?resourceList.theListShowsVideoAdaptation(1,1,null,null):2==e?resourceList.theListShowsVideoAdaptation(2,1,null,null):3==e?resourceList.theListShowsVideoAdaptation(2,2,1,2):4==e?resourceList.theListShowsVideoAdaptation(2,2,null,null):5==e||6==e?5==e?resourceList.theListShowsVideoAdaptation(3,3,2,2):6==e&&resourceList.theListShowsVideoAdaptation(3,2,null,null):7==e||8==e?(7==e||8==e)&&resourceList.theListShowsVideoAdaptation(4,4,3,3):9==e?resourceList.theListShowsVideoAdaptation(3,3,null,null):10==e?resourceList.theListShowsVideoAdaptation(5,5,4,4):11!=e&&12!=e&&13!=e&&14!=e&&15!=e&&16!=e||(11==e||12==e?resourceList.theListShowsVideoAdaptation(4,3,null,null):(13==e||14==e||15==e||16==e)&&resourceList.theListShowsVideoAdaptation(4,4,null,null))},theListShowsVideoAdaptation:function(e,t,r,a){var i=100/e;if($("#mapAllShow").children().hasClass("fa fa-chevron-right"))var s=$("#resource-map-module").height()/t;else s=$("#resource-video-module").height()/t;if($("#resource-video-module div:nth-child(2)").nextAll().css({width:i+"%",height:"calc(100% - (100% - "+s+"px))"}),null!=r&&null!=a){var o=i*r,l=s*a;$("#resource-video-module div.v-one").css({width:o+"%",height:"calc(100% - (100% - "+(l-.1)+"px))"})}},_unfast:function(e){return 0==e?1:2==e?2:4==e?3:8==e?4:16==e?5:void 0},videoBackFn:function(){if(setTimeout((function(){$("#playListVideoBack").removeClass("video-back-check").addClass("video-back")}),100),$("#playListVideoBack").removeClass("video-back").addClass("video-back-check"),"0"==h){var e=Number($("#playLeftGripVal").text());1!=e?e/=2:e=16,1==e?($("#rightGripValue").css("left","0"),$("#playLeftGripVal").text(e)):2==e?($("#rightGripValue").css("left","18px"),$("#playLeftGripVal").text(e)):4==e?($("#rightGripValue").css("left","36px"),$("#playLeftGripVal").text(4)):8==e?($("#rightGripValue").css("left","61px"),$("#playLeftGripVal").text(8)):16==e&&($("#rightGripValue").css("left","98px"),$("#playLeftGripVal").text(16)),resourceList.videoPlayBack()}else{if(!(S.elements.length>0))return!1;var t=$("#playLeftGripVal").text();1!=t&&t>1?ie=1:.0625!=se&&(se/=2);for(var r=0;r<S.elements.length;r++){var a=S.elements[r].key,i=document.getElementById("v_"+a+"_SourceVideoPlayback");if(1!=t&&t>1){var s=t/2;8==s?($("#rightGripValue").css("left","61px"),$("#playLeftGripVal").text(s),ie=4,i.playbackRate=s):4==s?($("#rightGripValue").css("left","36px"),$("#playLeftGripVal").text(s),ie=3,i.playbackRate=s):2==s?($("#rightGripValue").css("left","18px"),$("#playLeftGripVal").text(s),ie=2,i.playbackRate=s):1==s&&($("#rightGripValue").css("left","0px"),$("#playLeftGripVal").text(s),ie=1,i.playbackRate=s),A.setSpeed(ie)}else{if(.5==se)$("#playLeftGripVal").text("1/2");else if(.25==se)$("#playLeftGripVal").text("1/4");else if(.125==se)$("#playLeftGripVal").text("1/8");else{if(.0625!=se)return!1;$("#playLeftGripVal").text("1/16")}i.playbackRate=se,A.setSpeed(se)}}}},pluginClickAutoPlay:function(){for(var e=0,t=[],r=0;r<k.values().length;r++)if("true"===k.values()[r]){e+=1;var a,i=k.keys()[r];a=i.length>=9?i.substring(i.length-2,i.length):i.substring(i.length-1,i.length),t.push(a)}if(t.sort(),e>0)if("0"==h){if($("#playListVideoPlay").attr("data-stop-state"))if($("#playListVideoPlay").attr("data-stop-state",!1),$("#playListVideoPlay").hasClass("video-play"))0==$("#videoPlayWay").val()&&resourceList.videoStartPlay();te&&(te=!1,resourceList.videoScreenSeparated(t)),$("#checkAllVideoPlayback").prop("disabled","disabled");for(r=0;r<k.keys().length;r++)$("#"+k.keys()[r]).prop("disabled","disabled")}else if(te){te=!1,resourceList.videoScreenSeparated(t),$("#checkAllVideoPlayback").prop("disabled","disabled");for(r=0;r<k.keys().length;r++)$("#"+k.keys()[r]).prop("disabled","disabled")}else for(r=0;r<S.elements.length;r++){var s=S.elements[r].key;$("#v_"+s+"_SourceVideoPlayback")[0].play()}},videoPlayFn:function(){be=!1;var e=$("#playLeftGripVal").text();if(e=resourceList._unfast(e),c.elements.length>0||s.elements.length>0){for(var t=k.elements,r=[],a=0;a<t.length;a++)"true"==t[a].value&&r.push(t[a].key.replace("subChk_",""));var i=!1;for(a=0;a<r.length;a++){if("0"!=h){if(s.get(r[a])){i=!0;break}}else if(c.get(r[a])){i=!0;break}}if(!i)return void layer.msg("亲,所选通道没有数据哦");if(resourceList.channelHasChecked())if($("#playListVideoPlay").hasClass("video-play")){if(te=!0,"0"!=h)if($("#playListVideoPlay").removeClass("video-play").addClass("video-play-check"),$("#playListVideoPlay").prop("title","暂停"),(oe=!0)||resourceList.pluginClickAutoPlay(),de){for(a=0;a<S.elements.length;a++){for(var o=S.elements[a].key,l=0;l<d.elements.length;l++)if(o==d.elements[l].key)var n=d.elements[l].value;$("#v_"+o+"_SourceVideoPlayback")[0].currentTime=n,$("#v_"+o+"_SourceVideoPlayback")[0].play(),document.getElementById("v_"+o+"_SourceVideoPlayback").addEventListener("canplay",(function(){A.continue()}))}de=!1}else pe||(A.play(),A.pause()),le=resourceList.getFtpVideoList(),resourceList.playFTPVideoDataFn(le);else oe=!0,resourceList.terminalVideoPlayback();null!=(ne=!0)&&resourceList.trakPlayBack(ne)}else{if($("#playListVideoPlay").removeClass("video-play-check").addClass("video-play").attr("data-stop-state",!0),$("#playListVideoPlay").prop("title","播放"),oe=!1,"0"==h)pe=!0,A.pause(),$("video").attr("data-video-stop",!0),resourceList.videoPlayEnd(null,"TIMEOUT"),!0;else{if(le.length>0){A.pause();for(a=0;a<S.elements.length;a++){o=S.elements[a].key;$("#v_"+o+"_SourceVideoPlayback")[0].pause();var u=$("#v_"+o+"_SourceVideoPlayback")[0].currentTime;d.isEmpty()||d.containsKey(o)&&d.remove(o),d.put(o,u)}}te=!1,de=!0}null!=(ne=!1)&&resourceList.trakPlayBack(ne)}else layer.msg("亲，请选择需要播放的视频通道号")}else layer.msg("亲,请先获取数据哦")},stop:function(e){if("0"==h){void 0===e&&(e=$(".channel-checkbox"));for(var t=[],r=0;r<e.length;r++)t.push($(e[r]).data("channel"));resourceList.resourceVideoStopFn(t)}else A.stop(),resourceList.playListResetFn(),le=[],S.clear(),ie=1,se=1,$("#playLeftGripVal").text(1),$("#rightGripValue").css("left","0px"),oe=!1,de=!1},terminalVideoPlayback:function(){if(!pe){A.play();var e=$("#playLeftGripVal").text();A.setSpeed(e),A.pause()}le=[],resourceList.pluginClickAutoPlay(),$("#playListVideoPlay").removeClass("video-play").addClass("video-play-check"),$("#playListVideoPlay").prop("title","暂停");var t=$("#h").text(),r=$("#m").text(),a=$("#s").text(),i=x+" "+t+r+a,s=resourceList.timestamp(i);if(c.elements.length>0){0!=$("#videoPlayWay").val()&&resourceList.jwVideoClear();for(var o=c.elements,l=0;l<c.elements.length;l++){if("true"==k.get("subChk_"+o[l].key)){var n,d,u,p=o[l].key,h=c.get(p);if(h)for(var v=0;v<h.length;v++)s>=h[v][0]&&s<=h[v][1]&&(n=s,d=h[v][1],u=h[v][h[v].length-1],le.push([n,d,u,p]))}}resourceList.terminalVideoSub(le)}},terminalVideoSub:function(e,t){var r;r=$("#resourceListActive").hasClass("active")?Number($("#resourceLeftGripVal").text()):Number($("#playLeftGripVal").text());var a=0;a=$("#resourceListActive").hasClass("active")?Number($("#videoResourcePlayWay").val()):Number($("#videoPlayWay").val());var i=$.fn.zTree.getZTreeObj("treeDemoVideoPlayback"),s=(b=i.getNodeByParam("id",p,null)).simcardNumber,o=b.deviceNumber,l=resourceList.getVideoPlaySpeed(r),n=[],d=[],u=[],h=c.get(e[0]?e[0][3]:"");if(e)for(var v=0;v<e.length;v++){n.push(p),d.push(e[v][2]),h&&u.push(h[0][2]);var m=s+"-"+e[v][2];if(F.containsKey(m))F.get(m).closeSocket(),F.remove(m)}var f=[...new Set(n)].join(","),y=[...new Set(d)].join(","),g=[...new Set(u)].join(","),b=i.getNodeByParam("id",p,null),L=e[0]?e[0][0]:"",k=e[0]?e[0][1]:"",T=y.split(","),S=[];T.forEach(e=>{S.push({vehicleId:f,channelNumber:e,videoType:g,flag:!1,simcardNumber:b.simcardNumber,deviceNumber:o,streamType:h?h[0][3]:"",storageType:h?h[0][4]:"",remoteMode:a,forwardOrRewind:l,physicsChannel:e,startTime:"RESOURCE"===t?L:resourceList.timestampTransform(L),endTime:"RESOURCE"===t?k:resourceList.timestampTransform(k)})}),resourceList.openTerminalVideo(S)},terminalVideoRequest:function(e){resourceList.openTerminalVideo([e])},openTerminalVideo:function(e){var t=e,r=[];if(t){var a="ws://";"https:"===document.location.protocol&&(a="wss://"),json_ajax("POST","/clbs/v/monitoring/audioAndVideoParameters/"+Z,"json",!0,null,(function(e){if(K=[],!e.success)return layer.msg(e.msg);for(let d=0;d<t.length;d++){var i=t[d];if(i.flag)r.push(i.channelNumber);else{Te=!0,ke+=1;var s,o=i.simcardNumber+"-"+i.channelNumber;s=$("#resourceListActive").hasClass("active")?"videoSource":"v_"+i.channelNumber+"_SourceVideoPlayback";var l=a+resourceList.videoRequestUrl+":"+resourceList.videoResourcePort+"/"+i.simcardNumber+"/"+i.channelNumber,n={channelCount:e.obj.vocalTractStr||"0",audioFormat:e.obj.audioFormatStr,playType:"TRACK_BACK",dataType:"1",userID:e.obj.userUuid,deviceID:e.obj.deviceId,sampleRate:e.obj.samplingRateStr||"8000",vehicleId:i.vehicleId,channelNumber:i.channelNumber,physicsChannel:i.physicsChannel,deviceNumber:i.deviceNumber,videoType:i.videoType,streamType:"0",storageType:i.storageType,remoteMode:i.remoteMode,forwardOrRewind:i.forwardOrRewind,startTime:i.startTime,endTime:i.endTime,domId:s,id:o,simcardNumber:i.simcardNumber,deviceType:e.obj.deviceType};if(e.success){var c=new RTPMediaPlayer({domId:s,url:l,data:n,playType:"TRACK_BACK",onMessage:function(e,r){var a=JSON.parse(r);if(-1005!=a.data.msgBody.code&&-1008!=a.data.msgBody.code&&-1006!=a.data.msgBody.code&&-1004!=a.data.msgBody.code||layer.msg(a.data.msgBody.msg),-1008==a.data.msgBody.code||1001==a.data.msgBody.code)t[d].flag=!0;else if(-1005==a.data.msgBody.code){var i=window.localStorage.getItem("videoBg"),s="#v_"+e.channelNumber+"_SourceVideoPlayback";$(s).attr("style","width:100%; height:100%;background-image: url("+i+")!important")}},onPlaying:function(e,t){$("#playListActive").hasClass("active")?$("#playModule").removeClass("slider-module"):$("#resourceModule").removeClass("slider-module"),resourceList.videoPlaySuccess(e,t)},socketOpenFun:function(e,t){var r={vehicleId:e.vehicleId,simcardNumber:e.simcardNumber,channelNumber:e.channelNumber,sampleRate:e.sampleRate,channelCount:e.channelCount,audioFormat:e.audioFormat,playType:e.playType,dataType:e.dataType,userID:e.userID,deviceID:e.deviceID,streamType:e.streamType,startTime:e.startTime,endTime:e.endTime,remoteMode:JSON.stringify(e.remoteMode),forwardOrRewind:JSON.stringify(e.forwardOrRewind),storageType:JSON.stringify(e.storageType),deviceType:e.deviceType};t.play(r)},socketCloseFun:function(){0===(ke-=1)&&Te&&te&&$("#playListVideoPlay").hasClass("video-play-check")&&(resourceList.videoPlayFn(),A.pause(),layer.msg("视频订阅失败,已暂停播放"))}});F.put(o,c),K.push(c)}}}}))}if(r.length>0){var i="被占用视频通道为："+r.join(",");layer.msg(i)}},videoPlaySuccess:function(e,t){if($("#playListVideoPlay").hasClass("video-play-check")){resourceList.videoHandleBtnChange(),$("#playListActive").hasClass("active")&&A.continue(),D.remove(e.channelNumber),D.put(e.channelNumber,!0);for(var r=P+" "+$("#h").text()+$("#m").text()+$("#s").text(),a=new Date(r.replace(/-/g,"/")).getTime()/1e3,i=c.get(Number(e.channelNumber)),s=0;s<i.length;s++)if(a>=i[s][0]&&a<=i[s][1]){i[s][5]=!0;break}c.remove(e.channelNumber),c.put(e.channelNumber,i),$("#"+e.domId).attr("data-id",e.id),$("#"+e.domId).off("click").on("click",resourceList.openVideoChannelVoice)}else{var o=window.videoPlaybackSourceId;if(F.containsKey(o))F.get(o).openVideoVoice(),ve=o}},trakPlayBack:function(e){var t=0,r=C;if(Y.length>0)if(e)null==(t=resourceList.videoPlayGetStartTime(r))&&(t=0),null!=Y&&b.setPosition(Y[t]);else{var a=$(".time-info #h").text(),i=$(".time-info #m").text(),s=$(".time-info #s").text(),o=x+" "+a+i+s,l=0;r=resourceList.timestamp(o);l=resourceList.videoPlayGetStartTime(r),null!=Y&&(null==l&&(l=Y.length-1),b.setPosition(Y[l]),null==t&&(t=0),resourceList.coverPolyline(t,l))}},videoStopFn:function(){for(var e=$(".channel-checkbox"),t=[],r=0;r<e.length;r++)t.push($(e[r]).data("channel"));0===t.length&&(t=null),$("#playLeftGripVal").text(1),$("#rightGripValue").css("left",0),$("#playModule").addClass("slider-module"),pe=!1,D.clear(),!1,Te=!1,$("#playListVideoPlay").removeAttr("data-stop-state"),setTimeout((function(){$("#playListVideoStop").removeClass("video-stop-check").addClass("video-stop")}),100),$("#playListVideoStop").removeClass("video-stop").addClass("video-stop-check"),$("#playListVideoPlay").removeClass("video-play-check").addClass("video-play"),$("#checkAllVideoPlayback").removeAttr("disabled");for(r=0;r<k.keys().length;r++)$("#"+k.keys()[r]).removeAttr("disabled");te=!0,"0"==h?resourceList.resourceVideoStopFn(t):(A.stop(),resourceList.playListResetFn(),le=[],S.clear(),ie=1,se=1,$("#playLeftGripVal").text(1),$("#rightGripValue").css("left","0px"),oe=!1,de=!1),resourceList.playListResetFn(),b&&b.setPosition(Y[0]),null!=w&&w.hide(),w=null},playListResetFn:function(){$("#resource-video-module div:nth-child(2)").nextAll().remove(),$("#resource-video-module div:nth-child(2)").removeClass("hidden-video").css({width:"100%",height:"100%"}),$("#playListVideoFrame,#playListVideoStop,#playListVideoBack,#playListVideoGoing").css("cursor","not-allowed"),$("#playListVideoBack").off("click"),$("#playListVideoStop").off("click"),$("#playListVideoFrame").off("click"),$("#playListVideoGoing").off("click"),$("#playListVideoBack,#playListVideoGoing").attr("data","0"),ne=null},videoFrameFn:function(){if(setTimeout((function(){$("#playListVideoFrame").removeClass("video-frame-check").addClass("video-frame")}),100),$("#playListVideoFrame").removeClass("video-frame").addClass("video-frame-check"),"0"==h){A.pause();for(var e=$(".channel-checkbox"),t=[],r=0;r<e.length;r++)t.push($(e[r]).data("channel"));var a="",i="";for(r=0;r<t.length;r++)a+=p+",",i+=t[r]+",";a=a.substring(0,a.length-1),i=i.substring(0,i.length-1),resourceList.sendStopInstruct(a,i,"keyframes")}},videoGoingFn:function(){if(setTimeout((function(){$("#playListVideoGoing").removeClass("video-going-check").addClass("video-going")}),100),$("#playListVideoGoing").removeClass("video-going").addClass("video-going-check"),"0"==h){var e=Number($("#playLeftGripVal").text());16!=e?e*=2:e=1,1==e?($("#rightGripValue").css("left","0"),$("#playLeftGripVal").text(e)):2==e?($("#rightGripValue").css("left","18px"),$("#playLeftGripVal").text(e)):4==e?($("#rightGripValue").css("left","36px"),$("#playLeftGripVal").text(4)):8==e?($("#rightGripValue").css("left","61px"),$("#playLeftGripVal").text(8)):16==e&&($("#rightGripValue").css("left","98px"),$("#playLeftGripVal").text(16)),resourceList.videoQuickPlay()}else if(S.elements.length>0){var t=$("#playLeftGripVal").text();t.indexOf("/")>-1?se=1:5!=ie&&(ie+=1);for(var r=0;r<S.elements.length;r++){var a=S.elements[r].key,i=document.getElementById("v_"+a+"_SourceVideoPlayback");if(t.indexOf("/")>-1)if("1/2"==t)i.playbackRate=1,$("#playLeftGripVal").text("1");else if("1/4"==t)i.playbackRate=.5,$("#playLeftGripVal").text("1/2");else if("1/8"==t)i.playbackRate=.25,$("#playLeftGripVal").text("1/4");else{if("1/16"!=t)return!1;i.playbackRate=.125,$("#playLeftGripVal").text("1/8")}else 2==ie?(i.playbackRate=2,$("#rightGripValue").css("left","18px"),$("#playLeftGripVal").text(ie),A.setSpeed(2)):3==ie?(i.playbackRate=4,$("#rightGripValue").css("left","36px"),$("#playLeftGripVal").text(4),A.setSpeed(4)):4==ie?(i.playbackRate=8,$("#rightGripValue").css("left","61px"),$("#playLeftGripVal").text(8),A.setSpeed(8)):5==ie?(i.playbackRate=16,$("#rightGripValue").css("left","98px"),$("#playLeftGripVal").text(16),A.setSpeed(16)):ie>5&&(ie=5,i.playbackRate=16,$("#playLeftGripVal").text(16))}}},resourceVideoBackFn:function(){setTimeout((function(){$("#resourceListVideoBack").removeClass("video-resource-back-check").addClass("video-resource-back")}),100),$("#resourceListVideoBack").removeClass("video-resource-back").addClass("video-resource-back-check");var e=document.getElementById("videoSource");if("0"==h){var t=Number($("#resourceLeftGripVal").text());1!=t?t/=2:t=16,1==t?($("#leftGripValue").css("left","0"),$("#resourceLeftGripVal").text(t)):2==t?($("#leftGripValue").css("left","18px"),$("#resourceLeftGripVal").text(t)):4==t?($("#leftGripValue").css("left","36px"),$("#resourceLeftGripVal").text(4)):8==t?($("#leftGripValue").css("left","61px"),$("#resourceLeftGripVal").text(8)):16==t&&($("#leftGripValue").css("left","98px"),$("#resourceLeftGripVal").text(16));var r=$("#resourceListDataTable tbody tr.tableHighlight-blue").attr("channelNum");resourceList.videoPlayBack(r)}else{var a=$("#resourceLeftGripVal").text();if(1!=a&&a>1){re=1;var i=a/2;if(8==i)$("#leftGripValue").css("left","61px"),$("#resourceLeftGripVal").text(i),e.playbackRate=i;else if(4==i)$("#leftGripValue").css("left","36px"),$("#resourceLeftGripVal").text(i),e.playbackRate=i;else if(2==i)$("#leftGripValue").css("left","18px"),$("#resourceLeftGripVal").text(i),e.playbackRate=i;else{if(1!=i)return!1;$("#leftGripValue").css("left","0px"),$("#resourceLeftGripVal").text(i),e.playbackRate=i}}else if(.5==(ae/=2))$("#resourceLeftGripVal").text("1/2"),e.playbackRate=ae;else if(.25==ae)$("#resourceLeftGripVal").text("1/4"),e.playbackRate=ae;else if(.125==ae)$("#resourceLeftGripVal").text("1/8"),e.playbackRate=ae;else{if(.0625!=ae)return!1;$("#resourceLeftGripVal").text("1/16"),e.playbackRate=ae}}},resourceListPlayChannelNum:null,resourceVideoPlayFn:function(){if(be=!1,$(this).hasClass("video-resource-play")){$("#videoSource source").attr("src");if($("#resourceListDataTable tbody").find("tr").hasClass("tableHighlight-blue")){if($("#resourceListVideoPlay").prop("title","暂停"),"0"==h){var e=$("#resourceListDataTable tbody tr.tableHighlight-blue td:nth-child(7)")[0].innerHTML;resourceList.resourceListPlayChannelNum=e;var t=$("#resourceListDataTable tbody tr.tableHighlight-blue td:nth-child(7)")[0].innerHTML,r=$("#resourceListDataTable tbody tr.tableHighlight-blue .videoStartTime span").attr("videostarttime"),a=$("#resourceListDataTable tbody tr.tableHighlight-blue .videoEndTime span").attr("videoendtime"),i=$("#videoSource").attr("data-currenttime");if(""!=i&&null!=i&&null!=i){var s="20"+r.substring(0,2)+"/"+r.substring(2,4)+"/"+r.substring(4,6)+" "+r.substring(6,8)+":"+r.substring(8,10)+":"+r.substring(10,12),o=new Date(s).getTime()+1e3*Number(i),l=new Date(o);r=String(l.getYear()).substring(1,3)+(l.getMonth()+1>9?l.getMonth()+1:"0"+(l.getMonth()+1))+(l.getDate()>9?l.getDate():"0"+(l.getDate()+1))+(l.getHours()>9?l.getHours():"0"+l.getHours())+(l.getMinutes()>9?l.getMinutes():"0"+l.getMinutes())+(l.getSeconds()>9?l.getSeconds():"0"+l.getSeconds())}var n=[[r,a,e,t]];resourceList.terminalVideoSub(n,"RESOURCE")}else{var c=$(".tableHighlight-blue").attr("fileName"),d=$(".tableHighlight-blue").attr("ftpName");resourceList.publicVideoPlay(c,d)}$(this).removeClass("video-resource-play").addClass("video-resource-play-check"),$("#resourceListVideoStop").removeClass("video-resource-stop-check").addClass("video-resource-stop")}else{if(!$("#resourceListDataTables tbody").find("tr").hasClass("tableHighlight-blue"))return layer.msg("请选择文件后点击播放或直接双击文件播放"),!1;var u=$(".tableHighlight-blue");c=u.attr("data-fileName"),d=u.attr("data-ftpName");resourceList.publicVideoPlay(c,d,(function(){$("#resourceListVideoPlay").removeClass("video-resource-play").addClass("video-resource-play-check").prop("title","暂停"),$("#resourceListVideoStop").removeClass("video-resource-stop-check").addClass("video-resource-stop")}))}}else if($(this).removeClass("video-resource-play-check").addClass("video-resource-play"),$("#resourceListVideoPlay").prop("title","播放"),"0"==h)if($("#FTPListActive").hasClass("active")){var v=$("#videoSource");v[0].paused||(v[0].pause(),ce=v[0].currentTime)}else{$("#videoSource").attr("data-video-stop",!0),e=$("#resourceListDataTable tbody tr.tableHighlight-blue td:nth-child(7)")[0].innerHTML;var m=$.fn.zTree.getZTreeObj("treeDemoVideoPlayback").getNodeByParam("id",p,null).simcardNumber+"-"+e;if(F.containsKey(m))F.get(m).closeSocket(),F.remove(m);resourceList.videoPlayEnd([e],null)}else $("#videoSource")[0].paused||($("#videoSource")[0].pause(),ce=$("#videoSource")[0].currentTime)},resourceVideoStopFn:function(e){if($("#resourceModule").addClass("slider-module"),document.getElementById("videoSource").src="",document.getElementById("videoSource").load(),document.getElementById("videoSource").removeAttribute("src"),setTimeout((function(){$("#resourceListVideoStop").removeClass("video-resource-stop-check").addClass("video-resource-stop")}),100),$("#resourceListVideoStop").removeClass("video-resource-stop").addClass("video-resource-stop-check"),$("#resourceListVideoPlay").removeClass("video-resource-play-check").addClass("video-resource-play"),$("#resourceListVideoPlay").prop("title","播放"),"0"==h){document.getElementById("videoSource").setAttribute("data-currenttime",0),document.getElementById("videoSource").setAttribute("data-video-stop",!1),ue=[];var t=null;null==e?$("#resourceListDataTable tbody tr.tableHighlight-blue td:nth-child(7)")[0]&&(t=$("#resourceListDataTable tbody tr.tableHighlight-blue td:nth-child(7)")[0].innerHTML):"object"==typeof e?t=e:"string"==typeof e&&(t=[e]),resourceList.videoPlayEnd(t),resourceList.jwVideoClear()}else $("#videoSource").removeAttr("src"),$("#resourceListDataTable tbody").find("tr").removeClass("tableHighlight-blue"),re=1,ae=1,$("#resourceLeftGripVal").text(1),$("#leftGripValue").css("left","0px"),ce=0},resourceVideoFrameFn:function(){if(setTimeout((function(){$("#resourceListVideoFrame").removeClass("video-resource-frame-check").addClass("video-resource-frame")}),100),$("#resourceListVideoFrame").removeClass("video-resource-frame").addClass("video-resource-frame-check"),"0"==h){var e=$("#resourceListDataTable tbody tr.tableHighlight-blue"),t=e.attr("channelNum"),r=e.attr("videoStartTime"),a=e.attr("videoEndTime"),i=$("#videoSource").attr("data-currenttime");if(""!=i&&null!=i&&null!=i){var s="20"+r.substring(0,2)+"/"+r.substring(2,4)+"/"+r.substring(4,6)+" "+r.substring(6,8)+":"+r.substring(8,10)+":"+r.substring(10,12),o=new Date(s).getTime()+1e3*Number(i),l=new Date(o);r=String(l.getYear()).substring(1,3)+(l.getMonth()+1>9?l.getMonth()+1:"0"+(l.getMonth()+1))+(l.getDate()>9?l.getDate():"0"+(l.getDate()+1))+(l.getHours()>9?l.getHours():"0"+l.getHours())+(l.getMinutes()>9?l.getMinutes():"0"+l.getMinutes())+(l.getSeconds()>9?l.getSeconds():"0"+l.getSeconds())}var n=[[r,a,t]];resourceList.terminalVideoSub(n,"RESOURCE"),setTimeout((function(){resourceList.videokeysPlay(t)}),1e3)}},resourceVideoGoingFn:function(){setTimeout((function(){$("#resourceListVideoGoing").removeClass("video-resource-going-check").addClass("video-resource-going")}),100),$("#resourceListVideoGoing").removeClass("video-resource-going").addClass("video-resource-going-check");var e=document.getElementById("videoSource");if("0"==h){var t=Number($("#resourceLeftGripVal").text());16!=t?t*=2:t=1,1==t?($("#leftGripValue").css("left","0"),$("#resourceLeftGripVal").text(t)):2==t?($("#leftGripValue").css("left","18px"),$("#resourceLeftGripVal").text(t)):4==t?($("#leftGripValue").css("left","36px"),$("#resourceLeftGripVal").text(4)):8==t?($("#leftGripValue").css("left","61px"),$("#resourceLeftGripVal").text(8)):16==t&&($("#leftGripValue").css("left","98px"),$("#resourceLeftGripVal").text(16));var r=$("#resourceListDataTable tbody tr.tableHighlight-blue").attr("channelNum");resourceList.videoQuickPlay(r)}else{var a=$("#resourceLeftGripVal").text();if(a.indexOf("/")>-1)if(ae=1,"1/2"==a){var i=1;e.playbackRate=i,$("#resourceLeftGripVal").text("1")}else if("1/4"==a){i=.5;e.playbackRate=i,$("#resourceLeftGripVal").text("1/2")}else if("1/8"==a){i=.25;e.playbackRate=i,$("#resourceLeftGripVal").text("1/4")}else{if("1/16"!=a)return!1;i=.125;e.playbackRate=i,$("#resourceLeftGripVal").text("1/8")}else if(2==(re+=1))e.playbackRate=2,$("#leftGripValue").css("left","18px"),$("#resourceLeftGripVal").text(re);else if(3==re)e.playbackRate=4,$("#leftGripValue").css("left","36px"),$("#resourceLeftGripVal").text(4);else if(4==re)e.playbackRate=8,$("#leftGripValue").css("left","61px"),$("#resourceLeftGripVal").text(8);else if(5==re)e.playbackRate=16,$("#leftGripValue").css("left","98px"),$("#resourceLeftGripVal").text(16);else if(re>5)return re=5,e.playbackRate=16,$("#resourceLeftGripVal").text(16),!1}},listenerResourceVideoFn:function(){re=1,ae=1,$("#resourceLeftGripVal").text(1),$("#leftGripValue").css("left","0px")},videoPlayGetStartTime:function(e){if(null!=g)for(var t=0,r=0;r<g.length;r++){var a=g[r].latitude,i=g[r].longtitude,s=g[r].vtime;if(0!=a&&0!=i){if(s-e>=0)return t;t++}}},coverPolyline:function(e,t){var r=Y.slice(e,t+1);w=new AMap.Polyline({map:xe,path:r,strokeColor:"#ff17e5",strokeOpacity:1,strokeWeight:5,strokeStyle:"solid",strokeDasharray:[10,5],zIndex:51,showDir:!0})},initSelect:function(){var e=$("#findType").val(),t="<option value='0'>终端资源</option>";t+="<option id='ftpServer' value="+e+">"+e+"</option>",$("#type").append(t),resourceList.setAlarm()},ajaxAlarmDataFilter:function(e,t,r){if(L=new resourceList.maps,null!=r&&r.length>0)for(var a=0;a<r.length;a++){var i=r[a].type,s=r[a].name;L.put(i,s)}return r},beforeClickAlarm:function(e,t){var r=$.fn.zTree.getZTreeObj("alarmTree");t.checked?r.checkNode(t,!1,!0,!0):r.checkNode(t,!0,!0,!0)},AlarmTreeAsyncSuccess:function(e,t,r){$.fn.zTree.getZTreeObj("alarmTree").expandAll(!0)},fuzzyOnCheckAlarm:function(e,t,r){var a=$.fn.zTree.getZTreeObj("alarmTree");resourceList.alarmBinaryClear();for(var i=a.getCheckedNodes(!0),s="",o=0;o<i.length;o++)"all"!=i[o].alarmType&&(resourceList.alarmBinary(parseInt(i[o].type),1),s+=i[o].name+",");H="";for(var l=0;l<E.length;l++)H+=E[l];H=parseInt(H,2),37==i.length?$("#alarmSelect").val(r.name):$("#alarmSelect").val(s)},filterAlarmType:function(e){if(0!=e&null!=e&""!=e&0!=H&""!=H&null!=H){for(var t=e.toString(2),r=H.toString(2),a=0;a<t.length;a++)if(1==t.charAt(a)&r.charAt(r.length-t.length+a))return!0;return!1}return 0===H||""===H||null===H},alarmBinary:function(e,t){var r=E.length-(e+1);E.splice(r,1,t)},alarmBinaryClear:function(){E=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},advancedSearchFn:function(){$(".advanced-search-content").is(":hidden")?($(".advanced-search-content").slideDown(),$("#advancedSearchSpan").removeAttr("class").addClass("fa fa-caret-down")):($(".advanced-search-content").slideUp(),$("#advancedSearchSpan").removeAttr("class").addClass("fa fa-caret-up"))},videoScreenSeparated:function(e){var t=e.length;resourceList.videoSeparatedLogoPosition(),1==t?resourceList.videoSeparatedPublicFn(1,e,1,1,null,null):2==t?resourceList.videoSeparatedPublicFn(1,e,2,1,null,null):3==t?resourceList.videoSeparatedPublicFn(1,e,2,2,1,2):4==t?resourceList.videoSeparatedPublicFn(1,e,2,2,null,null):5==t||6==t?5==t?resourceList.videoSeparatedPublicFn(1,e,3,3,2,2):6==t&&resourceList.videoSeparatedPublicFn(1,e,3,2,null,null):7==t||8==t?(7==t||8==t)&&resourceList.videoSeparatedPublicFn(1,e,4,4,3,3):9==t?resourceList.videoSeparatedPublicFn(1,e,3,3,null,null):10==t?resourceList.videoSeparatedPublicFn(1,e,5,5,4,4):11!=t&&12!=t&&13!=t&&14!=t&&15!=t&&16!=t||(11==t||12==t?resourceList.videoSeparatedPublicFn(1,e,4,3,null,null):(13==t||14==t||15==t||16==t)&&resourceList.videoSeparatedPublicFn(1,e,4,4,null,null))},videoSeparatedPublicFn:function(e,t,r,a,i,o){for(var l="",n=e;n<=t.length;n++)l+='<div class="pull-left v-'+Q[n-1]+'"><video autoplay width="100%" height="100%" src="" id="v_'+t[n-1]+'_SourceVideoPlayback"></video></div>';(s.elements.length>0||c.elements.length)&&$("#resourceVideoDefault").addClass("hidden-video"),$("#playListActive").hasClass("active")&&$("#playListVideoDefault").addClass("hidden-video"),$("#resource-video-module div:nth-child(2)").nextAll().remove(),$("#resource-video-module").append(l),resourceList.theListShowsVideoAdaptation(r,a,i,o)},videoSeparatedLogoPosition:function(){$("video").css("background-size","15%")},allSelection:function(){if($(this).is(":checked")){$("input[name='subChk']").prop("checked",!0),$("#playListDataTable tbody").find("tr").show();for(var e=k.keys(),t=0,r=0;r<e.length;r++)"false"==k.get(e[r])&&(t+=1);var a=$("#timeLine").height();$("#timeLine").css("height",a+30*t+"px"),k.clear();for(var i=0;i<e.length;i++){if(k.put(e[i],"true"),9==(o=e[i].length))var s=e[i].substr(o-2,o);else s=e[i].substr(o-1,o);$(".station[data-key="+s+"]").show(),$("#station_"+s).show()}}else{$("input[name='subChk']").removeAttr("checked"),$("#playListDataTable tbody").find("tr").hide();e=k.keys();k.clear();for(i=0;i<e.length;i++){var o;if(k.put(e[i],"false"),9==(o=e[i].length))s=e[i].substr(o-2,o);else s=e[i].substr(o-1,o);$(".station[data-key="+s+"]").hide(),$("#station_"+s).hide();a=$("#timeLine").height();$("#timeLine").css("height",a-30+"px")}}resourceList.videoPlayAreaChange(),resourceList.setMainRightLayout()},singleChoice:function(){var e=$(this).attr("id");if($("#"+e).is(":checked")){if(k.containsKey(e)&&k.remove(e),k.put(e,"true"),9==(t=e.toString().length))r=e.toString().substr(t-2,t);else r=e.toString().substr(t-1,t);$(".station[data-key="+r+"]").show(),$("#station_"+r).show();a=$("#timeLine").height();$("#timeLine").css("height",a+30+"px"),-1==k.values().indexOf("false")&&$("#checkAllVideoPlayback").prop("checked","checked")}else{var t;if(k.containsKey(e)&&k.remove(e),k.put(e,"false"),9==(t=e.toString().length))var r=e.toString().substr(t-2,t);else var r=e.toString().substr(t-1,t);$(".station[data-key="+r+"]").hide(),$("#station_"+r).hide(),-1!=k.values().indexOf("false")&&$("#checkAllVideoPlayback").removeAttr("checked");var a=$("#timeLine").height();$("#timeLine").css("height",a-30+"px")}resourceList.videoPlayAreaChange(),resourceList.setMainRightLayout()},showchekedLable:function(e){var t;for(let r=0;r<W.length;r++){if(W[r]==e)return t=!0;t=!1}return t},getMonitorObjeChannelNumber:function(e){var t=e.concat(X),r=[...new Set(t)];if($("#videoChannelSelection").html(""),e.length>0){for(var a="",i="",s="",o=0;o<r.length;o++)0==o&&(a='<label class="checkbox-inline"><input type="checkbox" id="checkAllVideoPlayback" checked="checked"> 全部</label>'),resourceList.showchekedLable(r[o])?i+='<label class="checkbox-inline"><input type="checkbox" name="subChk" class="channel-checkbox" data-channel="'+r[o]+'"  id="subChk_'+r[o]+'"> 通道'+r[o]+"</label>":i+='<label class="checkbox-inline"><input type="checkbox" name="subChk" class="channel-checkbox" data-channel="'+r[o]+'" checked="checked" id="subChk_'+r[o]+'"> 通道'+r[o]+"</label>",s+='<div class="station" data-key="'+r[o]+'"><table border="0" class="techinian" cellpadding="0" cellspacing="0"><tr><td class="">通道 '+r[o]+"</td></tr></table></div>",k.isEmpty()||k.containsKey("subChk_"+r[o])&&k.remove("subChk_"+r[o]),resourceList.showchekedLable(r[o])?k.put("subChk_"+r[o],"false"):k.put("subChk_"+r[o],"true");$("#videoChannelSelection").append(a),$("#videoChannelSelection").append(i),$("#stationContainer").append('<div class="time-dimension">小时</div>'),$("#stationContainer").append(s),""==$("#stationContainer").html&&null==$("#stationContainer").html||$("#stationContainer").css({"padding-top":"0px"}),$("#checkAllVideoPlayback").on("click",resourceList.allSelection),$("input[name='subChk']").on("click",resourceList.singleChoice),resourceList.setMainRightLayout(),resourceList.hideIntTable()}layer.closeAll()},hideIntTable:function(){var e=$("#NewtimeLine"),t=e.height();for(let r=0;r<T.length;r++)resourceList.showchekedLable(T[r])&&($("#channel_"+T[r]).hide(),$("#channelTitle_"+T[r]).hide(),e.css("height",t-30+"px"),-1!==k.values().indexOf("false")&&$("#checkAll").removeAttr("checked"))},getThisChannelVideoResourceFile:function(e){if(0==e.length){if("0"==h)resourceList.videoPlayEnd(null,null);else{for(var t=0;t<S.elements.length;t++){var r=S.elements[t].key;document.getElementById("v_"+r+"_SourceVideoPlayback").removeAttribute("src")}resourceList.playListResetFn(),oe=!0,te=!0,!0}var a=c.keys();for(t=0;t<a.length;t++){for(var i=c.get(a[t]),s=0;s<i.length;s++)i[s][5]=!1;c.remove(a[t]),c.put(a[t],i)}}else"0"==h?$("#playListVideoPlay").hasClass("video-play-check")&&(resourceList.pluginClickAutoPlay(),resourceList.terminalVideoSub(e)):$("#playListVideoPlay").hasClass("video-play-check")&&resourceList.playFTPVideoDataFn(e),resourceList.videoHandleBtnChange()},playFTPVideoDataFn:function(e){if(te=!0,oe&&(0==$("#resource-video-module div:nth-child(2)").nextAll().length&&resourceList.pluginClickAutoPlay(),te=!1,void 0!==s))for(var t,r,a,i=0;i<e.length;i++){t=e[i][0],r=e[i][1],a=e[i][2];var o=e[i][3]?e[i][3]:a;C=t;for(var l,n,c=s.get(o),d=0;d<c.length;d++)if(t>=c[d][0]&&r<=c[d][1]){l=c[d][0];var u=c[d][1];n=c[d][2],S.containsKey(o)&&S.remove(o),S.put(o,[l,u,n]);break}json_ajax_p("POST","/clbs/realTimeVideo/resource/fileDownload","json",!1,{fileName:n,ftpName:h},(function(e){if(e.success){var r=e.obj.fileName;resourceList.addDomSourcePublicFn(r,o,t,l)}}))}},addDomSourcePublicFn:function(e,t,r,a){if(le.length>0){var i=r-a,s="/clbs/resourceVideo/"+e;$("#v_"+t+"_SourceVideoPlayback").attr("src",s);var o=document.getElementById("v_"+t+"_SourceVideoPlayback");null!=o&&(o.currentTime=i),1!=$("#playLeftGripVal").text()&&resourceList.getVideoPlaybackSpeedFn("v_"+t+"_SourceVideoPlayback","playLeftGripVal",!1),$("#v_"+t+"_SourceVideoPlayback").on("contextmenu",(function(){return!1})),$("#v_"+t+"_SourceVideoPlayback").length>0&&$("#v_"+t+"_SourceVideoPlayback")[0].addEventListener("ended",(function(){$("#v_"+t+"_SourceVideoPlayback").removeAttr("src")}));var l=$("#playLeftGripVal").text();A.setSpeed(l),A.continue(),resourceList.videoHandleBtnChange()}},getVideoPlaybackSpeedFn:function(e,t,r){var a=document.getElementById(e);if(null!=a){var i=$("#"+t).text(),s=null;i.indexOf("/")>-1?"1/2"==i?(a.playbackRate=.5,s=.5):"1/4"==i?(a.playbackRate=.25,s=.25):"1/8"==i?(a.playbackRate=.125,s=.125):"1/16"==i&&(a.playbackRate=.0625,s=.0625):"1"==i?(a.playbackRate=1,s=1):"2"==i?(a.playbackRate=2,s=2):"4"==i?(a.playbackRate=4,s=4):"8"==i?(a.playbackRate=8,s=8):"16"==i&&(a.playbackRate=16,s=16),$("#playListActive").hasClass("active")&&A&&A.setSpeed(s),r&&0!=ce&&(a.currentTime=ce)}},typeSelect:function(){var e=$("#type").val();if(ge=!1,"0"!=e){for(var t=$(".channel-checkbox"),r=[],a=0;a<t.length;a++)r.push($(t[a]).data("channel"));resourceList.resourceVideoStopFn(r),ye=1,be=!1,$("#videoType").attr("disabled","disabled"),$("#alarmBox").hide(),$("#codeSchema").attr("disabled","disabled"),$("#storageType").attr("disabled","disabled"),$("#videoPlayWay").attr("disabled","disabled"),$("#videoResourcePlayWay").attr("disabled","disabled"),$("#FTPListActive").attr("style","display:none")}else ye=0,be=!0,$("#videoType").removeAttr("disabled"),$("#alarmBox").show(),$("#codeSchema").removeAttr("disabled"),$("#storageType").removeAttr("disabled"),$("#videoPlayWay").removeAttr("disabled"),$("#videoResourcePlayWay").removeAttr("disabled"),$("#FTPListActive").attr("style","display:block");if(""!=O)resourceList.inquiry(1);else{resourceList.pageLoadsEmpty(),o.clear(),n.clear(),l.clear(),$("#resourceListDataTable tbody").html("");var i=$(".calendar.calendar3 table caption span").html().replace(/[^0-9]/gi,"-"),s=i.split("-")[0],c=i.split("-")[1];resourceList.buildDate([],[s,c,1])}},monitorCutoverresourceListFn:function(e){var t=e.currentTarget.hash;"#playList"==t?($("#resourceListVideoPlay").hasClass("video-resource-play-check")&&resourceList.resourceVideoStopFn(),$("#resourceVideoDefault").addClass("hidden-video"),$("#resource-video-module .pull-left").length>2?$("#playListVideoDefault").addClass("hidden-video"):$("#playListVideoDefault").removeClass("hidden-video"),$(".video-back-module,.video-play-module").show(),$(".video-resource-module, .video-play-select").hide()):"#resourceList"==t?($("#playListVideoPlay").hasClass("video-play-check")&&resourceList.videoStopFn(),$("#resourceListVideoPlay").hasClass("video-resource-play-check")&&resourceList.resourceVideoStopFn(),$("#resourceVideoDefault").removeClass("hidden-video"),$("#playListVideoDefault").addClass("hidden-video"),$(".video-back-module,.video-play-module").hide(),$(".video-resource-module, .video-play-select").show()):"#ftpList"===t&&($("#playListVideoPlay").hasClass("video-play-check")&&resourceList.videoStopFn(),$("#resourceVideoDefault").removeClass("hidden-video"),$("#playListVideoDefault").addClass("hidden-video"),$(".video-back-module,.video-play-module").hide(),$(".video-resource-module, .video-play-select").show()),$("#scalingBtn").hasClass("fa-chevron-down")&&resourceList.setMainRightLayout()},openVideoChannelVoice:function(){($("video").css("border","none"),$(this).css({border:"3px solid #6dcff6"}),null!=ve)&&(F.containsKey(ve)&&F.get(ve).closeVideoVoice());var e=$(this).attr("data-id");F.containsKey(e)&&(F.get(e).openVideoVoice(),ve=e)},videoSocketSubscribe:function(){setTimeout((function(){resourceList.webSocket&&resourceList.webSocket.conFlag?resourceList.webSocket.subscribe(resourceList.headers,"/user/topic/video/history/day",resourceList.getLastOilDataCallBack,null,null):resourceList.videoSocketSubscribe()}),2e3)},videoDateSocketSubscribe:function(){setTimeout((function(){resourceList.webSocket&&resourceList.webSocket.conFlag?resourceList.webSocket.subscribe(resourceList.headers,"/user/topic/video/history/month",resourceList.getMothDataCallBack,null,null):resourceList.videoDateSocketSubscribe()}),2e3)},historyPlaySubscribe:function(){setTimeout((function(){resourceList.webSocket.conFlag?resourceList.webSocket.subscribe(resourceList.headers,"/user/topic/video/history",(function(e){}),null,null):resourceList.historyPlaySubscribe()}),2e3)},historyControlSubscribe:function(){setTimeout((function(){resourceList.webSocket.conFlag?resourceList.webSocket.subscribe(resourceList.headers,"/user/topic/video/history/control",(function(e){resourceList.historyControlCallBack($.parseJSON(e.body))}),null,null):resourceList.historyControlSubscribe()}),2e3)},historyControlCallBack:function(e){{let r=Number(e.obj.remote),a=e.obj.closeType;if(2===r){if("drag"===a){let r=resourceList.yyMMddHHmmssToDate(e.obj.dragPlaybackTime).getTime()/1e3,a=$("#type").val(),i=resourceList.returnDragVideoTimeList(r,"0"===String(a)?c:s);le=i;var t=document.getElementsByTagName("video");for(let e=0;e<t.length;e++)t[e].src="",t[e].removeAttribute("src");return void(i.length>0&&resourceList.getThisChannelVideoResourceFile(i))}return"resourceChange"===a?void resourceList.getThisChannelVideoResourceFile(_):"keyframes"===a?(resourceList.terminalVideoPlayback(),void setTimeout((function(){resourceList.videokeysPlay()}),1500)):("TIMEOUT"!==a&&A.stop(),void layer.msg("下发成功"))}layer.msg("下发成功"),3!==r&&4!==r||(A.setDirection(3===r?"forward":"backward"),A.setSpeed(resourceList.getVideoActualPlaySpeed(Number(e.obj.forwardOrRewind))))}},getMothDataCallBack:function(e){var t=$.parseJSON(e.body);if(!t.success)return void layer.msg(t.msg);let r=t.obj;if(null==r||""===r)return Ve&&layer.msg("重试或请用高级查询"),void(Ve=!0);layer.closeAll();var a=[],i=t.obj.toString(2),s=i.length;if(s<31)for(var o=0;o<31-s;o++)i="0"+i;Le&&clearTimeout(Le);var l=$(".calendar.calendar3 table caption span").html().replace(/[^0-9]/gi,"-"),n=l.split("-")[0].substring(2,4),c=l.split("-")[1];c.length<2&&(c="0"+c);for(var d=n+c,u=0;u<i.length;u++)1==i.charAt(u)&&(31-u>9?a.push(d+(31-u).toString()):a.push(d+"0"+(31-u).toString()));0==a.length&&layer.msg("暂无数据"),resourceList.buildDate(a,[l.split("-")[0],c,1])},videoPlayBack:function(e){var t,r,a;if(r=$("#resourceListActive").hasClass("active")?Number($("#resourceLeftGripVal").text()):Number($("#playLeftGripVal").text()),null==e){var i=resourceList.stringCallBack();t=i[0],a=i[1]}else t=p,a=e;resourceList.sendForwardInstruct(t,a,resourceList.getVideoPlaySpeed(r))},videoStopPlay:function(e){var t,r;if(null==e){var a=resourceList.stringCallBack();t=a[0],r=a[1]}else t=p,r=e;resourceList.sendPauseInstruct(t,r)},stringCallBack:function(){for(var e="",t="",r="",a=c.elements,i=0;i<a.length;i++){if("true"==k.get("subChk_"+a[i].key))e+=p+",",a[i].newKey?t+=a[i].newKey+",":t+=a[i].key+",",r+=c.get(a[i].key)[2]+","}return[e=e.substring(0,e.length-1),t=t.substring(0,t.length-1),r=r.substring(0,r.length-1)]},sendStopInstruct:function(e,t,r,a){let i={obj:{vehicleIds:e,channelNums:t,remote:2,forwardOrRewind:0,dragPlaybackTime:a,closeType:r}};K.forEach(e=>{e.cmdCloseVideo(),e.closeSocket()}),resourceList.historyControlCallBack(i)},sendPauseInstruct:function(e,t){let r={vehicleIds:e,channelNums:t,remote:1,forwardOrRewind:0,dragPlaybackTime:0};resourceList.webSocket.send("/app/video/history/pause",resourceList.headers,r)},sendStartInstruct:function(e,t){let r={vehicleIds:e,channelNums:t,remote:0,forwardOrRewind:0,dragPlaybackTime:0};resourceList.webSocket.send("/app/video/history/start",resourceList.headers,r)},sendForwardInstruct:function(e,t,r){let a={obj:{vehicleIds:e,channelNums:t,remote:3,forwardOrRewind:r,dragPlaybackTime:0}};K.forEach(e=>{e.cmdForwardPlay(r)}),resourceList.historyControlCallBack(a)},sendBackwardInstruct:function(e,t,r){let a={obj:{vehicleIds:e,channelNums:t,remote:4,forwardOrRewind:r,dragPlaybackTime:0}};K.forEach(e=>{e.cmdForwardPlay(r)}),resourceList.historyControlCallBack(a)},sendKeyframeInstruct:function(e,t){let r={vehicleIds:e,channelNums:t,remote:6,forwardOrRewind:0,dragPlaybackTime:0};resourceList.webSocket.send("/app/video/history/keyframe",resourceList.headers,r)},videoStartPlay:function(e){var t,r;if(null==e){var a=resourceList.stringCallBack();t=a[0],r=a[1]}else t=p,r=e;A.continue(),resourceList.sendStartInstruct(t,r)},videoQuickPlay:function(e){var t,r,a;if(r=$("#resourceListActive").hasClass("active")?Number($("#resourceLeftGripVal").text()):Number($("#playLeftGripVal").text()),null==e){var i=resourceList.stringCallBack();t=i[0],a=i[1]}else t=p,a=e;resourceList.sendForwardInstruct(t,a,resourceList.getVideoPlaySpeed(r))},videokeysPlay:function(e){var t,r;if(null==e){var a=resourceList.stringCallBack();t=a[0],r=a[1]}else t=p,r=e;resourceList.sendKeyframeInstruct(t,r)},videoPlayEnd:function(e,t){var r="",a="";if(null==e){var i=resourceList.stringCallBack();r=i[0],a=i[1]}else{for(var s=0;s<e.length;s++)r+=p+",",a+=e[s]+",";r=r.substring(0,r.length-1),a=a.substring(0,a.length-1)}K.forEach(e=>{e.cmdCloseVideo()}),resourceList.sendStopInstruct(r,a,t),"TIMEOUT"==!t&&($("#resource-video-module div:nth-child(2)").nextAll().remove(),$("#playListActive").hasClass("active")?$("#playListVideoDefault").removeClass("hidden-video"):$("#playListVideoDefault").addClass("hidden-video"))},resourceSelected:function(e){$(e).hasClass("tableHighlight-blue")||($("#resourceListDataTable tbody").find("tr").removeClass("tableHighlight-blue"),$(e).addClass("tableHighlight-blue"),re=1,ae=1,$("#resourceLeftGripVal").text(1),$("#leftGripValue").css("left","0px"),"videoSource"==$("#videoSource").attr("name")&&setTimeout((function(){var e=$("#resourceListDataTable tbody tr.tableHighlight-blue").attr("channelNum");resourceList.videoStopPlay(e)}),500))},ondblclickDevice:function(e){var t=$(e);$("#resourceListActive").hasClass("active")&&$("#resourceListVideoPlay").hasClass("video-resource-play-check")&&resourceList.resourceVideoStopFn(resourceList.resourceListPlayChannelNum),Se=!0,document.getElementById("videoSource").setAttribute("data-currenttime",0),document.getElementById("videoSource").setAttribute("data-video-stop",!1);var r=t.context.children[6].innerText;resourceList.resourceListPlayChannelNum=r;var a=t.context.children[6].innerText,i=t.context.children[7].innerHTML.toString().slice(22,34),s=t.context.children[8].innerHTML.toString().slice(20,32);if(0==ue.length){ue=[r,i,s,a];var o=[[i,s,r,a]];resourceList.terminalVideoSub(o,"RESOURCE")}else{$("#leftGripValue").css("left","0px"),$("#resourceLeftGripVal").text(1),ue=[r,i,s,a];o=[[i,s,r,a]];resourceList.terminalVideoSub(o,"RESOURCE")}$("#resourceListVideoPlay").removeClass("video-resource-play").addClass("video-resource-play-check").prop("title","暂停")},timestampTransform:function(e){var t=new Date(1e3*e);return String(t.getFullYear()).substring(2,4)+(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+(t.getDate()<10?"0"+t.getDate():t.getDate())+(t.getHours()<10?"0"+t.getHours():t.getHours())+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())+(t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds())},getTimeFormat:function(e){var t=new Date(1e3*e);return t.getFullYear()+"/"+(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"/"+(t.getDate()<10?"0"+t.getDate():t.getDate())+" "+(t.getHours()<10?"0"+t.getHours():t.getHours())+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())+":"+(t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds())},resourceTovideo:function(){var t=!1,r=$("#permissionUrls").val();if(null!=r&&null!=r&&r.split(",").indexOf("/realTimeVideo/video/list")>-1)return t=!0,!0;return t||layer.msg("无操作权限，请联系管理员"),e.preventDefault(),e.stopPropagation(),!1},jwVideoClear:function(){for(var e=$("#videoBackRightTop video"),t=0;t<e.length;t++)e[t].removeAttribute("src");var r=F.values();F.clear();for(var a=0;a<r.length;a++)r[a].closeSocket()},getIco:function(){json_ajax_p("POST","/clbs/realTimeVideo/resource/getIco","json",!0,{vehicleId:p},(function(e){U=e}))},getVideoPlaySpeed:function(e){var t;switch(e){case 1:t=1;break;case 2:t=2;break;case 4:t=3;break;case 8:t=4;break;case 16:t=5}return t},getVideoActualPlaySpeed:function(e){var t;switch(e){case 1:t=1;break;case 2:t=2;break;case 3:t=4;break;case 4:t=8;break;case 5:t=16}return t},setMainRightLayout:function(){var e=$("#videoRightBottom").height()+10+"px";$("#videoBackRightTop").css("height","calc(100% - "+e+")")},videoPlayAreaChange:function(){for(var e=[],t=0;t<T.length;t++)"true"==k.get("subChk_"+T[t])&&e.push(T[t]);e=e.join(","),A.setChannels(e)},channelHasChecked:function(){for(var e=!1,t=k.values(),r=0;r<t.length;r++)if("true"==t[r]){e=!0;break}return e},videoHandleBtnChange:function(){$("#playListVideoBack").off("click").on("click",resourceList.videoBackFn),$("#playListVideoStop").off("click").on("click",resourceList.videoStopFn),$("#playListVideoGoing").off("click").on("click",resourceList.videoGoingFn),"0"==h&&($("#playListVideoFrame").off("click").on("click",resourceList.videoFrameFn),$("#playListVideoFrame").css("cursor","pointer")),$("#playListVideoStop,#playListVideoBack,#playListVideoGoing").css("cursor","pointer")},getFtpVideoList:function(){for(var e=$("#h").text(),t=$("#m").text(),r=$("#s").text(),a=x+" "+e+t+r,i=resourceList.timestamp(a),o=[],l=0;l<T.length;l++)if("true"===k.get("subChk_"+T[l])){var n=s.get(T[l]);if(void 0!==n)for(var c=0;c<n.length;c++)i>=n[c][0]&&i<=n[c][1]&&o.push([i,n[c][1],n[c][n[c].length-1],T[l]])}return o},_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,r,a,i,s,o,l,n="",c=0;for(e=resourceList._utf8_encode(e);c<e.length;)i=(t=e.charCodeAt(c++))>>2,s=(3&t)<<4|(r=e.charCodeAt(c++))>>4,o=(15&r)<<2|(a=e.charCodeAt(c++))>>6,l=63&a,isNaN(r)?o=l=64:isNaN(a)&&(l=64),n=n+this._keyStr.charAt(i)+this._keyStr.charAt(s)+this._keyStr.charAt(o)+this._keyStr.charAt(l);return n},_utf8_encode:function(e){e=e.replace(/rn/g,"n");for(var t="",r=0;r<e.length;r++){var a=e.charCodeAt(r);a<128?t+=String.fromCharCode(a):a>127&&a<2048?(t+=String.fromCharCode(a>>6|192),t+=String.fromCharCode(63&a|128)):(t+=String.fromCharCode(a>>12|224),t+=String.fromCharCode(a>>6&63|128),t+=String.fromCharCode(63&a|128))}return t},all:function(){$("#lkywTreeLoading i").css("visibility","visible"),$("#lkywTreeLoading span").text("加载中，请稍后"),$("#lkywTreeLoading").show(),$("#emptyNotification").hide(),Ie="all",resourceList.resourceListTree()},online:function(){$("#lkywTreeLoading i").css("visibility","visible"),$("#lkywTreeLoading span").text("加载中，请稍后"),$("#lkywTreeLoading").show(),$("#emptyNotification").hide(),Ie="online",resourceList.resourceListTree()},offline:function(){$("#lkywTreeLoading i").css("visibility","visible"),$("#lkywTreeLoading span").text("加载中，请稍后"),$("#lkywTreeLoading").show(),$("#emptyNotification").hide(),Ie="offline",resourceList.resourceListTree()},ftpListGet:function(){var e=$("#searchStartTime").val(),t=$("#searchEndTime").val();if(""!==e&&""!==t){var r=e,a=t,i=new RegExp("-","g");if(r=r.replace(i,"/"),a=a.replace(i,"/"),(r=new Date(parseInt(Date.parse(r),10)).getTime())>(a=new Date(parseInt(Date.parse(a),10)).getTime()))return layer.msg("开始时间应在结束时间之前"),!1;if(0!==type){if(a-r>26784e5)return layer.msg("查询FTP视频信息时间范围不能大于一个月"),!1}else Le=setTimeout((function(){layer.msg("终端无反馈,请重试")}),6e4)}var s=O,o=R,l=H,n=$("#channelNum").val(),c=$("#videoType").val(),d=$("#codeSchema").val(),u=$("#storageType").val(),p=$(".calendar.calendar3 table caption span").html().replace(/[^0-9]/gi,"-"),h=p.split("-")[0].substring(2,4),v=p.split("-")[1];v.length<2&&(v="0"+v);var m=h+v;if(1===Me){var f=$("#thisDateOf").text();e=f+" 00:00:00",t=f+" 23:59:59"}""===(l=H)&&(l=0);json_ajax_p("POST","/clbs/realTimeVideo/resource/getResource","json",!0,{vehicleId:s,brand:o,alarmType:l,channlNumer:n,startTime:e,endTime:t,type:"FTP服务器",msgSN:void 0,videoType:c,streamType:d,storageType:u,ftpName:"FTP服务器",date:m},resourceList.inquiryNewBack)}},window.videoPlaybackChoseTreeNode=function(e){e&&resourceList.searchVehicleTree(e.name,(function(){var t=$.fn.zTree.getZTreeObj("treeDemoVideoPlayback"),r=t.getNodeByParam("id",e.id,null);r&&!r.checked&&t.checkNode(r,!0,!0,!0)}))},window.videoPlaybackInit=function(e,t,r,a,i,s){var o,l;($("#findType").val(t),resourceList.videoRequestUrl=r,resourceList.videoResourcePort=a,resourceList.getOnlineArray=i,resourceList.headers={access_token:e},resourceList.webSocket=Object(B.a)({access_token:e}),resourceList.init(s),resourceList.searchTimeLoad(),resourceList.initSelect(),$("#chooseAll_videoPlayback").on("click",resourceList.all),$("#online_videoPlayback").on("click",resourceList.online),$("#chooseMissLine_videoPlayback").on("click",resourceList.offline),$("input").inputClear().on("onClearEvent",(function(e,t){"groupSelectVideoPlayback"==t.id&&("Microsoft Internet Explorer"==navigator.appName&&$(".resource-video-input").append('<div class="input-placeholder">请选择监控对象</div>'),O="",resourceList.resourceListTree())})),$("video").on("contextmenu",(function(){return!1})),$("#resourceListSilder").nstSlider({left_grip_selector:".leftGrip",rounding:{0:"0",1:"2",2:"4",4:"6",8:"10",16:"16"},value_changed_callback:function(e,t){$("#resourceLeftGripVal").text(t),1==t?re=1:2==t?re=2:4==t?re=3:8==t?re=4:16==t&&(re=5),ce=$("#videoSource")[0].currentTime,"0"!=h&&resourceList.getVideoPlaybackSpeedFn("videoSource","resourceLeftGripVal",!0)}}),$("#inquiry").on("click",resourceList.showQueryInfo),$("#advancedSubmit").on("click",(function(){if(new Date($("#searchEndTime").val()).getTime()-new Date($("#searchStartTime").val()).getTime()>864e5)return layer.msg("查询时间范围不能大于一天"),!1;ge=!0,be=!0,Ve=!1,Me=2,"0"==$("#type").val()?(resourceList.getResourceData($("#searchStartTime").val(),$("#searchEndTime").val()),resourceList.inquiry(2),me=$("#searchStartTime").val(),fe=$("#searchEndTime").val()):resourceList.inquiry(2)})),"Microsoft Internet Explorer"==navigator.appName)?"MSIE9.0"==navigator.appVersion.split(";")[1].replace(/[ ]/g,"")?$("#groupSelectVideoPlayback").on("focus",(function(){l=setInterval((function(){var e=$("#groupSelectVideoPlayback").val();""==e?resourceList.resourceListTree():resourceList.searchVehicleTree(e)}),500)})).on("blur",(function(){clearInterval(l)})):($("#groupSelectVideoPlayback").removeAttr("placeholder"),$(".resource-video-input").append('<div class="input-placeholder">请选择监控对象</div>'),$("#groupSelectVideoPlayback").on("input propertychange",(function(e){$(".input-placeholder").remove(),void 0!==o&&clearTimeout(o),o=setTimeout((function(){var e=$("#groupSelectVideoPlayback").val();""==e?($(".resource-video-input").append('<div class="input-placeholder">请选择监控对象</div>'),resourceList.resourceListTree()):($(".input-placeholder").remove(),resourceList.searchVehicleTree(e))}),500)}))):$("#groupSelectVideoPlayback").on("input propertychange",(function(e){void 0!==o&&clearTimeout(o),o=setTimeout((function(){O="";var e=$("#groupSelectVideoPlayback").val();""==e?resourceList.resourceListTree():resourceList.searchVehicleTree(e)}),500)}));$("#FTPListActive").on("click",(function(){resourceList.ftpListGet()})),$("#playListActive").on("click",(function(){setTimeout(()=>{resourceList.setMainRightLayout()},1e3)})),$("#resourceListActive").on("click",(function(){setTimeout(()=>{resourceList.setMainRightLayout()},1e3)})),$("#groupSelectVideoPlayback").on("click",resourceList.showMenu),$("#alarmSelectSpan,#alarmSelect").on("click",resourceList.showMenuAlarm),$("#mapAllShow").on("click",resourceList.mapAllShowFn),$("#videoBackScalingBtn").on("click",resourceList.tabHideDownFn),$("#playListVideoPlay").on("click",resourceList.videoPlayFn),$("#playListVideoFrame,#playListVideoStop,#playListVideoBack,#playListVideoGoing").css("cursor","not-allowed"),$("#resourceListVideoFrame").css("cursor","not-allowed"),$("#resourceListVideoPlay").on("click",resourceList.resourceVideoPlayFn),$("#resourceListVideoBack").on("click",resourceList.resourceVideoBackFn),$("#resourceListVideoStop").on("click",(function(){resourceList.resourceVideoStopFn()})),$("#resourceListVideoGoing").on("click",resourceList.resourceVideoGoingFn),document.getElementById("videoSource").addEventListener("ended",resourceList.listenerResourceVideoFn),$("#advancedSearch,#advancedSearchSpan").on("click",resourceList.advancedSearchFn),$('.video-right-bottom a[data-toggle="tab"]').on("shown.bs.tab",resourceList.monitorCutoverresourceListFn),$("#type").on("change",resourceList.typeSelect),$("#resourceTovideo").on("click",resourceList.resourceTovideo),$(".laydate-btns-clear").css({display:"none"}),$("#searchStartTime, #searchEndTime").focus((function(){0!=$("#type").val()?$(".laydate-btns-clear").css({display:"none"}):$(".laydate-btns-clear").css({display:"inline-block"})})),$("#sendSubmit").click(resourceList.submit),$(window).resize((function(){for(var e=0,t=0;t<k.values().length;t++)"true"===k.values()[t]&&(e+=1);resourceList.thisListShowsVideoScreenSeparated(e)}))};a(222);var _e=function(e,t,r,a){return new(r||(r=Promise))((function(i,s){function o(e){try{n(a.next(e))}catch(e){s(e)}}function l(e){try{n(a.throw(e))}catch(e){s(e)}}function n(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,l)}n((a=a.apply(e,t||[])).next())}))},Oe=function(e,t){var r,a,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function l(s){return function(l){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(i=2&s[0]?a.return:s[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,s[1])).done)return i;switch(a=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,a=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],a=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},Re=function(){function e(e,t){this.dependency=t,this.setOption(e)}return e.prototype.setOption=function(e){return _e(this,void 0,void 0,(function(){return Oe(this,(function(t){switch(t.label){case 0:return this.option=e,this.state={$origin:null,$dom:{$all:null,$online:null,$offline:null},data:{}},this.state.$origin=$(e.selector),[4,this.initHtml()];case 1:return t.sent(),this.bindEvent(),[2]}}))}))},e.prototype.update=function(e){window.videoPlaybackChoseTreeNode(e)},e.prototype.initHtml=function(){return _e(this,void 0,void 0,(function(){var e;return Oe(this,(function(t){return e=$(I.a),this.state.$origin.empty(),this.state.$origin.append(e),this.state.$dom.$all=e.find("#chooseAll_videoPlayback"),this.state.$dom.$online=e.find("#online_videoPlayback"),this.state.$dom.$offline=e.find("#chooseMissLine_videoPlayback"),this.updateOnlineNumber(),[2]}))}))},e.prototype.bindEvent=function(){var e=this.dependency.get("data");e.on("onTreeOnlineSizeChange",this.updateOnlineNumber.bind(this));var t=e.get("access_token"),r=e.get("ftpName"),a=e.get("videoUrl"),i=e.get("resourcePort");window.videoPlaybackInit(t,r,a,i,this.getOnlineArray.bind(this),this.option)},e.prototype.destory=function(){this.state.$origin.empty()},e.prototype.updateOnlineNumber=function(){var e=this.dependency.get("data"),t=e.get("treeAllSize"),r=e.get("treeOnlineSize"),a=e.get("treeOfflineSize");this.state.$dom.$all.find(".value-span").html("("+t.toString()+")"),this.state.$dom.$online.find(".value-span").html("("+r.toString()+")"),this.state.$dom.$offline.find(".value-span").html("("+a.toString()+")")},e.prototype.getOnlineArray=function(){var e=this.dependency.get("data"),t=e.get("runVidArray"),r=e.get("stopVidArray");return t||(t=[]),r||(r=[]),t.concat(r)},e}();r.default=Re}}]);